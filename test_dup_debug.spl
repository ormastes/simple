#!/usr/bin/env simple

use app.duplicate_check.config.{load_config, default_config}
use app.duplicate_check.detector.{collect_files}
use app.io.mod.{cli_get_args, exit}

fn main():
    val args = cli_get_args()

    print "=== DEBUG: cli_get_args() ==="
    print "Total args: {args.len()}"
    var i = 0
    while i < args.len():
        print "  args[{i}] = '{args[i]}'"
        i = i + 1

    var cmd_args = []
    i = 2
    while i < args.len():
        cmd_args = cmd_args + [args[i]]
        i = i + 1

    print ""
    print "=== DEBUG: cmd_args (from index 2) ==="
    print "Total cmd_args: {cmd_args.len()}"
    i = 0
    while i < cmd_args.len():
        print "  cmd_args[{i}] = '{cmd_args[i]}'"
        i = i + 1

    val target_path = if cmd_args.len() > 0 and not cmd_args[0].starts_with("-"):
        cmd_args[0]
    else:
        "src/"

    print ""
    print "=== DEBUG: target_path ==="
    print "target_path = '{target_path}'"

    val config = default_config()
    val files = collect_files(target_path, config)

    print ""
    print "=== DEBUG: Files collected ==="
    print "Total files: {files.len()}"
    if files.len() == 0:
        print "ERROR: No files found!"
        exit(1)

    print "First 10 files:"
    i = 0
    while i < 10 and i < files.len():
        print "  {files[i]}"
        i = i + 1
