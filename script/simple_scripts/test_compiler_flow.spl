# Test the compiler flow directly
# This tests if HIR modules are preserved through compilation phases

import compiler.*

fn main():
    print "=== Testing Compiler Flow ==="
    print ""

    # Create minimal options
    val options = CompileOptions(
        mode: CompileMode.Aot,
        input_files: ["simple/compiler/lexer.spl"],
        output_file: Some("/tmp/test_out"),
        optimize: false,
        debug_info: true,
        verbose: false,
        log_level: 4,
        profile: "test"
    )

    # Create driver
    val driver = CompilerDriver.create(options)

    # Try to compile
    print "Starting compilation..."
    val result = driver.compile()

    match result:
        case CompileResult.Success(_):
            print "✓ Compilation succeeded!"

        case CompileResult.ParseError(errors):
            print "✗ Parse error:"
            for err in errors:
                print "  {err}"

        case CompileResult.TypeError(errors):
            print "✗ Type error:"
            for err in errors:
                print "  {err}"

        case CompileResult.CodegenError(msg):
            print "✗ Codegen error: {msg}"

        case CompileResult.RuntimeError(msg):
            print "✗ Runtime error: {msg}"

        case _:
            print "✗ Unknown error"
