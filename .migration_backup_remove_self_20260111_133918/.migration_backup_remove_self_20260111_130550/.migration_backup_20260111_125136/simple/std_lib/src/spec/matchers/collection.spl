# Collection Matchers - include, be_empty
# Array, List, Dict, Set matchers

import matchers.{Matcher, MatchResult}

# Include matcher: expect [1,2,3] to include 2
class IncludeMatcher<T>:
    expected: T
    
    fn new(expected: T) -> IncludeMatcher<T>:
        return IncludeMatcher { expected: expected }

impl<T, C> Matcher<C> for IncludeMatcher<T> where C: Collection<T>:
    fn match(actual: C) -> MatchResult:
        if actual.contains(self.expected):
            return MatchResult.success()
        else:
            return MatchResult.failure(
                "Expected ${actual} to include ${self.expected}"
            )

fn include<T>(expected: T) -> IncludeMatcher<T>:
    return IncludeMatcher.new(expected)

# Empty matcher: expect [] to be_empty
class BeEmptyMatcher:
    fn new() -> BeEmptyMatcher:
        return BeEmptyMatcher {}

impl<C> Matcher<C> for BeEmptyMatcher where C: Collection<Any>:
    fn match(actual: C) -> MatchResult:
        if actual.is_empty():
            return MatchResult.success()
        else:
            return MatchResult.failure(
                "Expected collection to be empty but it has ${actual.len()} items"
            )

fn be_empty() -> BeEmptyMatcher:
    return BeEmptyMatcher.new()

# Have length/size matcher: expect [1,2,3] to have_length 3
class HaveLengthMatcher:
    expected_length: Int

    fn new(expected_length: Int) -> HaveLengthMatcher:
        return HaveLengthMatcher { expected_length: expected_length }

impl<C> Matcher<C> for HaveLengthMatcher where C: Collection<Any>:
    fn match(actual: C) -> MatchResult:
        let actual_len = actual.len()
        if actual_len == self.expected_length:
            return MatchResult.success()
        else:
            return MatchResult.failure(
                "Expected length ${self.expected_length} but got ${actual_len}"
            )

fn have_length(expected_length: Int) -> HaveLengthMatcher:
    return HaveLengthMatcher.new(expected_length)

# Alias for have_length
fn have_size(expected_length: Int) -> HaveLengthMatcher:
    return HaveLengthMatcher.new(expected_length)
