# Common I/O Error Types
# Shared across all host variants (async_nogc_mut, async_gc_immut, etc.)

use core.traits.*

# I/O Error type - common across all I/O operations
pub enum IoError:
    NotFound
    PermissionDenied
    AlreadyExists
    InvalidPath
    IsDirectory
    NotDirectory
    DirectoryNotEmpty
    ReadOnly
    FileTooLarge
    OutOfSpace
    Interrupted
    TimedOut
    ConnectionRefused
    ConnectionReset
    BrokenPipe
    WouldBlock
    InvalidData
    UnexpectedEof
    WriteZero
    Other(str)

impl IoError:
    pub fn message(self) -> str:
        match self:
            case NotFound: "file or directory not found"
            case PermissionDenied: "permission denied"
            case AlreadyExists: "file or directory already exists"
            case InvalidPath: "invalid path"
            case IsDirectory: "is a directory"
            case NotDirectory: "not a directory"
            case DirectoryNotEmpty: "directory not empty"
            case ReadOnly: "read-only file system"
            case FileTooLarge: "file too large"
            case OutOfSpace: "out of disk space"
            case Interrupted: "operation interrupted"
            case TimedOut: "operation timed out"
            case ConnectionRefused: "connection refused"
            case ConnectionReset: "connection reset"
            case BrokenPipe: "broken pipe"
            case WouldBlock: "operation would block"
            case InvalidData: "invalid data"
            case UnexpectedEof: "unexpected end of file"
            case WriteZero: "write returned zero bytes"
            case Other(msg): msg

    pub fn to_string(self) -> str:
        """Convert error to string.

        Returns:
            Error name

        Example:
            IoError::NotFound.to_string()  # → "not-found"
        """
        match self:
            case NotFound: "not-found"
            case PermissionDenied: "permission-denied"
            case AlreadyExists: "already-exists"
            case InvalidPath: "invalid-path"
            case IsDirectory: "is-directory"
            case NotDirectory: "not-directory"
            case DirectoryNotEmpty: "directory-not-empty"
            case ReadOnly: "read-only"
            case FileTooLarge: "file-too-large"
            case OutOfSpace: "out-of-space"
            case Interrupted: "interrupted"
            case TimedOut: "timed-out"
            case ConnectionRefused: "connection-refused"
            case ConnectionReset: "connection-reset"
            case BrokenPipe: "broken-pipe"
            case WouldBlock: "would-block"
            case InvalidData: "invalid-data"
            case UnexpectedEof: "unexpected-eof"
            case WriteZero: "write-zero"
            case Other(_): "other"

    pub fn description(self) -> str:
        """Get error description.

        Returns:
            Human-readable description
        """
        self.message()

    pub fn is_file_error(self) -> bool:
        """Check if this is a file system error.

        Returns:
            True for file/directory errors
        """
        match self:
            case NotFound: true
            case PermissionDenied: true
            case AlreadyExists: true
            case InvalidPath: true
            case IsDirectory: true
            case NotDirectory: true
            case DirectoryNotEmpty: true
            case ReadOnly: true
            case FileTooLarge: true
            case OutOfSpace: true
            case _: false

    pub fn is_network_error(self) -> bool:
        """Check if this is a network error.

        Returns:
            True for network-related errors
        """
        match self:
            case ConnectionRefused: true
            case ConnectionReset: true
            case BrokenPipe: true
            case TimedOut: true
            case _: false

    pub fn is_timeout_error(self) -> bool:
        """Check if this is a timeout error.

        Returns:
            True for timeout
        """
        match self:
            case TimedOut: true
            case _: false

    pub fn is_recoverable(self) -> bool:
        """Check if error might be recoverable.

        Returns:
            True if retry might succeed
        """
        match self:
            case NotFound: false
            case PermissionDenied: false
            case AlreadyExists: false
            case InvalidPath: false
            case IsDirectory: false
            case NotDirectory: false
            case DirectoryNotEmpty: false
            case ReadOnly: false
            case FileTooLarge: false
            case OutOfSpace: false
            case Interrupted: true
            case TimedOut: true
            case ConnectionRefused: true
            case ConnectionReset: true
            case BrokenPipe: false
            case WouldBlock: true
            case InvalidData: false
            case UnexpectedEof: false
            case WriteZero: false
            case Other(_): false

    pub fn is_fatal(self) -> bool:
        """Check if error is fatal.

        Returns:
            True for unrecoverable errors
        """
        not self.is_recoverable()

    # =========================================================================
    # Helper Methods
    # =========================================================================

    pub fn is_not_found(self) -> bool:
        """Check if error is NotFound.

        Returns:
            True if not found
        """
        match self:
            case NotFound: true
            case _: false

    pub fn is_permission_denied(self) -> bool:
        """Check if error is PermissionDenied.

        Returns:
            True if permission denied
        """
        match self:
            case PermissionDenied: true
            case _: false

    pub fn is_already_exists(self) -> bool:
        """Check if error is AlreadyExists.

        Returns:
            True if already exists
        """
        match self:
            case AlreadyExists: true
            case _: false

    pub fn is_invalid_path(self) -> bool:
        """Check if error is InvalidPath.

        Returns:
            True if invalid path
        """
        match self:
            case InvalidPath: true
            case _: false

    pub fn is_directory(self) -> bool:
        """Check if error is IsDirectory.

        Returns:
            True if is directory
        """
        match self:
            case IsDirectory: true
            case _: false

    pub fn is_not_directory(self) -> bool:
        """Check if error is NotDirectory.

        Returns:
            True if not directory
        """
        match self:
            case NotDirectory: true
            case _: false

    pub fn is_read_only(self) -> bool:
        """Check if error is ReadOnly.

        Returns:
            True if read only
        """
        match self:
            case ReadOnly: true
            case _: false

    pub fn is_would_block(self) -> bool:
        """Check if error is WouldBlock.

        Returns:
            True if would block
        """
        match self:
            case WouldBlock: true
            case _: false

    pub fn is_interrupted(self) -> bool:
        """Check if error is Interrupted.

        Returns:
            True if interrupted
        """
        match self:
            case Interrupted: true
            case _: false

    pub fn is_connection_refused(self) -> bool:
        """Check if error is ConnectionRefused.

        Returns:
            True if connection refused
        """
        match self:
            case ConnectionRefused: true
            case _: false

    pub fn is_connection_reset(self) -> bool:
        """Check if error is ConnectionReset.

        Returns:
            True if connection reset
        """
        match self:
            case ConnectionReset: true
            case _: false

    pub fn is_broken_pipe(self) -> bool:
        """Check if error is BrokenPipe.

        Returns:
            True if broken pipe
        """
        match self:
            case BrokenPipe: true
            case _: false

    pub fn is_unexpected_eof(self) -> bool:
        """Check if error is UnexpectedEof.

        Returns:
            True if unexpected EOF
        """
        match self:
            case UnexpectedEof: true
            case _: false

    pub fn is_invalid_data(self) -> bool:
        """Check if error is InvalidData.

        Returns:
            True if invalid data
        """
        match self:
            case InvalidData: true
            case _: false

    pub fn is_out_of_space(self) -> bool:
        """Check if error is OutOfSpace.

        Returns:
            True if out of space
        """
        match self:
            case OutOfSpace: true
            case _: false

    pub fn is_connection_error(self) -> bool:
        """Check if error is connection-related.

        Returns:
            True for connection errors
        """
        match self:
            case ConnectionRefused: true
            case ConnectionReset: true
            case BrokenPipe: true
            case _: false

    pub fn is_transient(self) -> bool:
        """Check if error is transient (temporary).

        Returns:
            True for temporary errors
        """
        match self:
            case Interrupted: true
            case WouldBlock: true
            case TimedOut: true
            case _: false

    pub fn is_retryable(self) -> bool:
        """Check if operation should be retried.

        Returns:
            True if retry might succeed
        """
        return self.is_recoverable()

    pub fn is_path_error(self) -> bool:
        """Check if error is path-related.

        Returns:
            True for path errors
        """
        match self:
            case NotFound: true
            case InvalidPath: true
            case IsDirectory: true
            case NotDirectory: true
            case _: false

    pub fn is_data_error(self) -> bool:
        """Check if error is data-related.

        Returns:
            True for data errors
        """
        match self:
            case InvalidData: true
            case UnexpectedEof: true
            case WriteZero: true
            case _: false

    pub fn is_space_error(self) -> bool:
        """Check if error is space-related.

        Returns:
            True for disk space errors
        """
        match self:
            case OutOfSpace: true
            case FileTooLarge: true
            case _: false

    pub fn summary(self) -> str:
        """Get summary of I/O error.

        Returns:
            Human-readable summary

        Example:
            IoError::NotFound.summary()
            # → "IoError: not-found (file system, fatal)"
        """
        let name = self.to_string()
        let msg = self.message()
        let props = []
        if self.is_file_error():
            props.push("file system")
        if self.is_network_error():
            props.push("network")
        if self.is_transient():
            props.push("transient")
        if self.is_retryable():
            props.push("retryable")
        else:
            props.push("fatal")
        let props_str = if props.len() > 0: " ({props.join(\", \")})" else: ""
        return "IoError: {name}{props_str}"

impl Display for IoError:
    fn fmt(self) -> str:
        self.message()

impl Error for IoError
