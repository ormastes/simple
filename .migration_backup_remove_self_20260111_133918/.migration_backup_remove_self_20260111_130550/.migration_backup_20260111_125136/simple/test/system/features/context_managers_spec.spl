import std.spec

# Feature Test: Context Managers (BDD)
describe "Context manager alias binding":
    context "with statement":
        it "binds alias even when parser sees cast-style `as`":
            class Resource:
                value: int

                fn __enter__():
                    return self.value + 10

                fn __exit__(exc):
                    pass

            let captured = 0
            with Resource(5) as alias:
                captured = alias

            expect(captured).to(eq(15))

    context "alias survives cast expression parsing":
        it "reuses identifier when `as` consumed inside resource":
            class Resource:
                value: int

                fn __enter__():
                    return self.value + 1

                fn __exit__(exc):
                    pass

            let result = 0
            with Resource(2) as alias:
                let inner = alias
                result = inner

            expect(result).to(eq(3))
