"""
# Process Instruction DSL

Complete pipeline: Parse → Validate → Generate Code

**Usage:** simple scripts/process_instruction_dsl.spl
**Input:** instructions.irdsl
**Output:** Generated Rust code for all backends
"""

use compiler.irdsl.parser.{parse_irdsl_file}
use compiler.irdsl.validator.{validate_instructions, check_coverage}
use compiler.irdsl.codegen.{generate_all_backends}

fn main():
    print "=" * 60
    print "Instruction DSL Processor - Phase 4 Complete Pipeline"
    print "=" * 60
    print ""

    # For demo purposes, use sample DSL content
    # In production, would read from instructions.irdsl file

    val sample_dsl = "\ninstruction ConstInt:\n    params: dest:VReg, value:i64\n    backends: cranelift, llvm, interpreter\n    description: Create integer constant\n    rust_pattern: MirInst::ConstInt { dest, value }\n\ninstruction Add:\n    params: dest:VReg, left:VReg, right:VReg\n    backends: cranelift, llvm, interpreter\n    description: Integer addition\n    rust_pattern: MirInst::Add { dest, left, right }\n\ninstruction VecSum:\n    params: dest:VReg, vec:VReg\n    backends: cranelift, interpreter\n    description: Sum vector elements\n    rust_pattern: MirInst::VecSum { dest, vec }\n    error_msg: SIMD not supported in this backend\n"

    print "Step 1: Parsing DSL..."
    val instructions = parse_irdsl_file(sample_dsl)
    print "✅ Parsed {instructions.len()} instructions\n"

    print "Step 2: Validating definitions..."
    val validation_report = validate_instructions(instructions)
    print validation_report

    print "Step 3: Checking coverage..."
    val coverage_report = check_coverage(instructions)
    print coverage_report
    print ""

    print "Step 4: Generating backend code..."
    val generated_code = generate_all_backends(instructions)
    print generated_code

    print "=" * 60
    print "✅ Phase 4 DSL Pipeline Complete!"
    print "=" * 60
