# FreeBSD x86 (i386) cross-compilation environment.
#
# Build:  docker build -t simple-freebsd-x86 -f docker/Dockerfile.freebsd-x86 .
# Usage:  docker run --rm -v $(pwd):/workspace simple-freebsd-x86

FROM ubuntu:24.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update -qq && apt-get install -y -qq --no-install-recommends \
    build-essential cmake clang lld \
    curl xz-utils ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Download FreeBSD i386 sysroot
RUN curl -L -o /tmp/freebsd-i386-base.txz \
    https://archive.freebsd.org/old-releases/i386/13.2-RELEASE/base.txz \
    && mkdir -p /opt/sysroots/freebsd-x86 \
    && tar xf /tmp/freebsd-i386-base.txz -C /opt/sysroots/freebsd-x86 \
        ./usr/include ./usr/lib ./lib \
    && rm /tmp/freebsd-i386-base.txz

WORKDIR /workspace

CMD ["bash", "-c", "cmake -B build/freebsd-x86 seed -DCMAKE_TOOLCHAIN_FILE=seed/cmake/toolchains/freebsd-x86.cmake && cmake --build build/freebsd-x86 --target seed --target seed_cpp --target spl_runtime"]
