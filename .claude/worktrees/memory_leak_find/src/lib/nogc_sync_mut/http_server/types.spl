# HTTP Server Types Module
# Core type definitions and status codes

# =============================================================================
# Core Type Definitions (using tuples, no generics)
# =============================================================================

# Request: (method, path, headers, body, params, query)
# Response: (status, reason, headers, body)
# Route: (pattern, method, handler_name)
# Session: (id, data, expires)
# Middleware: (name, handler_name, priority)

# =============================================================================
# HTTP Status Codes
# =============================================================================

fn status_ok() -> i64: 200
fn status_created() -> i64: 201
fn status_accepted() -> i64: 202
fn status_no_content() -> i64: 204

fn status_moved_permanently() -> i64: 301
fn status_found() -> i64: 302
fn status_see_other() -> i64: 303
fn status_not_modified() -> i64: 304
fn status_temporary_redirect() -> i64: 307
fn status_permanent_redirect() -> i64: 308

fn status_bad_request() -> i64: 400
fn status_unauthorized() -> i64: 401
fn status_forbidden() -> i64: 403
fn status_not_found() -> i64: 404
fn status_method_not_allowed() -> i64: 405
fn status_not_acceptable() -> i64: 406
fn status_request_timeout() -> i64: 408
fn status_conflict() -> i64: 409
fn status_gone() -> i64: 410
fn status_payload_too_large() -> i64: 413
fn status_uri_too_long() -> i64: 414
fn status_unsupported_media_type() -> i64: 415
fn status_too_many_requests() -> i64: 429

fn status_internal_server_error() -> i64: 500
fn status_not_implemented() -> i64: 501
fn status_bad_gateway() -> i64: 502
fn status_service_unavailable() -> i64: 503
fn status_gateway_timeout() -> i64: 504
fn status_http_version_not_supported() -> i64: 505

# Status code to reason phrase mapping
fn status_reason(code: i64) -> text:
    var result = "Unknown"
    if code == 200:
        result = "OK"
    if code == 201:
        result = "Created"
    if code == 202:
        result = "Accepted"
    if code == 204:
        result = "No Content"
    if code == 301:
        result = "Moved Permanently"
    if code == 302:
        result = "Found"
    if code == 303:
        result = "See Other"
    if code == 304:
        result = "Not Modified"
    if code == 307:
        result = "Temporary Redirect"
    if code == 308:
        result = "Permanent Redirect"
    if code == 400:
        result = "Bad Request"
    if code == 401:
        result = "Unauthorized"
    if code == 403:
        result = "Forbidden"
    if code == 404:
        result = "Not Found"
    if code == 405:
        result = "Method Not Allowed"
    if code == 406:
        result = "Not Acceptable"
    if code == 408:
        result = "Request Timeout"
    if code == 409:
        result = "Conflict"
    if code == 410:
        result = "Gone"
    if code == 413:
        result = "Payload Too Large"
    if code == 414:
        result = "URI Too Long"
    if code == 415:
        result = "Unsupported Media Type"
    if code == 429:
        result = "Too Many Requests"
    if code == 500:
        result = "Internal Server Error"
    if code == 501:
        result = "Not Implemented"
    if code == 502:
        result = "Bad Gateway"
    if code == 503:
        result = "Service Unavailable"
    if code == 504:
        result = "Gateway Timeout"
    if code == 505:
        result = "HTTP Version Not Supported"
    result

# =============================================================================
# HTTP Methods
# =============================================================================

fn method_get() -> text: "GET"
fn method_post() -> text: "POST"
fn method_put() -> text: "PUT"
fn method_delete() -> text: "DELETE"
fn method_patch() -> text: "PATCH"
fn method_head() -> text: "HEAD"
fn method_options() -> text: "OPTIONS"
fn method_trace() -> text: "TRACE"
fn method_connect() -> text: "CONNECT"

fn is_method_safe(method: text) -> bool:
    var safe = false
    if method == "GET":
        safe = true
    if method == "HEAD":
        safe = true
    if method == "OPTIONS":
        safe = true
    if method == "TRACE":
        safe = true
    safe

fn is_method_idempotent(method: text) -> bool:
    var idempotent = false
    if method == "GET":
        idempotent = true
    if method == "HEAD":
        idempotent = true
    if method == "PUT":
        idempotent = true
    if method == "DELETE":
        idempotent = true
    if method == "OPTIONS":
        idempotent = true
    if method == "TRACE":
        idempotent = true
    idempotent

# =============================================================================
# MIME Types
# =============================================================================

fn mime_text_plain() -> text: "text/plain"
fn mime_text_html() -> text: "text/html"
fn mime_text_css() -> text: "text/css"
fn mime_text_javascript() -> text: "text/javascript"
fn mime_application_json() -> text: "application/json"
fn mime_application_xml() -> text: "application/xml"
fn mime_application_pdf() -> text: "application/pdf"
fn mime_application_octet_stream() -> text: "application/octet-stream"
fn mime_image_png() -> text: "image/png"
fn mime_image_jpeg() -> text: "image/jpeg"
fn mime_image_gif() -> text: "image/gif"
fn mime_image_svg() -> text: "image/svg+xml"
fn mime_image_webp() -> text: "image/webp"
fn mime_audio_mpeg() -> text: "audio/mpeg"
fn mime_audio_wav() -> text: "audio/wav"
fn mime_video_mp4() -> text: "video/mp4"
fn mime_video_webm() -> text: "video/webm"
fn mime_multipart_form_data() -> text: "multipart/form-data"
fn mime_application_form_urlencoded() -> text: "application/x-www-form-urlencoded"

# Detect MIME type from file extension
fn mime_from_extension(path: text) -> text:
    var mime_type = "application/octet-stream"

    if path.ends_with(".html"):
        mime_type = "text/html"
    if path.ends_with(".htm"):
        mime_type = "text/html"
    if path.ends_with(".css"):
        mime_type = "text/css"
    if path.ends_with(".js"):
        mime_type = "text/javascript"
    if path.ends_with(".json"):
        mime_type = "application/json"
    if path.ends_with(".xml"):
        mime_type = "application/xml"
    if path.ends_with(".pdf"):
        mime_type = "application/pdf"
    if path.ends_with(".txt"):
        mime_type = "text/plain"
    if path.ends_with(".png"):
        mime_type = "image/png"
    if path.ends_with(".jpg"):
        mime_type = "image/jpeg"
    if path.ends_with(".jpeg"):
        mime_type = "image/jpeg"
    if path.ends_with(".gif"):
        mime_type = "image/gif"
    if path.ends_with(".svg"):
        mime_type = "image/svg+xml"
    if path.ends_with(".webp"):
        mime_type = "image/webp"
    if path.ends_with(".mp3"):
        mime_type = "audio/mpeg"
    if path.ends_with(".wav"):
        mime_type = "audio/wav"
    if path.ends_with(".mp4"):
        mime_type = "video/mp4"
    if path.ends_with(".webm"):
        mime_type = "video/webm"

    mime_type
