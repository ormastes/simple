# HTTP Utility Functions

import types

fn base64_encode(text: text) -> text:
    var charset = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
    var result = ""
    var i = 0
    var len = text.length()
    while i < len:
        var b1 = text.char_code_at(i)
        var b2 = 0
        var b3 = 0
        if i + 1 < len:
            b2 = text.char_code_at(i + 1)
        if i + 2 < len:
            b3 = text.char_code_at(i + 2)
        var e1 = b1 >> 2
        var e2 = ((b1 & 3) << 4) | (b2 >> 4)
        var e3 = ((b2 & 15) << 2) | (b3 >> 6)
        var e4 = b3 & 63
        result = result + charset.char_at(e1)
        result = result + charset.char_at(e2)
        if i + 1 < len:
            result = result + charset.char_at(e3)
        else:
            result = result + "="
        if i + 2 < len:
            result = result + charset.char_at(e4)
        else:
            result = result + "="
        i = i + 3
    result

fn is_valid_http_method(method: text) -> bool:
    var upper = method.to_upper()
    upper == "GET" or upper == "POST" or upper == "PUT" or upper == "DELETE" or upper == "PATCH" or upper == "HEAD" or upper == "OPTIONS"

fn is_absolute_url(url: text) -> bool:
    url.starts_with("http://") or url.starts_with("https://")

fn normalize_url(url: text) -> text:
    if not is_absolute_url(url):
        return "http://" + url
    url

fn get_default_port(scheme: text) -> i64:
    if scheme == "https":
        return 443
    80

fn content_type_is_json(content_type: text) -> bool:
    if content_type == nil:
        return false
    content_type.to_lower().contains("application/json")

fn content_type_is_form(content_type: text) -> bool:
    if content_type == nil:
        return false
    content_type.to_lower().contains("application/x-www-form-urlencoded")

fn content_type_is_text(content_type: text) -> bool:
    if content_type == nil:
        return false
    var lower = content_type.to_lower()
    lower.starts_with("text/") or lower.contains("application/json") or lower.contains("application/xml")
