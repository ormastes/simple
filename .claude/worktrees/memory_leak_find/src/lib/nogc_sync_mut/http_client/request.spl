# HTTP Request Building Functions

import types

fn create_headers() -> list:
    []

fn add_header(headers: list, name: text, value: text) -> list:
    var new_headers = []
    var i = 0
    while i < headers.length():
        new_headers.append(headers[i])
        i = i + 1
    new_headers.append((name, value))
    new_headers

fn get_header(headers: list, name: text) -> text:
    var name_lower = name.to_lower()
    var i = 0
    while i < headers.length():
        var header = headers[i]
        var header_name = header.0
        if header_name.to_lower() == name_lower:
            return header.1
        i = i + 1
    nil

fn has_header(headers: list, name: text) -> bool:
    var value = get_header(headers, name)
    value != nil

fn remove_header(headers: list, name: text) -> list:
    var name_lower = name.to_lower()
    var new_headers = []
    var i = 0
    while i < headers.length():
        var header = headers[i]
        var header_name = header.0
        if header_name.to_lower() != name_lower:
            new_headers.append(header)
        i = i + 1
    new_headers

fn set_header(headers: list, name: text, value: text) -> list:
    var removed = remove_header(headers, name)
    add_header(removed, name, value)

fn create_request(method: text, url: text) -> (text, text, list, text):
    var headers = create_headers()
    var body = ""
    (method, url, headers, body)

fn request_add_header(request: (text, text, list, text), name: text, value: text) -> (text, text, list, text):
    var method = request.0
    var url = request.1
    var headers = request.2
    var body = request.3
    var new_headers = add_header(headers, name, value)
    (method, url, new_headers, body)

fn request_set_body(request: (text, text, list, text), body: text) -> (text, text, list, text):
    var method = request.0
    var url = request.1
    var headers = request.2
    (method, url, headers, body)

fn http_get(url: text) -> (text, text, list, text):
    create_request(types.METHOD_GET, url)

fn http_post(url: text, body: text) -> (text, text, list, text):
    var req = create_request(types.METHOD_POST, url)
    request_set_body(req, body)

fn http_put(url: text, body: text) -> (text, text, list, text):
    var req = create_request(types.METHOD_PUT, url)
    request_set_body(req, body)

fn http_delete(url: text) -> (text, text, list, text):
    create_request(types.METHOD_DELETE, url)
