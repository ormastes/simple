# Async Runtime FFI
#
# External function declarations for async runtime operations.

use std.async.poll.{Poll}

# Future operations
extern fn future_alloc_ready<T>(value: T) -> [u8]
extern fn future_alloc_pending<T>() -> [u8]
extern fn future_poll<T>(state: [u8]) -> Poll<T>
extern fn future_poll_any(state: [u8]) -> Poll<()>
extern fn future_free<T>(state: [u8])
extern fn future_map<T, U>(state: [u8], f: fn(T) -> U) -> [u8]
extern fn future_then<T, U>(state: [u8], f: fn(T) -> Future<U>) -> [u8]

# Promise operations
extern fn promise_alloc<T>() -> [u8]
extern fn promise_get_future(state: [u8]) -> [u8]
extern fn promise_complete<T>(state: [u8], value: T) -> bool
extern fn promise_is_completed(state: [u8]) -> bool
extern fn promise_free<T>(state: [u8])

# Task operations
extern fn task_alloc_id() -> usize

# Async I/O operations
extern fn async_sleep(millis: usize) -> [u8]
extern fn async_yield() -> [u8]
extern fn async_read_file(path: text) -> [u8]
extern fn async_write_file(path: text, data: [u8]) -> [u8]

# Combinators
extern fn async_join(futures: [[u8]]) -> [u8]
extern fn async_select(futures: [[u8]]) -> [u8]

export future_alloc_ready, future_alloc_pending, future_poll, future_poll_any
export future_free, future_map, future_then
export promise_alloc, promise_get_future, promise_complete
export promise_is_completed, promise_free
export task_alloc_id
export async_sleep, async_yield, async_read_file, async_write_file
export async_join, async_select
