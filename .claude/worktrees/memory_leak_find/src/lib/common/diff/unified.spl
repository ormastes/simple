# Unified Diff Format Module
# Generate unified diffs (like diff -u)


import diff.types
import diff.patch

fn format_unified(changes: list, file1: text, file2: text, context_lines: i64) -> text:
    # Format diff in unified format (like diff -u)
    val hunks = create_hunks(changes, context_lines)

    var result = "--- {file1}" + "\n" + "+++ {file2}" + "\n"

    var i = 0
    while i < hunks.length():
        val hunk = hunks.get(i)
        result = result + format_hunk_unified(hunk)
        i = i + 1

    result

fn format_hunk_unified(hunk: tuple) -> text:
    # Format a single hunk in unified format
    val old_start = hunk.old_start + 1
    val old_count = hunk.old_count
    val new_start = hunk.new_start + 1
    val new_count = hunk.new_count

    var result = "@@ -{old_start},{old_count} +{new_start},{new_count} @@" + "\n"

    val changes = hunk.changes
    var i = 0
    while i < changes.length():
        val change = changes.get(i)
        val op = change.op

        if op == "equal":
            result = result + " " + change.content + "\n"
        else:
            if op == "delete":
                result = result + "-" + change.content + "\n"
            else:
                if op == "add":
                    result = result + "+" + change.content + "\n"
                else:
                    if op == "change":
                        result = result + "-" + change.old_content + "\n"
                        result = result + "+" + change.new_content + "\n"

        i = i + 1

    result
