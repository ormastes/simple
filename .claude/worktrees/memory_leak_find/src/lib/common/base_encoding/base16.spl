# Base16 (Hexadecimal) Encoding Module

use base_encoding.types.{BASE16_LOWER_ALPHABET, BASE16_UPPER_ALPHABET}
use base_encoding.utilities.{alphabet_char_at, text_char_at}

# ============================================================================
# BASE16 (HEX) ENCODING
# ============================================================================

fn base16_encode(bytes: list) -> text:
    """Encode bytes to Base16 (hex) uppercase."""
    base16_encode_with_alphabet(bytes, BASE16_UPPER_ALPHABET)

fn base16_encode_lower(bytes: list) -> text:
    """Encode bytes to Base16 (hex) lowercase."""
    base16_encode_with_alphabet(bytes, BASE16_LOWER_ALPHABET)

fn base16_encode_upper(bytes: list) -> text:
    """Encode bytes to Base16 (hex) uppercase."""
    base16_encode_with_alphabet(bytes, BASE16_UPPER_ALPHABET)

fn base16_encode_with_alphabet(bytes: list, alphabet: text) -> text:
    """Encode bytes to Base16 with custom alphabet."""
    var result = ""
    var i = 0
    while i < bytes.len():
        var byte = bytes[i]
        var high = byte / 16
        var low = byte % 16
        var high_char = alphabet_char_at(alphabet, high)
        var low_char = alphabet_char_at(alphabet, low)
        result = result + high_char + low_char
        i = i + 1
    result

fn base16_decode(encoded: text) -> list:
    """Decode Base16 (hex) to bytes. Case-insensitive."""
    var bytes = []
    var i = 0
    while i < encoded.len():
        if i + 1 >= encoded.len():
            return bytes
        var c1 = text_char_at(encoded, i)
        var c2 = text_char_at(encoded, i + 1)
        var v1 = hex_char_to_value(c1)
        var v2 = hex_char_to_value(c2)
        if v1 == -1:
            return bytes
        if v2 == -1:
            return bytes
        var byte = v1 * 16 + v2
        bytes.push(byte)
        i = i + 2
    bytes

fn hex_char_to_value(c: text) -> i64:
    """Convert hex character to value. Returns -1 for invalid."""
    if c == "0": return 0
    if c == "1": return 1
    if c == "2": return 2
    if c == "3": return 3
    if c == "4": return 4
    if c == "5": return 5
    if c == "6": return 6
    if c == "7": return 7
    if c == "8": return 8
    if c == "9": return 9
    if c == "a": return 10
    if c == "A": return 10
    if c == "b": return 11
    if c == "B": return 11
    if c == "c": return 12
    if c == "C": return 12
    if c == "d": return 13
    if c == "D": return 13
    if c == "e": return 14
    if c == "E": return 14
    if c == "f": return 15
    if c == "F": return 15
    -1

fn base16_validate(encoded: text) -> bool:
    """Validate Base16 (hex) encoded string."""
    if encoded.len() % 2 != 0:
        return false
    var i = 0
    while i < encoded.len():
        var c = text_char_at(encoded, i)
        var v = hex_char_to_value(c)
        if v == -1:
            return false
        i = i + 1
    true
