# JWT Types and Data Structures
#
# This module defines all data structures and type-related utilities for JWT.
# Uses tuple-based structures for runtime compatibility.
#
# Data Structures:
#   - JWT components: (header_text, payload_text, signature_text)
#   - JWTHeader: List of tuples [(key, value), ...]
#   - JWTPayload: List of tuples [(claim_key, claim_value), ...]
#   - ValidationOptions: List of tuples [(option_key, option_value), ...]

# ============================================================================
# JWT Header Operations
# ============================================================================

# Create default JWT header with algorithm
fn create_header(alg: text) -> list:
    var header = []
    var alg_tuple = ["alg", alg]
    var typ_tuple = ["typ", "JWT"]
    header = header + [alg_tuple]
    header = header + [typ_tuple]
    return header

# Get value from header by key
fn get_header_value(header: list, key: text) -> text:
    var i = 0
    var len = header.length()

    while i < len:
        var tuple = header.at(i)
        var k = tuple.at(0)
        if k == key:
            return tuple.at(1)
        i = i + 1

    return ""

# Set value in header
fn set_header_value(header: list, key: text, value: text) -> list:
    var result = []
    var found = false
    var i = 0
    var len = header.length()

    while i < len:
        var tuple = header.at(i)
        var k = tuple.at(0)

        if k == key:
            var new_tuple = [key, value]
            result = result + [new_tuple]
            found = true
        else:
            result = result + [tuple]

        i = i + 1

    if not found:
        var new_tuple = [key, value]
        result = result + [new_tuple]

    return result

# Get algorithm from header
fn get_algorithm(header: list) -> text:
    return get_header_value(header, "alg")

# ============================================================================
# JWT Payload (Claims) Creation
# ============================================================================

# Create empty payload
fn create_payload() -> list:
    return []

# ============================================================================
# Validation Options
# ============================================================================

# Create default validation options
fn create_validation_options() -> list:
    var options = []
    var opt1 = ["validate_exp", "true"]
    var opt2 = ["validate_nbf", "true"]
    var opt3 = ["leeway", "0"]
    options = options + [opt1]
    options = options + [opt2]
    options = options + [opt3]
    return options

# Get validation option value
fn get_validation_option(options: list, key: text) -> text:
    var i = 0
    var len = options.length()

    while i < len:
        var tuple = options.at(i)
        var k = tuple.at(0)
        if k == key:
            return tuple.at(1)
        i = i + 1

    return ""

# Set validation option
fn set_option(options: list, key: text, value: text) -> list:
    var result = []
    var found = false
    var i = 0
    var len = options.length()

    while i < len:
        var tuple = options.at(i)
        var k = tuple.at(0)

        if k == key:
            var new_tuple = [key, value]
            result = result + [new_tuple]
            found = true
        else:
            result = result + [tuple]

        i = i + 1

    if not found:
        var new_tuple = [key, value]
        result = result + [new_tuple]

    return result
