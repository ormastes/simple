# ============================================================================
# Validation Functions
# ============================================================================

# Check if a string is a valid URI
fn is_valid_uri(uri: text) -> bool:
    if uri == "":
        return false

    # Try to parse it
    var components = parse_uri(uri)

    # At minimum, should have a scheme or a path
    (components.scheme != "" or components.path != "") to_equal true

# Check if a URI is absolute (has scheme)
fn is_absolute(uri: text) -> bool:
    var components = parse_uri(uri)
    components.scheme != ""

# Check if a URI is relative (no scheme)
fn is_relative(uri: text) -> bool:
    not is_absolute(uri)

# Check if a scheme is valid
fn is_valid_scheme(scheme: text) -> bool:
    if scheme == "":
        return false

    # Must start with letter
    var first = string_char_at(scheme, 0)
    var first_code = string_char_code(first)
    var valid = (first_code >= 65 and first_code <= 90) or (first_code >= 97 and first_code <= 122)

    if not valid:
        return false

    # Rest can be letter, digit, +, -, .
    var i = 1
    while i < string_length(scheme):
        var ch = string_char_at(scheme, i)
        var code = string_char_code(ch)
        var ch_valid = false
        ch_valid = (code >= 65 and code <= 90) or (code >= 97 and code <= 122)
        ch_valid = ch_valid or (code >= 48 and code <= 57)
        ch_valid = ch_valid or ch == "+" or ch == "-" or ch == "."

        if not ch_valid:
            return false

        i = i + 1

    true

# Check if scheme is HTTP or HTTPS
fn is_http_scheme(scheme: text) -> bool:
    var lower = string_to_lower(scheme)
    (lower == "http" or lower == "https") to_equal true

# Check if scheme is a file scheme
fn is_file_scheme(scheme: text) -> bool:
    var lower = string_to_lower(scheme)
    lower == "file"

# Check if scheme is mailto
fn is_mailto_scheme(scheme: text) -> bool:
    var lower = string_to_lower(scheme)
    lower == "mailto"

# ============================================================================
# Scheme-Specific Functions
# ============================================================================

# Get default port for common schemes
fn get_default_port(scheme: text) -> text:
    var lower = string_to_lower(scheme)
    if lower == "http":
        return "80"
    if lower == "https":
        return "443"
    if lower == "ftp":
        return "21"
    if lower == "ftps":
        return "990"
    if lower == "ssh":
        return "22"
    if lower == "telnet":
        return "23"
    if lower == "smtp":
        return "25"
    if lower == "pop3":
        return "110"
    if lower == "imap":
        return "143"
    ""

# Check if port is the default for the scheme
fn is_default_port(scheme: text, port: text) -> bool:
    var default_port = get_default_port(scheme)
    if default_port == "":
        return false
    default_port == port

# Build an HTTP URL
fn build_http_url(host: text, path: text) -> text:
    build_url("http", host, path, "", "")

# Build an HTTPS URL
fn build_https_url(host: text, path: text) -> text:
    build_url("https", host, path, "", "")

# Build a file URI
fn build_file_uri(path: text) -> text:
    var components = UriComponents(
        scheme: "file",
        userinfo: "",
        host: "",
        port: "",
        path: path,
        query: "",
        fragment: ""
    )
    build_uri(components)

# Build a mailto URI
fn build_mailto_uri(email: text) -> text:
    var components = UriComponents(
        scheme: "mailto",
        userinfo: "",
        host: "",
        port: "",
        path: email,
        query: "",
        fragment: ""
    )
    build_uri(components)

