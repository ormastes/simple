# HIR → MIR adapter
#
# Bridges the mismatch between HIR's tree-structured control flow
# and MIR's flat basic-block representation.
# Design: doc/research/compiler_mdsoc_design.md Section 4.2

struct CfgContext:
    """
    Control flow graph context for HIR → MIR lowering.
    Tracks loop break/continue targets and current block label.
    Provides the structured→unstructured control flow bridge.
    """
    current_fn_name: text
    loop_depth: i64
    current_block_label: text
    break_label_stack: [text]
    continue_label_stack: [text]

    fn in_loop() -> bool:
        self.loop_depth > 0

    fn current_break_label() -> text:
        if self.break_label_stack.len() == 0:
            return ""
        self.break_label_stack[self.break_label_stack.len() - 1]

    fn current_continue_label() -> text:
        if self.continue_label_stack.len() == 0:
            return ""
        self.continue_label_stack[self.continue_label_stack.len() - 1]

    static fn for_function(fn_name: text) -> CfgContext:
        CfgContext(
            current_fn_name: fn_name,
            loop_depth: 0,
            current_block_label: "entry",
            break_label_stack: [],
            continue_label_stack: []
        )

export CfgContext
