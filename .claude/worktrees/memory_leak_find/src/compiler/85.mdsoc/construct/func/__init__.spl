# Construct Capsule: func
#
# Groups all compiler files that handle the 'func' language construct.
# Tier: decl (depends on expr, control, variable)
# Dimension: construct (vertical second axis)
# Participation: shared_bind

use compiler.mdsoc.types.*

export func_capsule_def

fn func_capsule_def() -> ConstructCapsule:
    """Define the func construct capsule.

    Function handling spans all pipeline layers. Many files are shared
    with other construct capsules since functions are the primary unit
    of computation and appear everywhere.
    """
    var cap = ConstructCapsule.new("func", ConstructKind.Func, ConstructTier.Decl)

    # No exclusive files — functions are pervasive
    cap.exclusive_files = []

    # Shared files — primary owner (primary_construct = "func")
    val sb_parser_decls = SharedBinding.new("10.frontend/core/parser_decls.spl", "func", 10)
    val sb_ast = SharedBinding.new("10.frontend/core/ast.spl", "func", 10)
    val sb_hir = SharedBinding.new("20.hir/hir_definitions.spl", "func", 20)
    val sb_mir_lower = SharedBinding.new("50.mir/mir_lowering_expr.spl", "func", 50)
    val sb_c_backend = SharedBinding.new("70.backend/backend/c_backend.spl", "func", 70)
    val sb_c_translate_decl = SharedBinding.new("src/app/compile/c_translate_decl.spl", "func", 0)
    val sb_interpreter = SharedBinding.new("70.backend/backend/interpreter.spl", "func", 70)

    cap.shared_bindings = [sb_parser_decls, sb_ast, sb_hir, sb_mir_lower, sb_c_backend, sb_c_translate_decl, sb_interpreter]

    # Depends on core/flow tiers
    cap.depends_on = ["expr", "control", "variable"]

    cap
