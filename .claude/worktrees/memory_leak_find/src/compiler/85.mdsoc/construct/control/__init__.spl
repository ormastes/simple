# Construct Capsule: control
#
# Groups all compiler files that handle control flow (if/for/while/return).
# Tier: flow (depends on expr, variable)
# Dimension: construct (vertical second axis)
# Participation: shared_bind

use compiler.mdsoc.types.*

export control_capsule_def

fn control_capsule_def() -> ConstructCapsule:
    """Define the control construct capsule.

    Control flow (if/elif/else, for, while, break, continue, return)
    is a flow-tier construct depending on expr and variable.
    """
    var cap = ConstructCapsule.new("control", ConstructKind.Control, ConstructTier.Flow)

    cap.exclusive_files = []

    # Shared files
    val sb_parser_decls = SharedBinding.new("10.frontend/core/parser_decls.spl", "func", 10)
    val sb_ast = SharedBinding.new("10.frontend/core/ast.spl", "func", 10)
    val sb_hir = SharedBinding.new("20.hir/hir_definitions.spl", "func", 20)
    val sb_mir_stmts = SharedBinding.new("50.mir/mir_instructions.spl", "expr", 50)
    val sb_interpreter = SharedBinding.new("70.backend/backend/interpreter.spl", "func", 70)
    val sb_c_stmt = SharedBinding.new("src/app/compile/c_translate_stmt.spl", "control", 0)

    cap.shared_bindings = [sb_parser_decls, sb_ast, sb_hir, sb_mir_stmts, sb_interpreter, sb_c_stmt]

    # Depends on expr (conditions), variable (loop variables)
    cap.depends_on = ["expr", "variable"]

    cap
