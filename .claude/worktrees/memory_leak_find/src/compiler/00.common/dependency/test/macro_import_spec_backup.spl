# Minimal test for Lean Theorem 1

use sspec.{describe, it, expect}
use compiler.common.dependency.macro_import.{
    SymKind, MacroSymbol, AutoImport, MacroExports, MacroDirManifest,
    is_auto_imported, auto_imported_macros, glob_import, explicit_import, combine_exports
}

# Helper to create standard exports
fn make_exports() -> MacroExports:
    var exports = MacroExports.new()
    exports.add_non_macro(MacroSymbol.value_sym("mod", "foo"))
    exports.add_non_macro(MacroSymbol.value_sym("mod", "bar"))
    exports.add_macro(MacroSymbol.macro_sym("mod", "my_macro"))
    exports.add_macro(MacroSymbol.macro_sym("mod", "other_macro"))
    exports

describe "Lean Theorem 1: glob_doesnt_leak_macros_wf":
    it "macro not in auto-import is excluded from glob":
        val exports = make_exports()
        expect exports.is_well_formed()

        var manifest = MacroDirManifest.new("test")
        manifest.add_auto_import(AutoImport.new("mod", "my_macro"))

        val result = glob_import(manifest, exports)

        # other_macro should NOT be in result
        var found_other = false
        for sym in result:
            val sym_name = sym.get_name()
            if sym_name == "other_macro":
                found_other = true

        expect not found_other

        # my_macro SHOULD be in result
        var found_my = false
        for sym in result:
            val sym_name = sym.get_name()
            if sym_name == "my_macro":
                found_my = true

        expect found_my
