# Compiler Compilation Context
#
# CompilationContext implementation for normal (AOT) compilation.
# Templates come from the parsed AST cache.

use compiler.common.compilation_context.{CompilationContext, InstantiationMode, ContractMode, GenericTemplate, ConcreteType, TypeRegistry}use compiler.backend.backend_types.CompiledUnituse compiler.common.di.DiContaineruse compiler.tools.aop.AopWeaveruse compiler.driver.pipeline_fn.compile_specialized_templateuse compiler.mono.monomorphize.note_sdn.InstantiationEntry
# ============================================================================
# CompilerCompilationContext
# ============================================================================

class CompilerCompilationContext(CompilationContext):
    """Compiler uses parsed AST cache for templates."""
    ast_cache: Dict<text, GenericTemplate>
    type_reg: TypeRegistry
    di: DiContainer
    aop: AopWeaver
    contracts: ContractMode
    coverage: bool
    recorded: [InstantiationEntry]

    fn load_template(name: text) -> text:
        if self.ast_cache_contains_key(ast_cache, name):
            Ok(self.ast_cache[name])
        else:
            Err("Template not found: {name}")

    fn has_template(name: text) -> bool:
        self.ast_cache_contains_key(ast_cache, name)

    fn type_registry() -> TypeRegistry:
        self.type_reg

    fn contract_mode() -> ContractMode:
        self.contracts

    fn di_container() -> has_DiContainer:
        self.di

    fn aop_weaver() -> has_AopWeaver:
        self.aop

    fn coverage_enabled() -> bool:
        self.coverage

    fn compile_template(template: GenericTemplate, type_args: [ConcreteType]) -> text:
        compile_specialized_template(template, type_args, self.contracts, self.di, self.aop, self.coverage)

    fn instantiation_mode() -> InstantiationMode:
        InstantiationMode.CompileTime

    me record_instantiation(entry: InstantiationEntry):
        self.recorded = self.recorded_push(recorded, entry)


# ============================================================================
# CompilerCompilationContext Methods (was: impl CompilerCompilationContext:)
# ============================================================================

# ============================================================================
# Exports
# ============================================================================

export CompilerCompilationContext
