# Shared Operand Extraction Utilities
#
# Common helper functions to extract register IDs, memory operands,
# immediates, labels, and symbols from MachInst operands.
# Used by all encoder backends (x86_64, aarch64, riscv64, riscv32).

use compiler.backend.native.mach_inst.{MachReg, MachRegKind, Operand, OperandKind}

fn get_phys_reg_id(op: Operand) -> i64:
    match op.kind:
        case Reg(reg):
            match reg.kind:
                case Physical(id): id
                case Virtual(id): id
        case _: 0

fn get_mem_base_id(op: Operand) -> i64:
    match op.kind:
        case Mem(base, _):
            match base.kind:
                case Physical(id): id
                case Virtual(id): id
        case _: 0

fn get_mem_offset(op: Operand) -> i64:
    match op.kind:
        case Mem(_, offset): offset
        case _: 0

fn get_imm_value(op: Operand) -> i64:
    match op.kind:
        case Imm(v): v
        case _: 0

fn get_label_id(op: Operand) -> i64:
    match op.kind:
        case Label(id): id
        case _: 0

fn get_sym_name(op: Operand) -> text:
    match op.kind:
        case Sym(name): name
        case _: ""

export get_phys_reg_id, get_mem_base_id, get_mem_offset, get_imm_value, get_label_id, get_sym_name
