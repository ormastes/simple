# Simple Language Server
# LSP server for Simple language (self-hosted implementation)
# Usage: simple lsp (communicates via stdin/stdout)

fn main() -> i64:
    extern fn rt_cli_get_args() -> [text]
    extern fn rt_env_get(name: text) -> text
    val args = rt_cli_get_args()

    # Check for help flag
    var show_help = false
    var show_version = false
    for arg in args:
        if arg == "--help" or arg == "-h":
            show_help = true
        if arg == "--version" or arg == "-v":
            show_version = true

    if show_help:
        print_usage()
        return 0

    if show_version:
        print "simple-lsp 0.1.0"
        print "Simple Language Server (LSP)"
        return 0

    # Log startup (only if debug enabled)
    val debug_mode = rt_env_get("SIMPLE_LSP_DEBUG")
    if debug_mode != "":
        print "Starting Simple LSP server (stdio mode)"

    # The full LSP server requires compiled mode (tree-sitter, JSON-RPC transport)
    # In interpreter mode, print guidance
    print "Simple Language Server"
    print "The LSP server requires compiled mode for full operation."
    print "Run: simple build && ./build/simple lsp"
    print ""
    print "For development, use: simple lsp --help"
    return 1

fn print_usage():
    print "Simple Language Server (LSP)"
    print ""
    print "Usage: simple lsp [options]"
    print ""
    print "The language server communicates via stdin/stdout using the"
    print "Language Server Protocol (LSP) with JSON-RPC 2.0 messages."
    print ""
    print "Options:"
    print "  -h, --help       Show this help message"
    print "  -v, --version    Show version information"
    print ""
    print "Environment Variables:"
    print "  SIMPLE_LSP_DEBUG  Enable debug logging to stderr"
    print ""
    print "Editor Integration:"
    print "  VS Code: Install the Simple Language extension"
    print "    Settings: \"simple.lsp.serverPath\": \"simple\""
    print ""
    print "  Neovim: Use simple.nvim plugin"
    print "    require('simple').setup()"
    print ""
    print "Documentation:"
    print "  https://github.com/simple-lang/simple/doc/status/lsp_implementation.md"
