# mmap Syscalls - Minimal OS-level Memory Mapping
#
# Thin syscall wrappers following the same pattern as memory_syscalls.spl
# NO logic in Rust - just 1-line libc calls
# ALL logic in Simple (smf_cache.spl, etc.)
#
# Pattern: Same as rt_malloc, rt_free, rt_read_u8, etc.

# ============================================================================
# Core mmap Syscalls (1-line Rust wrappers)
# ============================================================================

## Map file/memory into address space (libc mmap)
extern fn rt_mmap(addr: i64, length: i64, prot: i32, flags: i32, fd: i32, offset: i64) -> i64

## Unmap memory region (libc munmap)
extern fn rt_munmap(addr: i64, length: i64) -> i32

## Change memory protection (libc mprotect)
extern fn rt_mprotect(addr: i64, length: i64, prot: i32) -> i32

## Give kernel memory usage advice (libc madvise)
extern fn rt_madvise(addr: i64, length: i64, advice: i32) -> i32

## Sync memory to disk (libc msync)
extern fn rt_msync(addr: i64, length: i64, flags: i32) -> i32

## Lock memory in RAM (libc mlock)
extern fn rt_mlock(addr: i64, length: i64) -> i32

## Unlock memory (libc munlock)
extern fn rt_munlock(addr: i64, length: i64) -> i32

## Get system page size (libc sysconf)
extern fn rt_page_size() -> i64

# ============================================================================
# File Operations (needed for mmap)
# ============================================================================

## Open file (libc open)
extern fn rt_open_fd(path: text, flags: i32, mode: i32) -> i32

## Close file descriptor (libc close)
extern fn rt_close_fd(fd: i32) -> i32

# ============================================================================
# Constants (defined in Simple, used by Rust)
# ============================================================================

# Protection flags
val PROT_NONE: i32 = 0x0
val PROT_READ: i32 = 0x1
val PROT_WRITE: i32 = 0x2
val PROT_EXEC: i32 = 0x4

# Mapping flags
val MAP_SHARED: i32 = 0x1
val MAP_PRIVATE: i32 = 0x2
val MAP_ANONYMOUS: i32 = 0x20
val MAP_FAILED: i64 = -1

# Memory advice
val MADV_NORMAL: i32 = 0
val MADV_RANDOM: i32 = 1
val MADV_SEQUENTIAL: i32 = 2
val MADV_WILLNEED: i32 = 3
val MADV_DONTNEED: i32 = 4

# Sync flags
val MS_ASYNC: i32 = 1
val MS_SYNC: i32 = 2
val MS_INVALIDATE: i32 = 4

# Open flags
val O_RDONLY: i32 = 0x0
val O_WRONLY: i32 = 0x1
val O_RDWR: i32 = 0x2

# ============================================================================
# FFI Generation Metadata
# ============================================================================

# @ffi-gen-target: rust/runtime/src/interpreter_extern/mmap_syscalls.rs
# @ffi-gen-impl: Direct libc bindings (mmap/munmap/mprotect/etc.)
# @ffi-gen-style: syscall-only (no logic, just libc calls)
# @ffi-gen-pattern: Same as memory_syscalls.spl (rt_malloc, rt_free)
