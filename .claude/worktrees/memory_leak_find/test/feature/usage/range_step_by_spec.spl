"""
# Range Step Specification


**Feature IDs:** #RANGE-STEP
**Category:** Syntax
**Status:** Implemented

Ranges in Simple can be iterated with custom step values. This is primarily
used in slice syntax with the `[start:end:step]` notation, allowing iteration
over every Nth element or reversing sequences.

## Syntax

```simple
# Slice with step
arr[::2]       # Every other element (step=2)
arr[1::2]      # Every other starting from index 1
arr[::-1]      # Reversed
arr[1:5:2]     # Slice from 1 to 5 with step 2

# Range iteration (stdlib method)
for i in (0..10).step_by(2):
    print i    # 0, 2, 4, 6, 8
```

## Key Behaviors

- Step value can be positive (forward) or negative (reverse)
- Step of 1 is the default (every element)
- Step of -1 reverses the sequence
- Step of 2 selects every other element
- Works on arrays, strings, and any sliceable type
"""

describe "Range Step (Slicing with Step)":
    """
    ## Slice Step Specification

    Slice step syntax allows selecting elements at regular intervals from
    sequences. This test suite verifies:
    - Basic step syntax `[::step]` for every Nth element
    - Slice with start, end, and step `[start:end:step]`
    - Reverse iteration with negative step `[::-1]`
    - Step on arrays and strings
    - Edge cases with empty results and bounds
    """

    context "basic step on arrays":
        it "selects every other element with step 2":
            val arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
            expect arr[::2] == [0, 2, 4, 6, 8]

        it "selects every third element with step 3":
            val arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
            expect arr[::3] == [0, 3, 6, 9]

        it "selects every fourth element":
            val arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
            expect arr[::4] == [0, 4, 8]

    context "step with start offset":
        it "starts from index 1 with step 2":
            val arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
            expect arr[1::2] == [1, 3, 5, 7, 9]

        it "starts from index 2 with step 3":
            val arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
            expect arr[2::3] == [2, 5, 8]

        it "starts from middle of array":
            val arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
            expect arr[5::2] == [5, 7, 9]

    context "step with start and end":
        it "slices range with step":
            val arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
            expect arr[1:8:2] == [1, 3, 5, 7]

        it "slices narrow range with step":
            val arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
            expect arr[2:6:2] == [2, 4]

        it "slices with step larger than range":
            val arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
            expect arr[0:5:10] == [0]

    context "negative step (reverse)":
        it "reverses entire array":
            val arr = [1, 2, 3, 4, 5]
            expect arr[::-1] == [5, 4, 3, 2, 1]

        it "reverses empty array":
            val arr: [i64] = []
            expect arr[::-1] == []

        it "reverses single element":
            val arr = [42]
            expect arr[::-1] == [42]

        it "reverses with step -2":
            val arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
            expect arr[::-2] == [9, 7, 5, 3, 1]

    context "step on strings":
        it "selects every other character":
            val s = "abcdefgh"
            expect s[::2] == "aceg"

        it "reverses string":
            val s = "hello"
            expect s[::-1] == "olleh"

        it "selects odd-indexed characters":
            val s = "abcdefgh"
            expect s[1::2] == "bdfh"

        it "slices string with step":
            val s = "0123456789"
            expect s[1:8:2] == "1357"

    context "edge cases":
        it "handles step equal to length":
            val arr = [1, 2, 3, 4, 5]
            expect arr[::5] == [1]

        it "handles step greater than length":
            val arr = [1, 2, 3, 4, 5]
            expect arr[::10] == [1]

        it "handles step of 1 (identity)":
            val arr = [1, 2, 3, 4, 5]
            expect arr[::1] == [1, 2, 3, 4, 5]

        it "handles empty slice with step":
            val arr = [1, 2, 3, 4, 5]
            expect arr[5:5:2] == []

    context "practical examples":
        it "extracts even indices":
            val data = ["a", "b", "c", "d", "e", "f"]
            expect data[::2] == ["a", "c", "e"]

        it "extracts odd indices":
            val data = ["a", "b", "c", "d", "e", "f"]
            expect data[1::2] == ["b", "d", "f"]

        it "reverses for iteration":
            val nums = [1, 2, 3, 4, 5]
            var sum = 0
            for n in nums[::-1]:
                sum = sum * 10 + n
            expect sum == 54321

        it "samples at regular intervals":
            val readings = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]
            val sampled = readings[::3]
            expect sampled == [10, 40, 70, 100]
