"""
# Tensor Bridge Batch Conversion

**Feature ID:** #ML-001
**Category:** Runtime
**Status:** Active

## Overview

Tests batch conversion between math vector types (Vec3, Vec3d) and flat tensor
arrays. Validates flattening Vec3 lists to float arrays, unflattening arrays
back to Vec3 lists, round-trip consistency, and equivalent operations for
double-precision Vec3d types.

## Syntax

```simple
val vecs = [math.Vec3(1.0, 2.0, 3.0), math.Vec3(4.0, 5.0, 6.0)]
val arr = math.vecs_to_tensor(vecs)
val restored = math.tensor_to_vecs(arr)
```
"""
use math

# ============================================================================
# Batch Conversion
# ============================================================================

describe "Tensor Bridge Batch Conversion":
    it "arrtens Vec3 list to array":
        val vecs = [
            math.Vec3(1.0, 2.0, 3.0),
            math.Vec3(4.0, 5.0, 6.0)
        ]
        val arr = math.vecs_to_tensor(vecs)
        expect arr.len() == 6
        expect arr[0] == 1.0
        expect arr[1] == 2.0
        expect arr[2] == 3.0
        expect arr[3] == 4.0
        expect arr[4] == 5.0
        expect arr[5] == 6.0

    it "unarrtens array to Vec3 list":
        val arr = [1.0, 2.0, 3.0, 4.0, 5.0, 6.0]
        val vecs = math.tensor_to_vecs(arr)
        expect vecs.len() == 2
        expect vecs[0].x == 1.0
        expect vecs[0].y == 2.0
        expect vecs[0].z == 3.0
        expect vecs[1].x == 4.0

    it "round-trips Vec3 list":
        val original = [
            math.Vec3(10.0, 20.0, 30.0),
            math.Vec3(40.0, 50.0, 60.0)
        ]
        val arr = math.vecs_to_tensor(original)
        val restored = math.tensor_to_vecs(arr)
        expect restored.len() == 2
        expect restored[0].x == 10.0
        expect restored[1].z == 60.0

# ============================================================================
# Vec3d Batch Conversion
# ============================================================================

describe "Tensor Bridge Vec3d Batch Conversion":
    it "arrtens Vec3d list to f64 array":
        val vecs = [
            math.Vec3d(1.0, 2.0, 3.0),
            math.Vec3d(4.0, 5.0, 6.0)
        ]
        val arr = math.vecs3d_to_tensor(vecs)
        expect arr.len() == 6
        expect arr[0] == 1.0

    it "unarrtens f64 array to Vec3d list":
        val arr = [1.0, 2.0, 3.0, 4.0, 5.0, 6.0]
        val vecs = math.tensor_to_vecs3d(arr)
        expect vecs.len() == 2
        expect vecs[0].x == 1.0
