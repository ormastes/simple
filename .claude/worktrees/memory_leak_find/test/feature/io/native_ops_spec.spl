"""
# Native File and Directory Operations Tests

**Feature ID:** #IO-001
**Category:** I/O
**Status:** Active

## Overview

Tests native file and directory operations using SFFI without shell fallbacks. Validates
file creation, reading, copying, size retrieval, and deletion via file_ops, as well as
directory creation (including recursive/nested), directory detection, and removal via dir_ops.
All operations use /tmp paths and clean up after themselves.

## Syntax

```simple
file_write(test_file, content)
val read_content = file_read(test_file)
expect(read_content).to_equal(content)
file_delete(test_file)

dir_create(test_dir, true)  # recursive
check(is_dir(test_dir))
```
"""
# Test native file/dir operations (no shell fallbacks)

use std.spec
use app.io.dir_ops
use app.io.file_ops

describe "Native File Operations":
    it "creates and reads files":
        val test_file = "/tmp/simple_native_file_test.txt"
        val content = "Hello from native SFFI!"
        
        check(file_write(test_file, content))
        check(file_exists(test_file))
        
        val read_content = file_read(test_file)
        expect(read_content).to_equal(content)
        
        check(file_delete(test_file))
        check(not file_exists(test_file))
    
    it "copies files":
        val src = "/tmp/simple_copy_src.txt"
        val dst = "/tmp/simple_copy_dst.txt"
        
        file_write(src, "Copy test")
        check(file_copy(src, dst))
        
        val dst_content = file_read(dst)
        expect(dst_content).to_equal("Copy test")
        
        file_delete(src)
        file_delete(dst)
    
    it "gets file size":
        val test_file = "/tmp/simple_size_test.txt"
        val content = "12345"
        
        file_write(test_file, content)
        val size = file_size_raw(test_file)
        expect(size).to_equal(5)
        
        file_delete(test_file)

describe "Native Directory Operations":
    it "creates directories":
        val test_dir = "/tmp/simple_native_dir_test"
        
        check(dir_create(test_dir, false))
        check(is_dir(test_dir))
        check(dir_remove_all(test_dir) == 0)
    
    it "creates nested directories recursively":
        val test_dir = "/tmp/simple_native_deep/sub1/sub2"
        
        check(dir_create(test_dir, true))
        check(is_dir(test_dir))
        check(dir_remove_all("/tmp/simple_native_deep") == 0)
    
    it "creates directory tree with dir_create_all":
        val test_dir = "/tmp/simple_create_all/a/b/c"
        
        check(dir_create_all(test_dir))
        check(is_dir(test_dir))
        check(dir_remove_all("/tmp/simple_create_all") == 0)
