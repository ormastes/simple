"""
Feature: Context Sharing with context_def
Category: BDD Framework
Status: Complete
"""

# Test file for Context Sharing (context_def)
# Verifies reusable context definitions work correctly

# ============================================================================
# Define reusable contexts
# ============================================================================

context_def :with_counter:
    given_lazy :counter, \: 0
    given_lazy :increment, \: 1

context_def :with_list:
    given_lazy :items, \: [1, 2, 3]
    given_lazy :empty_list, \: []

context_def :with_strings:
    given_lazy :greeting, \: "hello"
    given_lazy :name, \: "world"

context_def :with_booleans:
    given_lazy :flag_true, \: true
    given_lazy :flag_false, \: false

# ============================================================================
# Tests
# ============================================================================

describe "Context Sharing (context_def)":
    """
    Tests reusable context definitions (context_def) for BDD fixtures.
    Verifies that contexts can be defined once and reused across multiple tests.
    """

    describe "basic context_def usage":
        """
        Tests basic usage of context_def with simple fixture values.
        """
        context :with_counter:
            it "provides counter value":
                expect get_let(:counter) == 0
            
            it "provides increment value":
                expect get_let(:increment) == 1

    describe "list context":
        """
        Tests context_def with list fixtures and accessing list elements.
        """
        context :with_list:
            it "provides items":
                val items = get_let(:items)
                expect len(items) == 3
            
            it "provides empty list":
                val empty = get_let(:empty_list)
                expect len(empty) == 0
            
            it "items are accessible":
                val items = get_let(:items)
                expect items[0] == 1

    describe "string context":
        """
        Tests context_def with string fixtures.
        """
        context :with_strings:
            it "provides greeting":
                expect get_let(:greeting) == "hello"
            
            it "provides name":
                expect get_let(:name) == "world"

    describe "boolean context":
        """
        Tests context_def with boolean fixtures.
        """
        context :with_booleans:
            it "provides true flag":
                expect get_let(:flag_true) == true
            
            it "provides false flag":
                expect get_let(:flag_false) == false

    describe "reusing contexts":
        """
        Tests that context_def can be reused multiple times without duplication.
        """
        context :with_counter:
            it "works first time":
                expect get_let(:counter) == 0
        
        context :with_counter:
            it "works second time":
                expect get_let(:counter) == 0

    describe "nested contexts with context_def":
        """
        Tests nesting of context_def with inline context blocks and fixture inheritance.
        """
        context :with_list:
            it "outer has items":
                val items = get_let(:items)
                expect len(items) == 3
            
            context "inner context":
                given_lazy :extra, \: 99
                
                it "inner has extra":
                    expect get_let(:extra) == 99
                
                it "inner still has outer items":
                    val items = get_let(:items)
                    expect len(items) == 3

main = 0
