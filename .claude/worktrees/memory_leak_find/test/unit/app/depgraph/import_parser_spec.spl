"""
# Import Parser Specification

**Feature IDs:** #TBD
**Category:** Tooling
**Status:** In Progress

## Overview

Tests that the import parser correctly identifies import statements
from source code strings.
"""

use std.spec


enum ImportKind:
    Use
    ExportUse
    CommonUse
    TypeUse

class ImportEntry:
    path: text
    kind: ImportKind
    is_glob: bool
    line_number: i64

    fn new(path: text, kind: ImportKind) -> ImportEntry:
        return ImportEntry(
            path: path,
            kind: kind,
            is_glob: false,
            line_number: 0
        )

class ParseResult:
    file_path: text
    imports: [ImportEntry]

    fn new(file_path: text) -> ParseResult:
        return ParseResult(
            file_path: file_path,
            imports: []
        )

fn parse_source(file_path: text, source: text) -> ParseResult:
    var imports: [ImportEntry] = []

    val lines = source.split("\n")
    for line in lines:
        val trimmed = line.trim()
        if trimmed.starts_with("import "):
            val path = trimmed.substring(7, trimmed.len())
            val entry = ImportEntry.new(path, ImportKind.Use)
            imports.push(entry)

    var result = ParseResult.new(file_path)
    result.imports = imports
    return result


describe "Import Parser":
    it "parses source with no imports":
        val source = "fn main(): 0\n"
        val result = parse_source("test.spl", source)
        expect(result.imports.len()).to_equal(0)

    it "parses source with one import":
        val source = "import foo.bar\nfn main(): 0\n"
        val result = parse_source("test.spl", source)
        expect(result.imports.len()).to_equal(1)
