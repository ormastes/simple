"""
# Color Utilities Specification

**Feature IDs:** #COLOR-001 to #COLOR-015
**Category:** Tooling | Color Management
**Difficulty:** 3/5
**Status:** Complete

## Overview

This specification covers color utility functions for RGB and HSL color spaces:
1. RGB color creation and manipulation
2. HSL color space conversions
3. Color scheme generation (complementary, triadic)
4. WCAG accessibility checking and luminance calculations
5. Color utility functions (invert, grayscale, lighten, darken, etc.)

## Key Concepts

| Concept | Description |
|---------|-------------|
| RGB | Red-Green-Blue color space (0-255 range) |
| HSL | Hue-Saturation-Lightness color space |
| Luminance | Relative brightness for accessibility |
| WCAG | Web Content Accessibility Guidelines |
| Color Schemes | Complementary and triadic color relationships |

## Behavior

- RGB values are bounded to 0-255 range
- HSL hue is in 0-360 range, saturation and lightness in 0-100 range
- WCAG AA requires contrast ratio >= 4.5:1
- WCAG AAA requires contrast ratio >= 7.0:1
- Color manipulation functions return clamped RGB values
"""

use std.color_utils.{
    RGB, HSL,
    rgb_to_hsl, hsl_to_rgb,
    lighten, darken, saturate, desaturate,
    complementary_scheme, triadic_scheme,
    relative_luminance, contrast_ratio,
    meets_wcag_aa, meets_wcag_aaa,
    named_color, invert, grayscale
}

# =====================================
# BDD Tests
# =====================================

describe "Color Utilities":
    """
    ## RGB and HSL Color Space Operations

    Verifies color utility implementations for RGB and HSL color spaces,
    including conversions, schemes, and accessibility checks.
    """

    describe "RGB Construction":
        """
        ## RGB Color Creation

        Tests for creating RGB colors with various methods.
        """

        it "creates RGB color":
            val color = RGB.create(r=255, g=128, b=0)
            expect color.r == 255
            expect color.g == 128
            expect color.b == 0

        it "creates black":
            val black = RGB.black()
            expect black.r == 0
            expect black.g == 0
            expect black.b == 0

        it "creates white":
            val white = RGB.white()
            expect white.r == 255
            expect white.g == 255
            expect white.b == 255

    describe "HSL Construction":
        """
        ## HSL Color Creation

        Tests for creating colors in HSL color space.
        """

        it "creates HSL color":
            val color = HSL.create(h=180.0, s=50.0, l=50.0)
            expect color.h == 180.0
            expect color.s == 50.0
            expect color.l == 50.0

    # Hex Conversion tests skipped - require runtime string methods (.chars(), .starts_with(), .contains())
    # describe "Hex Conversion":
    #     it "converts RGB to hex": ...
    #     it "parses hex to RGB": ...
    #     it "returns nil for invalid hex": ...

    describe "RGB/HSL Conversion":
        """
        ## Color Space Conversions

        Tests conversions between RGB and HSL color spaces.
        """

        it "converts red to HSL":
            val red = RGB.create(r=255, g=0, b=0)
            val hsl = rgb_to_hsl(red)
            expect hsl.h < 1.0
            expect hsl.s > 99.0
            expect hsl.l > 49.0 and hsl.l < 51.0

        it "converts gray to HSL with zero saturation":
            val gray = RGB.create(r=128, g=128, b=128)
            val hsl = rgb_to_hsl(gray)
            expect hsl.s < 1.0

    describe "Color Manipulation":
        """
        ## Color Adjustment Functions

        Tests functions that modify colors (lighten, darken, saturate, etc.).
        """

        it "lightens color":
            val base = RGB.create(r=100, g=100, b=100)
            val lighter = lighten(base, 20.0)
            expect lighter.r >= 0 and lighter.r <= 255

        it "darkens color":
            val base = RGB.create(r=200, g=200, b=200)
            val darker = darken(base, 20.0)
            expect darker.r >= 0 and darker.r <= 255

        it "saturates color":
            val base = RGB.create(r=150, g=100, b=100)
            val saturated = saturate(base, 20.0)
            expect saturated.r >= 0 and saturated.r <= 255

        it "desaturates color":
            val base = RGB.create(r=200, g=100, b=100)
            val desaturated = desaturate(base, 20.0)
            expect desaturated.r >= 0 and desaturated.r <= 255

    describe "Color Schemes":
        """
        ## Color Scheme Generation

        Tests generation of color schemes (complementary, triadic).
        """

        it "creates complementary scheme":
            val base = RGB.create(r=255, g=0, b=0)
            val complement = complementary_scheme(base)
            expect complement.r >= 0 and complement.r <= 255

        it "creates triadic scheme":
            val base = RGB.create(r=255, g=0, b=0)
            val (c1, c2, c3) = triadic_scheme(base)
            expect c1.r >= 0 and c1.r <= 255
            expect c2.r >= 0 and c2.r <= 255
            expect c3.r >= 0 and c3.r <= 255

    describe "WCAG Luminance":
        """
        ## WCAG Relative Luminance

        Tests calculation of relative luminance for accessibility.
        """

        it "calculates luminance for black":
            val black = RGB.black()
            val lum = relative_luminance(black)
            expect lum < 0.01

        it "calculates luminance for white":
            val white = RGB.white()
            val lum = relative_luminance(white)
            expect lum > 0.99

    describe "WCAG Contrast":
        """
        ## WCAG Contrast Ratio Checking

        Tests WCAG accessibility guidelines for contrast ratios.
        """

        it "calculates high contrast for black/white":
            val black = RGB.black()
            val white = RGB.white()
            val ratio = contrast_ratio(c1=black, c2=white)
            expect ratio > 20.0

        it "calculates low contrast for same color":
            val color = RGB.create(r=128, g=128, b=128)
            val ratio = contrast_ratio(c1=color, c2=color)
            expect ratio < 1.1 and ratio > 0.9

        it "validates WCAG AA for black/white":
            val black = RGB.black()
            val white = RGB.white()
            expect meets_wcag_aa(c1=black, c2=white)

        it "validates WCAG AAA for black/white":
            val black = RGB.black()
            val white = RGB.white()
            expect meets_wcag_aaa(c1=black, c2=white)

    describe "Named Colors":
        """
        ## Named Color Lookup

        Tests retrieval of colors by name.
        """

        it "finds red":
            val color = named_color("red")
            expect color != nil
            expect color.r == 255
            expect color.g == 0
            expect color.b == 0

        it "returns nil for unknown color":
            val color = named_color("notacolor")
            expect color == nil

    describe "Utility Functions":
        """
        ## Color Utility Functions

        Tests invert, grayscale, and other utility functions.
        """

        it "inverts color":
            val red = RGB.create(r=255, g=0, b=0)
            val inverted = invert(red)
            expect inverted.r == 0
            expect inverted.g == 255
            expect inverted.b == 255

        it "converts to grayscale":
            val color = RGB.create(r=200, g=100, b=50)
            val gray = grayscale(color)
            expect gray.r == gray.g
            expect gray.g == gray.b
