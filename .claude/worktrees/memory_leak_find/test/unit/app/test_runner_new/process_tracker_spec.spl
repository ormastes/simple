# Process Tracker Specification
# Tests for child process and container tracking

use std.spec.{describe, it, expect}
use app.test_runner_new.process_tracker.{tracker_kill_all_children, tracker_stop_all_containers}
use app.test_runner_new.process_tracker.{is_docker_available, get_running_containers}

# NOTE: Tests for tracker_register_pid, tracker_get_pids, tracker_clear are skipped
# due to runtime limitations with module-level mutable state. The infrastructure
# is in place for Week 1 deliverable, but full testing requires compiled mode.

describe "process tracker - kill children":
    it "should return 0 when no PIDs registered":
        val killed = tracker_kill_all_children()
        expect(killed).to_equal(0)

    it "should not crash with invalid PIDs":
        # Should not crash, returns value in any case
        val killed = tracker_kill_all_children()
        val is_valid_count = killed >= 0
        expect(is_valid_count).to_equal(true)

describe "process tracker - stop containers":
    it "should return 0 when no containers registered":
        val stopped = tracker_stop_all_containers()
        expect(stopped).to_equal(0)

    it "should not crash with no containers":
        # Should not crash, just return 0
        val stopped = tracker_stop_all_containers()
        expect(stopped).to_equal(0)

describe "process tracker - Docker availability":
    it "should detect if Docker is available":
        val available = is_docker_available()

        # Should return true or false, not crash
        val is_bool = available == true or available == false
        expect(is_bool).to_equal(true)

describe "process tracker - get running containers":
    it "should return list of containers":
        val containers = get_running_containers()

        # Should return an array (possibly empty)
        val is_array = containers.len() >= 0
        expect(is_array).to_equal(true)

    it "should return empty list when no containers":
        val containers = get_running_containers()

        # Should be an array
        val has_len = containers.len() >= 0
        expect(has_len).to_equal(true)
