"""
MCP Logging Specification
Feature: MCP Log Level and Emission
Category: MCP, Logging
Status: Complete
"""

use std.spec
use app.mcp.helpers.{log_level_to_int, make_log_notification}

describe "MCP Log Level Mapping":
    it "maps debug to 0":
        expect(log_level_to_int("debug")).to_equal(0)

    it "maps info to 1":
        expect(log_level_to_int("info")).to_equal(1)

    it "maps notice to 2":
        expect(log_level_to_int("notice")).to_equal(2)

    it "maps warning to 3":
        expect(log_level_to_int("warning")).to_equal(3)

    it "maps error to 4":
        expect(log_level_to_int("error")).to_equal(4)

    it "maps critical to 5":
        expect(log_level_to_int("critical")).to_equal(5)

    it "maps alert to 6":
        expect(log_level_to_int("alert")).to_equal(6)

    it "maps emergency to 7":
        expect(log_level_to_int("emergency")).to_equal(7)

    it "returns -1 for unknown level":
        expect(log_level_to_int("unknown")).to_equal(-1)

describe "MCP Log Notification Building":
    it "builds log notification with all fields":
        val notif = make_log_notification("info", "Test message", "mcp.server")
        expect(notif.contains("\"level\":\"info\"")).to_equal(true)
        expect(notif.contains("Test message")).to_equal(true)
        expect(notif.contains("\"logger\":\"mcp.server\"")).to_equal(true)
        expect(notif.contains("notifications/message")).to_equal(true)

    it "builds log notification without logger":
        val notif = make_log_notification("error", "Something failed", "")
        expect(notif.contains("\"level\":\"error\"")).to_equal(true)
        expect(notif.contains("Something failed")).to_equal(true)

describe "MCP Log Level Comparison":
    it "debug is lowest priority":
        expect(log_level_to_int("debug") < log_level_to_int("info")).to_equal(true)

    it "emergency is highest priority":
        expect(log_level_to_int("emergency") > log_level_to_int("error")).to_equal(true)

    it "levels increase monotonically":
        expect(log_level_to_int("debug") < log_level_to_int("info")).to_equal(true)
        expect(log_level_to_int("info") < log_level_to_int("warning")).to_equal(true)
        expect(log_level_to_int("warning") < log_level_to_int("error")).to_equal(true)
        expect(log_level_to_int("error") < log_level_to_int("emergency")).to_equal(true)
