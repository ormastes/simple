# Integration test for statistics module - verify all functions work

use app.doc.public_check.statistics.{
    calculate_public_coverage,
    format_coverage_report,
    coverage_to_json,
    meets_threshold,
    format_summary_report,
    summary_to_json
}

# Test basic calculation
val exports1 = ["foo", "bar", "baz", "qux", "quux"]
val documented1 = ["foo", "bar", "baz"]

val stats1 = calculate_public_coverage("src/test/module1.spl", exports1, documented1)

print "Module 1 stats:"
print "  Total: {stats1.total_exports}"
print "  Documented: {stats1.documented_exports}"
print "  Coverage: {stats1.coverage_percentage}%"
print ""

# Test text report formatting
val report = format_coverage_report(stats1)
print "Text Report:"
print report
print ""

# Test JSON formatting
val json_str = coverage_to_json(stats1)
print "JSON Format:"
print json_str
print ""

# Test threshold checking
val threshold_80 = meets_threshold(stats1, 80.0)
val threshold_50 = meets_threshold(stats1, 50.0)
print "Meets 80% threshold: {threshold_80}"
print "Meets 50% threshold: {threshold_50}"
print ""

# Test summary with multiple modules
val exports2 = ["alpha", "beta"]
val documented2 = ["alpha", "beta"]
val stats2 = calculate_public_coverage("src/test/module2.spl", exports2, documented2)

val all_stats = [stats1, stats2]

print "Summary Report:"
val summary = format_summary_report(all_stats)
print summary
print ""

print "Summary JSON:"
val summary_json = summary_to_json(all_stats)
print summary_json

print ""
print "All integration tests completed successfully!"
