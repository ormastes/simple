# Probability Utilities Module Extended Specification
#
# Tests for std.probability_utils module: collision_probability (birthday paradox).

use std.probability_utils.{collision_probability}

# ============================================================================
# collision_probability
# ============================================================================

describe "collision_probability":

    it "returns 0 for n=0":
        val result = collision_probability(0)
        expect(result).to_equal(0.0)

    it "returns 0 for n=1":
        val result = collision_probability(1)
        expect(result).to_equal(0.0)

    it "returns 0 for negative n":
        val result = collision_probability(-5)
        expect(result).to_equal(0.0)

    it "returns positive probability for n=2":
        val result = collision_probability(2)
        val positive = result > 0.0
        expect(positive).to_equal(true)

    it "returns very small probability for n=10":
        val result = collision_probability(10)
        val very_small = result < 0.001
        val positive = result > 0.0
        expect(very_small).to_equal(true)
        expect(positive).to_equal(true)

    it "probability increases with n":
        val p10 = collision_probability(10)
        val p100 = collision_probability(100)
        val p1000 = collision_probability(1000)
        val p10_lt_p100 = p10 < p100
        val p100_lt_p1000 = p100 < p1000
        expect(p10_lt_p100).to_equal(true)
        expect(p100_lt_p1000).to_equal(true)

    it "probability for n=1000 is still very small (64-bit space)":
        val result = collision_probability(1000)
        val tiny = result < 0.001
        expect(tiny).to_equal(true)

    it "probability scales quadratically with n":
        # P(n) ~ n*(n-1) / (2 * 2^64)
        # P(2n) ~ 4 * P(n) for small n
        val p100 = collision_probability(100)
        val p200 = collision_probability(200)
        # ratio should be approximately 4 (actually about (200*199)/(100*99) ~ 3.98)
        val ratio = p200 / p100
        val near_4 = ratio > 3.5
        val under_5 = ratio < 4.5
        expect(near_4).to_equal(true)
        expect(under_5).to_equal(true)

    it "returns non-negative probability for large n":
        val result = collision_probability(100000)
        val non_neg = result >= 0.0
        expect(non_neg).to_equal(true)
