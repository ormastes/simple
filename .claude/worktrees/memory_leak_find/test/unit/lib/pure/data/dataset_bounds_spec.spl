# Tests for ArrayDataset and LabeledDataset boundary behavior

use std.pure.data.dataset.{ArrayDataset, LabeledDataset, LabeledSample}

describe "Dataset Bounds":
    describe "ArrayDataset":
        it "returns empty for negative index":
            val data = [[1.0, 2.0], [3.0, 4.0]]
            val ds = ArrayDataset(data: data)
            val result = ds.get_item(-1)
            expect(result.len()).to_equal(0)

        it "returns empty for out-of-bounds index":
            val data = [[1.0, 2.0], [3.0, 4.0]]
            val ds = ArrayDataset(data: data)
            val result = ds.get_item(5)
            expect(result.len()).to_equal(0)

        it "returns valid item for in-bounds index":
            val data = [[1.0, 2.0], [3.0, 4.0]]
            val ds = ArrayDataset(data: data)
            val result = ds.get_item(0)
            expect(result.len()).to_equal(2)

        it "returns correct len":
            val data = [[1.0], [2.0], [3.0]]
            val ds = ArrayDataset(data: data)
            expect(ds.len()).to_equal(3)

    describe "LabeledDataset":
        it "returns default sample for negative index":
            val features = [[1.0, 2.0]]
            val labels = [0.0]
            val ds = LabeledDataset(features: features, labels: labels)
            val result = ds.get_item(-1)
            expect(result.feature.len()).to_equal(0)
            expect(result.label).to_equal(0.0)

        it "returns default sample for out-of-bounds index":
            val features = [[1.0, 2.0]]
            val labels = [0.0]
            val ds = LabeledDataset(features: features, labels: labels)
            val result = ds.get_item(10)
            expect(result.feature.len()).to_equal(0)
            expect(result.label).to_equal(0.0)

        it "returns valid sample for in-bounds index":
            val features = [[1.0, 2.0], [3.0, 4.0]]
            val labels = [0.0, 1.0]
            val ds = LabeledDataset(features: features, labels: labels)
            val result = ds.get_item(1)
            expect(result.label).to_equal(1.0)

        it "returns correct len":
            val features = [[1.0], [2.0]]
            val labels = [0.0, 1.0]
            val ds = LabeledDataset(features: features, labels: labels)
            expect(ds.len()).to_equal(2)
