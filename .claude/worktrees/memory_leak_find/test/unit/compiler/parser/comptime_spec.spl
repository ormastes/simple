# Comptime spec
#
# Tests for compile-time evaluation using const declarations.
# `const fn` and `comptime val` are planned features; currently
# `const` bindings and regular functions achieve the same effect.

const FACTORIAL_5 = 120
const MAX_SIZE = 65536
const PI_APPROX = 3.14

fn factorial(n: i64) -> i64:
    if n <= 1:
        return 1
    n * factorial(n - 1)

describe "comptime and const fn":
    it "const fn is callable normally":
        val result = factorial(5)
        expect(result).to_equal(120)

    it "const val holds precomputed result":
        expect(FACTORIAL_5).to_equal(120)

    it "const arithmetic works":
        expect(MAX_SIZE).to_equal(65536)

    it "const fn works with base case":
        val result = factorial(1)
        expect(result).to_equal(1)

    it "const fn works with larger input":
        val result = factorial(7)
        expect(result).to_equal(5040)

    it "const float value accessible":
        expect(PI_APPROX).to_be_greater_than(3.0)
