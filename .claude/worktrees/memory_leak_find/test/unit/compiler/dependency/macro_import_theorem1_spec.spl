use compiler.dependency.macro_import.{
    MacroSymbol, AutoImport,
    MacroExports, MacroDirManifest,
    glob_import
}

fn make_exports() -> MacroExports:
    var exports = MacroExports.new()
    exports.add_non_macro(MacroSymbol.value_sym("mod", "foo"))
    exports.add_non_macro(MacroSymbol.value_sym("mod", "bar"))
    exports.add_macro(MacroSymbol.macro_sym("mod", "my_macro"))
    exports.add_macro(MacroSymbol.macro_sym("mod", "other_macro"))
    exports

describe "Lean Theorem 1: glob_doesnt_leak_macros_wf":
    it "macro not in auto-import is excluded":
        val exports = make_exports()

        var manifest = MacroDirManifest.new("test")
        manifest.add_auto_import(AutoImport.new("mod", "my_macro"))

        val result = glob_import(manifest, exports)

        var found_other = false
        for sym in result:
            val sym_name = sym.get_name()
            if sym_name == "other_macro":
                found_other = true

        expect not found_other
