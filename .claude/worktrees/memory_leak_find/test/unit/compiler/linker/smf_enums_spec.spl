# SMF Enums Specification
#
# Unit tests for SMF enum types:
# - Platform: OS/target platform identifiers
# - Arch: CPU architecture identifiers
# - CompressionType: Compression algorithm identifiers
# - SmfAppType: Application type hints

use ..smf_enums.*

describe "Platform enum":
    it "converts from u8 to Platform correctly":
        expect(Platform.from_u8(0) == Platform.Any)
        expect(Platform.from_u8(1) == Platform.Linux)
        expect(Platform.from_u8(2) == Platform.Windows)
        expect(Platform.from_u8(3) == Platform.MacOS)
        expect(Platform.from_u8(4) == Platform.FreeBSD)
        expect(Platform.from_u8(5) == Platform.None_)

    it "defaults to Any for unknown u8 values":
        expect(Platform.from_u8(99) == Platform.Any)
        expect(Platform.from_u8(255) == Platform.Any)

    it "converts Platform to u8 correctly":
        expect(Platform.Any.to_u8() == 0)
        expect(Platform.Linux.to_u8() == 1)
        expect(Platform.Windows.to_u8() == 2)
        expect(Platform.MacOS.to_u8() == 3)
        expect(Platform.FreeBSD.to_u8() == 4)
        expect(Platform.None_.to_u8() == 5)

    it "round-trips u8 conversion correctly":
        for i in 0..6:
            val platform = Platform.from_u8(i)
            expect(platform.to_u8() == i)

    it "returns correct platform names":
        expect(Platform.Any.name() == "any")
        expect(Platform.Linux.name() == "linux")
        expect(Platform.Windows.name() == "windows")
        expect(Platform.MacOS.name() == "macos")
        expect(Platform.FreeBSD.name() == "freebsd")
        expect(Platform.None_.name() == "none")

describe "Arch enum":
    it "converts from u8 to Arch correctly":
        expect(Arch.from_u8(0) == Arch.X86_64)
        expect(Arch.from_u8(1) == Arch.Aarch64)
        expect(Arch.from_u8(2) == Arch.X86)
        expect(Arch.from_u8(3) == Arch.Arm)
        expect(Arch.from_u8(4) == Arch.Riscv64)
        expect(Arch.from_u8(5) == Arch.Riscv32)
        expect(Arch.from_u8(6) == Arch.Wasm32)
        expect(Arch.from_u8(7) == Arch.Wasm64)

    it "defaults to X86_64 for unknown u8 values":
        expect(Arch.from_u8(99) == Arch.X86_64)
        expect(Arch.from_u8(255) == Arch.X86_64)

    it "converts Arch to u8 correctly":
        expect(Arch.X86_64.to_u8() == 0)
        expect(Arch.Aarch64.to_u8() == 1)
        expect(Arch.X86.to_u8() == 2)
        expect(Arch.Arm.to_u8() == 3)
        expect(Arch.Riscv64.to_u8() == 4)
        expect(Arch.Riscv32.to_u8() == 5)
        expect(Arch.Wasm32.to_u8() == 6)
        expect(Arch.Wasm64.to_u8() == 7)

    it "round-trips u8 conversion correctly":
        for i in 0..8:
            val arch = Arch.from_u8(i)
            expect(arch.to_u8() == i)

    it "returns correct architecture names":
        expect(Arch.X86_64.name() == "x86_64")
        expect(Arch.Aarch64.name() == "aarch64")
        expect(Arch.X86.name() == "x86")
        expect(Arch.Arm.name() == "arm")
        expect(Arch.Riscv64.name() == "riscv64")
        expect(Arch.Riscv32.name() == "riscv32")
        expect(Arch.Wasm32.name() == "wasm32")
        expect(Arch.Wasm64.name() == "wasm64")

    it "correctly identifies 32-bit architectures":
        expect(Arch.X86.is_32bit())
        expect(Arch.Arm.is_32bit())
        expect(Arch.Riscv32.is_32bit())
        expect(Arch.Wasm32.is_32bit())

        expect(not Arch.X86_64.is_32bit())
        expect(not Arch.Aarch64.is_32bit())
        expect(not Arch.Riscv64.is_32bit())
        expect(not Arch.Wasm64.is_32bit())

    it "correctly identifies 64-bit architectures":
        expect(Arch.X86_64.is_64bit())
        expect(Arch.Aarch64.is_64bit())
        expect(Arch.Riscv64.is_64bit())
        expect(Arch.Wasm64.is_64bit())

        expect(not Arch.X86.is_64bit())
        expect(not Arch.Arm.is_64bit())
        expect(not Arch.Riscv32.is_64bit())
        expect(not Arch.Wasm32.is_64bit())

describe "CompressionType enum":
    it "converts from u8 to CompressionType correctly":
        expect(CompressionType.from_u8(0) == CompressionType.None_)
        expect(CompressionType.from_u8(1) == CompressionType.Zstd)
        expect(CompressionType.from_u8(2) == CompressionType.Lz4)

    it "defaults to None_ for unknown u8 values":
        expect(CompressionType.from_u8(99) == CompressionType.None_)
        expect(CompressionType.from_u8(255) == CompressionType.None_)

    it "converts CompressionType to u8 correctly":
        expect(CompressionType.None_.to_u8() == 0)
        expect(CompressionType.Zstd.to_u8() == 1)
        expect(CompressionType.Lz4.to_u8() == 2)

    it "round-trips u8 conversion correctly":
        for i in 0..3:
            val compression = CompressionType.from_u8(i)
            expect(compression.to_u8() == i)

    it "returns correct compression names":
        expect(CompressionType.None_.name() == "none")
        expect(CompressionType.Zstd.name() == "zstd")
        expect(CompressionType.Lz4.name() == "lz4")

describe "SmfAppType enum":
    it "converts from u8 to SmfAppType correctly":
        expect(SmfAppType.from_u8(0) == SmfAppType.Cli)
        expect(SmfAppType.from_u8(1) == SmfAppType.Tui)
        expect(SmfAppType.from_u8(2) == SmfAppType.Gui)
        expect(SmfAppType.from_u8(3) == SmfAppType.Service)
        expect(SmfAppType.from_u8(4) == SmfAppType.Repl)

    it "defaults to Cli for unknown u8 values":
        expect(SmfAppType.from_u8(99) == SmfAppType.Cli)
        expect(SmfAppType.from_u8(255) == SmfAppType.Cli)

    it "converts SmfAppType to u8 correctly":
        expect(SmfAppType.Cli.to_u8() == 0)
        expect(SmfAppType.Tui.to_u8() == 1)
        expect(SmfAppType.Gui.to_u8() == 2)
        expect(SmfAppType.Service.to_u8() == 3)
        expect(SmfAppType.Repl.to_u8() == 4)

    it "round-trips u8 conversion correctly":
        for i in 0..5:
            val app_type = SmfAppType.from_u8(i)
            expect(app_type.to_u8() == i)

    it "returns correct app type names":
        expect(SmfAppType.Cli.name() == "cli")
        expect(SmfAppType.Tui.name() == "tui")
        expect(SmfAppType.Gui.name() == "gui")
        expect(SmfAppType.Service.name() == "service")
        expect(SmfAppType.Repl.name() == "repl")
