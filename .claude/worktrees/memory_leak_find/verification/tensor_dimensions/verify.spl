# Verification script for Tensor Dimensions Lean proofs

use app.io.mod.{shell, shell_bool, shell_output, print, exit}
use std.text.{trim}

fn main():
    print "============================================================"
    print "  Tensor Dimension Inference - Lean 4 Verification"
    print "============================================================"
    print ""

    # Check if Lake is installed
    if not shell_bool("command -v lake"):
        print "Error: Lake (Lean build tool) is not installed"
        print "   Install Lean 4 from: https://leanprover.github.io/lean4/doc/setup.html"
        exit(1)

    val lake_version = shell_output("lake --version")
    var trimmed_version = trim(lake_version)
    print "Lake found: {trimmed_version}"
    print ""

    # Update dependencies (first time only)
    print "Updating Lake dependencies..."
    shell("lake update")

    print ""
    print "Building Lean verification project..."
    val build_result = shell("lake build")

    if build_result.exit_code == 0:
        print ""
        print "============================================================"
        print "  VERIFICATION SUCCESSFUL"
        print "============================================================"
        print ""
        print "All theorems verified:"
        print "  - shapesCompatible_refl"
        print "  - unifyDim_success_eq"
        print "  - matmulShape_deterministic"
        print "  - min_le_max_elements"
        print "  - training_fits_if_max_fits"
        print "  - components_fit_implies_total_fits"
        print "  - training_memory_bounds_consistent"
        print "  - tensor_memory_bounds_valid"
        print ""
    if build_result.exit_code != 0:
        print ""
        print "============================================================"
        print "  VERIFICATION FAILED"
        print "============================================================"
        print ""
        print "Check the output above for errors in the Lean proofs."
        exit(1)

main()
