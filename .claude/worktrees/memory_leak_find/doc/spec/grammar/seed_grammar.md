# Simple Language Grammar - Seed Tier

> **Seed tier**: The C++ bootstrap compiler (`src/compiler_seed/seed.cpp`). Minimal subset
> of Simple needed to compile the core compiler.

*Generated by `bin/simple grammar-doc` from `doc/spec/grammar/tier_keywords.sdn`.*

---

## Keywords

| Keyword | Category | Tier | Description | Example |
|---------|----------|------|-------------|---------|
| `fn` | declarations | seed | Function definition | `fn square(x: i64) -> i64: x * x` |
| `val` | declarations | seed | Immutable binding | `val name = "Alice"` |
| `var` | declarations | seed | Mutable binding | `var count = 0` |
| `struct` | declarations | seed | Struct definition | `struct Point: x: i64; y: i64` |
| `enum` | declarations | seed | Enum definition | `enum Color: Red; Green; Blue` |
| `class` | declarations | seed | Class definition (struct with methods) | `class Dog: name: text` |
| `impl` | declarations | seed | Method implementation block | `impl Point: fn len(): ...` |
| `extern` | declarations | seed | External function declaration (FFI) | `extern fn rt_print(s: text)` |
| `use` | declarations | seed | Module import | `use std.math.{sqrt, abs}` |
| `export` | declarations | seed | Symbol export | `export my_fn, MyType` |
| `import` | declarations | seed | Module import (deprecated, use use) |  |
| `static` | declarations | seed | Static method or binding |  |
| `me` | declarations | seed | Mutable self method |  |
| `asm` | declarations | seed | Inline assembly block |  |
| `if` | control_flow | seed | Conditional branch | `if x > 0: print "positive"` |
| `elif` | control_flow | seed | Else-if branch |  |
| `else` | control_flow | seed | Else branch |  |
| `for` | control_flow | seed | For loop | `for item in items: print item` |
| `while` | control_flow | seed | While loop |  |
| `match` | control_flow | seed | Pattern match expression | `match value: case 1: ...` |
| `case` | control_flow | seed | Match arm |  |
| `return` | control_flow | seed | Return from function | `return result` |
| `break` | control_flow | seed | Break out of loop |  |
| `continue` | control_flow | seed | Skip to next iteration |  |
| `in` | control_flow | seed | Membership / iteration operator |  |
| `pass` | control_flow | seed | No-op placeholder |  |
| `pass_todo` | control_flow | seed | Unimplemented placeholder (TODO) |  |
| `pass_do_nothing` | control_flow | seed | Intentional no-op |  |
| `pass_dn` | control_flow | seed | Alias for pass_do_nothing |  |
| `and` | control_flow | seed | Logical AND | `if a and b: ...` |
| `or` | control_flow | seed | Logical OR |  |
| `not` | control_flow | seed | Logical NOT |  |
| `self` | control_flow | seed | Current instance reference |  |
| `true` | expressions | seed | Boolean true literal | `val done = true` |
| `false` | expressions | seed | Boolean false literal |  |
| `nil` | expressions | seed | Null/none value | `var result = nil` |
| `super` | expressions | seed | Parent module reference |  |
| `Some` | expressions | seed | Option type wrapper |  |
| `Ok` | expressions | seed | Result success wrapper |  |
| `Err` | expressions | seed | Result error wrapper |  |
| `None` | expressions | seed | Option empty value |  |

## Operators

| Operator | Symbol | Tier |
|----------|--------|------|
| plus | `+` | seed |
| minus | `-` | seed |
| star | `*` | seed |
| slash | `/` | seed |
| percent | `%` | seed |
| eq | `==` | seed |
| not_eq | `!=` | seed |
| lt | `<` | seed |
| gt | `>` | seed |
| lt_eq | `<=` | seed |
| gt_eq | `>=` | seed |
| assign | `=` | seed |
| plus_eq | `+=` | seed |
| minus_eq | `-=` | seed |
| star_eq | `*=` | seed |
| slash_eq | `/=` | seed |
| percent_eq | `%=` | seed |
| dot_dot | `..` | seed |

## Constructs

| Construct | Tier |
|-----------|------|
| string_interpolation | seed |
| raw_string | seed |
| range_expr | seed |
| array_literal | seed |
| struct_constructor | seed |
| when_block | seed |
| cfg_attribute | seed |

## Assembly Capabilities

| Capability | Kind | Tier | Description |
|------------|------|------|-------------|
| asm_single_line | clang-depend | seed | Single-line asm statement (`asm "nop"`) |
| asm_indented_block | clang-depend | seed | Indented asm block (`asm:\n    "nop"`) |
| asm_braced_block | clang-depend | seed | Braced asm block (`asm nop`) |
| asm_match | clang-depend | seed | Target-conditional asm (`asm match: case [x86_64]: ...`) |
| asm_assert | clang-depend | seed | Target assertion (`asm assert [x86_64, linux]`) |

## Low-Level Features

| Feature | Tier | Description |
|---------|------|-------------|
| volatile_asm | seed | Volatile asm via C passthrough |

---

**Summary:** 41 keywords, 18 operators, 7 constructs

## Conditional Compilation (Platform/CPU)

Seed supports C-style source conditional directives:

- `#if <condition>`
- `#elif <condition>`
- `#else`
- `#endif`

Optional trailing `:` is accepted on hash directives (for example `#if linux:` and `#else:`).

### Supported condition atoms

- OS: `win`, `windows`, `linux`, `mac`, `macos`, `darwin`, `freebsd`, `openbsd`, `netbsd`, `android`, `unix`
- CPU/arch: `x86_64`, `amd64`, `x64`, `x86`, `i386`, `i686`, `aarch64`, `arm64`, `riscv64`, `riscv32`, `arm`, `ppc64le`
- Key/value: `os=linux`, `platform=windows`, `arch=x86_64`, `cpu=arm64`
- Boolean: `true`, `false`, `and`/`&&`, `or`/`||`, `not`/`!`
- Build: `debug`, `release`, `compiled`, `interpreter`

### Target override environment variables

- `SIMPLE_TARGET_OS`
- `SIMPLE_TARGET_ARCH`
- `SIMPLE_TARGET_CPU`

## Binary Completeness Gaps (2026-02-20)

> Hand-maintained status notes. Generated tables above are unchanged.
> See also `[asm_capabilities]` and `[low_level_features]` in `tier_keywords.sdn`.

### Clang-Depend Gaps (text passthrough — clang encodes)

| Capability | Current seed behavior | Status |
|---|---|---|
| `asm` text passthrough (single-line, block, braced) | **Working** — seed.cpp:3863-4018 | Done |
| `asm match: case [target]:` | **Working** — uses C preprocessor `#ifdef` | Done |
| `asm assert [target]` | **Working** — emits `static_assert` | Done |

### Compiler-Depend Gaps (compiler understands operands/registers)

| Capability | Current seed behavior | Status |
|---|---|---|
| `asm` with `in(reg)`/`out(reg)` operands | Not supported — requires register allocation (full only) | Full-tier only |
| `asm` clobber lists | Not supported — requires register allocation | Full-tier only |
| `asm` options (`volatile`, `noreturn`) | Not supported — requires attribute system | Full-tier only |

### Other Low-Level Gaps

| Capability | Current seed behavior | Evidence |
|---|---|---|
| Bitfield declarations | Not supported in seed subset | `seed.cpp:32` |
| `@packed`/`@repr`/`@align` attributes | No parse/lowering path | Seed subset does not include attributes |
| `union` declarations (C-style layout) | Only reserved-word rename in emitted C++ | `seed.cpp:3763` |
| Module/import/export semantics | Skipped during translation | `seed.cpp:2929` |
| Trait/type declarations in codegen | Trait blocks dropped in parse/emission (parse-skip) | `seed.cpp:3700` |

### Minimum Additions Needed In Seed

1. Add first-class AST+parser support for `bitfield`, `union`, and custom payload blocks.
2. Add attribute parsing/lowering for layout and ABI controls (`@repr`, `@packed`, `@align`, `@link_section`, `@addr_space`, `@callconv`, `@naked`, `@interrupt`).
3. Preserve and lower `use`/`import`/`export`/`mod` semantics instead of skipping them.
4. Emit deterministic data layout (`packed`, explicit alignment, explicit union storage) rather than dynamic fallbacks.

### Tier Boundaries — What Seed Should NOT Support

- Generics (`<T>`) — requires type system
- Trait semantics (dispatch, bounds, `dyn Trait`) — seed only parse-skips trait blocks
- Lambdas/closures — requires closure capture
- Optional chaining (`?.`/`??`) — requires runtime Optional support
- Pattern destructuring — requires pattern compiler
- `asm` operand constraints — requires register allocation (full-tier only)
- Multiple backends — seed always → C++ → clang
