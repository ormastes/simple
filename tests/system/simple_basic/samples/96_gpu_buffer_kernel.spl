# 96_gpu_buffer_kernel.spl - GPU API shape

# GPU API surface + buffer upload/download shape

use gpu

val ctx = gpu.Context.default()
val buf: gpu.Buffer[f32] = ctx.alloc(1024)

# Host data to upload
val host_data: [f32; 1024] = [0.0; 1024]
buf.upload(host_data)

# Kernel definition
@gpu.kernel
fn scale2(in: gpu.Buffer[f32], out: gpu.Buffer[f32]):
    val i = gpu.global_id()
    out[i] = in[i] * 2.0

# Launch kernel
ctx.launch(scale2, grid: 1024, args: (buf, buf))

# Download results
val result = buf.download()
print "result[0]={result[0]}"

main = 0
