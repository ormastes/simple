# Minimal Bare-Metal Hello World for QEMU x86
#
# This test verifies the baremetal infrastructure works.
# Expected output via serial: "Hello from bare-metal!"

use baremetal.x86.serial (serial_init, serial_write_string)
use baremetal.x86.io (outb)
use baremetal.common.test_harness (test_harness_init, test_start, test_pass, test_end)

# Entry point (called by bootloader)
fn _start():
    # Initialize serial port (COM1)
    serial_init()

    # Write hello message
    serial_write_string("Hello from bare-metal!\n")

    # Run a simple test
    test_harness_init()
    test_start("serial output")
    test_pass("serial output")
    test_end()

    # Exit QEMU via debug port (0xF4)
    outb(0xF4, 0)  # Exit code 0

fn main():
    _start()
