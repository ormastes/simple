# Simplest Bare-Metal Hello World
#
# Demonstrates:
# - Inline assembly for port I/O
# - Serial output via COM1
# - QEMU exit
#
# Build: simple build --target=baremetal-x86 test/baremetal/e2e_simple_hello.spl
# Run: qemu-system-i386 -kernel build/baremetal/kernel.elf -serial stdio -display none

# Port I/O using inline assembly
fn outb(port: u16, value: u8):
    unsafe:
        asm volatile("out dx, al", in("dx") port, in("al") value)

# COM1 serial port
val COM1: u16 = 0x3F8

# Write single character
fn putc(ch: u8):
    outb(COM1, ch)

# Entry point (bare-metal has no main, uses _start)
fn _start():
    # Write "Hi\n" to serial
    putc(0x48)  # 'H'
    putc(0x69)  # 'i'
    putc(0x0A)  # '\n'

    # Exit QEMU (port 0xF4, value 0 = success)
    outb(0xF4, 0)

    # Infinite loop (should never reach here)
    loop: pass
