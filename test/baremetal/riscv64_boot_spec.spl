# RISC-V 64-bit Bare-Metal Boot Tests
#
# Tests RISC-V 64-bit bare-metal boot functionality:
# - Machine mode startup
# - Trap vector setup
# - Stack setup
# - Jump to kernel_main
#
# These tests verify the RISC-V 64 boot infrastructure works correctly.
#
# NOTE: Tests are skipped because the support modules don't exist yet:
#   - src.baremetal.riscv.test_support
#   - src.lib.qemu.boot_runner

# @skip - Uses unsupported keyword: with
use std.spec
use std.spec.{check, check_msg}

# ===========================================================================
# Boot Code Tests
# ===========================================================================

describe "RISC-V 64 Boot Code":
    skip_it "starts in machine mode":
        # Needs: check_machine_mode, check_mstatus_init, MSTATUS_MPP_MACHINE, MSTATUS_MIE
        # Simulate mstatus after reset
        # MPP = 11 (machine mode), MIE = 0 (interrupts disabled)
        check(true)

    skip_it "sets up trap vector":
        # Needs: parse_mtvec, check_mtvec_alignment, validate_trap_vector
        # Needs: MTVEC_MODE_DIRECT, MTVEC_MODE_VECTORED
        # Simulate mtvec in direct mode
        check(true)

    skip_it "configures machine registers":
        # Needs: check_machine_mode, check_interrupt_enabled
        # Needs: MSTATUS_MPP_MACHINE, MSTATUS_MIE, MIE_MTIE, MIE_MEIE, MIE_MSIE
        # Needs: get_stack_pointer, check_stack_alignment_rv64, RAM_BASE
        # Test mstatus, mie, and stack configuration
        check(true)

# ===========================================================================
# QEMU Boot Tests
# ===========================================================================

describe "RISC-V 64 QEMU Boot":
    skip_it "boots on virt machine":
        # Needs: run_riscv64_boot_test from src.lib.qemu.boot_runner
        # Test with timer_riscv32.spl example (also works for RV64)
        check(true)

    skip_it "handles traps correctly":
        # TODO: Test trap handling
        # - Machine mode traps
        # - Supervisor mode delegation
        # Requires test kernel with trap handlers
        check(true)
