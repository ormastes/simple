# Example: How to Build Bare-Metal Programs
#
# This demonstrates using the BaremetalBuilder API directly
# until CLI integration is complete.

use app.build.baremetal (BaremetalConfig, BaremetalBuilder)
use app.io.io (print)

fn main():
    print "=== Bare-Metal Build Example ==="
    print ""

    # Create config for QEMU x86
    var config = BaremetalConfig.qemu_x86()

    print "Building for target: {config.target.triple()}"
    print "Output directory: {config.output_dir}"
    print ""

    # Create builder
    val builder = BaremetalBuilder.new(config)

    # Build source file
    val source_files = ["test/baremetal/e2e_simple_hello.spl"]

    print "Building {source_files[0]}..."
    val result = builder.build(source_files)

    if result.success:
        print ""
        print "[SUCCESS] Build completed in {result.duration_ms}ms"
        print ""
        print "Generated files:"
        print "  - LLVM IR:  build/baremetal/e2e_simple_hello.ll"
        print "  - Object:   build/baremetal/e2e_simple_hello.o"
        print "  - Binary:   build/baremetal/kernel.elf"
        print ""
        print "To run in QEMU:"
        print "  qemu-system-i386 -kernel build/baremetal/kernel.elf -serial stdio -display none"
    else:
        print ""
        print "[FAILED] Build failed"
        print ""
        print "Error:"
        print result.stderr
        print ""
        print "Note: Bare-metal compilation requires:"
        print "  1. Simple compiler with bare-metal target support"
        print "  2. LLVM tools (llc)"
        print "  3. GNU linker (ld)"
