# E1038: Private Type in Public Interface

Feature: E1038 - Private Type in Public Interface
  As a Simple compiler with module privacy
  I want to prevent private types from leaking into public interfaces
  So that module boundaries are properly enforced

  Background:
    Given I have the Simple compiler
    And the compiler supports module privacy (pub/private)

  Scenario: Private struct in public function return type
    When I compile:
      '''
      struct Internal:  # Private by default
        data: i32

      pub fn leak() -> Internal:  # Error: exposing private type
        Internal(42)
      '''
    Then I should see error E1038 at line 4
    And the error message should be "private type `Internal` in public interface"
    And the label should point to "Internal" in return type
    And the help should suggest "make `Internal` public or change function visibility"

  Scenario: Private struct in public function parameter
    When I compile:
      '''
      struct Secret:
        key: str

      pub fn process(s: Secret):  # Error: private type in public param
        print(s.key)
      '''
    Then I should see error E1038 at line 4
    And the error should point to parameter type "Secret"

  Scenario: Private type in public struct field
    When I compile:
      '''
      struct PrivateImpl:
        value: i32

      pub struct PublicAPI:
        impl: PrivateImpl  # Error: exposing private type
      '''
    Then I should see error E1038 at line 6
    And the error message should contain "private type `PrivateImpl` in public struct field"

  Scenario: Private type in trait associated type
    When I compile:
      '''
      struct Hidden:
        x: i32

      pub trait MyTrait:
        type Item = Hidden  # Error: private type in public trait
      '''
    Then I should see error E1038 at line 6
    And the error should indicate "private type in associated type"

  Scenario: Valid public type usage
    When I compile:
      '''
      pub struct Public:
        data: i32

      pub fn get_public() -> Public:
        Public(42)
      '''
    Then compilation should succeed

  Scenario: Private function with private type is OK
    When I compile:
      '''
      struct Internal:
        x: i32

      fn private_fn() -> Internal:  # OK: both private
        Internal(42)
      '''
    Then compilation should succeed

  Scenario: Korean language error
    Given I set compiler language to "ko"
    When I compile:
      '''
      struct 비공개:
        값: i32

      pub fn 누출() -> 비공개:
        비공개(0)
      '''
    Then I should see error E1038
    And the error message should contain "공개 인터페이스에 비공개 타입"

  Scenario: Module-level privacy
    When I compile:
      '''
      mod internal:
        pub struct Config:  # Public within module
          setting: i32

      # From outside the module
      pub fn expose() -> internal.Config:  # Error if Config not re-exported
        # ...
      '''
    Then I should see error E1038
    And the error should explain module privacy boundaries

  Scenario: Re-exporting makes type public
    When I compile:
      '''
      mod internal:
        pub struct Config:
          value: i32

      pub use internal.Config  # Re-export

      pub fn get_config() -> Config:  # OK: Config is re-exported
        Config(42)
      '''
    Then compilation should succeed

  Scenario: Generic type with private type parameter
    When I compile:
      '''
      struct Private:
        x: i32

      pub fn foo() -> Option<Private>:  # Error: Private in public signature
        Some(Private(0))
      '''
    Then I should see error E1038
    And the error should point to "Private" in "Option<Private>"
    And the help should suggest making Private public

  Scenario: Trait object with private trait
    When I compile:
      '''
      trait Internal:  # Private trait
        fn method():
          # ...

      pub fn get_object() -> dyn Internal:  # Error
        # ...
      '''
    Then I should see error E1038
    And the error should indicate "private trait `Internal` in public interface"
