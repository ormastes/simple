# Type Annotation Conversion - Comprehensive SSpec Tests
# Decision #7: val arr: ArrayList = [1, 2, 3] should auto-convert

describe "Type Annotation Conversion":

    context "Basic Conversion":
        it "should convert array literal to ArrayList":
            val arr: ArrayList = [1, 2, 3]
            expect(arr.len()).to_equal(3)
            expect(arr.get(0)).to_equal(1)

        it "should convert dict literal to HashMap":
            val map: HashMap = {"a": 1, "b": 2}
            expect(map.get("a")).to_equal(Some(1))

        it "should convert empty array to ArrayList":
            val arr: ArrayList = []
            expect(arr.len()).to_equal(0)

        it "should convert empty dict to HashMap":
            val map: HashMap = {}
            expect(map.len()).to_equal(0)

        it "should preserve element values":
            val arr: ArrayList = [10, 20, 30]
            expect(arr.get(0)).to_equal(10)
            expect(arr.get(1)).to_equal(20)
            expect(arr.get(2)).to_equal(30)

    context "Function Parameters":
        it "should auto-convert in function calls":
            fn process(data: ArrayList) -> i64:
                data.len()

            val result = process([1, 2, 3])
            expect(result).to_equal(3)

        it "should auto-convert with multiple parameters":
            fn combine(a: ArrayList, b: ArrayList) -> i64:
                a.len() + b.len()

            val result = combine([1, 2], [3, 4, 5])
            expect(result).to_equal(5)

        it "should auto-convert in method calls":
            class Processor:
                fn run(data: ArrayList) -> i64:
                    data.len()

            val p = Processor()
            expect(p.run([1, 2, 3])).to_equal(3)

        it "should auto-convert dict parameter":
            fn process_map(data: HashMap) -> i64:
                data.len()

            val result = process_map({"a": 1, "b": 2})
            expect(result).to_equal(2)

    context "Return Type Conversion":
        it "should convert return value to expected type":
            fn make_list() -> ArrayList:
                [1, 2, 3]

            val list = make_list()
            expect(list.len()).to_equal(3)

        it "should convert empty return":
            fn make_empty() -> ArrayList:
                []

            val list = make_empty()
            expect(list.len()).to_equal(0)

    context "Variable Assignment":
        it "should convert on variable assignment":
            var list: ArrayList = [1, 2, 3]
            list.push(4)
            expect(list.len()).to_equal(4)

        it "should convert on val assignment":
            val list: ArrayList = [1, 2, 3]
            expect(list.get(0)).to_equal(1)

    context "Class Field Initialization":
        it "should convert in constructor":
            class Container:
                data: ArrayList

            val c = Container(data: [1, 2, 3])
            expect(c.data.len()).to_equal(3)

    context "Nested Structures":
        it "should handle array of arrays":
            val matrix: Matrix = [[1, 2], [3, 4]]
            # Matrix.from() would be called with nested arrays
            expect(matrix).to_not_be_nil()

    context "Error Cases":
        it "should error if from() not defined":
            # class NoFrom has no from() method
            # val x: NoFrom = [1, 2, 3]  # Compile error

        it "should error on type mismatch":
            # fn process(data: ArrayList): pass
            # process("not an array")  # Compile error
