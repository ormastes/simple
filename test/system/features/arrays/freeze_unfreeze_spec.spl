# @pending
"""
Freeze and Unfreeze - Comprehensive SSpec Tests
Testing freeze() function for creating immutable collections

Category: Collections
Status: Implemented
"""

describe "Freeze and Unfreeze":

    context "Freeze Function":
        it "freezes mutable array":
            var arr = [1, 2, 3]
            val frozen = freeze(arr)
            expect frozen[0] == 1
            expect frozen.len() == 3

        it "freezes mutable dict":
            var dict = {"a": 1}
            val frozen = freeze(dict)
            expect frozen["a"] == 1

        it "is idempotent":
            val arr = freeze([1, 2, 3])
            val frozen_again = freeze(arr)
            expect frozen_again[0] == arr[0]
            expect frozen_again.len() == arr.len()

        it "freezes empty array":
            val frozen = freeze([])
            expect frozen.len() == 0

        it "freezes empty dict":
            val frozen = freeze({})
            expect frozen.len() == 0

    context "Frozen Array Operations":
        it "allows reads on frozen array":
            val frozen = freeze([1, 2, 3])
            expect frozen[0] == 1
            expect frozen[2] == 3

        it "allows len on frozen array":
            val frozen = freeze([1, 2, 3])
            expect frozen.len() == 3

        it "allows iteration on frozen array":
            val frozen = freeze([1, 2, 3])
            var sum = 0
            for x in frozen:
                sum = sum + x
            expect sum == 6

        it "allows first and last on frozen array":
            val frozen = freeze([1, 2, 3])
            expect frozen.first() == 1
            expect frozen.last() == 3

        it "allows negative indexing on frozen array":
            val frozen = freeze([1, 2, 3])
            expect frozen[-1] == 3
            expect frozen[-2] == 2

    context "Functional Operations on Frozen":
        it "allows map on frozen array":
            val frozen = freeze([1, 2, 3])
            val doubled = frozen.map(\x: x * 2)
            expect doubled[0] == 2
            expect doubled[1] == 4
            expect doubled[2] == 6

        it "allows filter on frozen array":
            val frozen = freeze([1, 2, 3, 4, 5])
            val evens = frozen.filter(\x: x % 2 == 0)
            expect evens.len() == 2
            expect evens[0] == 2
            expect evens[1] == 4

        it "allows reduce on frozen array":
            val frozen = freeze([1, 2, 3, 4])
            val sum = frozen.reduce(0, \acc, x: acc + x)
            expect sum == 10

        it "allows contains on frozen array":
            val frozen = freeze([1, 2, 3])
            expect frozen.contains(2)
            expect not frozen.contains(5)

    context "Frozen Dict Operations":
        it "allows reads on frozen dict":
            val frozen = freeze({"a": 1, "b": 2})
            expect frozen["a"] == 1
            expect frozen["b"] == 2

        it "allows len on frozen dict":
            val frozen = freeze({"a": 1, "b": 2})
            expect frozen.len() == 2

        it "allows keys on frozen dict":
            val frozen = freeze({"a": 1, "b": 2})
            val keys = frozen.keys()
            expect keys.len() == 2

        it "allows values on frozen dict":
            val frozen = freeze({"a": 1, "b": 2})
            val values = frozen.values()
            expect values.len() == 2

        it "allows contains_key on frozen dict":
            val frozen = freeze({"a": 1})
            expect frozen.contains_key("a")
            expect not frozen.contains_key("b")

    context "Type Behavior":
        it "treats frozen arrays as arrays":
            val frozen = freeze([1, 2, 3])
            expect frozen.len() == 3
            expect frozen[0] == 1

        it "treats frozen dicts as dicts":
            val frozen = freeze({"a": 1})
            expect frozen["a"] == 1
