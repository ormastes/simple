# @pending
# @skip - Uses unsupported keyword: with
"""
# Unit Types Specification

**Feature ID:** #UNIT-001
**Category:** Language | Types
**Status:** Implemented

## Overview

Tests for semantic unit types that add compile-time dimensional safety
to numeric values.
"""



# ============================================================================
# Test Group 1: Standalone Units
# ============================================================================

describe "Standalone Units":
    """
    ## Basic Unit Type Definition

    Tests for defining and using standalone unit types.
    """

    it "defines standalone unit type":
        unit UserId: i64 as uid
        val user_id = 42_uid
        expect user_id == 42

    it "performs arithmetic with units":
        unit Score: i64 as pts
        val a = 100_pts
        val b = 50_pts
        expect a + b == 150

    it "gets value from unit":
        val d = 42_km
        expect d.value() == 42

    it "gets suffix from unit":
        val d = 100_bytes
        val s = d.suffix()
        expect s == "bytes"

    it "converts unit to string":
        val d = 5_km
        val s = d.to_string()
        expect s == "5_km"


# ============================================================================
# Test Group 2: Unit Families
# ============================================================================

describe "Unit Families":
    """
    ## Unit Families with Conversions

    Tests for unit families with multiple related units and conversion factors.
    """

    it "defines unit family":
        unit length(base: f64): m = 1.0, km = 1000.0
        val d = 5000.0_m
        expect d.value() == 5000.0


# ============================================================================
# Test Group 3: Unit Arithmetic
# ============================================================================

describe "Unit Arithmetic":
    """
    ## Type-Safe Unit Arithmetic

    Tests for unit arithmetic with explicit allow rules.
    """

    it "allows same-family addition":
        unit length(base: f64): m = 1.0, km = 1000.0:
            allow add(length) -> length
            allow sub(length) -> length
        val a = 100_m
        val b = 50_m
        expect (a + b).value() == 150

    it "allows same-family subtraction":
        unit length(base: f64): m = 1.0, km = 1000.0:
            allow sub(length) -> length
        val a = 100_m
        val b = 30_m
        expect (a - b).value() == 70

    it "allows scaling by scalar":
        unit length(base: f64): m = 1.0
        val d = 10_m
        val scaled = d * 3
        expect scaled.value() == 30

    it "allows comparison always":
        unit length(base: f64): m = 1.0
        val a = 100_m
        val b = 50_m
        expect a > b


# ============================================================================
# Test Group 4: Compound Units
# ============================================================================

describe "Compound Units":
    """
    ## Compound Unit Definitions

    Tests for compound units derived from base units.
    """

    it "defines compound unit":
        unit length(base: f64): m = 1.0
        unit time(base: f64): s = 1.0
        unit velocity = length / time
        expect 1 == 1

    it "computes velocity from division":
        unit length(base: f64): m = 1.0
        unit time(base: f64): s = 1.0
        unit velocity = length / time
        val dist = 100_m
        val dur = 10_s
        val speed = dist / dur
        expect speed.value() == 10

    it "cancels same units in division":
        unit length(base: f64): m = 1.0
        val dist1 = 100_m
        val dist2 = 20_m
        val ratio = dist1 / dist2
        expect ratio == 5

    it "defines area from multiplication":
        unit length(base: f64): m = 1.0
        unit area = length * length
        val width = 10_m
        val height = 5_m
        val a = width * height
        expect a.value() == 50


# ============================================================================
# Test Group 5: SI Prefixes
# ============================================================================

describe "SI Prefixes":
    """
    ## SI Prefix Support

    Tests for SI prefixes (kilo, mega, milli, micro, etc.).
    """

    it "uses kilo prefix":
        unit length(base: f64): m = 1.0
        val dist = 5_km
        expect dist.value() == 5000

    it "uses mega prefix":
        unit length(base: f64): m = 1.0
        val dist = 2_Mm
        expect dist.value() == 2000000

    it "uses milli prefix":
        unit time(base: f64): s = 1.0
        val dur = 500_ms
        expect dur.value() < 1.0


# ============================================================================
# Test Group 6: Unit Type Inference
# ============================================================================

describe "Unit Type Inference":
    """
    ## Unit Type in Function Signatures

    Tests for unit types as function parameter and return types.
    """

    it "accepts correct unit parameter":
        unit length(base: f64): m = 1.0, km = 1000.0
        fn double_distance(d: length) -> length:
            return d + d
        val dist = 5_km
        expect double_distance(dist).value() == 10

    it "returns correct unit type":
        unit length(base: f64): m = 1.0, km = 1000.0
        fn get_distance() -> length:
            return 10_m
        expect get_distance().value() == 10

