"""
# Pattern Matching Specification

**Feature IDs:** #PATTERN-MATCH
**Category:** Language
**Status:** Implemented

Pattern matching provides a way to extract and deconstruct values using patterns.

## Key Behaviors

- Pattern matching deconstructs values into their components
- Variables bound in patterns are available in match arm bodies
- Patterns include literals, enums, tuples, records, and wildcards
"""

use std.spec


# ============================================================================
# Test Group 1: Basic Pattern Matching
# ============================================================================

describe "Basic Pattern Matching":
    """
    ## Literal and Wildcard Patterns

    Tests fundamental pattern matching with literals and wildcards.
    """

    it "matches exact literal values":
        fn classify(x):
            match x:
                0 =>
                    return 0
                1 =>
                    return 1
                _ =>
                    return 99
        expect classify(0) == 0
        expect classify(1) == 1
        expect classify(42) == 99

    it "matches with wildcard pattern":
        fn always_match(x):
            match x:
                _ =>
                    return 42
        expect always_match(100) == 42
        expect always_match(-1) == 42

    it "binds value to variable":
        fn double_it(x):
            match x:
                n =>
                    return n * 2
        expect double_it(5) == 10
        expect double_it(0) == 0


# ============================================================================
# Test Group 2: Tuple Pattern Matching
# ============================================================================

describe "Tuple Pattern Matching":
    """
    ## Tuple Destructuring

    Tests pattern matching on tuples.
    """

    it "matches tuple and extracts elements":
        fn sum_pair(pair):
            match pair:
                (a, b) =>
                    return a + b
        expect sum_pair((10, 20)) == 30

    it "matches nested tuples":
        fn extract_first(nested):
            match nested:
                ((a, _), _) =>
                    return a
        expect extract_first(((5, 10), 20)) == 5

    it "matches with partial wildcard":
        fn get_first(pair):
            match pair:
                (x, _) =>
                    return x
        expect get_first((42, 100)) == 42


# ============================================================================
# Test Group 3: Enum Pattern Matching
# ============================================================================

describe "Enum Pattern Matching":
    """
    ## Enum Variant Matching

    Tests pattern matching on enum variants.
    """

    it "matches Option Some variant":
        val opt = Some(42)
        var result = 0
        match opt:
            Some(x) =>
                result = x
            None =>
                result = -1
        expect result == 42

    it "matches Option None variant":
        val opt = nil
        var result = 0
        match opt:
            Some(x) =>
                result = x
            None =>
                result = -1
        expect result == -1

    it "matches Result Ok variant":
        val res = Ok(100)
        var result = 0
        match res:
            Ok(x) =>
                result = x
            Err(_) =>
                result = -1
        expect result == 100


# ============================================================================
# Test Group 4: Pattern Matching in Functions
# ============================================================================

describe "Pattern Matching in Functions":
    """
    ## Function Return with Match

    Tests pattern matching integrated with function returns.
    """

    it "uses match as expression":
        fn sign(x):
            return match x:
                n if n > 0 =>
                    1
                n if n < 0 =>
                    -1
                _ =>
                    0
        expect sign(10) == 1
        expect sign(-5) == -1
        expect sign(0) == 0

    it "matches multiple patterns":
        fn is_special(x):
            match x:
                0 =>
                    return true
                1 =>
                    return true
                _ =>
                    return false
        expect is_special(0) == true
        expect is_special(1) == true
        expect is_special(5) == false

