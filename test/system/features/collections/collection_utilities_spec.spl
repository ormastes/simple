"""
# Collection Utilities Specification

**Feature IDs:** #COLL-UTIL-001 to #COLL-UTIL-052
**Category:** Runtime | Collections
**Status:** Implemented

Tests collection utility functions including:
- Array sorting and reversing (in-place and copy)
- Array aggregation (sum, min, max, count)
- Array transformation (zip, enumerate, flatten, unique)
- Array slicing (take, drop)
- Array generation (range, repeat, fill)
- Array predicates (all_truthy, any_truthy)
- Tuple operations
- String operations
- Dictionary operations

## Array Utility Methods

```simple
# Sorting
arr.sort()              # In-place sort
val sorted = arr.sorted()   # Returns new sorted array

# Reversing
arr.reverse()           # In-place reverse
val rev = arr.reversed()    # Returns new reversed array

# Access
arr.first()             # First element or None
arr.last()              # Last element or None
arr.index_of(value)     # Index or -1 if not found

# Aggregation
arr.sum()               # Sum of numeric elements
arr.min()               # Minimum value
arr.max()               # Maximum value
arr.count(value)        # Count occurrences

# Transformation
arr.concat(other)       # Concatenate arrays
arr.copy()              # Shallow copy
arr.zip(other)          # Zip into tuples
arr.enumerate()         # Add indices as tuples
arr.flatten()           # Flatten nested arrays
arr.unique()            # Remove duplicates
arr.take(n)             # First n elements
arr.drop(n)             # Skip first n elements

# Generation
range(start, end, step) # Generate range array
repeat(value, n)        # Repeat value n times
arr.fill(value)         # Fill array with value

# Predicates
arr.all_truthy()        # All elements truthy?
arr.any_truthy()        # Any element truthy?
```
"""

use std.spec


# ============================================================================
# Test Group 1: Array Sorting
# ============================================================================

describe "Array Sorting":
    """
    ## In-Place and Copy Sorting

    Tests sort() and sorted() methods.
    """

    it "sorts array in-place":
        var arr = [3, 1, 4, 1, 5]
        arr.sort()
        expect arr[0] == 1
        expect arr[1] == 1
        expect arr[2] == 3
        expect arr[3] == 4
        expect arr[4] == 5

    it "returns new sorted array":
        val arr = [3, 1, 2]
        val s = arr.sorted()
        # Original unchanged
        expect arr[0] == 3
        # New array sorted
        expect s[0] == 1
        expect s[1] == 2
        expect s[2] == 3


# ============================================================================
# Test Group 2: Array Reversing
# ============================================================================

describe "Array Reversing":
    """
    ## In-Place and Copy Reversing

    Tests reverse() and reversed() methods.
    """

    it "reverses array in-place":
        var arr = [1, 2, 3]
        arr.reverse()
        expect arr[0] == 3
        expect arr[1] == 2
        expect arr[2] == 1

    it "returns new reversed array":
        val arr = [1, 2, 3]
        val r = arr.reversed()
        # Original unchanged
        expect arr[0] == 1
        # New array reversed
        expect r[0] == 3
        expect r[1] == 2
        expect r[2] == 1


# ============================================================================
# Test Group 3: Array Access Methods
# ============================================================================

describe "Array Access Methods":
    """
    ## First, Last, Index Lookup

    Tests array element access methods.
    """

    it "first returns first element":
        val arr = [10, 20, 30]
        expect arr.first() == Some(10)

    it "last returns last element":
        val arr = [10, 20, 30]
        expect arr.last() == Some(30)

    it "first returns None for empty array":
        val arr: [i64] = []
        expect arr.first() == None

    it "last returns None for empty array":
        val arr: [i64] = []
        expect arr.last() == None

    it "index_of finds element":
        val arr = [10, 20, 30, 20]
        expect arr.index_of(20) == 1  # First occurrence

    it "index_of returns -1 when not found":
        val arr = [10, 20, 30]
        expect arr.index_of(99) == -1


# ============================================================================
# Test Group 4: Array Concatenation and Copy
# ============================================================================

describe "Array Concatenation and Copy":
    """
    ## Combining and Duplicating Arrays

    Tests concat() and copy() methods.
    """

    it "concatenates two arrays":
        val a = [1, 2]
        val b = [3, 4]
        val c = a.concat(b)
        expect c.len() == 4
        expect c[0] == 1
        expect c[2] == 3
        expect c[3] == 4

    it "creates shallow copy":
        val arr = [1, 2, 3]
        val copy = arr.copy()
        expect copy.len() == 3
        expect copy[0] == 1
        expect copy[1] == 2
        expect copy[2] == 3


# ============================================================================
# Test Group 5: Array Aggregation
# ============================================================================

describe "Array Aggregation":
    """
    ## Sum, Min, Max, Count

    Tests numeric aggregation methods.
    """

    it "sums numeric array":
        val arr = [1, 2, 3, 4]
        expect arr.sum() == 10

    it "sum of empty array is zero":
        val arr: [i64] = []
        expect arr.sum() == 0

    it "finds minimum value":
        val arr = [3, 1, 4, 1, 5]
        expect arr.min() == Some(1)

    it "finds maximum value":
        val arr = [3, 1, 4, 1, 5]
        expect arr.max() == Some(5)

    it "min of empty array is None":
        val arr: [i64] = []
        expect arr.min() == None

    it "max of empty array is None":
        val arr: [i64] = []
        expect arr.max() == None

    it "counts occurrences":
        val arr = [1, 2, 1, 3, 1]
        expect arr.count(1) == 3
        expect arr.count(2) == 1
        expect arr.count(99) == 0


# ============================================================================
# Test Group 6: Array Transformation
# ============================================================================

describe "Array Transformation":
    """
    ## Zip, Enumerate, Flatten, Unique

    Tests array transformation methods.
    """

    it "zips two arrays into tuples":
        val a = [1, 2, 3]
        val b = [10, 20, 30]
        val z = a.zip(b)
        expect z.len() == 3
        expect z[0] == (1, 10)
        expect z[1] == (2, 20)
        expect z[2] == (3, 30)

    it "enumerates array with indices":
        val arr = [10, 20, 30]
        val e = arr.enumerate()
        expect e.len() == 3
        expect e[0] == (0, 10)
        expect e[1] == (1, 20)
        expect e[2] == (2, 30)

    it "flattens nested arrays":
        val nested = [[1, 2], [3, 4], 5]
        val flat = nested.flatten()
        expect flat.len() == 5
        expect flat[0] == 1
        expect flat[2] == 3
        expect flat[4] == 5

    it "removes duplicates":
        val arr = [1, 2, 1, 3, 2, 1]
        val u = arr.unique()
        expect u.len() == 3
        expect u[0] == 1
        expect u[1] == 2
        expect u[2] == 3


# ============================================================================
# Test Group 7: Array Slicing Methods
# ============================================================================

describe "Array Slicing Methods":
    """
    ## Take and Drop

    Tests take() and drop() methods.
    """

    it "takes first n elements":
        val arr = [1, 2, 3, 4, 5]
        val t = arr.take(3)
        expect t.len() == 3
        expect t[0] == 1
        expect t[2] == 3

    it "drops first n elements":
        val arr = [1, 2, 3, 4, 5]
        val d = arr.drop(2)
        expect d.len() == 3
        expect d[0] == 3
        expect d[2] == 5


# ============================================================================
# Test Group 8: Array Generation
# ============================================================================

describe "Array Generation":
    """
    ## Range, Repeat, Fill

    Tests array generation functions.
    """

    it "creates range with step 1":
        val r = range(0, 5, 1)
        expect r.len() == 5
        expect r[0] == 0
        expect r[4] == 4

    it "creates range with step 2":
        val r = range(0, 10, 2)
        expect r.len() == 5
        expect r[0] == 0
        expect r[2] == 4

    it "creates range with negative step":
        val r = range(5, 0, -1)
        expect r.len() == 5
        expect r[0] == 5
        expect r[4] == 1

    it "repeats value n times":
        val arr = repeat(42, 5)
        expect arr.len() == 5
        expect arr[0] == 42
        expect arr[4] == 42

    it "fills array with value":
        var arr = [1, 2, 3]
        arr.fill(0)
        expect arr[0] == 0
        expect arr[1] == 0
        expect arr[2] == 0


# ============================================================================
# Test Group 9: Array Predicates
# ============================================================================

describe "Array Predicates":
    """
    ## All and Any Truthy

    Tests array truthiness predicates.
    """

    it "all_truthy returns true when all truthy":
        val arr = [1, 2, 3]
        expect arr.all_truthy()

    it "all_truthy returns false with zero":
        val arr = [1, 0, 3]
        expect not arr.all_truthy()

    it "any_truthy returns true with some truthy":
        val arr = [0, 0, 1]
        expect arr.any_truthy()

    it "any_truthy returns false when all zero":
        val arr = [0, 0, 0]
        expect not arr.any_truthy()


# ============================================================================
# Test Group 10: Array Edge Cases
# ============================================================================

describe "Array Edge Cases":
    """
    ## Boundary and Error Conditions

    Tests edge cases and error handling.
    """

    it "pop from empty returns None":
        var arr: [i64] = []
        expect arr.pop() == None

    it "out of bounds get returns None":
        val arr = [1]
        expect arr[100] == None

    it "negative indexing works":
        val arr = [10, 20, 30]
        expect arr[-1] == 30
        expect arr[-2] == 20
        expect arr[-3] == 10


# ============================================================================
# Test Group 11: Tuple Operations
# ============================================================================

describe "Tuple Operations":
    """
    ## Tuple Creation and Access

    Tests tuple functionality.
    """

    it "creates tuple with specified size":
        val t = (10, 20, 30)
        expect t.len() == 3

    it "gets tuple elements by index":
        val t = (10, 20, 30)
        expect t[0] == 10
        expect t[1] == 20
        expect t[2] == 30

    it "out of bounds returns None":
        val t = (1, 2)
        expect t[10] == None

    it "supports zero-length tuple":
        val t = ()
        expect t.len() == 0


# ============================================================================
# Test Group 12: String Operations
# ============================================================================

describe "String Operations":
    """
    ## String Creation and Manipulation

    Tests string functionality.
    """

    it "creates string and gets length":
        val s = "Hello, World!"
        expect s.len() == 13

    it "concatenates strings":
        val a = "Hello"
        val b = " World"
        val c = a + b
        expect c == "Hello World"
        expect c.len() == 11

    it "handles empty string":
        val s = ""
        expect s.len() == 0

    it "handles unicode strings":
        val s = "Hello 世界"
        expect s.len() > 8  # UTF-8 bytes


# ============================================================================
# Test Group 13: Dictionary Operations
# ============================================================================

describe "Dictionary Operations":
    """
    ## Dictionary Creation and Manipulation

    Tests dictionary functionality.
    """

    it "creates empty dict":
        val d = {}
        expect d.len() == 0

    it "sets and gets values":
        var d = {}
        d["name"] = "Alice"
        d["age"] = 30
        expect d.len() == 2
        expect d["age"] == 30

    it "overwrites existing key":
        var d = {"counter": 1}
        d["counter"] = 2
        expect d.len() == 1
        expect d["counter"] == 2

    it "returns None for missing key":
        val d = {"a": 1}
        expect d["missing"] == None

    it "clears all entries":
        var d = {"a": 1, "b": 2, "c": 3}
        d.clear()
        expect d.len() == 0
        expect d["a"] == None

    it "handles multiple entries":
        var d = {}
        var i = 0
        while i < 5:
            d["key{i}"] = i * 10
            i = i + 1
        expect d.len() == 5

    it "supports integer keys":
        var d = {}
        d[1] = "one"
        d[2] = "two"
        expect d.len() == 2

