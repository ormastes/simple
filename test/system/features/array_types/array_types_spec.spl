"""
Array Types Tests
Feature: Array type system and operations
Category: Type System Features
Status: Implemented

Tests for array type declarations, indexing, operations, and functional methods.
"""

use std.spec


# ============================================================================
# Test Group 1: Array Basics
# ============================================================================

describe "Array Basics":
    """
    ## Array Literal and Indexing

    Tests for array creation, indexing, and basic operations.
    """

    context "array literals":
        it "creates array from literal":
            val arr = [1, 2, 3, 4, 5]
            expect arr[2] == 3

        it "gets array length":
            val arr = [10, 20, 30]
            expect arr.len() == 3

        it "gets first and last elements":
            val arr = [5, 10, 15, 20]
            expect arr.first() + arr.last() == 25

    context "array queries":
        it "checks if array contains element":
            val arr = [1, 2, 3]
            expect arr.contains(2)

        it "checks if array is empty":
            val arr = []
            expect arr.is_empty()

        it "checks non-empty array":
            val arr = [1]
            expect not arr.is_empty()


# ============================================================================
# Test Group 2: Array Modification
# ============================================================================

describe "Array Modification":
    """
    ## Array Mutation Operations

    Tests for push, concat, and other modifying operations.
    """

    context "push and concat":
        it "pushes element to array":
            var arr = [1, 2, 3]
            arr = arr.push(4)
            expect arr[3] == 4

        it "concatenates two arrays":
            val a = [1, 2]
            val b = [3, 4]
            val c = a.concat(b)
            expect c.len() == 4

    context "reverse":
        it "reverses array":
            val arr = [1, 2, 3]
            val rev = arr.reverse()
            expect rev[0] == 3


# ============================================================================
# Test Group 3: Functional Methods
# ============================================================================

describe "Array Functional Methods":
    """
    ## Functional Programming on Arrays

    Tests for map, filter, reduce, and other functional operations.
    """

    context "map":
        it "maps function over array":
            val arr = [1, 2, 3]
            val doubled = arr.map(\x: x * 2)
            expect doubled[1] == 4

    context "filter":
        it "filters array by predicate":
            val arr = [1, 2, 3, 4, 5]
            val evens = arr.filter(\x: x % 2 == 0)
            expect evens.len() == 2

    context "reduce":
        it "reduces array with accumulator":
            val arr = [1, 2, 3, 4, 5]
            val sum = arr.reduce(0, \acc, x: acc + x)
            expect sum == 15

    context "all and any":
        it "checks all elements match predicate":
            val arr = [2, 4, 6]
            val all_even = arr.all(\x: x % 2 == 0)
            expect all_even

    context "join":
        it "joins array elements with separator":
            val arr = [1, 2, 3]
            val s = arr.join("-")
            expect s == "1-2-3"

    context "sum":
        it "sums numeric array":
            val arr = [1, 2, 3, 4, 5]
            expect arr.sum() == 15


# ============================================================================
# Test Group 4: Slicing
# ============================================================================

describe "Array Slicing":
    """
    ## Python-Style Slice Syntax

    Tests for array slicing with start:end:step notation.
    """

    context "basic slicing":
        it "slices with start and end":
            val arr = [0, 1, 2, 3, 4, 5]
            val sub = arr[1:4]
            expect sub.len() == 3

        it "slices from start index to end":
            val arr = [0, 1, 2, 3, 4]
            val sub = arr[2:]
            expect sub[0] == 2

        it "slices from beginning to end index":
            val arr = [0, 1, 2, 3, 4]
            val sub = arr[:3]
            expect sub.len() == 3

    context "step slicing":
        it "slices with step":
            val arr = [0, 1, 2, 3, 4, 5, 6, 7]
            val evens = arr[::2]
            expect evens.len() == 4


# ============================================================================
# Test Group 5: Negative Indexing
# ============================================================================

describe "Negative Indexing":
    """
    ## Python-Style Negative Indices

    Tests for accessing elements from end of array.
    """

    it "gets last element with -1":
        val arr = [10, 20, 30, 40, 50]
        expect arr[-1] == 50

    it "gets second from end with -2":
        val arr = [1, 2, 3, 4, 5]
        expect arr[-2] == 4


# ============================================================================
# Test Group 6: Spread Operator
# ============================================================================

describe "Array Spread Operator":
    """
    ## Spread Syntax for Arrays

    Tests for spreading arrays into other arrays.
    """

    it "spreads arrays with *":
        val a = [1, 2, 3]
        val b = [4, 5]
        val c = [*a, *b]
        expect c.len() == 5

    it "spreads array mixed with elements":
        val a = [2, 3]
        val arr = [1, *a, 4]
        expect arr[2] == 3


# ============================================================================
# Test Group 7: List Comprehension
# ============================================================================

describe "List Comprehension":
    """
    ## Comprehension Syntax

    Tests for creating arrays with comprehension expressions.
    """

    it "creates list from comprehension":
        val arr = [1, 2, 3, 4, 5]
        val doubled = [x * 2 for x in arr]
        expect doubled[2] == 6

    it "filters with comprehension condition":
        val arr = [1, 2, 3, 4, 5, 6]
        val evens = [x for x in arr if x % 2 == 0]
        expect evens.len() == 3

    it "creates squares with comprehension":
        val squares = [x * x for x in [1, 2, 3, 4]]
        expect squares[3] == 16


# ============================================================================
# Test Group 8: Chained Comparisons
# ============================================================================

describe "Chained Comparisons":
    """
    ## Python-Style Chained Comparisons

    Tests for a < b < c style comparisons.
    """

    it "evaluates basic chained comparison":
        val x = 5
        expect 0 < x and x < 10

    it "evaluates false chained comparison":
        val x = 15
        expect not (0 < x and x < 10)

    it "evaluates three-way comparison":
        val a = 1
        val b = 5
        val c = 10
        expect a < b and b < c

    it "evaluates mixed comparison operators":
        val x = 5
        expect 0 <= x and x <= 10
