# @pending
# @skip - Uses unsupported keyword: with
"""
Placeholder Lambda Specification

Category: Syntax
Status: Implemented

Placeholder lambdas transform `_` in expressions into anonymous function parameters.
- `_ * 2` becomes `\__p0: __p0 * 2`
- `_ + _` becomes `\__p0, __p1: __p0 + __p1`
- `_.field` becomes `\__p0: __p0.field`
"""

describe "Placeholder Lambda":

    context "filter with comparison":
        it "filters with less than":
            val data = [1, 2, 3, 4, 5]
            val result = data.filter(_ < 3)
            expect result == [1, 2]

        it "filters with greater than":
            val data = [1, 2, 3, 4, 5]
            val result = data.filter(_ > 3)
            expect result == [4, 5]

        it "filters with less than or equal":
            val data = [1, 2, 3, 4, 5]
            val result = data.filter(_ <= 3)
            expect result == [1, 2, 3]

        it "filters with greater than or equal":
            val data = [1, 2, 3, 4, 5]
            val result = data.filter(_ >= 3)
            expect result == [3, 4, 5]

        it "filters with equality":
            val data = [1, 2, 3, 2, 1]
            val result = data.filter(_ == 2)
            expect result == [2, 2]

        it "filters with not equal":
            val data = [1, 2, 3, 2, 1]
            val result = data.filter(_ != 2)
            expect result == [1, 3, 1]

    context "map with arithmetic":
        it "maps with multiply":
            val data = [1, 2, 3]
            val result = data.map(_ * 10)
            expect result == [10, 20, 30]

        it "maps with add":
            val data = [1, 2, 3]
            val result = data.map(_ + 100)
            expect result == [101, 102, 103]

        it "maps with subtract":
            val data = [10, 20, 30]
            val result = data.map(_ - 5)
            expect result == [5, 15, 25]

        it "maps with negate":
            val data = [1, 2, 3]
            val result = data.map(-_)
            expect result == [-1, -2, -3]

    context "chaining":
        it "chains filter then map":
            val data = [1, 2, 3, 4, 5]
            val result = data.filter(_ > 2).map(_ * 2)
            expect result == [6, 8, 10]

        it "chains map then filter":
            val data = [1, 2, 3, 4, 5]
            val result = data.map(_ * 2).filter(_ > 5)
            expect result == [6, 8, 10]

    context "string operations":
        it "filters strings by length":
            val words = ["hi", "hello", "hey", "howdy"]
            val result = words.filter(_.len() > 3)
            expect result == ["hello", "howdy"]

    context "complex expressions":
        it "uses placeholder in modulo":
            val data = [1, 2, 3, 4, 5, 6]
            val result = data.filter(_ % 2 == 0)
            expect result == [2, 4, 6]

        it "uses placeholder in compound expression":
            val data = [1, 2, 3, 4, 5]
            val result = data.map(_ * 2 + 1)
            expect result == [3, 5, 7, 9, 11]

    context "with different collection methods":
        it "works with any":
            val data = [1, 2, 3]
            val result = data.any(_ > 2)
            expect result == true

        it "works with all":
            val data = [2, 4, 6]
            val result = data.all(_ % 2 == 0)
            expect result == true

        it "works with all returning false":
            val data = [2, 3, 6]
            val result = data.all(_ % 2 == 0)
            expect result == false

    context "empty collections":
        it "filter on empty returns empty":
            val data: [i64] = []
            val result = data.filter(_ > 0)
            expect result == []

        it "map on empty returns empty":
            val data: [i64] = []
            val result = data.map(_ * 2)
            expect result == []

    context "single element":
        it "filter matching single element":
            val data = [42]
            val result = data.filter(_ == 42)
            expect result == [42]

        it "filter non-matching single element":
            val data = [42]
            val result = data.filter(_ == 0)
            expect result == []
