# @pending
# @skip - Uses unsupported keyword: with
"""
# Decorators Specification

**Feature ID:** #DECO-001
**Category:** Language | Functions
**Status:** Implemented

## Overview

Decorators are functions that transform other functions, enabling
aspect-oriented programming patterns like logging, caching, and validation.

## Syntax

```simple
# Basic decorator
@double_result
fn add_one(x):
    return x + 1

# Decorator with arguments
@multiply_by(3)
fn increment(x):
    return x + 1
```
"""



# ============================================================================
# Basic Decorators
# ============================================================================

describe "Decorators":
    """
    ## Function Decorators

    Tests for decorator syntax and function wrapping.
    """

    it "applies basic decorator":
        fn double_result(f):
            fn wrapper(x):
                return f(x) * 2
            return wrapper

        @double_result
        fn add_one(x):
            return x + 1

        expect add_one(5) == 12

    it "applies decorator with arguments":
        fn multiply_by(factor):
            fn decorator(f):
                fn wrapper(x):
                    return f(x) * factor
                return wrapper
            return decorator

        @multiply_by(3)
        fn increment(x):
            return x + 1

        expect increment(10) == 33

    it "stacks multiple decorators":
        fn add_ten(f):
            fn wrapper(x):
                return f(x) + 10
            return wrapper

        fn double(f):
            fn wrapper(x):
                return f(x) * 2
            return wrapper

        @add_ten
        @double
        fn identity(x):
            return x

        expect identity(5) == 20  # 5 -> double -> 10 -> add_ten -> 20

    it "uses decorator without parentheses":
        fn add_five(f):
            fn wrapper(x):
                return f(x) + 5
            return wrapper

        @add_five
        fn square(x):
            return x * x

        expect square(4) == 21  # 16 + 5


# ============================================================================
# Attributes
# ============================================================================

describe "Attributes":
    """
    ## Compile-Time Attributes

    Tests for attribute syntax that provides metadata to the compiler.
    """

    it "uses inline attribute":
        #[inline]
        fn add(a, b):
            return a + b
        expect add(3, 4) == 7

    it "uses deprecated attribute":
        #[deprecated]
        fn old_api(x):
            return x * 2
        expect old_api(10) == 20

    it "uses deprecated with message":
        #[deprecated = "use new_api instead"]
        fn legacy(x):
            return x + 1
        expect legacy(5) == 6

    it "stacks multiple attributes":
        #[inline]
        #[deprecated]
        fn double(x):
            return x * 2
        expect double(21) == 42


# ============================================================================
# Context Managers (with statement)
# ============================================================================

describe "Context Managers":
    """
    ## With Statement

    Tests for context manager protocol and with blocks.
    """

    it "executes basic with block":
        var counter = 0
        with 42:
            counter = 1
        expect counter == 1

    it "binds value with as clause":
        with 42 as x:
            val value = x + 1
        expect value == 43
