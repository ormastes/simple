"""
# Reference Counted Pointers Specification

**Feature IDs:** #SHARED-PTR
**Category:** Runtime
**Status:** Implemented

Reference counted pointers provide safe sharing of data with automatic
memory management through reference counting.

## Key Behaviors

- Reference count incremented on clone, decremented on drop
- Value is deallocated when reference count reaches zero
- Cloning creates shallow copy with incremented reference count
"""



# ============================================================================
# Test Group 1: Basic Pointer Operations
# ============================================================================

describe "Reference Counted Pointers":
    """
    ## Basic Pointer Operations

    Tests basic reference counted pointer creation and usage.
    """

    it "creates pointer":
        val ptr = new * 42
        expect ptr == 42

    it "pointer arithmetic":
        val a = new * 10
        val b = new * 5
        expect a + b == 15

    it "multiple references":
        val a = new * 42
        val b = a
        expect a + b == 84


# ============================================================================
# Test Group 2: Reference Semantics
# ============================================================================

describe "Reference Semantics":
    """
    ## Reference Counting Semantics

    Tests reference counting behavior.
    """

    it "tracks multiple references":
        val list = [1, 2, 3]
        val ref1 = list
        val ref2 = list
        expect ref1.len() == 3
        expect ref2.len() == 3

    it "clones underlying data":
        val original = [1, 2, 3]
        val cloned = original
        expect cloned.len() == 3
        expect cloned[0] == 1

    it "dict references work correctly":
        val data = {"key": 42}
        val ref = data
        expect ref["key"] == 42


# ============================================================================
# Test Group 3: Memory Safety
# ============================================================================

describe "Memory Safety":
    """
    ## Memory Safety Guarantees

    Tests that references maintain memory safety.
    """

    it "data remains valid while referenced":
        val data = [1, 2, 3]
        val r1 = data
        expect r1[0] == 1

    it "strings are valid":
        val s = "hello"
        val ref = s
        expect ref.len() == 5

    it "nested data structures work":
        val outer = [[1, 2], [3, 4]]
        val ref = outer
        expect ref[0][0] == 1
        expect ref[1][1] == 4

