"""
# Underscore Wildcard Specification

**Feature ID:** #TBD
**Category:** Syntax
**Status:** Implemented

## Overview

Tests for underscore (_) as a wildcard placeholder in various contexts:
- Lambda parameters: `\_: expr` to ignore arguments
- For loop patterns: `for _ in items:` to iterate without binding
- Match patterns: `case _:` as a catch-all wildcard
"""

use spec.{describe, it, expect}

# ============================================================================
# Helper Functions for Underscore Wildcard Tests
# ============================================================================

# For loop with underscore pattern
fn sum_n_times(value: i64, n: i64) -> i64:
    var total = 0
    for _ in 0..n:
        total = total + value
    return total

# Match with underscore wildcard
fn classify_number(x: i64) -> text:
    match x:
        case 0: "zero"
        case 1: "one"
        case 2: "two"
        case _: "many"

# Enum match with underscore in payload
enum MyOption:
    Some(i64)
    Nil

fn is_some(opt: MyOption) -> bool:
    match opt:
        case MyOption.Some(_): true
        case MyOption.Nil: false

# ============================================================================
# SSpec Tests
# ============================================================================

describe "Underscore Wildcard Support":
    """
    ## Wildcard Pattern Tests

    Verifies that underscore (_) works correctly as a wildcard pattern
    in lambdas, for loops, and match expressions.
    """

    describe "in lambda parameters":
        it "ignores single argument":
            val f = \_: 42
            expect(f(100)).to_equal(42)
            expect(f(0)).to_equal(42)
            expect(f(-5)).to_equal(42)

        it "works in map to transform values":
            val items = [1, 2, 3, 4, 5]
            val result = items.map(\_: 0)
            expect(result.len()).to_equal(5)

    describe "in for loop patterns":
        it "iterates without binding":
            var total = 0
            for _ in 0..5:
                total = total + 1
            expect(total).to_equal(5)

        it "uses sum_n_times helper":
            expect(sum_n_times(value=10, n=3)).to_equal(30)
            expect(sum_n_times(value=5, n=4)).to_equal(20)

        it "works with list iteration":
            var count = 0
            for _ in [1, 2, 3]:
                count = count + 1
            expect(count).to_equal(3)

    describe "in match patterns":
        it "catches unmatched cases":
            expect(classify_number(0)).to_equal("zero")
            expect(classify_number(1)).to_equal("one")
            expect(classify_number(2)).to_equal("two")
            expect(classify_number(100)).to_equal("many")
            expect(classify_number(-1)).to_equal("many")

        it "ignores enum payload":
            expect(is_some(MyOption.Some(42))).to_equal(true)
            expect(is_some(MyOption.Some(0))).to_equal(true)
            expect(is_some(MyOption.Nil)).to_equal(false)
