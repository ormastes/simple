"""
# Floor Division (.fdiv) Method

**Feature ID:** OP-FDIV
**Category:** Operators | Arithmetic
**Status:** Implemented

The `.fdiv()` method provides floor division functionality, replacing the old `//` operator
which is now used for parallel execution.

Floor division divides two numbers and rounds down (towards negative infinity), unlike
truncating division which rounds towards zero.

## Migration from // Operator

**Old syntax (deprecated):**
```simple
val result = 7 // 2  # Floor division (old)
```

**New syntax:**
```simple
val result = 7.fdiv(2)  # Floor division (new)
```

## Mathematical Definition

Floor division: ⌊a/b⌋ (always rounds towards negative infinity)

Properties:
- `a = b * a.fdiv(b) + a % b` (division algorithm)
- `a.fdiv(b)` has same sign as `a / b` when positive
- `a.fdiv(b)` rounds down for negative results

## Examples

```simple
# Positive integers
7.fdiv(2)    # → 3
10.fdiv(3)   # → 3

# Negative integers (rounds towards negative infinity)
(-7).fdiv(2)   # → -4 (not -3)
7.fdiv(-2)     # → -4 (not -3)
(-7).fdiv(-2)  # → 3

# Floating point
7.5.fdiv(2.0)    # → 3.0
(-7.5).fdiv(2.0) # → -4.0
```

## Comparison with Other Division

| Operation | 7 / 2 | -7 / 2 | 7 / -2 | -7 / -2 |
|-----------|-------|--------|--------|---------|
| Regular `/` | 3 | -3 | -3 | 3 |
| Floor `.fdiv()` | 3 | -4 | -4 | 3 |
| Truncate `.trunc()` | 3 | -3 | -3 | 3 |
"""

describe "Floor Division (i64.fdiv) - Positive Integers":
    """Tests floor division with positive integers"""

    it "divides evenly":
        val result = 10.fdiv(5)
        expect result == 2

    it "divides with remainder":
        val result = 7.fdiv(2)
        expect result == 3

    it "divides with large remainder":
        val result = 17.fdiv(5)
        expect result == 3

    it "divides exactly":
        val result = 20.fdiv(4)
        expect result == 5

    it "divides small by large":
        val result = 3.fdiv(7)
        expect result == 0

    it "divides one by one":
        val result = 1.fdiv(1)
        expect result == 1

    it "divides large numbers":
        val result = 1000.fdiv(7)
        expect result == 142

describe "Floor Division (i64.fdiv) - Negative Integers":
    """Tests floor division with negative integers (rounds towards negative infinity)"""

    it "divides negative by positive (rounds down)":
        val result = (-7).fdiv(2)
        expect result == (-4)  # Not -3! Rounds towards negative infinity

    it "divides positive by negative (rounds down)":
        val result = 7.fdiv(-2)
        expect result == (-4)  # Not -3! Rounds towards negative infinity

    it "divides negative by negative (positive result)":
        val result = (-7).fdiv(-2)
        expect result == 3

    it "divides negative evenly":
        val result = (-10).fdiv(-5)
        expect result == 2

    it "handles negative dividend with remainder":
        val result = (-17).fdiv(5)
        expect result == (-4)  # -17 / 5 = -3.4 → floor = -4

    it "handles negative divisor with remainder":
        val result = 17.fdiv(-5)
        expect result == (-4)  # 17 / -5 = -3.4 → floor = -4

    it "handles both negative with remainder":
        val result = (-17).fdiv(-5)
        expect result == 3  # -17 / -5 = 3.4 → floor = 3

describe "Floor Division (i64.fdiv) - Edge Cases":
    """Tests edge cases for integer floor division"""

    it "divides zero by positive":
        val result = 0.fdiv(5)
        expect result == 0

    it "divides zero by negative":
        val result = 0.fdiv(-5)
        expect result == 0

    it "handles one divided by itself":
        val result = 42.fdiv(42)
        expect result == 1

    it "handles negative one by one":
        val result = (-1).fdiv(1)
        expect result == (-1)

    it "handles one by negative one":
        val result = 1.fdiv(-1)
        expect result == (-1)

    # TODO: Add test for division by zero error

describe "Floor Division (i64.fdiv) - Division Algorithm":
    """Verifies the division algorithm: a = b * fdiv(a,b) + a % b"""

    it "satisfies division algorithm for positive numbers":
        val a = 17
        val b = 5
        val q = a.fdiv(b)
        val r = a % b
        expect a == b * q + r
        expect q == 3
        expect r == 2

    it "satisfies division algorithm for negative dividend":
        val a = -17
        val b = 5
        val q = a.fdiv(b)
        val r = a % b
        expect a == b * q + r
        expect q == (-4)
        expect r == 3  # Note: remainder has sign of divisor in some languages

    it "satisfies division algorithm for negative divisor":
        val a = 17
        val b = -5
        val q = a.fdiv(b)
        val r = a % b
        expect a == b * q + r
        expect q == (-4)

    it "satisfies division algorithm for both negative":
        val a = -17
        val b = -5
        val q = a.fdiv(b)
        val r = a % b
        expect a == b * q + r
        expect q == 3

describe "Floor Division (f64.fdiv) - Positive Floats":
    """Tests floor division with positive floating point numbers"""

    it "divides evenly":
        val result = 10.0.fdiv(5.0)
        expect result == 2.0

    it "divides with fractional result":
        val result = 7.5.fdiv(2.0)
        expect result == 3.0

    it "divides small by large":
        val result = 1.5.fdiv(2.0)
        expect result == 0.0

    it "divides with small quotient":
        val result = 2.9.fdiv(3.0)
        expect result == 0.0

    it "divides exactly at boundary":
        val result = 6.0.fdiv(2.0)
        expect result == 3.0

    it "divides fractional by integer":
        val result = 9.7.fdiv(3.0)
        expect result == 3.0

describe "Floor Division (f64.fdiv) - Negative Floats":
    """Tests floor division with negative floating point numbers"""

    it "divides negative by positive":
        val result = (-7.5).fdiv(2.0)
        expect result == (-4.0)  # Rounds down to -4, not up to -3

    it "divides positive by negative":
        val result = 7.5.fdiv(-2.0)
        expect result == (-4.0)  # Rounds down to -4

    it "divides negative by negative":
        val result = (-7.5).fdiv(-2.0)
        expect result == 3.0

    it "handles negative fractional dividend":
        val result = (-5.9).fdiv(2.0)
        expect result == (-3.0)  # -5.9 / 2.0 = -2.95 → floor = -3

    it "handles negative fractional divisor":
        val result = 5.9.fdiv(-2.0)
        expect result == (-3.0)  # 5.9 / -2.0 = -2.95 → floor = -3

describe "Floor Division (f64.fdiv) - Special Float Values":
    """Tests floor division with special floating point values"""

    # TODO: skip it "handles division by very small number":
    # TODO: skip it "handles very large result":
    # TODO: skip it "handles infinity divided by finite":
    # TODO: skip it "handles finite divided by infinity":
    # TODO: skip it "handles NaN propagation":
describe "Floor Division vs Regular Division":
    """Compares floor division with regular division"""

    it "matches regular division for positive exact division":
        val regular = 10 / 5
        val floor = 10.fdiv(5)
        expect regular == floor

    it "differs from regular division when remainder exists":
        val regular = 7 / 2  # Truncating division: 3
        val floor = 7.fdiv(2)  # Floor division: 3
        expect regular == floor  # Same for positive

    it "differs for negative dividend":
        val regular = (-7) / 2  # Truncating: -3
        val floor = (-7).fdiv(2)  # Floor: -4
        expect floor == (-4)
        expect regular == (-3)
        expect floor != regular

    it "differs for negative divisor":
        val regular = 7 / (-2)  # Truncating: -3
        val floor = 7.fdiv(-2)  # Floor: -4
        expect floor == (-4)
        expect regular == (-3)
        expect floor != regular

describe "Floor Division - Real World Use Cases":
    """Tests real-world applications of floor division"""

    it "calculates number of pages needed":
        val total_items = 25
        val items_per_page = 10
        val pages = (total_items + items_per_page - 1).fdiv(items_per_page)
        expect pages == 3  # Need 3 pages for 25 items

    it "calculates array chunk count":
        val array_length = 17
        val chunk_size = 5
        val chunks = array_length.fdiv(chunk_size)
        expect chunks == 3  # 17 / 5 = 3 complete chunks

    it "calculates time in hours":
        val minutes = 125
        val hours = minutes.fdiv(60)
        expect hours == 2  # 125 minutes = 2 hours (plus 5 minutes)

    it "calculates grid coordinates":
        val index = 23
        val grid_width = 8
        val row = index.fdiv(grid_width)
        val col = index % grid_width
        expect row == 2  # Row 2 (0-indexed)
        expect col == 7  # Column 7

    it "rounds negative temperatures to day boundary":
        # -15 hours ago → which day?
        val hours_ago = -15
        val days_ago = hours_ago.fdiv(24)
        expect days_ago == (-1)  # Yesterday (rounds down)

describe "Floor Division - Property Testing":
    """Property-based tests for floor division"""

    it "always produces result <= regular division for negative":
        val a = -17
        val b = 5
        val floor_div = a.fdiv(b)
        val regular_div = a / b
        expect floor_div <= regular_div

    it "always rounds down for fractional floats":
        val result1 = 7.1.fdiv(2.0)
        val result2 = 7.9.fdiv(2.0)
        expect result1 == 3.0
        expect result2 == 3.0

    it "is idempotent for exact division":
        val result1 = 10.fdiv(5)
        val result2 = result1.fdiv(1)
        expect result2 == 2

describe "Floor Division - Consistency with Math Block":
    """Tests that .fdiv() matches old // behavior in math blocks"""

    # TODO: skip it "matches math block floor division for positive":
    # TODO: skip it "matches math block floor division for negative":
