"""
# Line Continuation Specification

**Feature IDs:** #2400
**Category:** Syntax
**Status:** Implemented

Line continuation allows long expressions, function calls, and statements to span multiple
lines for improved readability. Expressions can be continued on the next line using implicit
continuation within parentheses, brackets, and braces, as well as explicit continuation
with backslash at end of line. This enables clean formatting of complex expressions without
exceeding line length limits.

## Syntax

```simple
# Implicit continuation in parentheses
val result = (
    long_function_call(arg1, arg2) +
    another_expression
)

# Implicit continuation in brackets
val items = [
    1, 2, 3,
    4, 5, 6
]

# Implicit continuation in braces
val config = {
    key1: value1,
    key2: value2
}

# Explicit continuation with backslash
val sum = value1 + \
    value2 + \
    value3
```

## Key Concepts

| Concept | Description |
|---------|-------------|
| Implicit Continuation | Auto-continues inside (), [], {} without special syntax |
| Explicit Continuation | Backslash at line end forces continuation to next line |
| Nesting | Multiple levels of continuation allowed |
| Indentation | Improves readability but not required for continuation |

## Behavior

Line continuation:
- Allows expressions to span multiple lines for readability
- Supports implicit continuation within all bracket types
- Supports explicit continuation with trailing backslash
- Preserves semantic meaning across line boundaries
- Improves code formatting without changing functionality

## Related Specifications

- String Interpolation (line continuation in string expressions)
- Expression Parsing (handling multi-line expressions)
- Indentation Rules (interaction with Python-style indentation)
"""

import std.spec

describe "Line Continuation":
    """
    ## Line Continuation Specification

    This test suite verifies line continuation behavior including:
    - Implicit continuation within parentheses
    - Implicit continuation within brackets
    - Implicit continuation within braces
    - Explicit continuation with backslash
    - Complex multi-line expressions
    - Function calls spanning multiple lines
    """

    context "implicit continuation in parentheses":
        it "continues expression in parentheses":
            val result = (
                10 +
                20 +
                30
            )
            expect result == 60

        it "continues function call in parentheses":
            fn add(a: i32, b: i32) -> i32:
                a + b
            val result = (
                add(5,
                    10)
            )
            expect result == 15

    context "implicit continuation in function arguments":
        it "continues arguments across lines":
            fn concat_three(a: text, b: text, c: text) -> text:
                a + b + c
            val result = concat_three(
                "Hello",
                " ",
                "World"
            )
            expect result == "Hello World"

        it "continues with nested calls":
            fn double(x: i32) -> i32:
                x * 2
            fn add(a: i32, b: i32) -> i32:
                a + b
            val result = add(
                double(5),
                double(7)
            )
            expect result == 24

    context "implicit continuation in list literals":
        it "continues list across lines":
            val items = [
                1,
                2,
                3,
                4,
                5
            ]
            expect items == [1, 2, 3, 4, 5]

        it "continues list with mixed spacing":
            val items = [1,
                2, 3,
                4]
            expect items.length == 4

    context "implicit continuation in dict literals":
        it "continues dict across lines":
            val config = {
                name: "test",
                value: 42,
                enabled: true
            }
            expect config["name"] == "test"
            expect config["value"] == 42

    context "complex multi-line expressions":
        it "chains method calls across lines":
            val numbers = [1, 2, 3, 4, 5]
            val result = numbers
                .filter(\x: x > 2)
                .map(\x: x * 2)
            expect result == [6, 8, 10]

        it "continues binary operations":
            val a = 100
            val b = 200
            val c = 300
            val result = (
                a + b +
                c * 2
            )
            expect result == 900

    context "continuation with conditional expressions":
        it "continues if-expression":
            val x = 10
            val result = if (
                x > 5 &&
                x < 20
            ):
                "in range"
            else:
                "out of range"
            expect result == "in range"

    context "nested continuation":
        it "handles nested parentheses":
            val result = (
                (10 + 20) +
                (30 + 40)
            )
            expect result == 100

        it "mixes list and function calls":
            fn sum_list(items: List<i32>) -> i32:
                items.fold(0, \acc: \x: acc + x)
            val result = sum_list([
                1 + 2,
                3 + 4,
                5 + 6
            ])
            expect result == 21
