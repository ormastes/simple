"""
# Parser Syntax Validation Specification

**Feature IDs:** #PARSER-VAL-001 to #PARSER-VAL-015
**Category:** Infrastructure | Parser
**Status:** Implemented

Tests that the parser correctly validates syntax and provides helpful
error messages. Includes tests for correct Simple syntax that should
parse successfully.

## Key Validations

- Proper indentation handling
- Comment parsing (single-line, multi-line)
- Whitespace handling
- Newline requirements
- Block structure validation
"""



# ============================================================================
# Test Group 1: Comment Parsing
# ============================================================================

describe "Comment Parsing":
    """
    ## Single and Multi-Line Comments

    Tests that comments are correctly parsed and ignored.
    """

    context "single-line comments":
        it "parses code with trailing comment":
            val x = 42  # This is a comment
            expect x == 42

        it "parses comment-only lines":
            # This is a full-line comment
            val x = 42
            # Another comment
            expect x == 42

        it "parses multiple comment styles":
            val x = 42  # Hash comment
            expect x == 42

    context "multi-line comments":
        it "parses block comment":
            """
            This is a multi-line comment
            that spans several lines.
            """
            val x = 42
            expect x == 42

        it "parses inline docstring":
            fn documented() -> i64:
                """Returns the answer."""
                42
            expect documented() == 42


# ============================================================================
# Test Group 2: Indentation Handling
# ============================================================================

describe "Indentation Handling":
    """
    ## Python-Style Indentation

    Tests that indentation-based blocks are correctly parsed.
    """

    it "parses simple indented block":
        if true:
            val x = 42
            expect x == 42

    it "parses nested indentation":
        if true:
            if true:
                if true:
                    val x = 42
                    expect x == 42

    it "parses dedent correctly":
        var total = 0
        if true:
            total = 10
        if true:
            total = total + 32
        expect total == 42

    it "parses multiple statements in block":
        var a = 0
        var b = 0
        if true:
            a = 10
            b = 20
            val c = 12
            a = a + c
        expect a + b == 42


# ============================================================================
# Test Group 3: Correct Keyword Usage
# ============================================================================

describe "Correct Keyword Usage":
    """
    ## Simple Language Keywords

    Tests that Simple keywords are used correctly.
    """

    context "variable keywords":
        it "uses val for immutable":
            val x = 42
            expect x == 42

        it "uses var for mutable":
            var x = 0
            x = 42
            expect x == 42

        it "uses let for binding":
            let x = 42
            expect x == 42

    context "function keywords":
        it "uses fn for function":
            fn get_value() -> i64:
                42
            expect get_value() == 42

        it "uses return for early return":
            fn check(x: i64) -> i64:
                if x < 0:
                    return 0
                x
            expect check(42) == 42

    context "control flow keywords":
        it "uses elif not else if":
            fn classify(x: i64) -> text:
                if x < 0:
                    "negative"
                elif x == 0:
                    "zero"
                else:
                    "positive"
            expect classify(5) == "positive"


# ============================================================================
# Test Group 4: Boolean Literals
# ============================================================================

describe "Boolean Literal Validation":
    """
    ## Correct Boolean Syntax

    Tests that Simple uses lowercase true/false, not Python's True/False.
    """

    it "uses lowercase true":
        val x = true
        expect x == true

    it "uses lowercase false":
        val x = false
        expect x == false

    it "uses booleans in conditions":
        if true:
            expect true
        if not false:
            expect true


# ============================================================================
# Test Group 5: Nil vs None
# ============================================================================

describe "Nil Value Validation":
    """
    ## Correct Nil Syntax

    Tests that Simple uses nil, and None is for Option type.
    """

    it "uses nil for null value":
        val x = nil
        expect x == nil

    it "uses None for Option":
        val opt: Option<i64> = None
        expect not opt.?

    it "uses Some for Option with value":
        val opt = Some(42)
        expect opt.?


# ============================================================================
# Test Group 6: Type Annotation Syntax
# ============================================================================

describe "Type Annotation Validation":
    """
    ## Correct Type Syntax

    Tests that type annotations use correct Simple syntax.
    """

    it "uses colon for type annotation":
        val x: i64 = 42
        expect x == 42

    it "uses arrow for return type":
        fn get_value() -> i64:
            42
        expect get_value() == 42

    it "uses angle brackets for generics":
        fn identity<T>(x: T) -> T:
            x
        expect identity(42) == 42

    it "uses Option for optional types":
        val opt: Option<i64> = Some(42)
        expect opt.unwrap() == 42


# ============================================================================
# Test Group 7: String Syntax
# ============================================================================

describe "String Syntax Validation":
    """
    ## Correct String Literals

    Tests that strings use correct Simple syntax.
    """

    it "uses double quotes for interpolated strings":
        val name = "World"
        val greeting = "Hello, {name}!"
        expect greeting == "Hello, World!"

    it "uses single quotes for raw strings":
        val raw = 'Hello\nWorld'
        expect raw.contains("\\n")

    it "uses r prefix for raw double-quoted":
        val raw = r"Path\to\file"
        expect raw.contains("\\")


# ============================================================================
# Test Group 8: Collection Syntax
# ============================================================================

describe "Collection Syntax Validation":
    """
    ## Correct Collection Literals

    Tests that collections use correct Simple syntax.
    """

    it "uses square brackets for arrays":
        val arr = [1, 2, 3]
        expect arr.len() == 3

    it "uses parentheses for tuples":
        val t = (1, 2, 3)
        expect t.0 == 1

    it "uses braces for dictionaries":
        val d = {"key": 42}
        expect d["key"] == 42


# ============================================================================
# Test Group 9: Struct Instantiation
# ============================================================================

describe "Struct Instantiation Validation":
    """
    ## Correct Struct Construction

    Tests that structs are instantiated with correct syntax.
    """

    it "uses braces for struct literal":
        struct Point:
            x: i64
            y: i64
        val p = Point { x: 10, y: 20 }
        expect p.x == 10

    it "uses colon in struct literal":
        struct Data:
            value: i64
        val d = Data { value: 42 }
        expect d.value == 42


# ============================================================================
# Test Group 10: Pattern Matching Syntax
# ============================================================================

describe "Pattern Matching Validation":
    """
    ## Correct Match Syntax

    Tests that pattern matching uses correct Simple syntax.
    """

    it "uses case keyword for patterns":
        fn classify(x: i64) -> text:
            match x:
                case 0:
                    "zero"
                case _:
                    "other"
        expect classify(0) == "zero"

    it "uses if for guards":
        fn classify(x: i64) -> text:
            match x:
                case n if n < 0:
                    "negative"
                case _:
                    "non-negative"
        expect classify(-5) == "negative"

    it "uses double colon for enum variants":
        enum Status:
            Ok
            Error
        fn check(s: Status) -> text:
            match s:
                case Status.Ok:
                    "ok"
                case Status.Error:
                    "error"
        expect check(Status.Ok) == "ok"
