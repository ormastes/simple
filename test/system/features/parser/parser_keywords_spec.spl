"""
# Parser Keywords Specification

**Feature IDs:** #PARSER-KW-001 to #PARSER-KW-020
**Category:** Infrastructure | Parser
**Status:** Implemented

Tests that all Simple language keywords are correctly recognized and
parsed in their appropriate contexts.

## Keywords

- Declaration: fn, struct, class, enum, trait, impl, module, type, extern, macro, actor
- Variables: val, var, let, const
- Control: if, elif, else, while, for, loop, match, case, break, continue, return
- Logic: and, or, not, in, is
- Async: async, await, spawn, go, send, recv
- Special: true, false, nil, self, Self
"""

use std.spec


# ============================================================================
# Test Group 1: Declaration Keywords
# ============================================================================

describe "Declaration Keyword Parsing":
    """
    ## Type and Function Declaration Keywords

    Tests that declaration keywords are correctly recognized.
    """

    context "fn keyword":
        it "parses fn declaration":
            fn my_function() -> i64:
                42
            expect my_function() == 42

    context "struct keyword":
        it "parses struct declaration":
            struct MyStruct:
                value: i64
            val s = MyStruct { value: 42 }
            expect s.value == 42

    context "class keyword":
        it "parses class declaration":
            class MyClass:
                value: i64
            val c = MyClass { value: 42 }
            expect c.value == 42

    context "enum keyword":
        it "parses enum declaration":
            enum MyEnum:
                A
                B
            expect MyEnum::A != MyEnum::B

    context "trait keyword":
        it "parses trait declaration":
            trait MyTrait:
                fn method() -> i64
            expect true

    context "impl keyword":
        it "parses impl block":
            struct Point:
                x: i64
            impl Point:
                fn get_x() -> i64:
                    self.x
            val p = Point { x: 42 }
            expect p.get_x() == 42

    context "module keyword":
        it "parses module declaration":
            module my_module:
                fn helper() -> i64:
                    42
            expect my_module::helper() == 42

    context "type keyword":
        it "parses type alias":
            type MyInt = i64
            val x: MyInt = 42
            expect x == 42

    context "extern keyword":
        it "parses extern function":
            extern fn external_func(x: i64) -> i64
            expect true

    context "actor keyword":
        it "parses actor declaration":
            actor MyActor:
                fn handle():
                    pass
            expect true


# ============================================================================
# Test Group 2: Variable Keywords
# ============================================================================

describe "Variable Keyword Parsing":
    """
    ## Variable Declaration Keywords

    Tests that variable declaration keywords work correctly.
    """

    context "val keyword":
        it "declares immutable variable":
            val x = 42
            expect x == 42

    context "var keyword":
        it "declares mutable variable":
            var x = 0
            x = 42
            expect x == 42

    context "let keyword":
        it "declares binding":
            let x = 42
            expect x == 42

        it "supports destructuring":
            let (a, b) = (1, 2)
            expect a + b == 3


# ============================================================================
# Test Group 3: Control Flow Keywords
# ============================================================================

describe "Control Flow Keyword Parsing":
    """
    ## Branching and Looping Keywords

    Tests that control flow keywords are correctly parsed.
    """

    context "if/elif/else keywords":
        it "parses if":
            if true:
                expect true

        it "parses elif":
            if false:
                expect false
            elif true:
                expect true

        it "parses else":
            if false:
                expect false
            else:
                expect true

    context "while keyword":
        it "parses while loop":
            var x = 0
            while x < 3:
                x = x + 1
            expect x == 3

    context "for keyword":
        it "parses for loop":
            var sum = 0
            for i in [1, 2, 3]:
                sum = sum + i
            expect sum == 6

    context "loop keyword":
        it "parses infinite loop":
            var x = 0
            loop:
                x = x + 1
                if x >= 3:
                    break
            expect x == 3

    context "match/case keywords":
        it "parses match expression":
            val result = match 42:
                case 0:
                    "zero"
                case _:
                    "other"
            expect result == "other"

    context "break keyword":
        it "parses break in loop":
            var x = 0
            loop:
                x = x + 1
                break
            expect x == 1

    context "continue keyword":
        it "parses continue in loop":
            var sum = 0
            for i in [1, 2, 3, 4, 5]:
                if i % 2 == 0:
                    continue
                sum = sum + i
            expect sum == 9

    context "return keyword":
        it "parses return statement":
            fn early_return(x: i64) -> i64:
                if x < 0:
                    return 0
                x
            expect early_return(-1) == 0


# ============================================================================
# Test Group 4: Logic Keywords
# ============================================================================

describe "Logic Keyword Parsing":
    """
    ## Boolean and Test Keywords

    Tests that logical operator keywords work correctly.
    """

    context "and keyword":
        it "parses and operator":
            expect (true and true) == true
            expect (true and false) == false

    context "or keyword":
        it "parses or operator":
            expect (true or false) == true
            expect (false or false) == false

    context "not keyword":
        it "parses not operator":
            expect (not false) == true
            expect (not true) == false

    context "in keyword":
        it "parses in operator":
            expect 2 in [1, 2, 3]
            expect 5 not in [1, 2, 3]

    context "is keyword":
        it "parses is operator":
            val opt = Some(42)
            if opt is Some(x):
                expect x == 42


# ============================================================================
# Test Group 5: Async Keywords
# ============================================================================

describe "Async Keyword Parsing":
    """
    ## Concurrency Keywords

    Tests that async/concurrent keywords are recognized.
    """

    context "async keyword":
        it "parses async function":
            async fn async_func() -> i64:
                42
            expect true

    context "await keyword":
        it "parses await expression":
            async fn get_value() -> i64:
                42
            async fn use_value() -> i64:
                await get_value()
            expect true

    context "spawn keyword":
        it "parses spawn expression":
            fn work() -> i64:
                42
            val handle = spawn work()
            expect true

    context "go keyword":
        it "parses go statement":
            fn background_work():
                pass
            go background_work()
            expect true


# ============================================================================
# Test Group 6: Special Keywords
# ============================================================================

describe "Special Keyword Parsing":
    """
    ## Built-in Value Keywords

    Tests that special value keywords are recognized.
    """

    context "true/false keywords":
        it "parses true":
            val x = true
            expect x

        it "parses false":
            val x = false
            expect not x

    context "nil keyword":
        it "parses nil":
            val x = nil
            expect x == nil

    context "self keyword":
        it "parses self in method":
            struct Data:
                value: i64
            impl Data:
                fn get() -> i64:
                    self.value
            val d = Data { value: 42 }
            expect d.get() == 42

    context "Self keyword":
        it "parses Self in return type":
            struct Builder:
                value: i64
            impl Builder:
                fn with_value(v: i64) -> Self:
                    Builder { value: v }
            val b = Builder.with_value(42)
            expect b.value == 42


# ============================================================================
# Test Group 7: Suspension Keywords
# ============================================================================

describe "Suspension Keyword Parsing":
    """
    ## Async-by-Default Suspension

    Tests that suspension control flow keywords work.
    """

    context "if~ keyword":
        it "parses suspension if":
            if~ true:
                expect true

    context "while~ keyword":
        it "parses suspension while":
            var x = 0
            while~ x < 3:
                x = x + 1
            expect x == 3

    context "for~ keyword":
        it "parses suspension for":
            var sum = 0
            for~ i in [1, 2, 3]:
                sum = sum + i
            expect sum == 6


# ============================================================================
# Test Group 8: Visibility Keywords
# ============================================================================

describe "Visibility Keyword Parsing":
    """
    ## Access Modifier Keywords

    Tests that visibility keywords are recognized.
    """

    context "pub keyword":
        it "parses public function":
            pub fn public_func() -> i64:
                42
            expect public_func() == 42

        it "parses public struct":
            pub struct PublicStruct:
                value: i64
            expect true

    context "private (default)":
        it "parses private function":
            fn private_func() -> i64:
                42
            expect private_func() == 42
