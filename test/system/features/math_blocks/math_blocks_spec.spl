# @pending
"""
# Math Block Tensor Operations Specification

**Feature IDs:** #1090-1098 (subset: tensor ops)
**Category:** Syntax / Math DSL
**Difficulty:** 4/5
**Status:** Implemented

## Overview

The `m{}` math block supports torch-compatible tensor operations for numerical computing.
Each math block is a self-contained DSL expression that returns a Block value.
"""



# ============================================================================
# Basic Arithmetic
# ============================================================================

describe "Math Block Arithmetic":
    """
    Basic arithmetic operations.
    """

    it "evaluates addition":
        val result = m{ 2 + 3 }
        expect(result).to_equal(5)

    it "evaluates subtraction":
        val result = m{ 10 - 3 }
        expect(result).to_equal(7)

    it "evaluates multiplication":
        val result = m{ 4 * 5 }
        expect(result).to_equal(20)

    it "evaluates division":
        val result = m{ 15 / 3 }
        expect(result).to_equal(5)

    it "evaluates complex expression":
        val result = m{ (2 + 3) * 4 }
        expect(result).to_equal(20)

    it "respects operator precedence":
        val result = m{ 2 + 3 * 4 }
        expect(result).to_equal(14)

    it "evaluates power":
        val result = m{ 2^3 }
        expect(result).to_equal(8.0)

    it "evaluates negative numbers":
        val result = m{ -5 + 3 }
        expect(result).to_equal(-2)


# ============================================================================
# Math Functions
# ============================================================================

describe "Math Block Functions":
    """
    Built-in math functions.
    """

    it "evaluates sqrt of 16":
        val result = m{ sqrt(16) }
        expect(result).to_equal(4.0)

    it "evaluates sqrt of 9":
        val result = m{ sqrt(9) }
        expect(result).to_equal(3.0)

    it "evaluates abs of negative":
        val result = m{ abs(-5) }
        expect(result).to_equal(5)

    it "evaluates abs of positive":
        val result = m{ abs(7) }
        expect(result).to_equal(7)

    it "evaluates frac":
        val result = m{ frac(6, 2) }
        expect(result).to_equal(3.0)

    it "evaluates nested functions":
        val result = m{ sqrt(abs(-16)) }
        expect(result).to_equal(4.0)


# ============================================================================
# Matrix Operations - Scalar Results
# ============================================================================

describe "Math Block Matrix Operations":
    """
    Matrix operations that produce scalar results.
    """

    it "computes dot product":
        # dot([1,2,3], [4,5,6]) = 1*4 + 2*5 + 3*6 = 32
        val result = m{ dot([1, 2, 3], [4, 5, 6]) }
        expect(result).to_equal(32.0)

    it "computes dot product simple":
        # dot([1,1], [2,2]) = 1*2 + 1*2 = 4
        val result = m{ dot([1, 1], [2, 2]) }
        expect(result).to_equal(4.0)


# ============================================================================
# Constants
# ============================================================================

describe "Math Block Constants":
    """
    Built-in math constants.
    """

    it "evaluates pi greater than 3":
        val result = m{ pi }
        expect(result).to_be_greater_than(3.0)

    it "evaluates pi less than 4":
        val result = m{ pi }
        expect(result).to_be_less_than(4.0)

    it "evaluates e greater than 2":
        val result = m{ e }
        expect(result).to_be_greater_than(2.0)

    it "evaluates e less than 3":
        val result = m{ e }
        expect(result).to_be_less_than(3.0)


# ============================================================================
# Expressions with Arrays (returning scalars)
# ============================================================================

describe "Math Block Array Expressions":
    """
    Array expressions that produce scalar results through reductions.
    """

    it "evaluates array subscript":
        # Array access returns scalar
        val result = m{ [10, 20, 30][1] }
        expect(result).to_equal(20.0)

    it "evaluates nested array subscript":
        # 2D array access
        val result = m{ [[1, 2], [3, 4]][0][1] }
        expect(result).to_equal(2.0)


# ============================================================================
# LaTeX Compatibility
# ============================================================================

describe "Math Block LaTeX Compatibility":
    """
    LaTeX-style syntax support (with deprecation warnings).
    """

    it "evaluates LaTeX frac":
        val result = m{ \frac{10}{2} }
        expect(result).to_equal(5.0)

    it "evaluates LaTeX sqrt":
        val result = m{ \sqrt{25} }
        expect(result).to_equal(5.0)

    it "evaluates Greek letter pi":
        val result = m{ \pi }
        expect(result).to_be_greater_than(3.0)


# ============================================================================
# LaTeX Export
# ============================================================================

describe "Math Block LaTeX Export":
    """
    Math expressions can be exported to LaTeX format.
    """

    it "exports simple arithmetic":
        # Note: This demonstrates the LaTeX export capability
        # The actual export function is available in Rust: math.to_latex()
        # Simple syntax: 2 + 3 -> LaTeX: 2 + 3
        val result = m{ 2 + 3 }
        expect(result).to_equal(5)

    it "exports fractions":
        # Simple: frac(1, 2) -> LaTeX: \frac{1}{2}
        val result = m{ frac(1, 2) }
        expect(result).to_equal(0.5)

    it "exports Greek letters":
        # Simple: pi -> LaTeX: \pi
        val result = m{ pi }
        expect(result).to_be_greater_than(3.0)
