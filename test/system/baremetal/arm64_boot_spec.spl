# ARM64 (AArch64) Bare-Metal Boot Tests
#
# Tests ARM64 bare-metal boot functionality:
# - Exception vector table
# - EL1/EL2/EL3 setup
# - Stack pointer alignment
# - Jump to kernel_main
#
# These tests verify the ARM64 boot infrastructure works correctly.
#
# NOTE: Tests are skipped because the support modules don't exist yet:
#   - src.baremetal.arm64.test_support
#   - src.lib.qemu.boot_runner
#   - src.lib.qemu.mod

use std.spec
use std.spec.{check, check_msg}

# ===========================================================================
# Boot Code Tests
# ===========================================================================

describe "ARM64 Boot Code":
    skip_it "generates valid exception vector table":
        # Needs: create_vector_table, validate_vector_table from src.baremetal.arm64.test_support
        # ARM64 has 16 exception vectors
        # 4 exception types x 4 sources = 16 entries
        # Each entry is 128 bytes (total 2KB)
        check(true)

    skip_it "checks vector table alignment":
        # Needs: check_vbar_alignment
        # VBAR must be 2KB aligned
        check(true)

    skip_it "sets up exception levels correctly":
        # Needs: check_exception_level, check_el_transition, EL0-EL3
        # Boot typically starts at EL3 (highest privilege)
        # Then transitions: EL3 -> EL2 -> EL1 -> EL0
        check(true)

    skip_it "maintains stack pointer alignment":
        # Needs: get_stack_pointer, check_stack_alignment, STACK_SIZE
        # AArch64 requires 16-byte stack alignment
        check(true)

# ===========================================================================
# QEMU Boot Tests
# ===========================================================================

describe "ARM64 QEMU Boot":
    skip_it "boots on virt machine":
        # Needs: run_boot_test, BootTestConfig from src.lib.qemu.boot_runner
        # Needs: QemuArch from src.lib.qemu.mod
        # Test with a minimal ARM64 kernel
        check(true)

    skip_it "handles exceptions correctly":
        # TODO: Test exception handling
        # - Synchronous exceptions
        # - IRQ/FIQ
        # Requires test kernel with exception handlers
        check(true)
