"""
# Edge Case System Test


**Feature IDs:** #EDGE
**Category:** Testing
**Status:** Implemented
"""

use std.spec.{check}
use std.string.{NL}

describe "Edge Case Testing":
    slow_it "empty input handling":
        val empty = ""
        check(empty.len() == 0)
        
        val result = if empty.len() == 0: "empty" else: "not empty"
        check(result == "empty")
        
    slow_it "boundary values - zero":
        val zero = 0
        check(zero == 0)
        check(not (zero > 0))
        check(not (zero < 0))
        
    slow_it "boundary values - max int":
        val large = 999999999
        check(large > 0)
        check(large > 999999998)
        
    slow_it "boundary values - min int":
        val small = -999999999
        check(small < 0)
        check(small < -999999998)
        
    slow_it "null/nil propagation":
        val opt1 = nil
        val opt2 = opt1 ?? Some(42)
        check(opt2.?)
        check(opt2? == 42)
        
    slow_it "empty collection operations":
        val empty_arr = []
        check(empty_arr.len() == 0)
        
        val appended = empty_arr.append(1)
        check(appended.len() == 1)
        
    slow_it "single element collection":
        val single = [42]
        check(single.len() == 1)
        check(single[0] == 42)
        check(single[-1] == 42)
        
    slow_it "string edge cases - empty":
        val s = ""
        check(s.len() == 0)
        check(s + "x" == "x")
        
    slow_it "string edge cases - single char":
        val s = "a"
        check(s.len() == 1)
        check(s[0..1] == "a")
        
    slow_it "division edge cases":
        val a = 10
        val b = 1
        check(a / b == 10)
        check(a / a == 1)
        
    slow_it "modulo edge cases":
        check(0 % 5 == 0)
        check(5 % 5 == 0)
        check(4 % 5 == 4)
        
    slow_it "nested option unwrapping":
        val nested = Some(Some(Some(10)))
        check(nested.?)
        
    slow_it "deeply nested conditionals":
        val a = 1
        val b = 2
        val c = 3
        
        if a < b:
            if b < c:
                if c > a:
                    check(true)
                else:
                    check(false)
            else:
                check(false)
        else:
            check(false)
            
    slow_it "loop with zero iterations":
        var count = 0
        for i in 0..0:
            count = count + 1
        check(count == 0)
        
    slow_it "loop with one iteration":
        var count = 0
        for i in 0..1:
            count = count + 1
        check(count == 1)
        
    slow_it "break on first iteration":
        var count = 0
        for i in 0..100:
            count = count + 1
            break
        check(count == 1)
        
    slow_it "continue all iterations":
        var executed = 0
        var continued = 0
        for i in 0..10:
            executed = executed + 1
            continue
            continued = continued + 1
        check(executed == 10)
        check(continued == 0)
        
    slow_it "match with all paths":
        for i in [1, 2, 3, 99]:
            val result = match i:
                1: "one"
                2: "two"
                3: "three"
                _: "other"
            check(result.len() > 0)
            
    slow_it "boolean short circuit - and":
        var evaluated = false
        val result = false and (evaluated := true; true)
        check(not evaluated)  # Second part should not be evaluated
        
    slow_it "boolean short circuit - or":
        var evaluated = false
        val result = true or (evaluated := true; false)
        check(not evaluated)  # Second part should not be evaluated
        
    slow_it "comparison chain":
        val x = 5
        check(0 < x)
        check(x < 10)
        check(0 < x and x < 10)
        
    slow_it "negative array index":
        val arr = [1, 2, 3, 4, 5]
        check(arr[-1] == 5)
        check(arr[-2] == 4)
        check(arr[-5] == 1)
        
    slow_it "array slice edge cases":
        val arr = [1, 2, 3, 4, 5]
        check(arr[0..0].len() == 0)
        check(arr[0..5].len() == 5)
        check(arr[2..-1].len() == 3)
        
    slow_it "dict with missing keys":
        val d = {"a": 1, "b": 2}
        check(d.get("a").?)
        check(not d.get("c").?)
        check(d.get("missing") ?? 99 == 99)
        
    slow_it "string operations on empty":
        val s = ""
        check(s.starts_with(""))
        check(s.ends_with(""))
        check(not s.contains("x"))
        
    slow_it "arithmetic with negatives":
        check(-5 + 10 == 5)
        check(-5 * -2 == 10)
        check(-10 / 2 == -5)
        
    slow_it "power of zero":
        check(5 ** 0 == 1)
        check(0 ** 0 == 1)
        check((-5) ** 0 == 1)
        
    slow_it "nested match expressions":
        val opt = Some(2)
        val result = match opt:
            Some(x):
                match x:
                    1: "one"
                    2: "two"
                    _: "other"
            nil: "none"
        check(result == "two")
