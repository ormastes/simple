"""
# MCP Lazy Loading Performance Specification

**Feature IDs:** #LAZY-002
**Category:** Infrastructure
**Difficulty:** 2/5
**Status:** In Progress

## Overview

Performance verification for MCP server startup with lazy imports.
The MCP full server uses `use lazy` for 5 heavy tool modules (34 tools),
deferring their loading until first tool invocation.

## Expected Behavior

- MCP server starts without loading debug/diagnostic tool modules
- Tool schema functions are loaded on first tools/list request
- Handler functions are loaded on first tool invocation
- All 34 tools remain functional after lazy loading
"""

use std.spec

extern fn rt_file_exists(path: text) -> bool

# ============================================================================
# Test Group 1: MCP Server Module Structure
# ============================================================================

describe "MCP lazy loading structure":
    """
    ## Structure Tests

    Verify that the MCP server file has the correct lazy import structure.
    """

    it "MCP main.spl exists and uses lazy imports":
        val exists = rt_file_exists("src/app/mcp/main.spl")
        expect(exists).to_equal(true)

    it "MCP helper modules are kept eager":
        # Helpers and protocol are needed at startup
        val exists = rt_file_exists("src/app/mcp/helpers.spl")
        expect(exists).to_equal(true)

    it "debug tools module exists for lazy loading":
        val exists = rt_file_exists("src/app/mcp/debug_tools.spl")
        expect(exists).to_equal(true)

    it "debug log tools module exists for lazy loading":
        val exists = rt_file_exists("src/app/mcp/debug_log_tools.spl")
        expect(exists).to_equal(true)

    it "diagnostic read tools module exists for lazy loading":
        val exists = rt_file_exists("src/app/mcp/diag_read_tools.spl")
        expect(exists).to_equal(true)

    it "diagnostic edit tools module exists for lazy loading":
        val exists = rt_file_exists("src/app/mcp/diag_edit_tools.spl")
        expect(exists).to_equal(true)

    it "diagnostic vcs tools module exists for lazy loading":
        val exists = rt_file_exists("src/app/mcp/diag_vcs_tools.spl")
        expect(exists).to_equal(true)
