# @pending
# @skip - Uses unsupported keyword: with
"""
# Compiler Basics Specification

**Feature ID:** #COMPILER-BASICS-001
**Category:** Compiler | Core
**Status:** Implemented

## Overview

Tests for core compiler functionality - verifies that code compiles and executes
correctly through the compiler pipeline (HIR → MIR → execution).

## Syntax

```simple
# Integer literals
val x = 42

# Arithmetic operations
val sum = 10 + 32
val diff = 50 - 8

# Comparison operations
val is_less = 1 < 2

# Logical operations
val both = true and false
```

## Key Concepts

| Concept | Description |
|---------|-------------|
| Integer Literal | Compile-time integer constant |
| Arithmetic | Binary arithmetic operations (+, -, *, /, %) |
| Comparison | Binary comparison operations (<, >, <=, >=, ==, !=) |
| Logical | Boolean operations (and, or, not) |
| Let Binding | Variable binding (val/let) |
| Function | Function definition and call |

## Behavior

- Integer literals compile to immediate values
- Arithmetic operations follow standard precedence
- Comparisons return boolean values
- Logical operations short-circuit
"""

use std.spec


# ============================================================================
# Test Group 1: Integer Literals
# ============================================================================

describe "Integer Literals":
    """
    ## Integer Literal Compilation

    Tests that integer literals compile correctly.
    """

    it "compiles zero":
        val result = 0
        expect result == 0

    it "compiles positive integer":
        val result = 42
        expect result == 42

    it "compiles negative integer":
        val result = -5
        expect result == -5


# ============================================================================
# Test Group 2: Arithmetic Operations
# ============================================================================

describe "Arithmetic Operations":
    """
    ## Arithmetic Compilation

    Tests that arithmetic operations compile and execute correctly.
    """

    it "compiles addition":
        val result = 10 + 32
        expect result == 42

    it "compiles subtraction":
        val result = 50 - 8
        expect result == 42

    it "compiles multiplication":
        val result = 6 * 7
        expect result == 42

    it "compiles division":
        val result = 84 / 2
        expect result == 42

    it "compiles modulo":
        val result = 47 % 5
        expect result == 2

    it "compiles nested arithmetic":
        val result = (10 + 20) * 2 - 18
        expect result == 42


# ============================================================================
# Test Group 3: Comparison Operations
# ============================================================================

describe "Comparison Operations":
    """
    ## Comparison Compilation

    Tests that comparison operations compile correctly.
    """

    it "compiles less than - true case":
        val result = if 1 < 2: 1 else: 0
        expect result == 1

    it "compiles less than - false case":
        val result = if 2 < 1: 1 else: 0
        expect result == 0

    it "compiles greater than - true case":
        val result = if 2 > 1: 1 else: 0
        expect result == 1

    it "compiles greater than - false case":
        val result = if 1 > 2: 1 else: 0
        expect result == 0

    it "compiles less than or equal - equal case":
        val result = if 1 <= 1: 1 else: 0
        expect result == 1

    it "compiles less than or equal - false case":
        val result = if 2 <= 1: 1 else: 0
        expect result == 0

    it "compiles greater than or equal - equal case":
        val result = if 2 >= 2: 1 else: 0
        expect result == 1

    it "compiles greater than or equal - false case":
        val result = if 1 >= 2: 1 else: 0
        expect result == 0

    it "compiles equals - true case":
        val result = if 42 == 42: 1 else: 0
        expect result == 1

    it "compiles equals - false case":
        val result = if 42 == 43: 1 else: 0
        expect result == 0

    it "compiles not equals - true case":
        val result = if 42 != 43: 1 else: 0
        expect result == 1

    it "compiles not equals - false case":
        val result = if 42 != 42: 1 else: 0
        expect result == 0


# ============================================================================
# Test Group 4: Logical Operations
# ============================================================================

describe "Logical Operations":
    """
    ## Logical Operation Compilation

    Tests that logical operations compile correctly.
    """

    it "compiles logical and - true case":
        val result = if true and true: 1 else: 0
        expect result == 1

    it "compiles logical and - false case":
        val result = if true and false: 1 else: 0
        expect result == 0

    it "compiles logical or - true case":
        val result = if false or true: 1 else: 0
        expect result == 1

    it "compiles logical or - false case":
        val result = if false or false: 1 else: 0
        expect result == 0


# ============================================================================
# Test Group 5: Boolean Literals
# ============================================================================

describe "Boolean Literals":
    """
    ## Boolean Literal Compilation

    Tests that boolean literals compile correctly.
    """

    it "compiles true literal":
        val result = if true: 42 else: 0
        expect result == 42

    it "compiles false literal":
        val result = if false: 0 else: 42
        expect result == 42


# ============================================================================
# Test Group 6: Variable Bindings
# ============================================================================

describe "Variable Bindings":
    """
    ## Variable Binding Compilation

    Tests that variable bindings compile correctly.
    """

    it "compiles single let binding":
        val x = 42
        expect x == 42

    it "compiles multiple let bindings":
        val a = 10
        val b = 32
        val result = a + b
        expect result == 42

    it "compiles binding with expression":
        val x = 10 + 32
        expect x == 42


# ============================================================================
# Test Group 7: Function Definitions
# ============================================================================

describe "Function Definitions":
    """
    ## Function Definition Compilation

    Tests that function definitions compile correctly.
    """

    it "compiles simple function":
        fn get_value():
            return 42
        expect get_value() == 42

    it "compiles function with parameters":
        fn add(a, b):
            return a + b
        expect add(10, 32) == 42

    it "compiles function with multiple statements":
        fn calc(x, y):
            val sum = x + y
            return sum
        expect calc(10, 32) == 42

    it "compiles nested function call":
        fn double(x):
            return x * 2
        fn add_doubled(a, b):
            return double(a) + double(b)
        expect add_doubled(10, 11) == 42

