# Basic macro system test
# Tests for basic macro functionality: simple macros, const parameters, and template generation.

import std.spec

# Macros must be defined at module level

macro basic_answer() -> (returns result: Int):
    emit result:
        42

macro basic_double(x: Int) -> (returns result: Int):
    emit result:
        x * 2

macro basic_add(a: Int, b: Int) -> (returns result: Int):
    emit result:
        a + b

macro basic_max(a: Int, b: Int) -> (returns result: Int):
    emit result:
        if a > b:
            return a
        else:
            return b

describe "Basic Macros":
    it "expands simple macro":
        val x = basic_answer!()
        expect(x).to(eq(42))

    it "uses const parameter":
        val x = basic_double!(21)
        expect(x).to(eq(42))

    it "generates function with template":
        val x = basic_add!(30, 12)
        expect(x).to(eq(42))

    it "evaluates max correctly":
        val x = basic_max!(10, 50)
        expect(x).to(eq(50))

        val y = basic_max!(100, 5)
        expect(y).to(eq(100))
