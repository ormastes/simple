# Snapshot Testing Framework - Comparison Tests
"""
Tests for snapshot comparison functionality including content matching,
diff generation, output formatting, and context line handling for
displaying differences between actual and expected snapshots.
"""

import std.spec

describe "Snapshot Comparison":
    """
    Verifies the comparison engine that detects differences between
    actual output and stored snapshots, generating readable diffs.
    """
    context "Basic Comparison":
        it "matches identical content":
            val actual = "Hello World"
            val expected = "Hello World"
            expect(actual).to(eq(expected))

        it "detects content differences":
            val actual = "Hello World"
            val expected = "Hello World!"
            expect(actual == expected).to(be_false())

        it "ignores whitespace differences when configured":
            val content1 = "hello  world"
            val content2 = "hello world"
            # Different but could be normalized
            expect(content1 == content2).to(be_false())

    context "Diff Generation":
        it "generates diff for changed lines":
            val line1 = "old line"
            val line2 = "new line"
            expect(line1 == line2).to(be_false())

        it "handles multiline diffs":
            val text1 = "line 1\nline 2\nline 3"
            val text2 = "line 1\nline 2\nline 3"
            expect(text1).to(eq(text2))

        it "marks added lines":
            val original_length = 3
            val new_length = 4
            expect(new_length > original_length).to(be_true())

        it "marks removed lines":
            val original_length = 4
            val new_length = 3
            expect(new_length < original_length).to(be_true())

    context "Formatting":
        it "formats comparison result":
            val result = "Match"
            expect(result).to(eq("Match"))

        it "shows unified diff format":
            val diff_format = "unified"
            expect(diff_format).to(eq("unified"))

        it "shows side-by-side format":
            val diff_format = "side-by-side"
            expect(diff_format).to(eq("side-by-side"))

    context "Context Lines":
        it "includes context around changes":
            val context_size = 3
            expect(context_size > 0).to(be_true())

        it "handles edge cases at file start":
            val line_number = 1
            expect(line_number >= 1).to(be_true())

        it "handles edge cases at file end":
            val total_lines = 100
            val line_number = 100
            expect(line_number <= total_lines).to(be_true())
