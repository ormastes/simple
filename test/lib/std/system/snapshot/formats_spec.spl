# Snapshot Testing Framework - Formats Tests

use std.spec.*

describe "Snapshot Formats":
    context "Text Format":
        it "preserves text content":
            val content = "Hello\nWorld"
            expect(content).to(eq("Hello\nWorld"))

        it "handles empty text":
            val content = ""
            expect(content).to(eq(""))

        it "preserves whitespace in text":
            val content = "  indented  "
            expect(content).to(eq("  indented  "))

    context "JSON Format":
        it "parses valid json":
            val json_str = "{\"key\": \"value\"}"
            expect(json_str.contains("key")).to(be_true())

        it "handles json arrays":
            val json_str = "[1, 2, 3]"
            expect(json_str.contains("[")).to(be_true())

        it "handles nested json":
            val json_str = "{\"outer\": {\"inner\": \"value\"}}"
            expect(json_str.contains("inner")).to(be_true())

    context "YAML Format":
        it "handles yaml key-value":
            val yaml_str = "key: value"
            expect(yaml_str.contains("key")).to(be_true())

        it "handles yaml lists":
            val yaml_str = "- item1\n- item2"
            expect(yaml_str.contains("item1")).to(be_true())

        it "preserves yaml indentation":
            val yaml_str = "parent:\n  child: value"
            expect(yaml_str.contains("  child")).to(be_true())

    context "Format Detection":
        it "detects text format":
            val format = "text"
            expect(format).to(eq("text"))

        it "detects json format":
            val format = "json"
            expect(format).to(eq("json"))

        it "detects yaml format":
            val format = "yaml"
            expect(format).to(eq("yaml"))

    context "Format Conversion":
        it "converts text to bytes":
            val content = "hello"
            expect(len(content)).to(eq(5))

        it "handles unicode in content":
            val content = "hello world extended"
            expect(len(content) > 5).to(be_true())

        it "normalizes line endings":
            val content_unix = "line1\nline2"
            val content_mixed = "line1\r\nline2"
            # Both should be valid
            expect(content_unix.contains("line1")).to(be_true())
            expect(content_mixed.contains("line1")).to(be_true())

    context "Format Compatibility":
        it "ensures consistent encoding":
            val content = "test"
            expect(content).to(eq("test"))

        it "handles binary-safe formats":
            val format = "binary"
            expect(format).to(eq("binary"))
