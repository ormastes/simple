# Gherkin DSL System Tests
# Tests for the Gherkin BDD DSL components
"""
Tests for the Gherkin BDD DSL including StepKind enum functionality
and Examples table data extraction for parameterized scenarios.
"""

import spec.{StepKind, get_examples_headers, get_examples_data, expect, describe, it, eq}

describe "Gherkin DSL":
    """
    Verifies Gherkin DSL components: StepKind enum for Given/When/Then
    steps, and helper functions for processing Examples tables.
    """
    describe "StepKind enum":
        it "converts to string correctly":
            expect(StepKind.Given.to_string()).to eq("Given")
            expect(StepKind.When.to_string()).to eq("When")
            expect(StepKind.Then.to_string()).to eq("Then")
            expect(StepKind.AndThen.to_string()).to eq("And")

        it "provides descriptions":
            val given_desc = StepKind.Given.description()
            val when_desc = StepKind.When.description()
            val then_desc = StepKind.Then.description()
            expect(given_desc.contains("Setup")).to eq(true)
            expect(when_desc.contains("Action")).to eq(true)
            expect(then_desc.contains("Assertion")).to eq(true)

        it "has type check methods":
            expect(StepKind.Given.is_given()).to eq(true)
            expect(StepKind.When.is_when()).to eq(true)
            expect(StepKind.Then.is_then()).to eq(true)
            expect(StepKind.Given.is_setup()).to eq(true)
            expect(StepKind.When.is_action()).to eq(true)
            expect(StepKind.Then.is_assertion()).to eq(true)

describe "Examples Tables":
    """
    Tests helper functions for extracting headers and data rows
    from Gherkin Examples tables used in Scenario Outlines.
    """
    it "extracts data rows excluding header":
        val rows = [
            ["x", "y"],
            [1, 2],
            [3, 4]
        ]
        val data = get_examples_data(rows)
        expect(data.len()).to eq(2)  # Excludes header row
