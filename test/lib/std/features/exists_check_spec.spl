"""
# Existence Check Operator (.?) Specification

**Feature IDs:** #2100
**Category:** Syntax
**Status:** Implemented

The `.?` operator checks if a value is "present" (non-nil AND non-empty).
"""
use std.spec.*

describe "Existence Check Operator .?":
    """
    Verifies the existence check operator `.?` that tests whether a value is
    "present" (non-nil AND non-empty). This operator provides a concise way to
    check Option<T> for Some, collections for non-emptiness, and strings for
    non-empty content. Primitives always return true since they always exist.
    The operator integrates with no-paren method calls for idiomatic patterns
    like `list.first.?` and `str.trim.?`.
    """

    context "Option type":
        it "returns true for Some":
            val some_val: Option<i32> = Some(42)
            expect some_val.? == true

        it "returns true for Some(0)":
            val some_zero: Option<i32> = Some(0)
            expect some_zero.? == true

        it "returns false for None":
            val none_val: Option<i32> = None
            expect none_val.? == false

    context "List type":
        it "returns false for empty list":
            val empty: List<i32> = []
            expect empty.? == false

        it "returns true for non-empty list":
            val items = [1, 2, 3]
            expect items.? == true

    context "Dict type":
        it "returns false for empty dict":
            val empty: Dict<text, i32> = {}
            expect empty.? == false

        it "returns true for non-empty dict":
            val items = {"a": 1}
            expect items.? == true

    context "String type":
        it "returns false for empty string":
            val empty = ""
            expect empty.? == false

        it "returns true for non-empty string":
            val s = "hello"
            expect s.? == true

    context "Primitive types":
        it "returns true for positive number":
            val num = 42
            expect num.? == true

        it "returns true for zero":
            val zero = 0
            expect zero.? == true

        it "returns true for false":
            val flag = false
            expect flag.? == true

    context "with no-paren method calls":
        it "works with list.first.?":
            val items = [1, 2, 3]
            expect items.first.? == true

        it "returns false for empty list.first.?":
            val empty: List<i32> = []
            expect empty.first.? == false

        it "works with string.trim.?":
            val s = "  hello  "
            expect s.trim.? == true

        it "works with chained no-paren methods":
            val s = "  HELLO  "
            expect s.trim.lower.? == true

        it "returns false for empty result":
            val empty = ""
            expect empty.trim.? == false
