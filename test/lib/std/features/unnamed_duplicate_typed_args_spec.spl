"""
# Unnamed Duplicate Typed Arguments Warning Specification

**Feature IDs:** #LINT-001
**Category:** Lint
**Status:** Implemented

This lint warns when a function has multiple parameters of the same type that
are passed positionally without named arguments. This helps prevent argument
order mistakes at call sites by encouraging explicit naming.
"""

use std.spec.*

describe "Unnamed Duplicate Typed Args Warning":
    """
    Verifies the `unnamed_duplicate_typed_args` lint that detects potential
    call site errors when functions have multiple parameters of the same type.
    The lint encourages using named arguments (e.g., `foo(a=x, b=y)`) instead
    of positional arguments (e.g., `foo(x, y)`) to prevent accidental argument
    swapping bugs. This is especially important for functions like `copy(from,
    to)` where swapping arguments silently produces wrong behavior.
    """

    context "functions with duplicate typed params":
        it "warns on positional call with two text params":
            # When a function has fn foo(a: text, b: text)
            # calling foo(x, y) should warn, but foo(a=x, b=y) should not
            fn copy_text(src: text, dest: text) -> text:
                dest

            # Named arguments - no warning
            val result = copy_text(src="source", dest="destination")
            expect result == "destination"

        it "accepts named arguments without warning":
            fn swap(left: i64, right: i64) -> (i64, i64):
                (right, left)

            # Named call prevents accidental swapping
            val (a, b) = swap(left=1, right=2)
            expect a == 2
            expect b == 1

        it "works with mixed named and positional args":
            fn range_check(value: i64, min: i64, max: i64) -> bool:
                value >= min && value <= max

            # First positional, rest named
            val ok = range_check(5, min=0, max=10)
            expect ok == true

    context "no warning cases":
        it "does not warn on single parameter":
            fn single(x: text) -> text:
                x
            expect single("hello") == "hello"

        it "does not warn on different typed params":
            fn mixed(name: text, count: i64) -> text:
                "{name}: {count}"
            expect mixed("items", 5) == "items: 5"

        it "does not warn when all params are named":
            fn coords(x: i64, y: i64, z: i64) -> i64:
                x + y + z
            expect coords(x=1, y=2, z=3) == 6

    context "real world examples":
        it "copy function with named args":
            fn copy_file(source: text, dest: text) -> text:
                "Copied {source} to {dest}"

            # Using named args prevents confusing source/dest
            val msg = copy_file(source="/a/b.txt", dest="/c/d.txt")
            expect msg == "Copied /a/b.txt to /c/d.txt"

        it "compare function with named args":
            fn compare(expected: text, actual: text) -> bool:
                expected == actual

            # Named args clarify which is expected vs actual
            expect compare(expected="hello", actual="hello") == true

        it "move function with named args":
            fn move_item(from_pos: i64, to_pos: i64) -> i64:
                to_pos - from_pos

            # Clear intent with named args
            val distance = move_item(from_pos=0, to_pos=10)
            expect distance == 10
