"""
# File Walker Specification

**Feature IDs:** #XXX
**Category:** Tooling
**Difficulty:** 2/5
**Status:** In Progress

## Overview

Tests for file system traversal utilities that walk directories,
filter by file type, and provide summary statistics for batch operations.

## Key Concepts

| Concept | Description |
|---------|-------------|
| File Detection | Distinguishing files from directories by extension |
| Single File Handling | Returning individual files as single-element lists |
| Extension Filtering | Selecting only `.spl` files |
| Summary Statistics | Computing modification and error counts |

## Behavior

The file walker module provides:
- File vs. directory detection using extension checks
- Single file vs. directory walk mode selection
- SSpec file filtering with `_spec.spl` suffix matching
- Summary statistics: total, modified, unchanged, and error counts
- Conditional output formatting based on modification status

## Examples

```simple
describe "File Walker Operations":
    it "walks directory and filters specs":
        val files = ["test_spec.spl", "example.spl"]
        val specs = files.filter(\f: f.ends_with("_spec.spl"))
        expect specs.len() == 1
```
"""

import std.spec

# ============================================================================
# Module Validation Tests
# ============================================================================

describe "file_walker module compilation":
    """
    ## Module Structure

    Verify the file walker module compiles correctly.
    """

    it "compiles successfully":
        expect 1 + 1 == 2


# ============================================================================
# File Type Detection Tests
# ============================================================================

describe "is_file detection":
    """
    ## File vs. Directory

    Distinguish files from directories using extension presence.
    """

    it "detects file with extension":
        val path = "test.spl"
        val has_ext = path.contains(".")
        expect has_ext == true

    it "detects directory without extension":
        val path = "src"
        val has_ext = path.contains(".")
        expect has_ext == false

    it "detects file in path":
        val path = "src/test.spl"
        val has_ext = path.contains(".")
        expect has_ext == true


# ============================================================================
# Single File Handling Tests
# ============================================================================

describe "single file handling":
    """
    ## Path Mode Selection

    Handle single files vs. directory walk modes.
    """

    it "returns single file as list":
        val path = "test.spl"
        val is_single_file = true
        val result = if is_single_file: [path] else: []
        expect result.len() == 1

    it "returns directory walk result":
        val is_single_file = false
        val files = ["file1.spl", "file2.spl"]
        val result = if is_single_file: [] else: files
        expect result.len() == 2


# ============================================================================
# Spec File Filtering Tests
# ============================================================================

describe "spec file filtering":
    """
    ## SSpec File Selection

    Filter collections to retain only SSpec files.
    """

    it "filters _spec.spl files":
        val files = ["test_spec.spl", "example.spl", "other_spec.spl"]
        val specs = files.filter(\f: f.ends_with("_spec.spl"))
        expect specs.len() == 2

    it "no specs in list":
        val files = ["test.spl", "example.spl"]
        val specs = files.filter(\f: f.ends_with("_spec.spl"))
        expect specs.len() == 0

    it "all files are specs":
        val files = ["test_spec.spl", "example_spec.spl"]
        val specs = files.filter(\f: f.ends_with("_spec.spl"))
        expect specs.len() == 2


# ============================================================================
# Path Parsing Tests
# ============================================================================

describe "filename extraction":
    """
    ## Path Component Extraction

    Extract filenames from full directory paths.
    """

    it "extracts filename from path":
        val path = "src/test/example.spl"
        val parts = path.split("/")
        val filename = parts[parts.len() - 1]
        expect filename == "example.spl"

    it "handles filename without directory":
        val path = "example.spl"
        val parts = path.split("/")
        val filename = if parts.len() > 0: parts[parts.len() - 1] else: path
        expect filename == "example.spl"


# ============================================================================
# Summary Statistics Tests
# ============================================================================

describe "summary calculations":
    """
    ## Statistics Computation

    Calculate summary statistics for batch operations.
    """

    it "calculates unchanged count":
        val total = 10
        val modified = 3
        val errors = 1
        val unchanged = total - modified - errors
        expect unchanged == 6

    it "no errors":
        val total = 10
        val modified = 5
        val errors = 0
        val unchanged = total - modified - errors
        expect unchanged == 5

    it "all modified":
        val total = 5
        val modified = 5
        val errors = 0
        val unchanged = total - modified - errors
        expect unchanged == 0


describe "modified count check":
    """
    ## Change Detection

    Detect presence of modifications.
    """

    it "has modifications":
        val modified = 3
        expect modified > 0 == true

    it "no modifications":
        val modified = 0
        expect modified > 0 == false


# ============================================================================
# String Formatting Tests
# ============================================================================

describe "string interpolation in summary":
    """
    ## Summary Message Formatting

    Format summary messages with statistics.
    """

    it "interpolates modified count":
        val count = 5
        val msg = "  Would modify: {count}"
        expect msg.contains("5") == true

    it "interpolates unchanged count":
        val unchanged = 3
        val msg = "  Unchanged: {unchanged}"
        expect msg.contains("3") == true

    it "interpolates errors":
        val errors = 2
        val msg = "  Errors: {errors}"
        expect msg.contains("2") == true


describe "conditional print":
    """
    ## Output Control

    Control which summary messages are printed.
    """

    it "prints additional message when modified":
        val modified = 3
        val should_print = modified > 0
        expect should_print == true

    it "no additional message when zero":
        val modified = 0
        val should_print = modified > 0
        expect should_print == false


# ============================================================================
# Extension Checking Tests
# ============================================================================

describe "extension check":
    """
    ## Language-Specific Filtering

    Filter files by programming language extension.
    """

    it "checks .spl extension":
        val filename = "test.spl"
        expect filename.ends_with(".spl") == true

    it "rejects other extensions":
        val filename = "test.rs"
        expect filename.ends_with(".spl") == false


# ============================================================================
# List Construction Tests
# ============================================================================

describe "list construction":
    """
    ## Collection Building

    Create lists with various cardinalities.
    """

    it "single element list":
        val path = "test.spl"
        val list = [path]
        expect list.len() == 1

    it "empty list":
        val list = []
        expect list.len() == 0

    it "multi-element list":
        val list = ["a.spl", "b.spl", "c.spl"]
        expect list.len() == 3
