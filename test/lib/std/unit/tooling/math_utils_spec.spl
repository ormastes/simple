# Tests for math utilities

use tooling.math_utils.*

# =====================================
# Integer Absolute Value Tests
# =====================================

fn test_abs_i32_positive():
    assert(abs_i32(5) == 5)
    assert(abs_i32(100) == 100)

fn test_abs_i32_negative():
    assert(abs_i32(-5) == 5)
    assert(abs_i32(-100) == 100)

fn test_abs_i32_zero():
    assert(abs_i32(0) == 0)

fn test_abs_i64():
    assert(abs_i64(-9223372036854775807) > 0)
    assert(abs_i64(1000000) == 1000000)

fn test_abs_f64():
    assert(abs_f64(-3.14) == 3.14)
    assert(abs_f64(2.71) == 2.71)

# =====================================
# Min/Max Tests
# =====================================

fn test_min_i32():
    assert(min_i32(5, 10) == 5)
    assert(min_i32(-5, 3) == -5)
    assert(min_i32(0, 0) == 0)

fn test_max_i32():
    assert(max_i32(5, 10) == 10)
    assert(max_i32(-5, 3) == 3)
    assert(max_i32(0, 0) == 0)

fn test_min_f64():
    assert(min_f64(3.14, 2.71) == 2.71)
    assert(min_f64(-1.5, -0.5) == -1.5)

fn test_max_f64():
    assert(max_f64(3.14, 2.71) == 3.14)
    assert(max_f64(-1.5, -0.5) == -0.5)

# =====================================
# Clamp Tests
# =====================================

fn test_clamp_i32_within_range():
    assert(clamp_i32(5, 0, 10) == 5)

fn test_clamp_i32_below_min():
    assert(clamp_i32(-5, 0, 10) == 0)

fn test_clamp_i32_above_max():
    assert(clamp_i32(15, 0, 10) == 10)

fn test_clamp_f64():
    assert(clamp_f64(5.5, 0.0, 10.0) == 5.5)
    assert(clamp_f64(-1.0, 0.0, 10.0) == 0.0)
    assert(clamp_f64(11.0, 0.0, 10.0) == 10.0)

# =====================================
# Sign Tests
# =====================================

fn test_sign_i32_positive():
    assert(sign_i32(5) == 1)
    assert(sign_i32(100) == 1)

fn test_sign_i32_negative():
    assert(sign_i32(-5) == -1)
    assert(sign_i32(-100) == -1)

fn test_sign_i32_zero():
    assert(sign_i32(0) == 0)

fn test_sign_f64():
    assert(sign_f64(3.14) == 1.0)
    assert(sign_f64(-2.71) == -1.0)
    assert(sign_f64(0.0) == 0.0)

# =====================================
# Power Tests
# =====================================

fn test_pow_i32_basic():
    assert(pow_i32(2, 3) == 8)
    assert(pow_i32(3, 2) == 9)
    assert(pow_i32(5, 3) == 125)

fn test_pow_i32_zero_exponent():
    assert(pow_i32(10, 0) == 1)
    assert(pow_i32(0, 0) == 1)

fn test_pow_i32_base_zero():
    assert(pow_i32(0, 5) == 0)

fn test_pow_i32_negative_base():
    assert(pow_i32(-2, 3) == -8)
    assert(pow_i32(-2, 4) == 16)

fn test_pow_f64():
    val result = pow_f64(2.0, 3.0)
    assert(result > 7.99 and result < 8.01)

# =====================================
# GCD and LCM Tests
# =====================================

fn test_gcd_basic():
    assert(gcd(12, 8) == 4)
    assert(gcd(21, 14) == 7)
    assert(gcd(17, 19) == 1)  # Coprime

fn test_gcd_same_number():
    assert(gcd(10, 10) == 10)

fn test_gcd_with_zero():
    assert(gcd(0, 5) == 5)
    assert(gcd(5, 0) == 5)

fn test_lcm_basic():
    assert(lcm(4, 6) == 12)
    assert(lcm(3, 5) == 15)

fn test_lcm_coprime():
    assert(lcm(7, 11) == 77)

# =====================================
# Factorial and Binomial Tests
# =====================================

fn test_factorial_small():
    assert(factorial(0) == 1)
    assert(factorial(1) == 1)
    assert(factorial(5) == 120)
    assert(factorial(6) == 720)

fn test_binomial_basic():
    assert(binomial(5, 2) == 10)  # "5 choose 2"
    assert(binomial(4, 2) == 6)   # "4 choose 2"

fn test_binomial_edge_cases():
    assert(binomial(5, 0) == 1)
    assert(binomial(5, 5) == 1)

# =====================================
# Rounding Tests
# =====================================

fn test_floor_f64():
    assert(floor_f64(3.7) == 3.0)
    assert(floor_f64(-2.3) == -3.0)
    assert(floor_f64(5.0) == 5.0)

fn test_ceil_f64():
    assert(ceil_f64(3.2) == 4.0)
    assert(ceil_f64(-2.7) == -2.0)
    assert(ceil_f64(5.0) == 5.0)

fn test_round_f64():
    assert(round_f64(3.4) == 3.0)
    assert(round_f64(3.6) == 4.0)
    assert(round_f64(-2.5) == -2.0 or round_f64(-2.5) == -3.0)  # Platform dependent

fn test_trunc_f64():
    assert(trunc_f64(3.7) == 3.0)
    assert(trunc_f64(-2.9) == -2.0)

# =====================================
# Interpolation Tests
# =====================================

fn test_lerp_basic():
    assert(lerp(0.0, 10.0, 0.0) == 0.0)
    assert(lerp(0.0, 10.0, 1.0) == 10.0)
    assert(lerp(0.0, 10.0, 0.5) == 5.0)

fn test_lerp_negative():
    assert(lerp(-10.0, 10.0, 0.5) == 0.0)

fn test_inverse_lerp():
    val t = inverse_lerp(0.0, 10.0, 5.0)
    assert(t == 0.5)

fn test_remap():
    # Map 5 from [0,10] to [0,100]
    val result = remap(5.0, 0.0, 10.0, 0.0, 100.0)
    assert(result == 50.0)

# =====================================
# Statistics Tests
# =====================================

fn test_sum_i32():
    assert(sum_i32([1, 2, 3, 4, 5]) == 15)
    assert(sum_i32([]) == 0)

fn test_sum_f64():
    val result = sum_f64([1.0, 2.5, 3.5])
    assert(result > 6.99 and result < 7.01)

fn test_product_i32():
    assert(product_i32([2, 3, 4]) == 24)
    assert(product_i32([]) == 1)

fn test_average_i32():
    match average_i32([1, 2, 3, 4, 5]):
        Some(avg) =>
            assert(avg == 3)
        None =>
            assert(false)

fn test_average_empty():
    match average_i32([]):
        Some(_) =>
            assert(false)
        None =>
            assert(true)

fn test_median_odd():
    match median_i32([1, 2, 3, 4, 5]):
        Some(med) =>
            assert(med == 3)
        None =>
            assert(false)

fn test_median_even():
    match median_i32([1, 2, 3, 4]):
        Some(med) =>
            # Average of 2 and 3
            assert(med == 2)
        None =>
            assert(false)

# =====================================
# Range Checking Tests
# =====================================

fn test_in_range_i32():
    assert(in_range_i32(5, 0, 10))
    assert(not in_range_i32(-1, 0, 10))
    assert(not in_range_i32(11, 0, 10))

fn test_in_range_f64():
    assert(in_range_f64(5.5, 0.0, 10.0))
    assert(not in_range_f64(-0.1, 0.0, 10.0))

# =====================================
# Even/Odd Tests
# =====================================

fn test_is_even():
    assert(is_even(0))
    assert(is_even(2))
    assert(is_even(-4))
    assert(not is_even(1))
    assert(not is_even(-3))

fn test_is_odd():
    assert(is_odd(1))
    assert(is_odd(3))
    assert(is_odd(-5))
    assert(not is_odd(0))
    assert(not is_odd(2))

# =====================================
# Divisibility Tests
# =====================================

fn test_is_divisible_by():
    assert(is_divisible_by(10, 2))
    assert(is_divisible_by(15, 5))
    assert(not is_divisible_by(7, 3))

# =====================================
# Comparison Tests
# =====================================

fn test_approx_equal():
    assert(approx_equal(1.0, 1.0000001, 0.001))
    assert(not approx_equal(1.0, 1.1, 0.001))

fn test_compare_f64():
    assert(compare_f64(1.0, 2.0, 0.001) < 0)
    assert(compare_f64(2.0, 1.0, 0.001) > 0)
    assert(compare_f64(1.0, 1.00001, 0.01) == 0)

# =====================================
# Conversion Tests
# =====================================

fn test_to_radians():
    val pi_approx = to_radians(180.0)
    assert(pi_approx > 3.14 and pi_approx < 3.15)

fn test_to_degrees():
    val deg = to_degrees(3.14159)
    assert(deg > 179.0 and deg < 181.0)

# =====================================
# Normalization Tests
# =====================================

fn test_normalize():
    val result = normalize(5.0, 0.0, 10.0)
    assert(result == 0.5)

fn test_denormalize():
    val result = denormalize(0.5, 0.0, 10.0)
    assert(result == 5.0)

# =====================================
# Square Root Tests
# =====================================

fn test_sqrt_f64():
    val result = sqrt_f64(4.0)
    assert(result > 1.99 and result < 2.01)

    val result2 = sqrt_f64(9.0)
    assert(result2 > 2.99 and result2 < 3.01)

fn test_sqrt_negative():
    # Should handle negative numbers gracefully (NaN or 0)
    val result = sqrt_f64(-1.0)
    # Just check it doesn't crash

# =====================================
# Other Math Functions Tests
# =====================================

fn test_distance_2d():
    val d = distance_2d(0.0, 0.0, 3.0, 4.0)
    assert(d > 4.99 and d < 5.01)  # Should be 5.0

fn test_distance_3d():
    val d = distance_3d(0.0, 0.0, 0.0, 1.0, 1.0, 1.0)
    assert(d > 1.73 and d < 1.74)  # sqrt(3)
