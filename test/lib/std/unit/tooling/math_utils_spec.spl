"""
Math Utilities Tests

Tests for mathematical operations including absolute value, min/max, rounding,
power functions, GCD/LCM, combinatorics, and statistical calculations.

Feature:
  Mathematical utility functions

Category:
  Tooling/Mathematics

Status:
  Complete
"""

use std.math_utils.{
    abs_i64, min_i64, max_i64, clamp_i64, sign_i64,
    pow_i64, gcd, lcm, factorial, binomial,
    is_even, is_odd, is_divisible_by, in_range_i64,
    sum_i64, product_i64, average_i64, median_i64
}

# =====================================
# BDD Tests
# =====================================

describe "Math Utilities":
    """
    Comprehensive tests for mathematical utility functions covering basic operations,
    comparisons, combinatorics, and statistical calculations on i64 values.
    """

    describe "Absolute Value":
        it "returns positive for positive":
            expect abs_i64(5) == 5

        it "returns positive for negative":
            expect abs_i64(-5) == 5

        it "returns zero for zero":
            expect abs_i64(0) == 0

    describe "Min/Max":
        it "min returns smaller":
            expect min_i64(a=5, b=10) == 5
            expect min_i64(a=-5, b=3) == -5

        it "max returns larger":
            expect max_i64(a=5, b=10) == 10
            expect max_i64(a=-5, b=3) == 3

    describe "Clamp":
        it "clamps within range":
            expect clamp_i64(x=5, min_val=0, max_val=10) == 5

        it "clamps below min":
            expect clamp_i64(x=-5, min_val=0, max_val=10) == 0

        it "clamps above max":
            expect clamp_i64(x=15, min_val=0, max_val=10) == 10

    describe "Sign":
        it "returns 1 for positive":
            expect sign_i64(5) == 1

        it "returns -1 for negative":
            expect sign_i64(-5) == -1

        it "returns 0 for zero":
            expect sign_i64(0) == 0

    describe "Power":
        it "calculates powers":
            expect pow_i64(base=2, exp=3) == 8
            expect pow_i64(base=3, exp=2) == 9

        it "handles zero exponent":
            expect pow_i64(base=10, exp=0) == 1

        it "handles zero base":
            expect pow_i64(base=0, exp=5) == 0

        it "handles negative base":
            expect pow_i64(base=-2, exp=3) == -8
            expect pow_i64(base=-2, exp=4) == 16

    describe "GCD and LCM":
        it "calculates gcd":
            expect gcd(a=12, b=8) == 4
            expect gcd(a=21, b=14) == 7
            expect gcd(a=17, b=19) == 1

        it "gcd with same number":
            expect gcd(a=10, b=10) == 10

        it "gcd with zero":
            expect gcd(a=0, b=5) == 5
            expect gcd(a=5, b=0) == 5

        it "calculates lcm":
            expect lcm(a=4, b=6) == 12
            expect lcm(a=3, b=5) == 15

    describe "Factorial and Binomial":
        it "calculates factorial":
            expect factorial(0) == 1
            expect factorial(1) == 1
            expect factorial(5) == 120

        it "calculates binomial":
            expect binomial(n=5, k=2) == 10
            expect binomial(n=4, k=2) == 6
            expect binomial(n=5, k=0) == 1
            expect binomial(n=5, k=5) == 1

    describe "Even/Odd":
        it "detects even":
            expect is_even(0)
            expect is_even(2)
            expect is_even(-4)
            expect not is_even(1)

        it "detects odd":
            expect is_odd(1)
            expect is_odd(3)
            expect not is_odd(0)

    describe "Divisibility":
        it "checks divisibility":
            expect is_divisible_by(x=10, d=2)
            expect is_divisible_by(x=15, d=5)
            expect not is_divisible_by(x=7, d=3)

    describe "Range":
        it "checks in range":
            expect in_range_i64(x=5, min_val=0, max_val=10)
            expect not in_range_i64(x=-1, min_val=0, max_val=10)
            expect not in_range_i64(x=11, min_val=0, max_val=10)

    describe "Statistics":
        it "calculates sum":
            expect sum_i64([1, 2, 3, 4, 5]) == 15

        it "sum of empty is 0":
            val empty_list: [i64] = []
            expect sum_i64(empty_list) == 0

        it "calculates product":
            expect product_i64([2, 3, 4]) == 24

        it "product of empty is 1":
            val empty_list: [i64] = []
            expect product_i64(empty_list) == 1

        it "calculates average":
            val result = average_i64([1, 2, 3, 4, 5])
            expect result == 3

        it "average of empty is nil":
            val empty_list: [i64] = []
            val result = average_i64(empty_list)
            expect result == nil

        it "calculates median odd":
            val result = median_i64([1, 2, 3, 4, 5])
            expect result == 3

        it "calculates median even":
            val result = median_i64([1, 2, 3, 4])
            expect result == 2
