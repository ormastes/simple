# Tests for Markdown utilities

use tooling.markdown_utils.*

# =====================================
# Header Tests
# =====================================

fn test_h1():
    assert(h1("Title") == "# Title")

fn test_h2():
    assert(h2("Section") == "## Section")

fn test_h3():
    assert(h3("Subsection") == "### Subsection")

fn test_heading():
    assert(heading("Test", 4) == "#### Test")

# =====================================
# Text Formatting Tests
# =====================================

fn test_bold():
    assert(bold("text") == "**text**")

fn test_italic():
    assert(italic("text") == "*text*")

fn test_bold_italic():
    assert(bold_italic("text") == "***text***")

fn test_code():
    assert(code("variable") == "`variable`")

fn test_strikethrough():
    assert(strikethrough("old") == "~~old~~")

# =====================================
# Link Tests
# =====================================

fn test_link():
    val result = link("Google", "https://google.com")
    assert(result == "[Google](https://google.com)")

fn test_image():
    val result = image("Alt text", "/path/to/image.png")
    assert(result == "![Alt text](/path/to/image.png)")

fn test_link_with_title():
    val result = link_with_title("Link", "https://example.com", "Example")
    assert(result.contains("[Link]"))
    assert(result.contains("Example"))

fn test_reference_link():
    assert(reference_link("Text", "ref1") == "[Text][ref1]")

# =====================================
# List Tests
# =====================================

fn test_unordered_list():
    val result = unordered_list(["Apple", "Banana", "Cherry"])
    assert(result.contains("- Apple"))
    assert(result.contains("- Banana"))
    assert(result.contains("- Cherry"))

fn test_ordered_list():
    val result = ordered_list(["First", "Second", "Third"])
    assert(result.contains("1. First"))
    assert(result.contains("2. Second"))
    assert(result.contains("3. Third"))

fn test_checklist_item():
    val checked = checklist_item("Done task", true)
    assert(checked.contains("[x]"))

    val unchecked = checklist_item("Todo task", false)
    assert(unchecked.contains("[ ]"))

# =====================================
# Code Block Tests
# =====================================

fn test_code_block():
    val result = code_block("fn main():\n    pass", "simple")
    assert(result.contains("```simple"))
    assert(result.contains("fn main()"))
    assert(result.contains("```"))

fn test_code_block_plain():
    val result = code_block_plain("some code")
    assert(result.contains("```"))
    assert(result.contains("some code"))

# =====================================
# Blockquote Tests
# =====================================

fn test_blockquote():
    assert(blockquote("Quote") == "> Quote")

fn test_blockquote_multi():
    val result = blockquote_multi(["Line 1", "Line 2"])
    assert(result.contains("> Line 1"))
    assert(result.contains("> Line 2"))

# =====================================
# Horizontal Rule Tests
# =====================================

fn test_horizontal_rule():
    assert(horizontal_rule() == "---")

fn test_hr():
    assert(hr() == "---")

# =====================================
# Table Tests
# =====================================

fn test_table():
    val headers = ["Name", "Age"]
    val rows = [
        ["Alice", "30"],
        ["Bob", "25"]
    ]
    val result = table(headers, rows)

    assert(result.contains("Name"))
    assert(result.contains("Age"))
    assert(result.contains("Alice"))
    assert(result.contains("---"))
    assert(result.contains("|"))

fn test_table_with_align():
    val headers = ["Left", "Center", "Right"]
    val rows = [["A", "B", "C"]]
    val alignments = [TableAlign.Left, TableAlign.Center, TableAlign.Right]

    val result = table_with_align(headers, rows, alignments)
    assert(result.contains(":---"))
    assert(result.contains(":---:"))
    assert(result.contains("---:"))

# =====================================
# Task List Tests
# =====================================

fn test_task_list():
    val tasks = [
        ("Complete task", true),
        ("Pending task", false)
    ]
    val result = task_list(tasks)

    assert(result.contains("[x] Complete task"))
    assert(result.contains("[ ] Pending task"))

# =====================================
# Definition Tests
# =====================================

fn test_definition():
    val result = definition("Term", "Definition text")
    assert(result.contains("Term"))
    assert(result.contains(": Definition text"))

# =====================================
# Footnote Tests
# =====================================

fn test_footnote_ref():
    assert(footnote_ref("1") == "[^1]")

fn test_footnote_def():
    val result = footnote_def("1", "Footnote text")
    assert(result.contains("[^1]:"))
    assert(result.contains("Footnote text"))

# =====================================
# Document Structure Tests
# =====================================

fn test_front_matter():
    val result = front_matter("title: Test\nauthor: Me")
    assert(result.contains("---"))
    assert(result.contains("title: Test"))

fn test_toc():
    assert(toc() == "<!-- TOC -->")

# =====================================
# Helper Tests
# =====================================

fn test_escape_markdown():
    val escaped = escape_markdown("*test* #heading")
    assert(escaped.contains("\\*"))
    assert(escaped.contains("\\#"))

fn test_document():
    val sections = [
        MarkdownSection(heading: "Intro", level: 1, content: "Welcome"),
        MarkdownSection(heading: "Details", level: 2, content: "More info")
    ]
    val result = document(sections)

    assert(result.contains("# Intro"))
    assert(result.contains("## Details"))
    assert(result.contains("Welcome"))

# =====================================
# Common Pattern Tests
# =====================================

fn test_readme_template():
    val result = readme_template(
        "My Project",
        "A cool project",
        "npm install my-project",
        "import my_project"
    )

    assert(result.contains("# My Project"))
    assert(result.contains("## Installation"))
    assert(result.contains("## Usage"))

fn test_badge():
    val result = badge("build", "passing", "green")
    assert(result.contains("build"))
    assert(result.contains("passing"))
    assert(result.contains("green"))

fn test_note():
    val result = note("Important information")
    assert(result.contains("NOTE"))
    assert(result.contains("Important information"))

fn test_warning():
    val result = warning("Be careful")
    assert(result.contains("WARNING"))

fn test_important():
    val result = important("Critical")
    assert(result.contains("IMPORTANT"))
