"""
Feature: String Utilities
Category: Tooling
Status: Complete

Unit tests for string manipulation utilities including repeat, reverse,
whitespace detection, character search, string joining, and case-insensitive comparison.
"""

use std.string_utils.{
    repeat_str, reverse_str, is_whitespace,
    contains_char, count_char, starts_with_char, ends_with_char,
    index_of_char, join_strs, compare_case_insensitive
}

# =====================================
# BDD Tests
# =====================================

describe "String Utilities":
    """Tests for string manipulation and character searching operations."""

    describe "Repeat":
        it "repeats string n times":
            expect repeat_str("ab", 3) == "ababab"
            expect repeat_str("x", 5) == "xxxxx"

        it "returns empty for zero repeats":
            expect repeat_str("test", 0) == ""

        it "handles empty string":
            expect repeat_str("", 5) == ""

    describe "Reverse":
        it "reverses string":
            expect reverse_str("hello") == "olleh"
            expect reverse_str("12345") == "54321"

        it "handles empty string":
            expect reverse_str("") == ""

        it "handles single char":
            expect reverse_str("a") == "a"

    describe "Whitespace":
        it "detects all whitespace":
            expect is_whitespace("   ")
            expect is_whitespace("\t\n")

        it "detects non-whitespace":
            expect not is_whitespace("hello")

        it "handles empty string":
            expect is_whitespace("")

    describe "Character Search":
        it "contains_char finds char":
            expect contains_char("hello", "e")
            expect not contains_char("hello", "x")

        it "count_char counts occurrences":
            expect count_char("hello", "l") == 2
            expect count_char("hello", "e") == 1
            expect count_char("hello", "x") == 0

        it "starts_with_char works":
            expect starts_with_char("hello", "h")
            expect not starts_with_char("hello", "w")

        it "ends_with_char works":
            expect ends_with_char("hello", "o")
            expect not ends_with_char("hello", "x")

        it "index_of_char finds index":
            val result = index_of_char("hello", "e")
            expect result == 1

        it "index_of_char returns nil for missing":
            val result = index_of_char("hello", "x")
            expect result == nil

    describe "Join":
        it "joins strings with separator":
            expect join_strs(["a", "b", "c"], ",") == "a,b,c"
            expect join_strs(["hello", "world"], " ") == "hello world"

        it "handles empty list":
            val empty: [text] = []
            expect join_strs(empty, ",") == ""

        it "handles single element":
            expect join_strs(["single"], ",") == "single"

    describe "Case Insensitive Compare":
        it "compares ignoring case":
            expect compare_case_insensitive("Hello", "hello")
            expect compare_case_insensitive("WORLD", "world")
            expect not compare_case_insensitive("test", "best")
