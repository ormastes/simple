# Shader Abstraction Tests
# Mock implementation for testing shader functionality

use std.spec.*

# Mock Shader
class Shader:
    name: text
    source: text
    compiled: bool

impl Shader:
    static fn new(name: text, source: text) -> Shader:
        Shader(name: name, source: source, compiled: false)

    me compile():
        self.compiled = true

    fn is_compiled() -> bool:
        self.compiled

    fn get_source() -> text:
        self.source

# Mock ShaderUniform
class ShaderUniform:
    name: text
    value: text
    uniform_type: text

impl ShaderUniform:
    static fn new(name: text, uniform_type: text) -> ShaderUniform:
        ShaderUniform(name: name, value: "", uniform_type: uniform_type)

    me set_value(v: text):
        self.value = v

    fn get_value() -> text:
        self.value

# Mock ShaderProgram
class ShaderProgram:
    vertex_shader: Shader
    fragment_shader: Shader
    uniforms: List<ShaderUniform>
    linked: bool

impl ShaderProgram:
    static fn new(vs: Shader, fs: Shader) -> ShaderProgram:
        ShaderProgram(vertex_shader: vs, fragment_shader: fs, uniforms: [], linked: false)

    me link():
        self.vertex_shader.compile()
        self.fragment_shader.compile()
        self.linked = true

    me add_uniform(uniform: ShaderUniform):
        self.uniforms.push(uniform)

    fn is_linked() -> bool:
        self.linked

    fn get_uniform_count() -> i64:
        self.uniforms.len()

describe "ShaderSystem":
    it "creates shaders":
        val vertex = Shader.new("vertex", "vertex_code")
        val fragment = Shader.new("fragment", "fragment_code")
        assert vertex.name == "vertex"
        assert fragment.name == "fragment"

    it "compiles shaders":
        val shader = Shader.new("test", "shader_code")
        shader.compile()
        assert shader.is_compiled() == true

    it "sets shader uniforms":
        val uniform = ShaderUniform.new("color", "vec4")
        uniform.set_value("1.0, 1.0, 1.0, 1.0")
        assert uniform.get_value() == "1.0, 1.0, 1.0, 1.0"

    it "handles shader programs":
        val vs = Shader.new("vertex", "vs_code")
        val fs = Shader.new("fragment", "fs_code")
        val program = ShaderProgram.new(vs, fs)
        program.link()
        assert program.is_linked() == true

    it "handles shader includes":
        val vs = Shader.new("vertex", "vs_code")
        val fs = Shader.new("fragment", "fs_code")
        val program = ShaderProgram.new(vs, fs)
        val uniform = ShaderUniform.new("projection", "mat4")
        program.add_uniform(uniform)
        assert program.get_uniform_count() == 1
