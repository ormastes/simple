"""
String Helper Utilities Tests
Feature: String Manipulation Utilities
Category: Utilities, String Processing
Status: Complete

Unit tests for common string helper functions used across
Simple app implementations. Tests trimming, splitting, case
conversion, and pattern matching.
"""

# String helper functions

fn trim_whitespace(s: str) -> str:
    s.trim()

fn split_lines(s: str) -> [str]:
    s.split("\n")

fn contains_keyword(s: str, keyword: str) -> bool:
    s.contains(keyword)

fn count_occurrences(s: str, pattern: str) -> i64:
    # Simplified implementation - just checks if pattern exists
    if s.contains(pattern):
        return 1
    else:
        return 0

describe "Whitespace Handling":
    """
    Tests for trimming and normalizing whitespace.
    """

    it "trims leading whitespace":
        val input = "   text"
        val result = trim_whitespace(input)
        expect result == "text"

    it "trims trailing whitespace":
        val input = "text   "
        val result = trim_whitespace(input)
        expect result == "text"

    it "trims both sides":
        val input = "  text  "
        val result = trim_whitespace(input)
        expect result == "text"

    it "preserves internal whitespace":
        val input = "hello world"
        val result = trim_whitespace(input)
        expect result == "hello world"

describe "String Splitting":
    """
    Tests for splitting strings into components.
    """

    it "splits by newline":
        val input = "line1\nline2\nline3"
        val lines = split_lines(input)
        expect lines.len() == 3
        expect lines[0] == "line1"

    it "handles single line":
        val input = "single line"
        val lines = split_lines(input)
        expect lines.len() == 1

    it "handles empty string":
        val input = ""
        val lines = split_lines(input)
        expect lines.len() >= 0

    it "splits path components":
        val path = "src/app/lsp/main.spl"
        val parts = path.split("/")
        expect parts.len() == 4
        expect parts[0] == "src"
        expect parts[-1] == "main.spl"

describe "Pattern Matching":
    """
    Tests for finding patterns in strings.
    """

    it "finds keyword in string":
        val text = "fn main():"
        expect contains_keyword(text, "fn")
        expect contains_keyword(text, "main")

    it "detects missing keyword":
        val text = "val x = 42"
        expect not contains_keyword(text, "fn")

    it "finds file extensions":
        val filename = "test.spl"
        expect filename.ends_with(".spl")

    it "checks file path patterns":
        val path = "test/lib/std/unit/app/test.spl"
        expect path.contains("test")
        expect path.contains("app")
        expect path.ends_with(".spl")

describe "String Comparison":
    """
    Tests for comparing strings.
    """

    it "compares equal strings":
        val s1 = "hello"
        val s2 = "hello"
        expect s1 == s2

    it "compares different strings":
        val s1 = "hello"
        val s2 = "world"
        expect s1 != s2

    it "handles case sensitivity":
        val lower = "hello"
        val upper = "HELLO"
        expect lower != upper

    it "compares prefixes":
        val text = "function_name"
        expect text.starts_with("func")
        expect not text.starts_with("var")

describe "String Construction":
    """
    Tests for building strings.
    """

    it "concatenates strings":
        val part1 = "hello"
        val part2 = "world"
        val result = part1 + " " + part2
        expect result == "hello world"

    it "builds paths":
        val dir = "test"
        val file = "spec.spl"
        val path = dir + "/" + file
        expect path == "test/spec.spl"

    it "formats with variables":
        val name = "Alice"
        val greeting = "Hello, " + name + "!"
        expect greeting.contains(name)

describe "String Searching":
    """
    Tests for searching within strings.
    """

    it "finds substring position":
        val text = "hello world"
        val index = text.find("world")
        expect index >= 0

    it "handles missing substring":
        val text = "hello world"
        val index = text.find("xyz")
        expect index < 0

    it "finds first occurrence":
        val text = "test test test"
        val index = text.find("test")
        expect index == 0

describe "String Length and Indexing":
    """
    Tests for string length and character access.
    """

    it "measures string length":
        val text = "hello"
        expect text.len() == 5

    it "handles empty string length":
        val empty = ""
        expect empty.len() == 0

    it "accesses characters by index":
        val text = "hello"
        expect text[0] == 'h'
        expect text[4] == 'o'

    it "uses negative indexing":
        val text = "hello"
        expect text[-1] == 'o'
        expect text[-5] == 'h'

describe "String Slicing":
    """
    Tests for extracting substrings.
    """

    it "checks substring existence":
        val text = "hello world"
        expect text.contains("hello")
        expect text.contains("world")

    it "finds substring by search":
        val text = "hello world"
        val index = text.find("world")
        expect index > 0

    it "validates text content":
        val text = "hello world"
        expect text.len() == 11
        expect text.starts_with("hello")
        expect text.ends_with("world")
