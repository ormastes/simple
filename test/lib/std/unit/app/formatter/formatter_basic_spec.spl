"""
Formatter Basic Tests
Feature: Code Formatter
Category: Formatting, Development Tools
Status: Complete

Unit tests for Simple language formatter basic functionality.
Tests indentation, spacing, and basic formatting rules.
"""

# Helper functions for formatter testing

fn count_leading_spaces(line: str) -> i64:
    var count = 0
    for i in 0..line.len():
        if line[i] == ' ':
            count = count + 1
        else:
            break
    return count

fn is_properly_indented(line: str, expected_indent: i64) -> bool:
    val actual = count_leading_spaces(line)
    actual == expected_indent

describe "Indentation Rules":
    """
    Tests for proper indentation formatting.
    """

    it "uses 4-space indentation":
        val indent_size = 4
        expect indent_size == 4

    it "calculates leading spaces correctly":
        val line1 = "fn test():"
        val line2 = "    return 42"
        val line3 = "        nested"

        expect count_leading_spaces(line1) == 0
        expect count_leading_spaces(line2) == 4
        expect count_leading_spaces(line3) == 8

    it "validates indentation levels":
        val code_line = "    if x > 0:"
        expect is_properly_indented(code_line, 4)

describe "Spacing Rules":
    """
    Tests for spacing around operators and keywords.
    """

    it "adds spaces around binary operators":
        val with_spaces = "x + y"
        val without_spaces = "x+y"

        expect with_spaces.contains(" + ")
        expect not without_spaces.contains(" + ")

    it "formats function definitions":
        val formatted = "fn add(a: i64, b: i64) -> i64:"
        expect formatted.starts_with("fn ")
        expect formatted.ends_with(":")

    it "formats method calls":
        val call = "object.method(arg1, arg2)"
        expect call.contains(".")
        expect call.contains("(")
        expect call.contains(")")

describe "Line Formatting":
    """
    Tests for line-level formatting rules.
    """

    it "removes trailing whitespace":
        val line_with_trailing = "code    "
        val line_clean = "code"

        expect line_with_trailing.trim() == line_clean

    it "preserves empty lines":
        val empty_line = ""
        expect empty_line.len() == 0

    it "handles multiline strings":
        val multiline = "line1\nline2\nline3"
        expect multiline.contains("\n")

describe "Statement Formatting":
    """
    Tests for formatting different statement types.
    """

    it "formats variable declarations":
        val decl1 = "val x = 42"
        val decl2 = "var y = 100"

        expect decl1.starts_with("val ")
        expect decl2.starts_with("var ")

    it "formats if statements":
        val if_stmt = "if condition:"
        expect if_stmt.starts_with("if ")
        expect if_stmt.ends_with(":")

    it "formats match expressions":
        val match_expr = "match value:"
        expect match_expr.starts_with("match ")
        expect match_expr.ends_with(":")

describe "Expression Formatting":
    """
    Tests for formatting expressions.
    """

    it "formats function calls":
        val call = "function(arg1, arg2)"
        expect call.contains("(")
        expect call.contains(",")
        expect call.contains(")")

    it "formats array literals":
        val array = "[1, 2, 3]"
        expect array.starts_with("[")
        expect array.ends_with("]")

    it "formats struct initialization":
        val struct_init = "Point { x: 10, y: 20 }"
        expect struct_init.contains("{")
        expect struct_init.contains("}")
        expect struct_init.contains(":")
