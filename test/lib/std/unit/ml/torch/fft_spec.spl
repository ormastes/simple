# FFT Operations Test Suite
# Tests for ml.torch.fft module

import std.spec
import ml.torch as torch
import ml.torch.fft as fft
import ml.torch.device.Device
import ml.torch.dtype.DType

describe "FFT Operations":
    context "1D FFT":
        it "computes 1D FFT":
            val device = Device::CUDA(1)
            val signal = torch.randn([128], device=device)
            val spectrum = fft.fft(signal, n=-1, dim=0, norm=0)
            expect spectrum.shape() == [128]
            expect spectrum.device().cuda_id() == Some(1)

    context "2D FFT":
        it "computes 2D FFT":
            val device = Device::CUDA(1)
            val signal = torch.randn([16, 16], device=device)
            val spectrum = fft.fft(signal, n=-1, dim=0, norm=0)
            expect spectrum.shape() == [16, 16]
            expect spectrum.device().cuda_id() == Some(1)

    context "inverse FFT":
        it "computes inverse FFT":
            val device = Device::CUDA(1)
            val signal = torch.randn([64], device=device)
            val spectrum = fft.fft(signal, n=-1, dim=0, norm=0)
            val reconstructed = fft.ifft(spectrum, n=-1, dim=0, norm=0)
            expect reconstructed.shape() == [64]
            expect reconstructed.device().cuda_id() == Some(1)

    context "real FFT":
        it "computes real FFT":
            val device = Device::CUDA(1)
            val signal = torch.randn([128], device=device)
            val spectrum = fft.rfft(signal, n=-1, dim=0, norm=0)
            expect spectrum.device().cuda_id() == Some(1)
