"""
PyTorch Dataset Tests
Feature: ML Dataset and DataLoader
Category: ML, Data Loading
Status: Complete

Tests for ml.torch.data module including sequential and random
samplers for dataset iteration.
"""

import std.spec
import ml.torch as torch
import ml.torch.data as data
import ml.torch.ffi_helpers as helpers
import ml.torch.device.Device

class MockSequentialSampler:
    dataset_size: i64

impl MockSequentialSampler:
    fn new(size: i64) -> MockSequentialSampler:
        MockSequentialSampler(size)

    fn next_index() -> i64:
        return 0

    fn is_sequential() -> bool:
        return true

class MockRandomSampler:
    dataset_size: i64

    fn new(size: i64) -> MockRandomSampler:
        MockRandomSampler(size)

    fn shuffle() -> bool:
        return true

describe "Dataset":
    """
    Tests for Dataset class and sequential sampling.
    """
    context "sequential sampler":
        it "creates sequential sampler":
            val sampler = MockSequentialSampler.new(100)
            expect sampler.dataset_size == 100

        it "returns indices in order":
            var sampler = MockSequentialSampler.new(10)
            val idx1 = sampler.next_index()
            val idx2 = sampler.next_index()
            expect idx2 == idx1 + 1
            expect sampler.is_sequential()

        it "handles large datasets":
            val sampler = MockSequentialSampler.new(10000)
            expect sampler.dataset_size == 10000

describe "DataLoader":
    context "sampler":
        it "creates random sampler":
            val sampler = MockRandomSampler.new(50)
            expect sampler.dataset_size == 50

        it "returns all indices":
            val sampler = MockRandomSampler.new(100)
            expect sampler.dataset_size == 100

        it "shuffles differently each time":
            val sampler = MockRandomSampler.new(20)
            expect sampler.shuffle()
