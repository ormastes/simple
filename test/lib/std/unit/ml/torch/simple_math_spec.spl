# Simple Math Operations Test Suite
# Tests for ml.torch math operations

import std.spec
import ml.torch as torch
import ml.torch.simple_math as math
import ml.torch.device.Device
import ml.torch.dtype.DType

describe "Math Operations":
    context "clamp":
        it "clamps values to range":
            val device = Device::CUDA(1)
            val x = torch.Tensor.randn([100], device=device)
            val clamped = math.clamp(x, -1.0, 1.0)
            expect clamped.shape() == [100]
            expect clamped.device().cuda_id() == Some(1)

    context "select":
        it "selects values conditionally":
            val device = Device::CUDA(1)
            val cond = torch.Tensor.randn([10], device=device)
            val x = torch.Tensor.ones([10], device=device)
            val y = torch.Tensor.zeros([10], device=device)
            val selected = math.select_where(cond, x, y)
            expect selected.shape() == [10]
            expect selected.device().cuda_id() == Some(1)

    context "element-wise operations":
        it "applies element-wise min/max":
            val device = Device::CUDA(1)
            val x = torch.Tensor.randn([20], device=device)
            val y = torch.Tensor.randn([20], device=device)
            val selected = math.select_where(x, x, y)
            expect selected.shape() == [20]
            expect selected.device().cuda_id() == Some(1)
