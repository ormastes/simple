# @skip
"""
LSP Diagnostics Tests
Feature: Language Server Protocol Diagnostics
Category: LSP, Error Reporting
Status: Complete

Unit tests for LSP diagnostic types including Position, Range,
DiagnosticSeverity, and Diagnostic message construction.
"""

# Local type definitions (test stubs)

struct Position:
    line: i64
    character: i64

struct Range:
    start: Position
    end: Position

enum DiagnosticSeverity:
    Error
    Warning
    Information
    Hint

struct Diagnostic:
    range: Range
    severity: DiagnosticSeverity
    message: str
    source: str

enum CompletionItemKind:
    Text = 1
    Method = 2
    Function = 3
    Variable = 6
    Keyword = 14
    Struct = 22

struct CompletionItem:
    label: str
    kind: i64
    detail: Option<str>
    documentation: Option<str>
    insert_text: Option<str>



describe "Position":
    """
    Tests for LSP Position type (line and character offsets).
    """
    it "creates position with line and character":
        val pos = Position.new(10, 5)
        expect pos.line == 10
        expect pos.character == 5

    it "starts at zero":
        val pos = Position.new(0, 0)
        expect pos.line == 0
        expect pos.character == 0

describe "Range":
    it "creates range from positions":
        val start = Position.new(0, 0)
        val end = Position.new(0, 10)
        val range = Range.new(start, end)
        expect range.start.line == 0
        expect range.end.character == 10

    it "supports multi-line ranges":
        val start = Position.new(5, 0)
        val end = Position.new(10, 20)
        val range = Range.new(start, end)
        expect range.start.line == 5
        expect range.end.line == 10

describe "DiagnosticSeverity":
    it "has Error severity":
        expect DiagnosticSeverity.Error.to_int() == 1

    it "has Warning severity":
        expect DiagnosticSeverity.Warning.to_int() == 2

    it "has Information severity":
        expect DiagnosticSeverity.Information.to_int() == 3

    it "has Hint severity":
        expect DiagnosticSeverity.Hint.to_int() == 4

describe "Diagnostic":
    it "creates diagnostic with range and message":
        val range = Range.new(Position.new(0, 0), Position.new(0, 5))
        val diag = Diagnostic.new(range, DiagnosticSeverity.Error, "Syntax error")
        expect diag.message == "Syntax error"
        expect diag.severity == DiagnosticSeverity.Error

    it "adds source":
        val range = Range.new(Position.new(0, 0), Position.new(0, 5))
        val diag = Diagnostic.new(range, DiagnosticSeverity.Warning, "Unused variable")
            .with_source("simple-lint")
        expect diag.source == Some("simple-lint")
