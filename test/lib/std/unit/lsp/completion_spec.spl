"""
LSP Completion Handler Tests
Feature: Language Server Protocol Completion
Category: LSP, Editor Integration
Status: Complete

Unit tests for LSP completion handler including CompletionItemKind
enum values and CompletionItem builder pattern.
"""

use app.lsp.handlers.completion.{CompletionItemKind, CompletionItem}

describe "CompletionItemKind":
    """
    Tests for LSP completion item kind enum values.
    """
    it "has Text kind":
        expect CompletionItemKind.Text == 1

    it "has Method kind":
        expect CompletionItemKind.Method == 2

    it "has Function kind":
        expect CompletionItemKind.Function == 3

    it "has Variable kind":
        expect CompletionItemKind.Variable == 6

    it "has Keyword kind":
        expect CompletionItemKind.Keyword == 14

    it "has Struct kind":
        expect CompletionItemKind.Struct == 22

describe "CompletionItem":
    it "creates item with label and kind":
        val item = CompletionItem.new("test", CompletionItemKind.Variable)
        expect item.label == "test"
        expect item.kind == 6

    it "adds detail":
        val item = CompletionItem.new("fn", CompletionItemKind.Keyword)
            .with_detail("Function keyword")
        expect item.detail == Some("Function keyword")

    it "adds documentation":
        val item = CompletionItem.new("fn", CompletionItemKind.Keyword)
            .with_documentation("Define a function")
        expect item.documentation == Some("Define a function")

    it "adds insert text":
        val item = CompletionItem.new("fn", CompletionItemKind.Snippet)
            .with_insert_text("fn ${1:name}():\n    ${0}")
        expect item.insert_text.is_some()

    it "chains builder methods":
        val item = CompletionItem.new("struct", CompletionItemKind.Keyword)
            .with_detail("Define a struct")
            .with_documentation("Struct definitions create custom types")
        expect item.detail.is_some()
        expect item.documentation.is_some()
