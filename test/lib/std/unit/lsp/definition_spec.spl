"""
LSP Definition Handler Tests
Feature: Language Server Protocol Go-to-Definition
Category: LSP, Editor Integration
Status: Complete

Unit tests for LSP definition handler that resolves symbol locations
for functions, variables, classes, and imported definitions.
"""

use std.spec.*

# Mock LSP types for definition handling
class DefinitionLocation:
    uri: text
    range_start: i64
    range_end: i64

impl DefinitionLocation:
    static fn new(uri: text, start: i64, end: i64) -> DefinitionLocation:
        DefinitionLocation(uri: uri, range_start: start, range_end: end)

class MockDefinitionHandler:
    definitions: Dict<text, DefinitionLocation>

impl MockDefinitionHandler:
    static fn new() -> MockDefinitionHandler:
        MockDefinitionHandler(definitions: {})

    me find_definition(symbol: text) -> Option<DefinitionLocation>:
        self.definitions.get(symbol)

    me register_definition(symbol: text, location: DefinitionLocation):
        self.definitions[symbol] = location

describe "Definition Handler":
    """
    Tests for LSP definition handler resolving symbol locations.
    """
    it "finds function definitions":
        val handler = MockDefinitionHandler.new()
        val location = DefinitionLocation.new("file.spl", 10, 20)
        handler.register_definition("my_function", location)
        val result = handler.find_definition("my_function")
        assert result.is_some()

    it "finds variable definitions":
        val handler = MockDefinitionHandler.new()
        val location = DefinitionLocation.new("file.spl", 5, 15)
        handler.register_definition("my_var", location)
        val result = handler.find_definition("my_var")
        assert result.is_some()

    it "finds class definitions":
        val handler = MockDefinitionHandler.new()
        val location = DefinitionLocation.new("file.spl", 25, 35)
        handler.register_definition("MyClass", location)
        val result = handler.find_definition("MyClass")
        assert result.is_some()

    it "handles undefined symbols":
        val handler = MockDefinitionHandler.new()
        val result = handler.find_definition("undefined_symbol")
        assert result.is_none()

    it "finds imported definitions":
        val handler = MockDefinitionHandler.new()
        val location = DefinitionLocation.new("imported.spl", 100, 110)
        handler.register_definition("imported_fn", location)
        val result = handler.find_definition("imported_fn")
        assert result.is_some()
