# @pending
# @skip
# Basic Lean Code Generation Tests
#
# Minimal tests for verification.lean modules that don't have parsing issues.

use verification.lean.emitter as emitter
use verification.lean.naming as naming

describe "Lean Code Generation Basics":
    """
    ## Basic Module Tests

    Tests for the core lean codegen modules.
    """

    context "LeanEmitter":
        """
        ### Low-Level Emission
        """

        it "creates empty emitter":
            var emit = emitter.LeanEmitter.new()
            val output = emit.finish()
            expect(output).to_equal(""))

        it "emits line":
            var emit = emitter.LeanEmitter.new()
            emit.emit_line("def test := 1")
            val output = emit.finish()
            expect(output).to_contain("def test"))

        it "handles indentation":
            var emit = emitter.LeanEmitter.new()
            emit.emit_line("structure Foo where")
            emit.indent()
            emit.emit_line("x : Int")
            emit.dedent()
            val output = emit.finish()
            expect(output).to_contain("structure Foo"))
            expect(output).to_contain("x : Int"))

    context "Naming Conventions":
        """
        ### Identifier Translation
        """

        it "converts to PascalCase":
            expect(naming.to_pascal_case("my_type")).to_equal("MyType"))
            expect(naming.to_pascal_case("simple")).to_equal("Simple"))

        it "converts to camelCase":
            expect(naming.to_camel_case("my_function")).to_equal("myFunction"))
            expect(naming.to_camel_case("get_value")).to_equal("getValue"))

        it "detects reserved words":
            expect(naming.is_reserved("let")).to_be_true()
            expect(naming.is_reserved("def")).to_be_true()
            expect(naming.is_reserved("myVar")).to_be_false()

        it "converts namespace":
            expect(naming.to_lean_namespace("std.collections")).to_equal("Std.Collections"))
