# Lean Naming Convention Tests
#
# Tests for Simple -> Lean identifier conversion functions.

import std.spec
import verification.lean.naming as naming

describe "Lean Naming Conventions":
    """
    ## Identifier Transformation

    Tests that Simple identifiers are correctly transformed to
    Lean naming conventions (PascalCase for types, camelCase for functions).
    """

    context "to_pascal_case":
        """
        ### PascalCase Conversion

        Converts snake_case to PascalCase for type and class names.
        """

        it "converts simple word":
            expect(naming.to_pascal_case("simple")).to(eq("Simple"))

        it "converts snake_case":
            expect(naming.to_pascal_case("my_type")).to(eq("MyType"))

        it "converts multi-word snake_case":
            expect(naming.to_pascal_case("ref_capability")).to(eq("RefCapability"))

        it "handles multiple underscores":
            expect(naming.to_pascal_case("a_b_c")).to(eq("ABC"))

        it "handles empty string":
            expect(naming.to_pascal_case("")).to(eq(""))

    context "to_camel_case":
        """
        ### camelCase Conversion

        Converts snake_case to camelCase for function and variable names.
        """

        it "converts simple word":
            expect(naming.to_camel_case("simple")).to(eq("simple"))

        it "converts snake_case":
            expect(naming.to_camel_case("my_function")).to(eq("myFunction"))

        it "converts multi-word snake_case":
            expect(naming.to_camel_case("get_value")).to(eq("getValue"))

        it "lowercases first character of uppercase input":
            expect(naming.to_camel_case("UPPER")).to(eq("uPPER"))

        it "handles empty string":
            expect(naming.to_camel_case("")).to(eq(""))

    context "sanitize_lean_ident":
        """
        ### Reserved Word Escaping

        Escapes Lean reserved keywords with guillemets.
        """

        it "escapes 'let' keyword":
            expect(naming.sanitize_lean_ident("let")).to(eq("«let»"))

        it "escapes 'def' keyword":
            expect(naming.sanitize_lean_ident("def")).to(eq("«def»"))

        it "escapes 'Type' keyword":
            expect(naming.sanitize_lean_ident("Type")).to(eq("«Type»"))

        it "does not escape non-reserved words":
            expect(naming.sanitize_lean_ident("myVar")).to(eq("myVar"))

    context "is_reserved":
        """
        ### Reserved Word Detection

        Detects Lean reserved keywords.
        """

        it "detects 'let' as reserved":
            expect(naming.is_reserved("let")).to(be_true())

        it "detects 'forall' as reserved":
            expect(naming.is_reserved("forall")).to(be_true())

        it "returns false for non-reserved word":
            expect(naming.is_reserved("myFunction")).to(be_false())

    context "to_lean_type_name":
        """
        ### Combined Type Name Conversion

        PascalCase + sanitization for type names.
        """

        it "converts simple type name":
            expect(naming.to_lean_type_name("my_type")).to(eq("MyType"))

        it "escapes reserved word after conversion":
            expect(naming.to_lean_type_name("type")).to(eq("«Type»"))

    context "to_lean_func_name":
        """
        ### Combined Function Name Conversion

        camelCase + sanitization for function names.
        """

        it "converts simple function name":
            expect(naming.to_lean_func_name("my_function")).to(eq("myFunction"))

        it "escapes reserved word after conversion":
            expect(naming.to_lean_func_name("let")).to(eq("«let»"))

    context "to_lean_namespace":
        """
        ### Namespace Path Conversion

        Converts module paths to Lean namespace format.
        """

        it "converts simple module path":
            expect(naming.to_lean_namespace("std.collections")).to(eq("Std.Collections"))

        it "handles single component":
            expect(naming.to_lean_namespace("main")).to(eq("Main"))

    context "to_lean_ident":
        """
        ### General Identifier Conversion

        Handles special characters and ensures valid Lean identifiers.
        """

        it "converts simple name":
            expect(naming.to_lean_ident("myVar")).to(eq("myVar"))

        it "replaces dashes with underscores":
            expect(naming.to_lean_ident("my-var")).to(eq("my_var"))

        it "replaces spaces with underscores":
            expect(naming.to_lean_ident("my var")).to(eq("my_var"))

        it "prefixes digit-starting names":
            expect(naming.to_lean_ident("123abc")).to(eq("_123abc"))

        it "handles empty becoming unnamed":
            expect(naming.to_lean_ident("")).to(eq("unnamed"))
