"""
# Lambda Syntax fn() Specification

**Category:** Syntax
**Status:** Implemented

Tests for fn() lambda syntax and its interchangeability with the \\ operator.
The fn() syntax provides an alternative way to define lambdas and is compatible
with BDD framework blocks like describe/context/it.
"""

import std.spec

describe "fn() Lambda Syntax":
    """
    Verifies the fn() lambda syntax for defining anonymous functions.
    This syntax is an alias for the backslash operator (\:) and supports
    parameters, multiple expressions, and nested contexts.
    """

    describe "basic inline lambdas":
        """
        Tests basic fn() lambda syntax with simple expressions.
        """

        it "supports fn() with no parameters":
            fn call_it(f: Any) -> i64:
                return f()

            val result = call_it(fn(): 42)
            expect(result).to(eq(42))

        it "supports fn(x) with single parameter":
            fn apply(x: i64, f: Any) -> i64:
                return f(x)

            val result = apply(5, fn(n): n * 2)
            expect(result).to(eq(10))

        it "supports fn(x, y) with multiple parameters":
            fn apply2(x: i64, y: i64, f: Any) -> i64:
                return f(x, y)

            val result = apply2(3, 4, fn(a, b): a + b)
            expect(result).to(eq(7))

    describe "block lambdas":
        """
        Tests fn() syntax with indented blocks containing multiple expressions.
        """

        it "supports fn() with indented block":
            fn execute(f: Any) -> i64:
                return f()

            val result = execute(fn():
                val x = 10
                val y = 20
                x + y
            )
            expect(result).to(eq(30))

        it "supports fn(x) with parameter and block":
            fn transform(x: i64, f: Any) -> i64:
                return f(x)

            val result = transform(5, fn(n):
                val doubled = n * 2
                val squared = doubled * doubled
                squared
            )
            expect(result).to(eq(100))

    describe "nested lambdas":
        """
        Tests fn() syntax with nested lambda definitions.
        """

        it "supports nested fn() lambdas":
            fn outer(f: Any) -> Any:
                return f

            fn inner(g: Any) -> i64:
                return g()

            val result = inner(outer(fn(): 99))
            expect(result).to(eq(99))

    describe "compatibility with backslash operator":
        """
        Verifies that fn() and \\ syntax are interchangeable and can be mixed.
        """

        it "fn() and \\ are interchangeable":
            fn test(f1: Any, f2: Any) -> i64:
                return f1() + f2()

            # Mix both syntaxes
            val result = test(fn(): 10, \: 20)
            expect(result).to(eq(30))

    describe "used in BDD framework":
        """
        Tests fn() lambda syntax within BDD framework context blocks.
        """

        it "works with context/it blocks":
            var executed = false

            fn mock_context(name: text, block: Any) -> void:
                block()

            mock_context("test", fn():
                executed = true
            )

            expect(executed).to(be_true())
