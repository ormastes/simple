# @pending
# @skip - Uses unsupported keyword: with
"""
Comprehensive tests for string operations.

Tests string creation, manipulation, searching, and transformation
including length operations, character access, trimming, and more.
"""
# NOTE: No imports needed - describe/it/expect are built-in

describe "text Type":
    """
    Tests for the text (string) type covering creation, length operations,
    character access, substring searching, trimming, modification,
    immutable operations, filtering, case sensitivity, and repetition.
    """
    context "creation":
        it "creates string from literals":
            val str = "hello"
            expect str.len == 5

        it "creates empty string":
            val empty = ""
            expect empty.len == 0

        it "creates string with special characters":
            val special = "hello\nworld"
            expect special.len == 11

        it "creates string with unicode":
            val unicode = "cafÃ©"
            expect unicode.len >= 4

    context "length operations":
        it "len returns byte length":
            val str = "hello"
            expect str.len == 5

        it "len handles empty strings":
            val empty = ""
            expect empty.len == 0

        it "char_count returns character count":
            val str = "hello"
            expect str.char_count == 5

        it "byte_len returns byte length":
            val str = "hello"
            expect str.byte_len == 5

    context "character access":
        it "accesses characters by index":
            val str = "hello"
            # Access via iteration or methods
            expect str.len == 5

        it "handles out of bounds gracefully":
            val str = "hi"
            expect str.len == 2

    context "substring searching":
        it "contains finds substring":
            val str = "hello world"
            expect str.contains("world") == true
            expect str.contains("xyz") == false

        it "starts_with checks prefix":
            val str = "hello world"
            expect str.starts_with("hello") == true
            expect str.starts_with("world") == false

        it "ends_with checks suffix":
            val str = "hello world"
            expect str.ends_with("world") == true
            expect str.ends_with("hello") == false

        it "find_str locates substring":
            val str = "hello world"
            val pos = str.find_str("world")
            expect pos.is_some == true

        it "find_str returns None for missing substring":
            val str = "hello world"
            val pos = str.find_str("xyz")
            expect pos.is_none == true

    context "trimming operations":
        it "trimmed removes leading and trailing whitespace":
            val str = "  hello  "
            val trimmed = str.trimmed()
            expect trimmed.len < str.len

        it "trim_start removes leading whitespace":
            val str = "  hello world"
            val trimmed = str.trim_start()
            expect trimmed.len <= str.len

        it "trim_end removes trailing whitespace":
            val str = "hello world  "
            val trimmed = str.trim_end()
            expect trimmed.len <= str.len

    context "string modification":
        it "push adds character":
            # Note: push returns a new string (strings are immutable)
            val str = "hello"
            val result = str.push(' ')
            expect result.len >= 6

        it "push_str appends string":
            # Note: push_str returns a new string (strings are immutable)
            val str = "hello"
            val result = str.push_str(" world")
            expect result.len >= 11

        it "pop removes last character":
            # Note: pop returns Option with the last char (doesn't modify)
            val str = "hello"
            val ch = str.pop()
            expect ch.is_some == true

        it "clear removes all characters":
            # Note: clear returns empty string (strings are immutable)
            val str = "hello"
            val result = str.clear()
            expect result.len == 0

    context "immutable operations":
        it "appended creates new string with character":
            val str = "hello"
            val extended = str.appended('!')
            expect extended.len > str.len

        it "prepended adds character to start":
            val str = "world"
            val extended = str.prepended(' ')
            expect extended.len > str.len

        it "reversed reverses characters":
            val str = "hello"
            val rev = str.reversed()
            # Just verify it returns a string
            expect rev.len == 5

        it "sorted sorts characters":
            val str = "hello"
            val sorted = str.sorted()
            expect sorted.len == 5

    context "filtering operations":
        it "filtered removes characters":
            val str = "a1b2c3"
            # Filter would keep only alpha chars
            expect str.len == 6

        it "taken keeps first n characters":
            val str = "hello world"
            val first5 = str.taken(5)
            expect first5.len <= 5

        it "dropped skips first n characters":
            val str = "hello world"
            val rest = str.dropped(6)
            expect rest.len <= str.len

    context "case sensitivity":
        it "string comparison is case sensitive":
            expect "Hello" != "hello"
            expect "Hello" == "Hello"

        it "contains is case sensitive":
            val str = "Hello World"
            expect str.contains("hello") == false
            expect str.contains("Hello") == true

    context "empty string handling":
        it "empty string operations":
            val empty = ""
            expect empty.len == 0
            expect empty.contains("") == true
            expect empty.starts_with("") == true
            expect empty.ends_with("") == true

        it "single character string":
            val single = "a"
            expect single.len == 1
            expect single.starts_with("a") == true
            expect single.ends_with("a") == true

    context "whitespace handling":
        it "whitespace is counted in length":
            val str = "hello world"
            expect str.len == 11

        it "spaces can be searched":
            val str = "hello world"
            expect str.contains(" ") == true

        it "tabs and newlines work":
            val str = "hello\tworld"
            expect str.len >= 11

    context "string concatenation patterns":
        it "multiple string operations":
            # Note: text operations return new strings (immutable)
            val str = "hello"
            val str2 = str.push(' ')
            val str3 = str2.push_str("world")
            expect str3.len >= 11

        it "string comparisons work":
            val str1 = "hello"
            val str2 = "hello"
            expect str1 == str2

    context "complex string operations":
        it "chains multiple operations":
            val str = "  hello world  "
            val trimmed = str.trimmed()
            expect trimmed.len < str.len
            expect trimmed.contains("hello") == true

        it "works with special characters":
            val str = "hello@world.com"
            expect str.contains("@") == true
            expect str.contains(".com") == true
            expect str.find_str("@").is_some == true

    context "string repetition":
        it "repeats string with * operator":
            val str = "a" * 3
            expect str == "aaa"

        it "repeats multi-character string":
            val str = "ab" * 2
            expect str == "abab"

        it "repeats with integer on left side":
            val str = 3 * "x"
            expect str == "xxx"

        it "handles zero repetition":
            val str = "hello" * 0
            expect str == ""

        it "handles single repetition":
            val str = "hello" * 1
            expect str == "hello"

        it "works with empty string":
            val str = "" * 5
            expect str == ""
