"""
BDD Tests for Random Module.

Feature #225: Random number generation including seeding,
integer and float generation, sequence operations, and distributions.
"""

use std.spec
use core.*

describe "Random module":
    """
    Tests for the random number generation module covering seeding,
    state management, integer/float generation, sequence operations,
    and statistical distributions.
    """
    context "Seeding":
        it "should set seed":
            seed(42)
            val state1 = getstate()
            seed(42)
            val state2 = getstate()
            expect(state1).to eq(state2)

        it "should allow getting and setting state":
            seed(100)
            val saved_state = getstate()
            randint(1, 100)
            setstate(saved_state)
            val restored_state = getstate()
            expect(restored_state).to eq(saved_state)

    context "Random integers":
        it "should generate integer in range":
            seed(42)
            val result = randint(1, 10)
            expect(result >= 1).to be_true()
            expect(result <= 10).to be_true()

        it "should generate uniform integer in range":
            seed(42)
            val result = randrange(0, 100, 10)
            expect(result >= 0).to be_true()
            expect(result < 100).to be_true()

    context "Random floats":
        it "should generate f32 in 0-1":
            seed(42)
            val result = random()
            expect(result >= 0.0).to be_true()
            expect(result < 1.0).to be_true()

        it "should generate uniform f32 in range":
            seed(42)
            val result = uniform(5.0, 10.0)
            expect(result >= 5.0).to be_true()
            expect(result <= 10.0).to be_true()

    context "Sequences":
        it "should choose random element":
            seed(42)
            val items = [1, 2, 3, 4, 5]
            val result = choice(items)
            expect(result.is_some()).to be_true()

        it "should choose k random elements":
            seed(42)
            val items = [1, 2, 3, 4, 5]
            val results = choices(items, 3)
            expect(results.len()).to eq(3)

        it "should shuffle list":
            seed(42)
            var items = [1, 2, 3, 4, 5]
            shuffle(items)
            expect(items.len()).to eq(5)

        it "should sample without replacement":
            seed(42)
            val items = [1, 2, 3, 4, 5]
            val results = sample(items, 3)
            expect(results.len()).to eq(3)

    context "Distributions":
        it "should generate normal distribution":
            seed(42)
            val result = gauss(0.0, 1.0)
            expect(result > -5.0).to be_true()
            expect(result < 5.0).to be_true()

        it "should generate exponential distribution":
            seed(42)
            val result = expovariate(1.0)
            expect(result >= 0.0).to be_true()
