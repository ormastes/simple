# @skip
"""
Context Manager Specification

Tests for context manager functionality including TimerContext
and time measurement operations. Context managers provide resource
management with automatic cleanup.
"""

use spec.{describe, context, it, expect}
use context_manager.{TimerContext, time_now}

describe "Context Manager":
    """
    Tests for context manager implementations including timing
    and resource management operations.
    """
    context "TimerContext":
        it "should measure elapsed time":
            val timer = TimerContext.new("test operation")
            timer.__enter__()

            # Simulate some work
            var sum = 0
            for i in 0..1000:
                sum = sum + i

            timer.__exit__(nil, nil, nil)

            # Elapsed time should be positive
            val elapsed = timer.elapsed()
            expect(elapsed).to_be_greater_than_or_equal(0.0)

    context "time_now function":
        it "should return current time":
            val t1 = time_now()
            val t2 = time_now()

            # Time should be monotonically increasing
            expect(t2).to_be_greater_than_or_equal(t1)

            # Time should be reasonable (not zero)
            expect(t1).to_be_greater_than(0.0)
