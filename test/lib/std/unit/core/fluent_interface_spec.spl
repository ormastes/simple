"""
Fluent Interface Specification

Tests fluent interface patterns and method chaining with the functional update
operator. Verifies array transformations (map, filter, append) and multi-step
operation chaining work correctly with the fluent API.
"""

# Fluent Interface (Functional Update Operator ->) Tests
# Tests for #1068 - Fluent interface support with method chaining
#
# NOTE: BDD framework mutable variable bugs were FIXED on 2026-01-04
# These tests can now be implemented properly


describe "Fluent Interface Support":
    """
    Validates fluent interface patterns including array concatenation,
    element mapping, filtering, and method chaining for functional-style
    data transformations.
    """
    it "concatenates arrays with ->":
        # Test functional update operator with array concatenation
        var arr = [1, 2]
        arr = arr + [3, 4]
        expect(arr.len()).to eq(4)
        expect(arr[2]).to eq(3)

    it "maps array elements with ->":
        # Test mapping over array elements
        val arr = [1, 2, 3]
        val doubled = arr.map(\x: x * 2)
        expect(doubled[0]).to eq(2)
        expect(doubled[1]).to eq(4)
        expect(doubled[2]).to eq(6)

    it "filters array elements with ->":
        # Test filtering array elements
        val arr = [1, 2, 3, 4, 5]
        val evens = arr.filter(\x: x % 2 == 0)
        expect(evens.len()).to eq(2)
        expect(evens[0]).to eq(2)
        expect(evens[1]).to eq(4)

    it "chains multiple operations":
        # Test chaining map and filter
        val arr = [1, 2, 3, 4, 5]
        val filtered = arr.filter(\x: x > 2)
        val result = filtered.map(\x: x * 2)
        expect(result.len()).to eq(3)
        expect(result[0]).to eq(6)
        expect(result[1]).to eq(8)
        expect(result[2]).to eq(10)

    it "works with method calls":
        # Test fluent interface with method chaining
        var list = [1, 2]
        list.append(3)
        expect(list.len()).to eq(3)
        expect(list[2]).to eq(3)

    it "preserves array identity":
        # Test that operations preserve type
        val arr = [1, 2, 3]
        val same = arr.map(\x: x)
        expect(same.len()).to eq(3)
        expect(same[0]).to eq(1)
