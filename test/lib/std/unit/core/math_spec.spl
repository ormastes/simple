# BDD Tests for Math Module
# Feature #220-229: Math and Numeric features

import std.spec
import core.*

describe "Math module":
    context "Constants":
        it "should provide PI constant":
            val pi = PI()
            expect(pi > 3.14).to be_true()
            expect(pi < 3.15).to be_true()

        it "should provide E constant":
            val e = E()
            expect(e > 2.71).to be_true()
            expect(e < 2.72).to be_true()

        it "should provide TAU constant":
            val tau = TAU()
            expect(tau > 6.28).to be_true()
            expect(tau < 6.29).to be_true()

    context "Basic operations":
        it "should calculate absolute value":
            expect(abs(-5.5)).to eq(5.5)
            expect(abs(5.5)).to eq(5.5)
            expect(abs(0.0)).to eq(0.0)

        it "should calculate absolute value for integers":
            expect(abs_int(-10)).to eq(10)
            expect(abs_int(10)).to eq(10)
            expect(abs_int(0)).to eq(0)

        it "should determine sign":
            expect(sign(5.0)).to eq(1.0)
            expect(sign(-5.0)).to eq(-1.0)
            expect(sign(0.0)).to eq(0.0)

        it "should floor f32":
            expect(floor(3.7)).to eq(3)
            expect(floor(3.2)).to eq(3)
            expect(floor(-2.5)).to eq(-3)

        it "should ceil f32":
            expect(ceil(3.2)).to eq(4)
            expect(ceil(3.7)).to eq(4)
            expect(ceil(-2.5)).to eq(-2)

        it "should round f32":
            expect(round(3.5)).to eq(4)
            expect(round(3.4)).to eq(3)
            expect(round(-2.5)).to eq(-2)

    context "Exponential and roots":
        it "should calculate square root":
            val result = sqrt(9.0)
            expect(result > 2.99).to be_true()
            expect(result < 3.01).to be_true()

        it "should calculate exp":
            val result = exp(1.0)
            expect(result > 2.71).to be_true()
            expect(result < 2.72).to be_true()

    context "Trigonometry":
        it "should calculate sin":
            val result = sin(0.0)
            expect(abs(result) < 0.001).to be_true()

        it "should calculate cos":
            val result = cos(0.0)
            expect(result > 0.99).to be_true()
            expect(result < 1.01).to be_true()

        it "should calculate tan":
            val result = tan(0.0)
            expect(abs(result) < 0.001).to be_true()

        it "should convert degrees to radians":
            val result = radians(180.0)
            expect(result > 3.14).to be_true()
            expect(result < 3.15).to be_true()

        it "should convert radians to degrees":
            val result = degrees(PI())
            expect(result > 179.9).to be_true()
            expect(result < 180.1).to be_true()

    context "Min/Max operations":
        it "should find min of two floats":
            expect(min(3.5, 2.1)).to eq(2.1)
            expect(min(2.1, 3.5)).to eq(2.1)

        it "should find max of two floats":
            expect(max(3.5, 2.1)).to eq(3.5)
            expect(max(2.1, 3.5)).to eq(3.5)

        it "should find min of two integers":
            expect(min_int(5, 3)).to eq(3)
            expect(min_int(3, 5)).to eq(3)

        it "should find max of two integers":
            expect(max_int(5, 3)).to eq(5)
            expect(max_int(3, 5)).to eq(5)

    context "Clamping":
        it "should clamp f32 values":
            expect(clamp(5.0, 0.0, 10.0)).to eq(5.0)
            expect(clamp(-5.0, 0.0, 10.0)).to eq(0.0)
            expect(clamp(15.0, 0.0, 10.0)).to eq(10.0)

        it "should clamp integer values":
            expect(clamp_int(5, 0, 10)).to eq(5)
            expect(clamp_int(-5, 0, 10)).to eq(0)
            expect(clamp_int(15, 0, 10)).to eq(10)

    context "Integer math":
        it "should calculate factorial":
            expect(factorial(0)).to eq(1)
            expect(factorial(1)).to eq(1)
            expect(factorial(5)).to eq(120)

        it "should calculate GCD":
            expect(gcd(12, 8)).to eq(4)
            expect(gcd(17, 13)).to eq(1)
            expect(gcd(100, 50)).to eq(50)

        it "should calculate LCM":
            expect(lcm(4, 6)).to eq(12)
            expect(lcm(3, 5)).to eq(15)

    context "f32 comparisons":
        it "should compare floats with tolerance":
            expect(is_close(1.0, 1.0000001)).to be_true()
            expect(is_close(1.0, 2.0)).to be_false()

        it "should detect NaN":
            val nan = NAN()
            expect(is_nan(nan)).to be_true()
            expect(is_nan(1.0)).to be_false()

        it "should detect infinity":
            val inf = INF()
            expect(is_inf(inf)).to be_true()
            expect(is_inf(1.0)).to be_false()

        it "should detect finite":
            expect(is_finite(1.0)).to be_true()
            expect(is_finite(INF())).to be_false()
            expect(is_finite(NAN())).to be_false()
