"""
# Shared Examples BDD Framework Specification

**Feature IDs:** #TEST-010, #TEST-011
**Category:** Testing Framework
**Status:** Implemented

Shared examples provide a mechanism for defining reusable test patterns that can be
included in multiple test contexts. The `shared_examples` keyword defines a block of
tests, while `it_behaves_like` includes them in a specific context.

## Syntax

```simple
shared_examples "name":
    it "test":
        # test body

describe "context":
    context "specific case":
        it_behaves_like "name"
```

## Key Behaviors

- Shared examples are defined at describe block level
- Can be used in multiple test contexts
- Support fixture setup via given_lazy
- Variables bound in parent context are accessible in shared examples
- `include_examples` is an alias for `it_behaves_like`
"""
import std.spec

# ============================================================================
# Shared Example Definitions
# ============================================================================

shared_examples "basic assertions":
    """
    Tests basic assertion capabilities available to all examples.
    """
    it "can test equality":
        expect 1 + 1 == 2

    it "can test boolean":
        expect true

shared_examples "container tests":
    """
    Tests container-related assertions using fixture values.
    """
    it "container has items":
        val c = get_let(:container)
        expect len(c) >= 0

shared_examples "value tests":
    """
    Tests numeric value assertions using fixture values.
    """
    it "value is defined":
        val v = get_let(:value)
        expect v >= 0

# ============================================================================
# Shared Examples Usage Tests
# ============================================================================

describe "Shared Examples (TEST-010, TEST-011)":
    """
    ## Shared Examples Specification

    Shared examples provide reusable test patterns that can be included in
    multiple test contexts. This test suite verifies:
    - Basic shared_examples definition and usage
    - Including shared examples in test contexts
    - Fixture access within shared examples
    - Multiple shared examples in same context
    - Nested context inheritance
    - Alias methods (include_examples)
    """

    describe "Basic shared_examples usage":
        """
        Verifies shared examples work without fixture dependencies.
        """
        it_behaves_like "basic assertions"

    describe "Shared examples with fixtures":
        """
        Verifies shared examples can access fixtures from parent context.
        """
        context "with a list container":
            given_lazy :container, \: [1, 2, 3]
            it_behaves_like "container tests"

        context "with an empty container":
            given_lazy :container, \: []
            it_behaves_like "container tests"

        context "with a numeric value":
            given_lazy :value, \: 42
            it_behaves_like "value tests"

    describe "Multiple shared examples in same context":
        """
        Verifies multiple shared examples can be included in one context.
        """
        context "with comprehensive setup":
            given_lazy :container, \: [10, 20, 30]
            given_lazy :value, \: 100

            it_behaves_like "container tests"
            it_behaves_like "value tests"

    describe "Nested contexts with shared examples":
        """
        Verifies shared examples work in nested context hierarchies.
        """
        context "outer context":
            given_lazy :container, \: [1]
            it_behaves_like "container tests"

            context "inner context":
                given_lazy :container, \: [1, 2, 3, 4, 5]
                it_behaves_like "container tests"

    describe "include_examples alias":
        """
        Verifies include_examples provides an alternative to it_behaves_like.
        """
        context "using include_examples instead of it_behaves_like":
            given_lazy :container, \: ["a", "b", "c"]
            include_examples "container tests"

# ============================================================================
# Edge Cases and Error Handling
# ============================================================================

describe "Shared Examples Edge Cases":
    """
    ## Shared Examples Edge Cases Specification

    Edge cases and special scenarios for shared examples. This test suite verifies:
    - Standalone shared examples without dependencies
    - Nested shared example definitions
    - Complex fixture scenarios
    - Isolation between example groups
    """

    describe "shared examples with no dependencies":
        """
        Verifies shared examples work without requiring any fixtures.
        """
        shared_examples "standalone tests":
            it "can test constants":
                expect 1 + 1 == 2

            it "can test strings":
                expect len("hello") == 5

        it_behaves_like "standalone tests"

    describe "shared examples in nested context":
        """
        Verifies shared examples can be defined and used in nested contexts.
        """
        context "outer":
            shared_examples "nested example":
                it "works in nested context":
                    expect true

            it_behaves_like "nested example"

    describe "Shared examples with local state":
        """
        Verifies shared examples maintain proper isolation.
        """
        context "first group":
            given_lazy :value, \: 10
            it_behaves_like "value tests"

        context "second group":
            given_lazy :value, \: 20
            it_behaves_like "value tests"
