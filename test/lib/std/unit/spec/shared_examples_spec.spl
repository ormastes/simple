# Test file for TEST-010 (shared_examples) and TEST-011 (it_behaves_like)
# Verifies the shared examples functionality works correctly

import test.unit.*
import std.spec

# ============================================================================
# TEST-010: shared_examples - Define reusable example groups
# ============================================================================

# Define shared examples for testing
shared_examples "basic assertions":
    it "can test equality":
        expect 1 + 1 == 2

    it "can test boolean":
        expect true

shared_examples "container tests":
    it "container has items":
        val c = get_let(:container)
        expect len(c) >= 0

shared_examples "value tests":
    it "value is defined":
        val v = get_let(:value)
        expect v >= 0

# ============================================================================
# TEST-011: it_behaves_like - Include shared examples
# ============================================================================

describe "Shared Examples (TEST-010, TEST-011)":

    describe "Basic shared_examples usage":
        it_behaves_like "basic assertions"

    describe "Shared examples with fixtures":
        context "with a list container":
            given_lazy :container, \: [1, 2, 3]
            it_behaves_like "container tests"

        context "with an empty container":
            given_lazy :container, \: []
            it_behaves_like "container tests"

        context "with a numeric value":
            given_lazy :value, \: 42
            it_behaves_like "value tests"

    describe "Multiple shared examples in same context":
        context "with comprehensive setup":
            given_lazy :container, \: [10, 20, 30]
            given_lazy :value, \: 100

            it_behaves_like "container tests"
            it_behaves_like "value tests"

    describe "Nested contexts with shared examples":
        context "outer context":
            given_lazy :container, \: [1]
            it_behaves_like "container tests"

            context "inner context":
                given_lazy :container, \: [1, 2, 3, 4, 5]
                it_behaves_like "container tests"

    describe "include_examples alias":
        context "using include_examples instead of it_behaves_like":
            given_lazy :container, \: ["a", "b", "c"]
            include_examples "container tests"


# ============================================================================
# Edge Cases and Error Handling
# ============================================================================

describe "Shared Examples Edge Cases":

    describe "shared examples with no dependencies":
        shared_examples "standalone tests":
            it "can test constants":
                expect 1 + 1 == 2

            it "can test strings":
                expect len("hello") == 5

        it_behaves_like "standalone tests"

    describe "shared examples in nested context":
        context "outer":
            shared_examples "nested example":
                it "works in nested context":
                    expect true

            it_behaves_like "nested example"

main = 0
