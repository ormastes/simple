# Physics AABB Collision Tests
# Tests for physics.collision.aabb module

import std.spec
import physics.core.Vector3
import physics.collision.aabb.AABB

describe "AABB":
    context "creation":
        it "creates AABB from min and max":
            val min = Vector3(0.0, 0.0, 0.0)
            val max = Vector3(10.0, 10.0, 10.0)
            val box = AABB(min, max)
            expect box.min.x == 0.0
            expect box.max.x == 10.0

        it "creates AABB from center and size":
            val center = Vector3(5.0, 5.0, 5.0)
            val size = Vector3(10.0, 10.0, 10.0)
            val box = AABB::from_center_size(center, size)
            expect box.min.x == 0.0
            expect box.max.x == 10.0

    context "collision":
        it "detects overlapping AABBs":
            val box1 = AABB(Vector3(0.0, 0.0, 0.0), Vector3(10.0, 10.0, 10.0))
            val box2 = AABB(Vector3(5.0, 5.0, 5.0), Vector3(15.0, 15.0, 15.0))
            expect box1.intersects(box2)

        it "detects non-overlapping AABBs":
            val box1 = AABB(Vector3(0.0, 0.0, 0.0), Vector3(5.0, 5.0, 5.0))
            val box2 = AABB(Vector3(10.0, 10.0, 10.0), Vector3(15.0, 15.0, 15.0))
            expect not box1.intersects(box2)

        it "detects touching AABBs as not intersecting":
            val box1 = AABB(Vector3(0.0, 0.0, 0.0), Vector3(5.0, 5.0, 5.0))
            val box2 = AABB(Vector3(5.0, 0.0, 0.0), Vector3(10.0, 5.0, 5.0))
            # Edge touching - max.x of box1 equals min.x of box2
            # This should NOT intersect (using < comparison)
            expect not box1.intersects(box2)

    context "point containment":
        it "contains point inside":
            val box = AABB(Vector3(0.0, 0.0, 0.0), Vector3(10.0, 10.0, 10.0))
            val point = Vector3(5.0, 5.0, 5.0)
            expect box.contains_point(point)

        it "does not contain point outside":
            val box = AABB(Vector3(0.0, 0.0, 0.0), Vector3(10.0, 10.0, 10.0))
            val point = Vector3(15.0, 5.0, 5.0)
            expect not box.contains_point(point)
