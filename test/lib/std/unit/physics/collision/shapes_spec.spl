"""
Feature: Collision Shape Representations
Category: Physics
Status: Implemented
"""

# Physics Collision Shapes Tests
# Tests for physics.collision.shapes module

import std.spec
import physics.core.Vector3
import physics.collision.shapes.{Capsule, Shape}

describe "Capsule":
    """
    Tests for capsule shape implementation.
    Covers creation with start, end, and radius; center point calculation;
    and total height calculation.
    """
    it "creates capsule with start, end, and radius":
        val capsule = Capsule(
            start: Vector3(0.0, 0.0, 0.0),
            end: Vector3(0.0, 2.0, 0.0),
            radius: 0.5
        )
        expect capsule.radius == 0.5
        expect capsule.start.y == 0.0
        expect capsule.end.y == 2.0

    it "calculates center point":
        val capsule = Capsule(
            start: Vector3(0.0, 0.0, 0.0),
            end: Vector3(0.0, 4.0, 0.0),
            radius: 0.5
        )
        val center = capsule.center()
        expect center.y == 2.0

    it "calculates total height":
        val capsule = Capsule(
            start: Vector3(0.0, 0.0, 0.0),
            end: Vector3(0.0, 2.0, 0.0),
            radius: 0.5
        )
        # Height = axis_length + 2 * radius = 2 + 1 = 3
        expect capsule.height() == 3.0

describe "Shape":
    """
    Tests for shape variant union and common shape properties.
    Covers sphere, box, and capsule variants; radius queries;
    string conversion; and convexity checks.
    """
    context "Sphere variant":
        it "creates sphere shape":
            val shape = Shape::Sphere(radius: 1.0)
            expect shape.is_sphere()
            expect not shape.is_box()
            expect not shape.is_capsule()

        it "gets radius from sphere":
            val shape = Shape::Sphere(radius: 5.0)
            expect shape.get_radius() == Some(5.0)

        it "converts to string":
            val shape = Shape::Sphere(radius: 1.0)
            expect shape.to_string() == "sphere"

    context "Box variant":
        it "creates box shape":
            val extents = Vector3(1.0, 2.0, 3.0)
            val shape = Shape::Box(half_extents: extents)
            expect shape.is_box()
            expect not shape.is_sphere()

        it "returns None for box radius":
            val shape = Shape::Box(half_extents: Vector3(1.0, 1.0, 1.0))
            expect shape.get_radius() == None

    context "Capsule variant":
        it "creates capsule shape":
            val shape = Shape::Capsule(radius: 0.5, height: 2.0)
            expect shape.is_capsule()
            expect not shape.is_sphere()

        it "gets radius from capsule":
            val shape = Shape::Capsule(radius: 0.5, height: 2.0)
            expect shape.get_radius() == Some(0.5)

    context "Common properties":
        it "all shapes are convex":
            expect Shape::Sphere(radius: 1.0).is_convex()
            expect Shape::Box(half_extents: Vector3(1.0, 1.0, 1.0)).is_convex()
            expect Shape::Capsule(radius: 0.5, height: 2.0).is_convex()
