"""
# Dictionary Grammar and Syntax Specification

**Feature IDs:** #1002, #1018
**Category:** Language, Syntax
**Status:** Complete

Tests for dictionary literal syntax, ensuring correct grammar is used.
Verifies that {"key": value} syntax works correctly.
"""

describe "Dictionary Grammar":
    """
    Tests for dictionary literal syntax and grammar.
    Ensures proper key-value syntax is enforced.
    """

    context "basic dict syntax":
        """
        ### Scenario: Dictionary Literal Syntax

        Dictionaries use {"key": value} syntax with quoted keys.
        """

        it "creates dict with string keys":
            val config = {"name": "Alice", "age": 30}
            expect config["name"] == "Alice"
            expect config["age"] == 30

        it "creates dict with integer values":
            val scores = {"math": 95, "science": 87, "history": 92}
            expect scores["math"] == 95

        it "creates dict with mixed value types":
            val data = {"count": 42, "name": "test", "active": true}
            expect data["count"] == 42
            expect data["active"] == true

        it "creates nested dicts":
            val nested = {"outer": {"inner": 123}}
            expect nested["outer"]["inner"] == 123

        it "creates empty dict":
            val empty: Dict<text, i32> = {}
            expect empty.len() == 0

    context "dict with arrays":
        """
        ### Scenario: Dictionaries Containing Arrays

        Tests dicts with array values.
        """

        it "stores arrays as values":
            val data = {"numbers": [1, 2, 3], "letters": ["a", "b", "c"]}
            expect data["numbers"][0] == 1
            expect data["letters"][2] == "c"

        it "stores nested structures":
            val complex = {
                "users": [
                    {"name": "Alice", "id": 1},
                    {"name": "Bob", "id": 2}
                ]
            }
            expect complex["users"][0]["name"] == "Alice"

    context "dict operations":
        """
        ### Scenario: Dictionary Operations

        Tests insertion, update, deletion, and iteration.
        """

        it "inserts new key-value pair":
            var dict = {"a": 1}
            dict["b"] = 2
            expect dict["b"] == 2

        it "updates existing value":
            var dict = {"x": 10}
            dict["x"] = 20
            expect dict["x"] == 20

        it "checks key existence":
            val dict = {"key": "value"}
            expect dict.contains_key("key")
            expect not dict.contains_key("missing")

        it "gets keys":
            val dict = {"a": 1, "b": 2, "c": 3}
            val keys = dict.keys()
            expect keys.len() == 3

        it "gets values":
            val dict = {"a": 1, "b": 2}
            val values = dict.values()
            expect values.len() == 2

    context "dict with optional chaining":
        """
        ### Scenario: Dict with Optional Values

        Using dicts with Option types and optional chaining.
        """

        it "stores optional values":
            val dict = {"present": Some(42), "absent": None}
            expect dict["present"]? == Some(42)

        it "uses optional chaining with dict access":
            val dict = {"key": Some("value")}
            expect dict["key"]?.to_string() == Some("value")

        it "returns None for missing key with ?":
            val dict = {"a": 1}
            expect dict.get("missing") == None

    context "dict type annotations":
        """
        ### Scenario: Dict Type Annotations

        Explicit type annotations for dictionaries.
        """

        it "annotates string to int dict":
            val dict: Dict<text, i32> = {"one": 1, "two": 2}
            expect dict["one"] == 1

        it "annotates string to string dict":
            val dict: Dict<text, text> = {"greeting": "hello"}
            expect dict["greeting"] == "hello"

        it "annotates complex value types":
            val dict: Dict<text, [i32]> = {"nums": [1, 2, 3]}
            expect dict["nums"].len() == 3
