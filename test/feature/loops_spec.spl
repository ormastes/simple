# @pending
"""
# Loop Constructs Specification

**Feature IDs:** #1100
**Category:** Syntax
**Status:** Implemented

The Simple language provides several loop constructs for iterating over collections and
executing code repeatedly. Loop types include while loops for condition-based iteration,
for loops for collection iteration, and comprehensions for creating collections from
iterative expressions. All loops support break and continue flow control.

## Syntax

```simple
# While loop (condition-based)
var i = 0
while i < 10:
    print i
    i = i + 1

# For loop (collection iteration)
for item in items:
    print item

# Range iteration
for i in 0..10:
    print i

# List comprehension
[for x in items if x > 5: x * 2]

# Dictionary comprehension
{for x in items: (x, x * 2)}
```

## Key Concepts

| Concept | Description |
|---------|-------------|
| While Loop | Condition-based repetition until condition becomes false |
| For Loop | Iteration over collection elements with implicit binding |
| Range | Sequence of values from start to end (inclusive or exclusive) |
| Comprehension | Concise syntax for building collections from iterations |
| Break Statement | Exit loop immediately |
| Continue Statement | Skip to next loop iteration |

## Behavior

Loop constructs:
- Execute code zero or more times based on conditions or collection size
- Support break and continue for flow control
- Provide implicit iteration variables in for loops
- Enable collection creation through comprehensions
- Work with ranges and user-defined iterables
- Support nested loops and complex conditions

## Related Specifications

- Range Expressions (start..end syntax)
- Collection Types (List, Dict, Set iteration)
- Pattern Matching (destructuring in for loops)
- Lambda Expressions (used in functional iteration)
"""


describe "Loop Constructs":
    """
    ## Loop Constructs Specification

    This test suite verifies loop functionality including:
    - Basic while loops with conditions
    - For loops over collections and ranges
    - Break and continue flow control
    - Nested loops
    - List and dictionary comprehensions
    - Loop variable scoping and binding
    """

    context "while loops":
        it "executes while loop with condition":
            var count = 0
            var i = 0
            while i < 5:
                count = count + 1
                i = i + 1
            expect count == 5

        it "exits while loop when condition becomes false":
            var total = 0
            var i = 1
            while i <= 4:
                total = total + i
                i = i + 1
            expect total == 10

        it "handles while loop with break":
            var i = 0
            var count = 0
            while true:
                count = count + 1
                i = i + 1
                if i == 5:
                    break
            expect count == 5

        it "handles while loop with continue":
            var sum = 0
            var i = 0
            while i < 5:
                i = i + 1
                if i == 3:
                    continue
                sum = sum + i
            expect sum == 12

    context "for loops over ranges":
        it "iterates over exclusive range":
            var sum = 0
            for i in 0..5:
                sum = sum + i
            expect sum == 10

        it "iterates over inclusive range":
            var sum = 0
            for i in 0..=5:
                sum = sum + i
            expect sum == 15

        it "handles negative ranges":
            var sum = 0
            for i in -3..=0:
                sum = sum + i
            expect sum == -6

    context "for loops over collections":
        it "iterates over list":
            val items = [1, 2, 3, 4, 5]
            var sum = 0
            for item in items:
                sum = sum + item
            expect sum == 15

        it "iterates with break":
            val items = [1, 2, 3, 4, 5]
            var sum = 0
            for item in items:
                if item == 3:
                    break
                sum = sum + item
            expect sum == 3

        it "iterates with continue":
            val items = [1, 2, 3, 4, 5]
            var sum = 0
            for item in items:
                if item == 3:
                    continue
                sum = sum + item
            expect sum == 12

    context "nested loops":
        it "executes nested loops":
            var sum = 0
            for i in 0..3:
                for j in 0..3:
                    sum = sum + 1
            expect sum == 9

        it "breaks outer loop from nested loop":
            var sum = 0
            for i in 0..5:
                for j in 0..5:
                    sum = sum + 1
                    if sum == 6:
                        break
                if sum == 6:
                    break
            expect sum == 6

    context "list comprehensions":
        it "creates list from range":
            val result = [for x in 0..5: x * 2]
            expect result == [0, 2, 4, 6, 8]

        it "filters with comprehension":
            val result = [for x in 0..10 if x % 2 == 0: x]
            expect result == [0, 2, 4, 6, 8]

        it "transforms and filters":
            val result = [for x in 1..6 if x > 2: x * 2]
            expect result == [6, 8, 10]

        it "comprehension over existing collection":
            val items = [1, 2, 3, 4, 5]
            val result = [for x in items: x * 2]
            expect result == [2, 4, 6, 8, 10]

    context "range with step":
        it "iterates with positive step":
            val result = [for x in range(0, 10, 2): x]
            expect result == [0, 2, 4, 6, 8]

        it "iterates with negative step":
            val result = [for x in range(5, 0, -1): x]
            expect result == [5, 4, 3, 2, 1]

    context "dictionary comprehension":
        it "creates dict from range":
            val result = {for x in 0..3: (x, x * 2)}
            expect result[0] == 0
            expect result[1] == 2
            expect result[2] == 4

    context "complex loop patterns":
        it "nested comprehension":
            val matrix = [[1, 2], [3, 4], [5, 6]]
            val result = [for row in matrix: [for cell in row: cell * 2]]
            expect result == [[2, 4], [6, 8], [10, 12]]

        it "conditional nesting in comprehension":
            val result = [for x in 0..5 if x > 1: [for y in 0..2: x + y]]
            expect result.len() == 3
