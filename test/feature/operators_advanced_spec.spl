"""
# Advanced Operators Specification


**Feature IDs:** #OP-ADV-001 to #OP-ADV-030
**Category:** Language | Operators
**Status:** Implemented

Tests advanced operators and language features including:
- Mutability control (let, let mut, var, const, static)
- Lambda expressions
- String operations
- Array and dict methods
- Bitwise operators
- Comparison and logical operators
- Power and floor division
- In operator
- Symbols

## Syntax

```simple
# Mutability
let x = 10       # immutable
let mut y = 10   # mutable with let mut
var z = 10       # mutable with var
const MAX = 100  # constant
static counter = 0  # static variable

# Operators
val a = 12 & 10    # bitwise AND
val b = 2 ** 10    # power
val c = 7.fdiv(2)  # floor division (// is now parallel operator)
val d = "ell" in "hello"  # in operator
```
"""
use std.string.{NL}
use std.string.{NL}



# ============================================================================
# Test Group 1: Mutability Control
# ============================================================================

describe "Mutability Control":
    """
    ## let, let mut, var, const, static

    Tests variable mutability declarations.
    """

    it "let is immutable":
        val x = 10
        # x = 20  # Would be error
        expect x == 10

    it "var is mutable":
        var y = 10
        y = 30
        expect y == 30

    it "var in loop":
        var sum = 0
        var i = 0
        while i < 5:
            sum = sum + i
            i = i + 1
        expect sum == 10  # 0+1+2+3+4

    it "const declaration":
        const MAX = 100
        expect MAX == 100

    it "const with arithmetic":
        const BASE = 10
        const MULTIPLIER = 5
        expect BASE * MULTIPLIER == 50

    it "const with type annotation":
        const SIZE: i64 = 256
        expect SIZE == 256

    it "static variable":
        static counter = 42
        expect counter == 42


# ============================================================================
# Test Group 2: Lambda Expressions
# ============================================================================

describe "Lambda Expressions":
    """
    ## Lambda Syntax

    Tests lambda creation and usage.
    """

    it "basic lambda":
        val double = \x: x * 2
        expect double(21) == 42

    it "lambda with multiple params":
        val add = \a, b: a + b
        expect add(10, 32) == 42

    it "lambda as higher-order":
        fn apply(f, x):
            f(x)

        val inc = {NL}: n + 1
        expect apply(inc, 41) == 42


# ============================================================================
# Test Group 3: String Operations
# ============================================================================

describe "String Operations":
    """
    ## String Methods

    Tests string length, concatenation, interpolation.
    """

    it "string length":
        val s = "hello"
        expect s.len() == 5

    it "string concatenation":
        val a = "hello"
        val b = "world"
        val c = a + " " + b
        expect c.len() == 11

    it "string interpolation":
        val x = 42
        val s = "value is {x}"
        expect s.len() == 11


# ============================================================================
# Test Group 4: Array Methods
# ============================================================================

describe "Array Methods":
    """
    ## Array Operations

    Tests array length and access.
    """

    it "array length":
        val arr = [1, 2, 3, 4, 5]
        expect arr.len() == 5


# ============================================================================
# Test Group 5: Dict Methods
# ============================================================================

describe "Dict Methods":
    """
    ## Dictionary Operations

    Tests dict length, keys, values, contains_key.
    """

    it "dict length":
        val d = {"a": 1, "b": 2, "c": 3}
        expect d.len() == 3

    it "dict keys":
        val d = {"x": 10, "y": 20}
        val keys = d.keys()
        expect keys.len() == 2

    it "dict values":
        val d = {"a": 5, "b": 10}
        val vals = d.values()
        expect vals[0] + vals[1] == 15

    it "dict contains_key":
        val d = {"hello": 1}
        expect d.contains_key("hello")


# ============================================================================
# Test Group 6: Bitwise Operators
# ============================================================================

describe "Bitwise Operators":
    """
    ## &, |, ^, <<, >>, ~

    Tests bitwise operations.
    """

    it "bitwise AND":
        expect (12 & 10) == 8  # 1100 & 1010 = 1000

    it "bitwise OR":
        expect (12 | 10) == 14  # 1100 | 1010 = 1110

    it "bitwise XOR":
        expect (12 xor 10) == 6  # 1100 ^ 1010 = 0110

    it "left shift":
        expect (1 << 4) == 16

    it "right shift":
        expect (16 >> 2) == 4

    it "bitwise NOT":
        expect (~0) == -1


# ============================================================================
# Test Group 7: Comparison Operators
# ============================================================================

describe "Comparison Operators":
    """
    ## <, >, <=, >=, ==, !=

    Tests comparison operations.
    """

    it "less than":
        expect 1 < 2

    it "greater than":
        expect 2 > 1

    it "less than or equal":
        expect 2 <= 2

    it "greater than or equal":
        expect 2 >= 2

    it "equal":
        expect 2 == 2

    it "not equal":
        expect 2 != 3


# ============================================================================
# Test Group 8: Logical Operators
# ============================================================================

describe "Logical Operators":
    """
    ## and, or, not

    Tests logical operations.
    """

    it "and operator":
        expect true and true
        expect not (true and false)

    it "or operator":
        expect true or false
        expect not (false or false)

    it "not operator":
        expect not false
        expect not (not true)


# ============================================================================
# Test Group 9: Power Operator
# ============================================================================

describe "Power Operator":
    """
    ## ** Exponentiation

    Tests power operator.
    """

    it "power of zero":
        expect (2 ** 0) == 1

    it "power of one":
        expect (2 ** 1) == 2

    it "power of three":
        expect (2 ** 3) == 8

    it "power of ten":
        expect (2 ** 10) == 1024

    it "three to fourth":
        expect (3 ** 4) == 81


# ============================================================================
# Test Group 10: Floor Division
# ============================================================================

describe "Floor Division":
    """
    ## .fdiv() Method

    Tests floor division method (// operator is now for parallel execution).
    """

    it "positive floor division":
        expect 7.fdiv(2) == 3

    it "another floor division":
        expect 10.fdiv(3) == 3

    it "negative floor division":
        expect (-7).fdiv(2) == -4  # rounds toward negative infinity

    it "exact division":
        expect 8.fdiv(4) == 2


# ============================================================================
# Test Group 11: In Operator
# ============================================================================

describe "In Operator":
    """
    ## x in collection

    Tests membership operator.
    """

    it "in array present":
        expect 2 in [1, 2, 3]

    it "in array absent":
        expect not (5 in [1, 2, 3])

    it "in string present":
        expect "ell" in "hello"

    it "in string absent":
        expect not ("xyz" in "hello")


# ============================================================================
# Test Group 12: Recursive Functions
# ============================================================================

describe "Recursive Functions":
    """
    ## Function Recursion

    Tests recursive function calls.
    """

    it "factorial":
        fn factorial(n: i64) -> i64:
            if n <= 1:
                1
            else:
                n * factorial(n - 1)

        expect factorial(3) == 6


# ============================================================================
# Test Group 13: Nested Data Structures
# ============================================================================

describe "Nested Data Structures":
    """
    ## Nested Arrays and Structs

    Tests nested data access.
    """

    it "nested arrays":
        val arr = [[1, 2], [3, 4], [5, 6]]
        expect arr[0][0] + arr[1][1] + arr[2][0] == 10

    it "nested structs":
        struct Inner:
            value: i64

        struct Outer:
            inner: Inner

        val o = Outer(inner: Inner(value: 42))
        expect o.inner.value == 42


# ============================================================================
# Test Group 14: Early Return
# ============================================================================

describe "Early Return":
    """
    ## Multiple Return Paths

    Tests functions with multiple returns.
    """

    it "early return based on condition":
        fn verify(x: i64) -> i64:
            if x > 10:
                return 1
            if x > 5:
                return 2
            3

        expect verify(7) == 2


# ============================================================================
# Test Group 15: Tuple Destructuring
# ============================================================================

describe "Tuple Destructuring":
    """
    ## Multiple Assignment

    Tests tuple unpacking.
    """

    it "destructures tuple":
        val (a, b, c) = (1, 2, 3)
        expect a + b + c == 6


# ============================================================================
# Test Group 16: Symbols
# ============================================================================

describe "Symbols":
    """
    ## :symbol Syntax

    Tests symbol literals.
    """

    it "symbol comparison":
        val s = :hello
        expect s == :hello

