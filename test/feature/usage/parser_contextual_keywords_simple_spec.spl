# # Contextual Keyword Disambiguation
#
# **Feature ID:** #PARSER-012
# **Category:** Syntax
# **Status:** Active
#
# ## Overview
#
# Simple treats `skip`, `static`, and `default` as contextual keywords rather than
# fully reserved words. This means each token can serve as either a keyword or an
# ordinary identifier depending on syntactic context -- specifically, whether it is
# followed by `(`. The spec validates all six disambiguation branches (keyword vs
# identifier for each of the three tokens), confirms that multiple contextual
# keywords can coexist as method names within a single class, and ensures that
# identifiers merely prefixed with a keyword name (e.g., `skip_all`) are never
# misinterpreted.
#
# ## Syntax
#
# ```simple
# # skip as identifier (followed by '(')
# fn skip(n):
# return n * 2
# val result = skip(5)
#
# # skip as keyword (standalone statement)
# skip
#
# # static as keyword in method declaration
# class Math:
# static fn add(a, b):
# return a + b
# Math.add(3, 7)
#
# # default as identifier on a class method
# class Settings:
# fn default():
# return 200
# settings.default()
# ```
#
# ## Key Concepts
#
# | Concept | Description |
# |---------|-------------|
# | Contextual keyword | A token that acts as a keyword or identifier based on surrounding syntax |
# | Lookahead disambiguation | The parser checks for a following `(` to decide identifier vs keyword |
# | Branch coverage | All six branches (keyword/identifier x three tokens) are exercised |
# | Coexistence | A single class can define methods named `skip`, `static`, and `default` |

# Branch 1: skip as Identifier (followed by '(')
describe "skip as identifier":
    it "works as function name":
        fn skip(n):
            return n * 2
        val result = skip(5)
        expect result == 10

    it "works as method name":
        class MyClass:
            fn skip(n):
                return n + 1

        val obj = MyClass()
        val result = obj.skip(10)
        expect result == 11

# Branch 2: skip as Keyword (NOT followed by '(')
describe "skip as keyword":
    it "works as standalone statement":
        skip
        expect true

    it "works in function body":
        fn test():
            skip
            return 42
        expect test() == 42

# Branch 3: static as Identifier (followed by '(')
describe "static as identifier":
    it "works as function name":
        fn static():
            return "static func"
        expect static() == "static func"

    it "works as method name":
        class Config:
            fn static():
                return 100

        val cfg = Config()
        expect cfg.static() == 100

# Branch 4: static as Keyword (NOT followed by '(')
describe "static as keyword":
    it "works in static method declaration":
        class Math:
            static fn add(a, b):
                return a + b

        expect Math.add(3, 7) == 10

# Branch 5: default as Identifier (followed by '(')
describe "default as identifier":
    it "works as function name":
        fn default():
            return "default val"
        expect default() == "default val"

    it "works as method name":
        class Settings:
            fn default():
                return 200

        val settings = Settings()
        expect settings.default() == 200

# Branch 6: default as Keyword (NOT followed by '(')
describe "default as keyword":
    it "parses in match context":
        val x = 5
        val result = match x:
            case 1: "one"
            case _: "other"
        expect result == "other"

# Edge Cases
describe "edge cases":
    it "allows all three keywords as method names in same class":
        class Multi:
            fn skip():
                return 1

            fn static():
                return 2

            fn default():
                return 3

        val obj = Multi()
        expect obj.skip() == 1
        expect obj.static() == 2
        expect obj.default() == 3

    it "distinguishes keywords from underscored identifiers":
        val skip_all = 10
        val static_var = 20
        val default_value = 30
        expect skip_all == 10
        expect static_var == 20
        expect default_value == 30

print "âœ… All contextual keyword tests passed!"
print "Branch Coverage: 6/6 (100%)"
