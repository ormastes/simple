# Shared test helpers for duplicate_check tests
#
# Reduces code duplication across test files by providing common
# helper functions for file creation, cleanup, and config creation.

use app.duplicate_check.config.{DuplicationConfig}
use app.io.mod.{file_write, shell}

# Create a test file in a test directory
fn create_test_file_in(dir: text, path: text, content: text):
    shell("mkdir -p {dir}")
    file_write(path, content)

# Clean up test directory
fn cleanup_test_dir(dir: text):
    shell("rm -rf {dir}")

# Create a minimal test config for testing
fn minimal_test_config() -> DuplicationConfig:
    DuplicationConfig(
        min_tokens: 5,
        min_lines: 1,
        ignore_identifiers: false,
        ignore_literals: false,
        ignore_comments: true,
        ignore_whitespace: true,
        similarity_threshold: 0.85,
        output_format: "text",
        report_path: "doc/analysis/duplicate_db.sdn",
        max_allowed: 0,
        min_impact: 10,
        exclude_patterns: [],
        use_ast_features: false,
        use_cosine_similarity: false,
        verbose: false,
        quiet: true,
        use_parallel: false,
        num_workers: 0,
        use_incremental: false,
        incremental_cache_path: ".cache.sdn"
    )

# Create a verbose test config
fn verbose_test_config() -> DuplicationConfig:
    var config = minimal_test_config()
    config.verbose = true
    config.quiet = false
    config

# Create a config with custom settings
fn custom_test_config(min_tokens: i64, min_lines: i64, quiet: bool) -> DuplicationConfig:
    var config = minimal_test_config()
    config.min_tokens = min_tokens
    config.min_lines = min_lines
    config.quiet = quiet
    config

export create_test_file_in, cleanup_test_dir
export minimal_test_config, verbose_test_config, custom_test_config
