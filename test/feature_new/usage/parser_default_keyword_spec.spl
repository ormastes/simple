describe "Default keyword in function parameters":
    it "parses default parameter value with = syntax":
        fn greet(name = "World"):
            return "Hello, {name}"
        expect greet() == "Hello, World"
        expect greet("Alice") == "Hello, Alice"

    it "parses multiple default parameters":
        fn create_range(min = 0, max = 100):
            return [min, max]
        val range = create_range()
        expect range[0] == 0
        expect range[1] == 100

    it "overrides single default parameter":
        fn with_defaults(x = 1, y = 2):
            return x + y
        expect with_defaults() == 3
        expect with_defaults(5) == 7
        expect with_defaults(5, 10) == 15

    it "parses default with expressions":
        fn with_expr_default(size = 2 ** 10):
            return size
        expect with_expr_default() == 1024

    it "parses default with arithmetic":
        fn compute(base = 100, offset = 10 + 5):
            return base + offset
        expect compute() == 115

    it "uses default in nested function":
        fn outer():
            fn inner(value = 42):
                return value
            return inner()
        expect outer() == 42

describe "Default keyword with types":
    it "parses default parameter with type annotation":
        fn typed_default(count: i32 = 0):
            return count
        expect typed_default() == 0
        expect typed_default(5) == 5

    it "parses default text parameter":
        fn with_text(message: text = "default"):
            return message
        expect with_text() == "default"
        expect with_text("custom") == "custom"

    it "parses default float parameter":
        fn with_float(value: f64 = 3.14):
            return value
        expect with_float() > 3.0

describe "Default keyword in methods":
    it "parses default in class method":
        class Counter:
            value: i32

            me increment(amount = 1):
                self.value = self.value + amount

        var c = Counter(value: 10)
        c.increment()
        expect c.value == 11

    it "parses default in static method":
        class Factory:
            static fn create(size = 10) -> i32:
                return size

        expect Factory.create() == 10
        expect Factory.create(20) == 20

describe "Default keyword with collections":
    it "parses default empty array":
        fn with_array(items = []):
            return items.len()
        expect with_array() == 0
        expect with_array([1, 2, 3]) == 3

    it "parses default array literal":
        fn with_values(data = [1, 2, 3]):
            return data.len()
        expect with_values() == 3

describe "Default keyword edge cases":
    it "parses default with boolean":
        fn with_flag(enabled = true):
            return enabled
        expect with_flag() == true
        expect with_flag(false) == false

    it "parses default with negative number":
        fn with_negative(value = -10):
            return value
        expect with_negative() == -10

    it "parses default with string interpolation":
        val default_name = "World"
        fn greet_default(name = default_name):
            return "Hello, {name}"
        expect greet_default() == "Hello, World"

describe "Default keyword combinations":
    it "parses mix of required and default parameters":
        fn mixed(required, optional = 5):
            return required + optional
        expect mixed(10) == 15
        expect mixed(10, 20) == 30

    it "parses multiple functions with defaults":
        fn first(x = 1):
            return x
        fn second(y = 2):
            return y
        expect first() == 1
        expect second() == 2

    # TODO: Lambda default parameters not yet supported
    # it "parses default in lambda", skip:
    #     val lambda_default = \x = 10: x * 2
    #     expect lambda_default() == 20
    #     expect lambda_default(5) == 10
