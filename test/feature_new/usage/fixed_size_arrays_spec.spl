"""
Fixed-Size Arrays - Comprehensive SSpec Tests
Decision #8: [T; N] syntax with runtime size checking

Category: Collections
Status: Implemented (Part 2/2)
"""

describe "Fixed-Size Arrays":

    context "Basic Syntax":
        it "creates fixed-size array with type annotation":
            val vec3: [f64; 3] = [1.0, 2.0, 3.0]
            expect vec3.len() == 3

        it "creates fixed-size int array":
            val arr: [i64; 5] = [1, 2, 3, 4, 5]
            expect arr.len() == 5

        it "creates single element fixed-size array":
            val arr: [i64; 1] = [42]
            expect arr.len() == 1
            expect arr[0] == 42

    context "Indexing":
        it "allows indexing read":
            val vec3: [f64; 3] = [1.0, 2.0, 3.0]
            expect vec3[0] == 1.0
            expect vec3[1] == 2.0
            expect vec3[2] == 3.0

        it "allows negative indexing":
            val arr: [i64; 3] = [10, 20, 30]
            expect arr[-1] == 30
            expect arr[-2] == 20
            expect arr[-3] == 10

    context "Read Operations":
        it "allows len":
            val vec3: [f64; 3] = [1.0, 2.0, 3.0]
            expect vec3.len() == 3

        it "allows first and last":
            val arr: [i64; 4] = [10, 20, 30, 40]
            expect arr.first() == 10
            expect arr.last() == 40

        it "allows contains":
            val arr: [i64; 3] = [1, 2, 3]
            expect arr.contains(2)
            expect not arr.contains(5)

        it "allows iteration":
            val vec3: [i64; 3] = [1, 2, 3]
            var sum = 0
            for x in vec3:
                sum = sum + x
            expect sum == 6

    context "Functional Operations":
        it "allows map (returns dynamic array)":
            val vec3: [i64; 3] = [1, 2, 3]
            val doubled = vec3.map(\x: x * 2)
            expect doubled[0] == 2
            expect doubled[1] == 4
            expect doubled[2] == 6

        it "allows filter (returns dynamic array)":
            val arr: [i64; 5] = [1, 2, 3, 4, 5]
            val evens = arr.filter(\x: x % 2 == 0)
            expect evens.len() == 2
            expect evens[0] == 2

        it "allows reduce":
            val arr: [i64; 4] = [1, 2, 3, 4]
            val sum = arr.reduce(0, \acc, x: acc + x)
            expect sum == 10

    context "Display Format":
        it "displays with size annotation":
            val vec3: [i64; 3] = [1, 2, 3]
            # FixedSizeArray displays as [items; size]
            expect vec3.len() == 3
