# errdefer statement spec
#
# Tests for the `errdefer expr` statement (Phase 4b)

describe "errdefer statement":
    it "errdefer syntax parses correctly":
        var log: [text] = []
        val f = fn():
            errdefer log.push("errdeferred")
            42
        val r = f()
        expect(r).to_equal(42)

    it "errdefer and defer can coexist":
        var log: [text] = []
        val f = fn():
            defer log.push("deferred")
            errdefer log.push("errdeferred")
            log.push("body")
        f()
        expect(log[0]).to_equal("body")

    it "multiple errdefer statements parse":
        var log: [text] = []
        val f = fn():
            errdefer log.push("first err")
            errdefer log.push("second err")
            99
        val r = f()
        expect(r).to_equal(99)
