# Multiline Boolean Expressions in Parentheses Test
#
# Tests that boolean expressions can span multiple lines when wrapped in parentheses.
# The lexer should suppress newline tokens inside parentheses (lex_paren_depth > 0).

use std.spec.{describe, it, expect}

describe "Multiline Boolean Expressions":
    it "allows simple multiline and in parentheses":
        val result = (true and
            true)
        expect(result).to_equal(true)

    it "allows multiline and with false":
        val result = (true and
            false)
        expect(result).to_equal(false)

    it "allows multiline or in parentheses":
        val result = (false or
            true)
        expect(result).to_equal(true)

    it "allows three-way and expression":
        val result = (true and
            true and
            true)
        expect(result).to_equal(true)

    it "allows three-way mixed expression":
        val a = true
        val b = false
        val c = true
        val result = (a and
            b or
            c)
        expect(result).to_equal(true)

    it "allows nested parentheses with multiline":
        val result = (true and (false or
            true))
        expect(result).to_equal(true)

    it "allows complex nested expression":
        val result = (true and
            (false or
                (true and
                    true)))
        expect(result).to_equal(true)

    it "works in if statement condition":
        val a = true
        val b = true
        val c = true
        var result = false
        if (a and
            b and
            c):
            result = true
        expect(result).to_equal(true)

    it "works with comparison operators":
        val x = 5
        val result = (x > 3 and
            x < 10)
        expect(result).to_equal(true)

    it "works with function calls":
        fn is_positive(n: i64) -> bool:
            n > 0
        fn is_even(n: i64) -> bool:
            n % 2 == 0
        val n = 4
        val result = (is_positive(n) and
            is_even(n))
        expect(result).to_equal(true)

    it "allows multiline with not operator":
        val result = (not false and
            true)
        expect(result).to_equal(true)

    it "allows four-level deep nesting":
        val result = (true and
            (true or
                (false and
                    (true or
                        false))))
        expect(result).to_equal(true)

    it "works with multiple conditions in while":
        var count = 0
        var i = 0
        while (i < 5 and
            count < 10):
            count = count + 1
            i = i + 1
        expect(count).to_equal(5)

    it "works in match guard":
        val x = 10
        val result = match x:
            case 10:
                if (x > 5 and
                    x < 15):
                    "yes"
                else:
                    "no"
            case _:
                "other"
        expect(result).to_equal("yes")

    it "works with string comparisons":
        val name = "Alice"
        val result = (name == "Alice" and
            name.len() > 3)
        expect(result).to_equal(true)

    it "allows very long multiline expression":
        val result = (true and
            true and
            true and
            true and
            true and
            true and
            true and
            true)
        expect(result).to_equal(true)

    it "works with array membership":
        val items = [1, 2, 3, 4, 5]
        val x = 3
        val result = (x in items and
            x > 0)
        expect(result).to_equal(true)

    it "works with null coalescing":
        val x = 5
        val maybe = x
        val result = (maybe ?? 0 > 0 and
            maybe ?? 0 < 10)
        expect(result).to_equal(true)
