# Associated types spec
#
# Tests for type aliases within struct contexts.
# Associated types allow structs and traits to define type aliases
# that can be used in their method signatures.

# Struct with type alias using 'type' keyword (at module level, works fine)
type ItemType = i64
type KeyType = text

struct IntList:
    items: [i64]

    fn size() -> i64:
        self.items.len()

    fn get(idx: i64) -> i64:
        self.items[idx]

struct TextMap:
    keys: [text]
    values: [text]

    fn count() -> i64:
        self.keys.len()

describe "associated types":
    it "struct with associated type alias works":
        val x: ItemType = 42
        expect(x).to_equal(42)

    it "struct fields are accessible":
        val list = IntList(items: [1, 2, 3])
        expect(list.size()).to_equal(3)

    it "struct item access via type alias":
        val list = IntList(items: [10, 20])
        val item: ItemType = list.get(0)
        expect(item).to_equal(10)

    it "key type alias works with text struct":
        val key: KeyType = "hello"
        expect(key.len()).to_equal(5)

    it "struct with key/value works":
        val m = TextMap(keys: ["a", "b"], values: ["1", "2"])
        expect(m.count()).to_equal(2)
