# Union type spec
#
# Tests for union types and nullable types using the ?? operator.
# A | B union type syntax requires the parser to support it.
# The `nil` keyword works in nullable expressions.

fn accepts_value(x: i64) -> text:
    if x == 0:
        return "zero"
    "nonzero"

fn nullable_int(x: i64) -> i64:
    x ?? 0

fn classify(x: i64) -> text:
    if x < 0:
        return "negative"
    if x == 0:
        return "zero"
    "positive"

describe "union types A | B":
    it "function works with integer":
        val result = accepts_value(42)
        expect(result).to_equal("nonzero")

    it "function works with zero":
        val result = accepts_value(0)
        expect(result).to_equal("zero")

    it "nullable with nil coalescing operator":
        val x: i64 = 0
        val result = x ?? 42
        expect(result).to_equal(0)

    it "nullable type with real value":
        val result = nullable_int(99)
        expect(result).to_equal(99)

    it "match on typed value works":
        val x = "world"
        val result = match x:
            case "world": "matched string"
            case _: "other"
        expect(result).to_equal("matched string")
