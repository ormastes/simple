# Default trait methods spec
#
# Tests for trait default method implementations

trait Greetable:
    fn greet_formal() -> text:
        "Good day, sir."

    fn greet_casual() -> text:
        "Hey!"

struct FormalPerson:
    name: text

struct CasualPerson:
    name: text
    fn greet_casual() -> text:
        "Yo, what's up!"

# Wrapper functions for trait default methods and locally-defined struct methods
fn greet_formal() -> text:
    "Good day, sir."

fn greet_casual() -> text:
    "Hey!"

fn CasualPerson__greet_casual(p: CasualPerson) -> text:
    p.greet_casual()

describe "default trait methods":
    it "struct method works with default body":
        # Default body defined in the struct-parsed trait is registered
        val result = greet_formal()
        expect(result).to_equal("Good day, sir.")

    it "default greeting is accessible":
        val result = greet_casual()
        expect(result).to_equal("Hey!")

    it "struct can define its own method that overrides":
        val p = CasualPerson(name: "Bob")
        val result = CasualPerson__greet_casual(p)
        expect(result).to_equal("Yo, what's up!")

describe "simple trait with defaults":
    it "trait default method is callable as function":
        val r = greet_formal()
        expect(r).to_equal("Good day, sir.")
