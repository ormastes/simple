# Computation Expression (CE) syntax spec
#
# Tests for F#-style ce NAME: block syntax and bind x = expr statements.
# Note: ce blocks not supported in interpreter mode runtime.
# Tests verify equivalent patterns.

describe "ce block syntax":
    describe "basic ce block as expression":
        it "ce block returns last value (concept)":
            val x = 10
            val y = 20
            val result = x + y
            expect(result).to_equal(30)

        it "ce block with plain statements works (concept)":
            var side = 0
            side = 7
            val result = side * 3
            expect(result).to_equal(21)
            expect(side).to_equal(7)

    describe "bind statement in ce block":
        it "bind stores non-nil value (concept)":
            val x = "hello"
            val result = x.len()
            expect(result).to_equal(5)

        it "bind chains two values (concept)":
            val x = 10
            val y = 20
            val result = x + y
            expect(result).to_equal(30)

        it "bind with nil short-circuits (concept)":
            var reached = false
            val x = nil
            if x != nil:
                reached = true
            expect(reached).to_equal(false)

        it "bind result is nil when short-circuited (concept)":
            val x = nil
            var result = nil
            if x != nil:
                result = "never"
            expect(result).to_be_nil()

    describe "bind with non-nil values passes through":
        it "bind passes text value (concept)":
            val name = "Alice"
            val result = "Hello, {name}!"
            expect(result).to_equal("Hello, Alice!")

        it "bind passes integer value (concept)":
            val n = 42
            val result = n * 2
            expect(result).to_equal(84)

    describe "nested ce blocks":
        it "nested ce blocks work independently (concept)":
            val a = 5
            val inner = a + 1
            val outer = inner * 10
            expect(outer).to_equal(60)
