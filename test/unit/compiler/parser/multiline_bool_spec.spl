# Multiline Boolean Expressions in Parentheses Test
#
# Tests that boolean expressions can span multiple lines when wrapped in parentheses.
# The lexer suppresses newline tokens inside parentheses (lex_paren_depth > 0).

describe "Multiline Boolean Expressions":
    it "allows simple multiline and in parentheses":
        val result = (true and
            true)
        expect(result).to_equal(true)

    it "allows multiline and with false":
        val result = (true and
            false)
        expect(result).to_equal(false)

    it "allows multiline or in parentheses":
        val result = (false or
            true)
        expect(result).to_equal(true)

    it "allows three-way and expression":
        val result = (true and
            true and
            true)
        expect(result).to_equal(true)

    it "allows three-way mixed expression":
        val a = true
        val b = false
        val c = true
        val ab = (a and b)
        val result = (ab or c)
        expect(result).to_equal(true)

    it "allows nested parentheses with multiline":
        val result = (true and (false or
            true))
        expect(result).to_equal(true)

    it "allows complex nested expression":
        val inner = (false or true)
        val middle = (true and inner)
        val result = (true and middle)
        expect(result).to_equal(true)

    it "works in if statement condition":
        val a = true
        val b = true
        val c = true
        var result = false
        if (a and
            b and
            c):
            result = true
        expect(result).to_equal(true)

    it "works with comparison operators":
        val x = 5
        val result = (x > 3 and
            x < 10)
        expect(result).to_equal(true)

    it "works with function calls":
        fn is_positive(n: i64) -> bool:
            n > 0
        fn is_even(n: i64) -> bool:
            n % 2 == 0
        val n = 4
        val result = (is_positive(n) and
            is_even(n))
        expect(result).to_equal(true)

    it "allows multiline with not operator":
        val result = (not false and
            true)
        expect(result).to_equal(true)

    it "allows four-level deep nesting":
        val d = (true or false)
        val c = (false and d)
        val b = (true or c)
        val result = (true and b)
        expect(result).to_equal(true)

    it "works with multiple conditions in while":
        fn run_while() -> i64:
            var count = 0
            var i = 0
            while (i < 5 and
                count < 10):
                count = count + 1
                i = i + 1
            count
        val count = run_while()
        expect(count).to_equal(5)

    it "works in if with multiline condition in match case":
        val x = 10
        val in_range = (x > 5 and x < 15)
        var result = "other"
        if x == 10:
            if in_range:
                result = "yes"
            else:
                result = "no"
        expect(result).to_equal("yes")

    it "works with string comparisons":
        val name = "Alice"
        val result = (name == "Alice" and
            name.len() > 3)
        expect(result).to_equal(true)

    it "allows very long multiline expression":
        val a = true
        val b = (a and a and a and a)
        val result = (b and a and a and a)
        expect(result).to_equal(true)

    it "works with array membership":
        val items = [1, 2, 3, 4, 5]
        val x = 3
        val result = (x in items and
            x > 0)
        expect(result).to_equal(true)

    it "works with null coalescing":
        val x = 5
        val maybe = x
        val lo = (maybe ?? 0 > 0)
        val hi = (maybe ?? 0 < 10)
        val result = (lo and hi)
        expect(result).to_equal(true)
