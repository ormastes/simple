# Pattern binding spec
#
# Tests for pattern matching with value extraction.
# Note: `case X as binding_name:` syntax (Phase 7b feature) is planned
# but not yet implemented in the current binary. These tests use
# the existing match syntax to verify pattern matching behavior.

fn extract_number(x: i64) -> i64:
    match x:
        case 42: 42 * 2
        case 10: 10 + 5
        case _: x

fn check_word(s: text) -> text:
    match s:
        case "hello": s + " world"
        case "bye": s + " then"
        case _: "unknown: " + s

describe "pattern binding in match":
    it "matched value used via original variable":
        val x = 42
        val result = match x:
            case 42: x * 2
            case _: 0
        expect(result).to_equal(84)

    it "match with guard uses enclosing scope":
        val x = 10
        val result = match x:
            case 10 if x > 5: "big"
            case _: "small"
        expect(result).to_equal("big")

    it "wildcard works without binding":
        val x = 99
        val result = match x:
            case 42: "forty-two"
            case _: "other"
        expect(result).to_equal("other")

    it "string pattern matched via function":
        val result = check_word("hello")
        expect(result).to_equal("hello world")

    it "extract function uses matched literal":
        val result = extract_number(10)
        expect(result).to_equal(15)
