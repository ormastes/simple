"""
# Parser Outline Specification

**Feature IDs:** #TBD
**Category:** Compiler
**Status:** In Progress

## Overview

Tests TreeSitter outline parsing including imports/exports iteration
and full parse_full() pipeline.
"""

use std.spec
use compiler.core.parser.*
use compiler.parser_types.*
use compiler.core.lexer.*
use compiler.blocks.*
use compiler.treesitter.*


describe "Parser Outline":
    it "parses outline with at least 1 function":
        val src = "fn main() -> i64:\n    0\n"
        var ts = TreeSitter.new(src)
        val outline = ts.parse_outline()
        expect(outline.functions.len() > 0).to_equal(true)

    it "outline has 0 imports for simple function":
        val src = "fn main() -> i64:\n    0\n"
        var ts = TreeSitter.new(src)
        val outline = ts.parse_outline()
        expect(outline.imports.len()).to_equal(0)

    it "parses full module with outline":
        val src = "fn main() -> i64:\n    0\n"
        var ts = TreeSitter.new(src)
        val outline = ts.parse_outline()
        var parser = Parser.new(src)
        parser.outline = Some(outline)
        val module = parser.parse_full()
        expect(module.functions.keys().len() > 0).to_equal(true)
