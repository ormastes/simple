# # Parser Step-by-Step Specification
#
# **Feature IDs:** #TBD
# **Category:** Compiler
# **Status:** In Progress
#
# ## Overview
#
# Tests step-by-step parsing with TreeSitter outline integration.

use std.spec
use compiler.core.parser.*
use compiler.parser_types.*
use compiler.core.lexer.*
use compiler.blocks.*
use compiler.treesitter.*


describe "Parser Step-by-Step":
    it "parses with TreeSitter outline and finds 1 function":
        val src = "fn main() -> i64:\n    0\n"
        var ts = TreeSitter.new(src)
        val outline = ts.parse_outline()
        expect(outline.functions.len()).to_equal(1)

    it "creates parser with outline and parses successfully":
        val src = "fn main() -> i64:\n    0\n"
        var ts = TreeSitter.new(src)
        val outline = ts.parse_outline()
        var parser = Parser.new(src)
        parser.outline = Some(outline)
        val ast = parser.parse()
        expect(ast.functions.keys().len()).to_equal(1)
