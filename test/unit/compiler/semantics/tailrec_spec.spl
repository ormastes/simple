# Tail recursion spec
#
# Tests for @tailrec annotation support

# @tailrec
fn factorial_tr(n: i64, acc: i64) -> i64:
    if n <= 1:
        return acc
    factorial_tr(n - 1, n * acc)

# @tailrec
fn sum_to(n: i64, acc: i64) -> i64:
    if n <= 0:
        return acc
    sum_to(n - 1, acc + n)

describe "@tailrec annotation":
    it "tailrec annotated function works correctly":
        # factorial(5) = 120
        val result = factorial_tr(5, 1)
        expect(result).to_equal(120)

    it "tailrec accumulator pattern":
        # sum 1..10 = 55
        val result = sum_to(10, 0)
        expect(result).to_equal(55)

    it "base case returns directly":
        val result = factorial_tr(1, 1)
        expect(result).to_equal(1)

    it "tailrec with zero":
        val result = sum_to(0, 42)
        expect(result).to_equal(42)
