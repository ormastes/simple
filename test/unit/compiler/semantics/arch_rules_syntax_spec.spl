# Architecture Rules Syntax Specification
#
# Tests for architecture rules data structures

use compiler.arch_rules.*
use compiler.predicate.*

describe "Architecture Rules Data Structures":
    it "creates forbid rule":
        val pred = Predicate__Sel(Selector__Within("app.*"))
        val rule = ArchRule(
            action: RuleAction.Forbid,
            predicate: pred,
            priority: 10,
            message: Some("Forbidden")
        )
        expect rule.action == RuleAction.Forbid
        expect rule.priority == 10

    it "creates allow rule":
        val pred = Predicate__Sel(Selector__Within("app.*"))
        val rule = ArchRule(
            action: RuleAction.Allow,
            predicate: pred,
            priority: 5,
            message: nil
        )
        expect rule.action == RuleAction.Allow
        expect rule.priority == 5

    it "creates config from rules":
        val pred = Predicate__Sel(Selector__Within("app.*"))
        val rule = ArchRule(
            action: RuleAction.Forbid,
            predicate: pred,
            priority: 10,
            message: nil
        )
        val config = ArchRulesConfig__from_rules([rule])
        expect config.enabled

    it "creates disabled config":
        val config = ArchRulesConfig__disabled()
        expect not config.enabled

    it "creates validation engine":
        val config = ArchRulesConfig__disabled()
        val engine = ArchRulesEngine__create(config)
        expect not engine.is_enabled()
