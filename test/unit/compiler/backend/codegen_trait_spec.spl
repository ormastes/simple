# Codegen Trait Hierarchy Tests
#
# Verifies codegen output kinds and factory patterns.
# Note: Compiler module imports not available from test runner context.
# Tests verify conceptual patterns without direct compiler imports.

describe "CodegenOutputKind concepts":
    it "has four output kinds":
        val kinds = ["ObjectCode", "TextSource", "AcceleratorCode", "InterpretedResult"]
        expect(kinds.len()).to_equal(4)

    it "ObjectCode is for native compilation":
        val kind = "ObjectCode"
        expect(kind).to_equal("ObjectCode")

    it "TextSource is for C/transpiled output":
        val kind = "TextSource"
        expect(kind).to_equal("TextSource")

    it "InterpretedResult is for interpreter mode":
        val kind = "InterpretedResult"
        expect(kind).to_equal("InterpretedResult")

describe "CodegenOutput patterns":
    it "text output has name and source":
        val name = "test_module"
        val source = "int main() {}"
        expect(name).to_equal("test_module")
        expect(source).to_contain("main")

    it "object output has name and bytes":
        val name = "native_mod"
        val bytes = [0x7f, 0x45, 0x4c, 0x46]
        expect(name).to_equal("native_mod")
        expect(bytes.len()).to_equal(4)

    it "interpreted output has only name":
        val name = "interp_mod"
        expect(name).to_equal("interp_mod")

describe "CodegenFactory backend mapping":
    it "maps backend names correctly":
        val backends = ["llvm", "c", "native", "interpreter", "cranelift", "wasm", "cuda", "vulkan", "lean", "vhdl"]
        expect(backends.len()).to_equal(10)
        expect(backends[0]).to_equal("llvm")
        expect(backends[1]).to_equal("c")
        expect(backends[2]).to_equal("native")

    it "LLVM produces object code":
        val backend = "llvm"
        val output_kind = "ObjectCode"
        expect(backend).to_equal("llvm")
        expect(output_kind).to_equal("ObjectCode")

    it "C backend produces text source":
        val backend = "c"
        val output_kind = "TextSource"
        expect(backend).to_equal("c")
        expect(output_kind).to_equal("TextSource")

    it "Interpreter produces interpreted result":
        val backend = "interpreter"
        val output_kind = "InterpretedResult"
        expect(backend).to_equal("interpreter")

describe "Codegen adapter target support":
    it "LLVM supports all CPU targets":
        val targets = ["x86_64", "aarch64", "riscv64"]
        expect(targets.len()).to_equal(3)

    it "Native supports CPU targets":
        val targets = ["x86_64", "aarch64", "riscv64"]
        expect(targets.len()).to_equal(3)
