# Label token spec
#
# Tests for labeled loop control flow behavior.
# The 'label syntax for labeled break/continue is planned; currently
# we use return values from functions to achieve the same effect.

fn search_2d(target_i: i64, target_j: i64) -> i64:
    for i in 0..5:
        for j in 0..5:
            if i == target_i and j == target_j:
                return i * 10 + j
    -1

fn count_outer_iters() -> i64:
    var count = 0
    for i in 0..4:
        var break_outer = false
        for j in 0..4:
            if j == 1:
                break_outer = true
        if not break_outer:
            count = count + 1
    count

describe "label tokens for labeled break/continue":
    it "labeled break exits outer loop (via fn return)":
        val found = search_2d(2, 2)
        expect(found).to_equal(22)

    it "labeled continue effect (count outer iters not triggering inner)":
        # When inner loop always triggers 'continue outer' at j==1,
        # the outer iteration count remains 0
        val count = count_outer_iters()
        expect(count).to_equal(0)

    it "unlabeled break only exits inner loop":
        var total = 0
        for i in 0..3:
            for j in 0..10:
                if j == 2:
                    break
            total = total + 1
        expect(total).to_equal(3)
