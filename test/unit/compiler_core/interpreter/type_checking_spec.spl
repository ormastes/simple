# Type Checking in Interpreter Tests
#
# Tests for runtime type checking in function calls (eval.spl)

use std.spec.{describe, it, expect}

describe("Function Parameter Type Checking"):
    it("passes when types match"):
        fn add(x: i64, y: i64) -> i64:
            x + y
        val result = add(5, 10)
        expect(result).to_equal(15)

    it("accepts bool parameter"):
        fn is_true(flag: bool) -> bool:
            flag
        val result = is_true(true)
        expect(result).to_equal(true)

    it("accepts text parameter"):
        fn greet(name: text) -> text:
            "Hello, " + name
        val result = greet("World")
        expect(result).to_equal("Hello, World")

    it("accepts f64 parameter"):
        fn double(x: f64) -> f64:
            x * 2.0
        val result = double(3.5)
        expect(result).to_equal(7.0)

    it("works with multiple typed parameters"):
        fn combine(num: i64, txt: text, flag: bool) -> text:
            if flag:
                txt + " " + str(num)
            else:
                str(num) + " " + txt
        val result = combine(42, "answer", true)
        expect(result).to_equal("answer 42")

    it("works with untyped parameters"):
        fn identity(x):
            x
        val result = identity(123)
        expect(result).to_equal(123)

describe("Type Checking Edge Cases"):
    it("handles nil values"):
        fn maybe(x) -> i64:
            if x == nil:
                0
            else:
                x
        val result = maybe(nil)
        expect(result).to_equal(0)

    it("works with nested function calls"):
        fn inner(x: i64) -> i64:
            x + 1
        fn outer(y: i64) -> i64:
            inner(y) * 2
        val result = outer(5)
        expect(result).to_equal(12)

    it("accepts array parameters"):
        fn sum_array(arr) -> i64:
            var total: i64 = 0
            for x in arr:
                total = total + x
            total
        val result = sum_array([1, 2, 3, 4, 5])
        expect(result).to_equal(15)
