describe "Traits Extended":
    it "skipped":
        skip("imports compiler modules - causes OOM via numbered directory resolution")

# # Tests for new @traits queries added in Part B
# #
# # Tests the extended __traits built-in queries:
# #   "methods", "all_members", "enum_count", "is_class",
# #   "is_fn", "is_integral", "is_float", "is_numeric",
# #   "is_array", "is_dict", "member_type", "set_member"
# 
# use compiler.core.ast.{ast_reset}
# use compiler.core.interpreter.eval.{eval_init, eval_reset, eval_module, eval_has_error, eval_get_error}
# use compiler.core.interpreter.env.{env_init}
# use compiler.core.interpreter.value.{val_reset}
# use compiler.core.parser.{parse_module, parser_has_errors}
# 
# # Helper: parse and evaluate a code snippet, return error message or ""
# fn eval_code(code: text) -> text:
#     ast_reset()
#     val_reset()
#     env_init()
#     eval_reset()
#     parse_module(code, "traits_extended_test.spl")
#     if parser_has_errors():
#         return "PARSE_ERROR"
#     eval_module()
#     if eval_has_error():
#         return eval_get_error()
#     return ""
# 
# describe "@traits(\"methods\") query":
#     it "returns empty array for struct with no methods":
#         val code = "struct NoMethods:\n    x: i64\nval m = @traits(\"methods\", \"NoMethods\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns method names for struct with methods":
#         val code = "struct WithMethod:\n    x: i64\nfn WithMethod__get_x(self): self.x\nval m = @traits(\"methods\", \"WithMethod\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns empty for unknown type":
#         val code = "val m = @traits(\"methods\", \"UnknownType\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
# describe "@traits(\"all_members\") query":
#     it "returns fields + methods for struct":
#         val code = "struct Point:\n    x: i64\n    y: i64\nfn Point__get_x(self): self.x\nval all = @traits(\"all_members\", \"Point\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns empty for unknown type":
#         val code = "val all = @traits(\"all_members\", \"Ghost\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
# describe "@traits(\"enum_count\") query":
#     it "returns 0 for unknown enum":
#         val code = "val cnt = @traits(\"enum_count\", \"NotAnEnum\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns correct count for known enum":
#         val code = "enum Color:\n    Red\n    Green\n    Blue\nval cnt = @traits(\"enum_count\", \"Color\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns 1 for single-variant enum":
#         val code = "enum Solo:\n    Only\nval cnt = @traits(\"enum_count\", \"Solo\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
# describe "@traits(\"is_class\") query":
#     it "returns false for struct without methods":
#         val code = "struct Plain:\n    x: i64\nval ic = @traits(\"is_class\", \"Plain\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns true for struct with methods":
#         val code = "struct Classy:\n    x: i64\nfn Classy__do_thing(self): self.x\nval ic = @traits(\"is_class\", \"Classy\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns false for unknown type":
#         val code = "val ic = @traits(\"is_class\", \"Nowhere\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
# describe "@traits(\"is_fn\") query":
#     it "returns true for registered function":
#         val code = "fn my_func(): 42\nval ok = @traits(\"is_fn\", \"my_func\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns false for unknown function":
#         val code = "val ok = @traits(\"is_fn\", \"nonexistent_fn\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
# describe "@traits(\"is_integral\") query":
#     it "returns true for i64":
#         val code = "val r = @traits(\"is_integral\", \"i64\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns true for u32":
#         val code = "val r = @traits(\"is_integral\", \"u32\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns false for f64":
#         val code = "val r = @traits(\"is_integral\", \"f64\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns false for text":
#         val code = "val r = @traits(\"is_integral\", \"text\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
# describe "@traits(\"is_float\") query":
#     it "returns true for f64":
#         val code = "val r = @traits(\"is_float\", \"f64\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns true for f32":
#         val code = "val r = @traits(\"is_float\", \"f32\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns false for i64":
#         val code = "val r = @traits(\"is_float\", \"i64\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
# describe "@traits(\"is_numeric\") query":
#     it "returns true for i64":
#         val code = "val r = @traits(\"is_numeric\", \"i64\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns true for f64":
#         val code = "val r = @traits(\"is_numeric\", \"f64\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns false for text":
#         val code = "val r = @traits(\"is_numeric\", \"text\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
# describe "@traits(\"is_array\") query":
#     it "returns true for [i64]":
#         val code = "val r = @traits(\"is_array\", \"[i64]\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns true for [text]":
#         val code = "val r = @traits(\"is_array\", \"[text]\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns false for text":
#         val code = "val r = @traits(\"is_array\", \"text\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns false for empty string":
#         val code = "val r = @traits(\"is_array\", \"\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
# describe "@traits(\"is_dict\") query":
#     it "returns true for dict type":
#         val code = "val r = @traits(\"is_dict\", \"{text: i64}\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns false for text":
#         val code = "val r = @traits(\"is_dict\", \"text\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
# describe "@traits(\"member_type\") query":
#     it "returns empty string for unknown type":
#         val code = "val t = @traits(\"member_type\", \"Ghost\", \"x\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns type for known struct field":
#         val code = "struct Box:\n    value: i64\nval t = @traits(\"member_type\", \"Box\", \"value\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns empty string for unknown field":
#         val code = "struct Widget:\n    name: text\nval t = @traits(\"member_type\", \"Widget\", \"missing\")\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
# describe "@traits(\"set_member\") query":
#     it "sets a struct field by name":
#         val code = "struct Counter:\n    count: i64\nval c = Counter(count: 0)\n@traits(\"set_member\", c, \"count\", 42)\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
# 
#     it "returns nil on success":
#         val code = "struct Box:\n    value: i64\nval b = Box(value: 1)\nval r = @traits(\"set_member\", b, \"value\", 99)\n"
#         val err = eval_code(code)
#         expect(err).to_equal("")
