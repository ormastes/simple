# Test: Eager Yield-Based Generators (Phase 2)
#
# Functions containing `yield` collect all yielded values into an array,
# returned as the function result (eager generator semantics).

fn gen_simple():
    yield 1
    yield 2
    yield 3

fn gen_range(n: i64):
    var i = 0
    while i < n:
        yield i
        i = i + 1

fn gen_nested_inner():
    yield 10
    yield 20

fn gen_nested_outer():
    val inner = gen_nested_inner()
    yield 1
    yield 2

fn gen_with_return():
    yield 1
    yield 2
    return 42

fn gen_single():
    yield 99

fn gen_expr():
    yield 2 + 3
    yield 10 * 2

describe "Eager yield generators":
    it "collects yielded values into array":
        val result = gen_simple()
        result.len().should.to_equal(3)

    it "collects correct values":
        val result = gen_simple()
        result[0].should.to_equal(1)
        result[1].should.to_equal(2)
        result[2].should.to_equal(3)

    it "handles yield in while loop":
        val result = gen_range(4)
        result.len().should.to_equal(4)
        result[0].should.to_equal(0)
        result[3].should.to_equal(3)

    it "supports single yield":
        val result = gen_single()
        result.len().should.to_equal(1)
        result[0].should.to_equal(99)

    it "yields computed expressions":
        val result = gen_expr()
        result[0].should.to_equal(5)
        result[1].should.to_equal(20)

    it "supports nested generator calls":
        val result = gen_nested_outer()
        result.len().should.to_equal(2)
        result[0].should.to_equal(1)
        result[1].should.to_equal(2)

    it "explicit return overrides yield array":
        val result = gen_with_return()
        result.should.to_equal(42)
