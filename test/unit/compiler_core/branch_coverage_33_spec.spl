"""
# Branch Coverage Test Suite - Complex Method Arguments

**Feature IDs:** #BRANCH #METHOD_ARGS #SLICE
**Category:** Testing
**Status:** Implemented

## Overview

Tests string methods with complex nested arguments to cover
method parsing branches (lines 1093-1098, 1116-1120).
"""

use std.spec.{check}

describe "String Slice with Expressions":
    it "slice with arithmetic in bounds":
        val s = "hello world"
        val start = 1 + 1
        val end = 7 - 1
        val sub = s[start..end]
        check(sub.len() == 4)

    it "slice with function calls":
        val s = "abcdef"
        val len = s.len()
        val sub = s[0..(len - 1)]
        check(sub.len() == 5)

    it "slice with nested parens":
        val s = "test string"
        val sub = s[(0 + 1)..(4 + 1)]
        check(sub.len() == 4)

describe "Replace with Complex Args":
    it "replace with expressions":
        val s = "hello"
        val old = "l"
        val new = "L"
        val r = s.replace(old, new)
        check(r.contains("L"))

    it "replace with method results":
        val s = "test"
        val pattern = "t"
        val r = s.replace(pattern, "X")
        check(r.contains("X"))

describe "Method Calls with Array Access":
    it "array index in slice":
        val s = "abcdefgh"
        val bounds = [0, 3, 6]
        val sub = s[bounds[0]..bounds[1]]
        check(sub.len() == 3)

    it "array element in method":
        val strings = ["a", "b", "c"]
        val combined = "abc"
        check(combined.contains(strings[0]))

describe "Nested Method Calls":
    it "method on method result":
        val s = "  test  "
        val trimmed = s.trim()
        val upper = trimmed
        check(upper.len() == 4)

    it "multiple operations":
        val s = "hello world"
        val len = s.len()
        check(len > 0)

describe "Complex Expressions in Arguments":
    it "boolean expression arg":
        val s = "test"
        val b = s.len() > 0
        check(b)

    it "comparison in arg":
        val s1 = "abc"
        val s2 = "xyz"
        check(s1 != s2)

    it "arithmetic in string method":
        val s = "0123456789"
        val mid = 5
        val sub = s[(mid - 2)..(mid + 2)]
        check(sub.len() == 4)

describe "Method Depth Tracking":
    it "deeply nested parens":
        val x = ((1 + 2) * (3 + 4))
        check(x == 21)

    it "mixed brackets and parens":
        val arr = [1, 2, 3]
        val idx = (1 + 0)
        val val = arr[idx]
        check(val == 2)

    it "nested function calls":
        fn add(a: i64, b: i64) -> i64:
            a + b
        fn mul(a: i64, b: i64) -> i64:
            a * b
        val result = add(mul(2, 3), mul(4, 5))
        check(result == 26)

describe "String Index Operations":
    it "index_of with expression":
        val s = "hello world"
        val pattern = "o"
        val idx = s.index_of(pattern)
        check(idx >= 0)

    it "last_index_of":
        val s = "hello world"
        val idx = s.last_index_of("l")
        check(idx > 0)
