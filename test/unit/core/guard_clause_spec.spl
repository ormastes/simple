# Guard Clause Tests
#
# Tests match arm guard clauses: case X if cond: body
# Uses expression-style match (val result = match...) to avoid nested closure issues.

describe "guard clauses":
    describe "basic guard evaluation":
        it "guard true: matches arm":
            val x = 5
            val result = match x:
                case 5 if x > 3: "big_five"
                case 5: "five"
                case _: "other"
            expect(result).to_equal("big_five")

        it "guard false: falls to next arm":
            val x = 5
            val result = match x:
                case 5 if x > 10: "big_five"
                case 5: "five"
                case _: "other"
            expect(result).to_equal("five")

        it "guard with string match":
            val s = "hello"
            val result = match s:
                case "hello" if s.len() > 3: "long_hello"
                case "hello": "hello"
                case _: "other"
            expect(result).to_equal("long_hello")

        it "guard with equality check":
            val n = 42
            val result = match n:
                case 42 if n == 42: "perfect"
                case 42: "forty_two"
                case _: "other"
            expect(result).to_equal("perfect")

    describe "guard with multiple arms":
        it "multiple guards evaluated in order":
            val x = 7
            val result = match x:
                case 7 if x > 10: "large"
                case 7 if x > 5: "medium"
                case 7: "small"
                case _: "other"
            expect(result).to_equal("medium")

        it "wildcard with guard":
            val x = 99
            val result = match x:
                case 5: "five"
                case _ if x > 50: "large"
                case _: "other"
            expect(result).to_equal("large")
