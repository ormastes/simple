"""
# Branch Coverage Test Suite - Complex String Operations

**Feature IDs:** #BRANCH #STRING_COMPLEX #INTERPOLATION
**Category:** Testing
**Status:** Implemented

## Overview

Tests complex string interpolation, nested braces, and multi-part
string operations to cover translate_expr branches (lines 678, 720, 757-765).
"""

use std.spec.{check}
use std.string.{NL}

describe "Complex String Interpolation":
    it "multiple interpolations":
        val x = 5
        val y = 10
        val z = 15
        val s = "{x} + {y} + {z}"
        check(s.contains("5"))
        check(s.contains("10"))
        check(s.contains("15"))

    it "interpolation with expressions":
        val a = 3
        val b = 4
        val result = "{a * b}"
        check(result.contains("12"))

    it "nested expression interpolation":
        val x = 2
        val y = 3
        val complex = "{x * (y + 1)}"
        check(complex.contains("8"))

    it "interpolation with method calls":
        val s = "hello"
        val msg = "Length is {s.len()}"
        check(msg.contains("5"))

describe "String Concatenation Chains":
    it "multiple concat":
        val s1 = "a" + "b" + "c"
        check(s1 == "abc")

    it "long concat chain":
        val s2 = "a" + "b" + "c" + "d" + "e"
        check(s2 == "abcde")

    it "concat with variables":
        val x = "hello"
        val y = "world"
        val z = x + " " + y
        check(z == "hello world")

    it "concat in expression":
        val a = "test"
        val b = ("x" + "y") + ("z")
        check(b == "xyz")

describe "String Method Chains":
    it "trim and operations":
        val s = "  hello  "
        val clean = s.trim()
        check(clean == "hello")

    it "multiple replacements":
        val text = "abc"
        val r1 = text.replace("a", "x")
        val r2 = r1.replace("b", "y")
        check(r2 == "xyc")

    it "slice operations":
        val s = "abcdefgh"
        val sub = s[2..5]
        check(sub.len() == 3)

describe "String Edge Cases":
    it "empty interpolation":
        val s = "{0}"
        check(s.contains("0"))

    it "consecutive interpolations":
        val x = 1
        val y = 2
        val s = "{x}{y}"
        check(s.contains("1"))
        check(s.contains("2"))

    it "interpolation at start":
        val x = 5
        val s = "{x} is the value"
        check(s.starts_with("5"))

    it "interpolation at end":
        val x = 5
        val s = "Value is {x}"
        check(s.ends_with("5"))

describe "Special String Cases":
    it "multiline string":
        val s = """line1
line2"""
        check(s.contains("line1"))
        check(s.contains("line2"))

    it "raw string":
        val r = r"no {interpolation}"
        check(r.contains("{"))

    it "escaped characters":
        val e = "line1{NL}line2"
        check(e.contains(NL))

    it "string with quotes":
        val q = "He said \"hello\""
        check(q.contains("\""))
