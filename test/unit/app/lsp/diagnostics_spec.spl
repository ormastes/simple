# LSP Diagnostics Tests
# Feature: Language Server Protocol Diagnostics
# Category: LSP, Error Reporting
# Status: Complete
#
# Unit tests for LSP diagnostic types including Position, Range,
# DiagnosticSeverity, and Diagnostic message construction.

# Local type definitions (test stubs)

class Position:
    line: i64
    character: i64

impl Position:
    static fn new(line: i64, character: i64) -> Position:
        Position(line: line, character: character)

class Range:
    start: Position
    end: Position

impl Range:
    static fn new(start: Position, end: Position) -> Range:
        Range(start: start, end: end)

enum DiagnosticSeverity:
    Error = 1
    Warning = 2
    Information = 3
    Hint = 4

class Diagnostic:
    range: Range
    severity: DiagnosticSeverity
    message: str
    source: Option<str>

impl Diagnostic:
    static fn new(range: Range, severity: DiagnosticSeverity, message: str) -> Diagnostic:
        Diagnostic(range: range, severity: severity, message: message, source: nil)

    fn with_source(src: str) -> Diagnostic:
        Diagnostic(range: self.range, severity: self.severity, message: self.message, source: Some(src))

enum CompletionItemKind:
    Text = 1
    Method = 2
    Function = 3
    Variable = 6
    Keyword = 14
    Struct = 22

struct CompletionItem:
    label: str
    kind: i64
    detail: Option<str>
    documentation: Option<str>
    insert_text: Option<str>



describe "Position":
    # Tests for LSP Position type (line and character offsets).
    it "creates position with line and character":
        val pos = Position.new(10, 5)
        expect pos.line == 10
        expect pos.character == 5

    it "starts at zero":
        val pos = Position.new(0, 0)
        expect pos.line == 0
        expect pos.character == 0

describe "Range":
    it "creates range from positions":
        val start = Position.new(0, 0)
        val end = Position.new(0, 10)
        val range = Range.new(start, end)
        expect range.start.line == 0
        expect range.end.character == 10

    it "supports multi-line ranges":
        val start = Position.new(5, 0)
        val end = Position.new(10, 20)
        val range = Range.new(start, end)
        expect range.start.line == 5
        expect range.end.line == 10

describe "DiagnosticSeverity":
    it "has Error severity":
        expect DiagnosticSeverity.Error == DiagnosticSeverity.Error

    it "has Warning severity":
        expect DiagnosticSeverity.Warning == DiagnosticSeverity.Warning

    it "has Information severity":
        expect DiagnosticSeverity.Information == DiagnosticSeverity.Information

    it "has Hint severity":
        expect DiagnosticSeverity.Hint == DiagnosticSeverity.Hint

describe "Diagnostic":
    it "creates diagnostic with range and message":
        val range = Range.new(Position.new(0, 0), Position.new(0, 5))
        val diag = Diagnostic.new(range, DiagnosticSeverity.Error, "Syntax error")
        expect diag.message == "Syntax error"
        expect diag.severity == DiagnosticSeverity.Error

    it "adds source":
        val range = Range.new(Position.new(0, 0), Position.new(0, 5))
        val diag = Diagnostic.new(range, DiagnosticSeverity.Warning, "Unused variable")
            .with_source("simple-lint")
        expect diag.source != nil
