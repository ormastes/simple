# LSP Completion Handler Tests
# Feature: Language Server Protocol Completion
# Category: LSP, Editor Integration
# Status: Complete
#
# Unit tests for LSP completion handler including CompletionItemKind
# enum values and CompletionItem builder pattern.

# Local type definitions (test stubs)

struct Position:
    line: i64
    character: i64

struct Range:
    start: Position
    end: Position

enum DiagnosticSeverity:
    Error
    Warning
    Information
    Hint

struct Diagnostic:
    range: Range
    severity: DiagnosticSeverity
    message: str
    source: str

enum CompletionItemKind:
    Text = 1
    Method = 2
    Function = 3
    Variable = 6
    Keyword = 14
    Struct = 22
    Snippet = 25

class CompletionItem:
    label: str
    kind: CompletionItemKind
    detail: Option<str>
    documentation: Option<str>
    insert_text: Option<str>

impl CompletionItem:
    static fn new(label: str, kind: CompletionItemKind) -> CompletionItem:
        CompletionItem(label: label, kind: kind, detail: nil, documentation: nil, insert_text: nil)

    fn with_detail(detail: str) -> CompletionItem:
        CompletionItem(label: self.label, kind: self.kind, detail: Some(detail), documentation: self.documentation, insert_text: self.insert_text)

    fn with_documentation(documentation: str) -> CompletionItem:
        CompletionItem(label: self.label, kind: self.kind, detail: self.detail, documentation: Some(documentation), insert_text: self.insert_text)

    fn with_insert_text(insert_text: str) -> CompletionItem:
        CompletionItem(label: self.label, kind: self.kind, detail: self.detail, documentation: self.documentation, insert_text: Some(insert_text))



describe "CompletionItemKind":
    # Tests for LSP completion item kind enum values.
    it "has Text kind":
        expect CompletionItemKind.Text == 1

    it "has Method kind":
        expect CompletionItemKind.Method == 2

    it "has Function kind":
        expect CompletionItemKind.Function == 3

    it "has Variable kind":
        expect CompletionItemKind.Variable == 6

    it "has Keyword kind":
        expect CompletionItemKind.Keyword == 14

    it "has Struct kind":
        expect CompletionItemKind.Struct == 22

describe "CompletionItem":
    it "creates item with label and kind":
        val item = CompletionItem.new("test", CompletionItemKind.Variable)
        expect item.label == "test"
        expect item.kind == CompletionItemKind.Variable

    it "adds detail":
        val item = CompletionItem.new("fn", CompletionItemKind.Keyword)
            .with_detail("Function keyword")
        expect item.detail == Some("Function keyword")

    it "adds documentation":
        val item = CompletionItem.new("fn", CompletionItemKind.Keyword)
            .with_documentation("Define a function")
        expect item.documentation == Some("Define a function")

    it "adds insert text":
        val item = CompletionItem.new("fn", CompletionItemKind.Snippet)
            .with_insert_text("fn ${1:name}():\n    ${0}")
        expect item.insert_text != nil

    it "chains builder methods":
        val item = CompletionItem.new("struct", CompletionItemKind.Keyword)
            .with_detail("Define a struct")
            .with_documentation("Struct definitions create custom types")
        expect item.detail != nil
        expect item.documentation != nil
