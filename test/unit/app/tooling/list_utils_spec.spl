"""
Feature: List Utilities
Category: Standard Library / Tooling
Status: Complete

Comprehensive list manipulation utilities including reverse, chunk, rotate,
deduplicate, flatten, and other common list operations.
"""

use std.array.{
    array_reverse, array_take, array_drop,
    array_chunk, array_windows,
    array_interleave, array_flatten, array_intersperse,
    array_rotate_left, array_rotate_right,
    array_dedup, array_dedup_all,
    array_is_sorted, array_equals
}

# =====================================
# BDD Tests
# =====================================

describe "List Utilities":
    """
    Tests for list manipulation utilities covering reversing, chunking,
    rotation, deduplication, flattening, and other sequence operations.
    """

    describe "Reverse":
        """Test list reversal operations"""
        it "reverses list":
            expect array_equals(array_reverse([1, 2, 3, 4]), [4, 3, 2, 1])

        it "handles single element":
            expect array_equals(array_reverse([1]), [1])

        it "handles empty list":
            val empty: [i64] = []
            expect array_reverse(empty).len() == 0

    describe "Chunk":
        """Test list chunking/partitioning operations"""
        it "chunks list into parts":
            val chunks_list = array_chunk([1, 2, 3, 4, 5], 2)
            expect chunks_list.len() == 3

        it "handles exact fit":
            val chunks_list = array_chunk([1, 2, 3, 4], 2)
            expect chunks_list.len() == 2

        it "handles size larger than list":
            val chunks_list = array_chunk([1, 2], 5)
            expect chunks_list.len() == 1

    describe "Interleave":
        """Test list interleaving operations"""
        it "interleaves equal length lists":
            val result = array_interleave([1, 2, 3], [4, 5, 6])
            expect array_equals(result, [1, 4, 2, 5, 3, 6])

        it "handles different lengths":
            val result = array_interleave([1, 2], [3, 4, 5, 6])
            expect result.len() == 6

    describe "Rotation":
        """Test list rotation operations (left and right)"""
        it "rotates left":
            expect array_equals(array_rotate_left([1, 2, 3, 4, 5], 2), [3, 4, 5, 1, 2])

        it "rotates left by zero":
            expect array_equals(array_rotate_left([1, 2, 3], 0), [1, 2, 3])

        it "rotates right":
            expect array_equals(array_rotate_right([1, 2, 3, 4, 5], 2), [4, 5, 1, 2, 3])

    describe "Deduplication":
        """Test deduplication operations for removing duplicate elements"""
        it "removes consecutive duplicates":
            expect array_equals(array_dedup([1, 1, 2, 2, 3, 3]), [1, 2, 3])

        it "keeps non-consecutive duplicates":
            expect array_equals(array_dedup([1, 2, 1, 2]), [1, 2, 1, 2])

        it "dedup_all removes all duplicates":
            expect array_equals(array_dedup_all([1, 2, 1, 3, 2]), [1, 2, 3])

    describe "Flatten":
        """Test flattening nested list structures"""
        it "flattens nested lists":
            val nested = [[1, 2], [3, 4], [5]]
            expect array_equals(array_flatten(nested), [1, 2, 3, 4, 5])

        it "handles empty nested list":
            val empty: [[i64]] = []
            expect array_flatten(empty).len() == 0

    describe "Windows":
        """Test sliding window operations on lists"""
        it "creates sliding windows":
            val wins = array_windows([1, 2, 3, 4], 2)
            expect wins.len() == 3

        it "handles size too large":
            val wins = array_windows([1, 2], 5)
            expect wins.len() == 0

    describe "Intersperse":
        """Test interspersing separator elements between list items"""
        it "inserts separator between elements":
            expect array_equals(array_intersperse([1, 2, 3], 0), [1, 0, 2, 0, 3])

        it "handles single element":
            expect array_equals(array_intersperse([1], 0), [1])

    describe "Slicing":
        """Test take and drop operations for list slicing"""
        it "take gets first n elements":
            expect array_equals(array_take([1, 2, 3, 4, 5], 3), [1, 2, 3])

        it "take handles oversized n":
            expect array_equals(array_take([1, 2], 5), [1, 2])

        it "drop removes first n elements":
            expect array_equals(array_drop([1, 2, 3, 4, 5], 2), [3, 4, 5])

        it "drop handles oversized n":
            val dropped = array_drop([1, 2], 5)
            expect dropped.len() == 0

    describe "Comparison":
        """Test list equality checking"""
        it "list_equals returns true for equal":
            expect array_equals([1, 2, 3], [1, 2, 3])

        it "list_equals returns false for different":
            expect not array_equals([1, 2], [1, 2, 3])
            expect not array_equals([1, 2, 3], [1, 3, 2])

    describe "Sorting Check":
        """Test detection of sorted sequences"""
        it "is_sorted detects sorted":
            expect array_is_sorted([1, 2, 3, 4])

        it "is_sorted detects unsorted":
            expect not array_is_sorted([1, 3, 2, 4])

        it "is_sorted handles empty":
            val empty: [i64] = []
            expect array_is_sorted(empty)

        it "is_sorted handles single element":
            expect array_is_sorted([1])
