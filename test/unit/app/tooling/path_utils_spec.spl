"""
Path Utilities Tests

Tests for file path manipulation including extraction, joining, normalization,
and conversion between absolute and relative paths.

Feature:
  File path manipulation and utilities

Category:
  Tooling/File System

Status:
  Complete
"""

use std.path.{
    get_filename, get_dir_name, get_parent_dir, get_parent_dir_option,
    join_path, get_extension, get_stem, has_extension,
    normalize_path, is_absolute_path, make_relative, split_path
}

describe "Path Utilities":
    """
    Comprehensive tests for path utility functions covering filename extraction,
    directory operations, path joining, normalization, and cross-platform support.
    """

    describe "Filename Extraction":
        it "extracts filename from unix path":
            expect get_filename("/home/user/file.txt") == "file.txt"
            expect get_filename("/home/user/") == ""
            expect get_filename("file.txt") == "file.txt"

        it "extracts filename from windows path":
            expect get_filename("C:\\Users\\user\\file.txt") == "file.txt"
            expect get_filename("C:\\Program Files\\app.exe") == "app.exe"

        it "handles edge cases":
            expect get_filename("") == ""
            expect get_filename("/") == ""
            expect get_filename("simple_file") == "simple_file"

    describe "Directory Name":
        it "gets directory name":
            expect get_dir_name("/home/user/documents") == "documents"
            expect get_dir_name("/home/user/documents/") == "documents"

    describe "Parent Directory":
        it "gets parent dir unix":
            expect get_parent_dir("/home/user/file.txt") == "/home/user"
            expect get_parent_dir("/home/user/") == "/home"
            expect get_parent_dir("/home") == "/"

        it "returns option for parent":
            val result = get_parent_dir_option("/home/user/file.txt")
            expect result == "/home/user"

        it "returns nil for no parent":
            val result = get_parent_dir_option("file.txt")
            expect result == nil

    describe "Path Joining":
        it "joins unix paths":
            expect join_path("/home/user", "file.txt") == "/home/user/file.txt"
            expect join_path("/home/user/", "file.txt") == "/home/user/file.txt"

        it "handles edge cases":
            expect join_path("", "file.txt") == "file.txt"
            expect join_path("/home", "") == "/home"
            expect join_path("", "") == ""

    describe "Extension":
        it "gets extension":
            expect get_extension("file.txt") == "txt"
            expect get_extension("archive.tar.gz") == "gz"
            expect get_extension("/path/to/file.json") == "json"

        it "returns empty for no extension":
            expect get_extension("README") == ""
            expect get_extension("/path/to/file") == ""
            expect get_extension("") == ""

        it "handles hidden files":
            expect get_extension(".gitignore") == ""
            expect get_extension(".config.yml") == "yml"

    describe "Stem":
        it "gets stem":
            expect get_stem("file.txt") == "file"
            expect get_stem("archive.tar.gz") == "archive.tar"
            expect get_stem("/path/to/document.pdf") == "document"

        it "handles no extension":
            expect get_stem("README") == "README"
            expect get_stem("Makefile") == "Makefile"

    describe "Has Extension":
        it "checks extension":
            expect has_extension("file.txt", "txt")
            expect has_extension("file.txt", ".txt")
            expect has_extension("archive.TAR", "tar")

        it "returns false for wrong extension":
            expect not has_extension("file.txt", "pdf")
            expect not has_extension("README", "txt")

    describe "Path Normalization":
        it "normalizes backslashes":
            expect normalize_path("C:\\Users\\user\\file.txt") == "C:/Users/user/file.txt"
            expect normalize_path("/home/user/file.txt") == "/home/user/file.txt"
            expect normalize_path("path\\to\\file") == "path/to/file"

    describe "Absolute Path":
        it "detects unix absolute paths":
            expect is_absolute_path("/home/user/file.txt")
            expect is_absolute_path("/")
            expect not is_absolute_path("relative/path")

        it "detects windows absolute paths":
            expect is_absolute_path("C:\\Users\\user\\file.txt")
            expect is_absolute_path("D:/data/file.dat")
            expect not is_absolute_path("relative\\path")

        it "handles edge cases":
            expect not is_absolute_path("")
            expect not is_absolute_path("file.txt")

    describe "Make Relative":
        it "makes path relative":
            expect make_relative("/home/user/docs/file.txt", "/home/user") == "docs/file.txt"
            expect make_relative("/home/user/file.txt", "/home/user") == "file.txt"

        it "returns original for no common prefix":
            val result = make_relative("/var/log/file.txt", "/home/user")
            expect result == "/var/log/file.txt"

    describe "Split Path":
        it "splits unix path":
            val parts = split_path("/home/user/documents/file.txt")
            expect parts.len() == 4
            expect parts[0] == "home"
            expect parts[1] == "user"
            expect parts[2] == "documents"
            expect parts[3] == "file.txt"

        it "splits relative path":
            val parts = split_path("docs/file.txt")
            expect parts.len() == 2
            expect parts[0] == "docs"
            expect parts[1] == "file.txt"

        it "handles empty path":
            val parts = split_path("")
            expect parts.len() == 0

    describe "Complex Scenarios":
        it "manipulates complex path":
            val path = "/home/user/projects/simple/src/main.spl"
            expect get_filename(path) == "main.spl"
            expect get_extension(path) == "spl"
            expect get_stem(path) == "main"
            expect get_parent_dir(path) == "/home/user/projects/simple/src"

        it "builds path from components":
            val base = "/home/user"
            val subdir = "projects"
            val filename = "main.spl"
            val step1 = join_path(base, subdir)
            val final_path = join_path(step1, filename)
            expect final_path == "/home/user/projects/main.spl"

        it "converts relative path":
            val absolute = "/home/user/projects/simple/src/main.spl"
            val base = "/home/user/projects"
            val relative = make_relative(absolute, base)
            expect relative == "simple/src/main.spl"
            val parts = split_path(relative)
            expect parts.len() == 3
