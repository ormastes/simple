"""
Feature: Data Structure Utilities
Category: Tooling
Status: Complete

Unit tests for data structures including Stack, Queue, and Deque
with operations like push, pop, enqueue, dequeue, and various helper functions.
"""

use std.ds_utils.{
    Stack, Queue, Deque,
    stack_from_list, queue_from_list, deque_from_list,
    stack_get, queue_get, reverse_stack, merge_queues
}

# =====================================
# BDD Tests
# =====================================

describe "Data Structure Utilities":
    """Tests for Stack, Queue, and Deque generic data structures."""

    describe "Stack":
        it "creates empty stack":
            val stack: Stack = Stack.create()
            expect stack.is_empty()
            expect stack.size() == 0

        it "pushes items":
            var stack: Stack = Stack.create()
            stack.push(1)
            stack.push(2)
            stack.push(3)
            expect stack.size() == 3
            expect not stack.is_empty()

        it "pops items in LIFO order":
            var stack: Stack = Stack.create()
            stack.push(1)
            stack.push(2)
            stack.push(3)
            val result1 = stack.pop()
            expect result1 == 3
            val result2 = stack.pop()
            expect result2 == 2
            expect stack.size() == 1

        it "returns nil when popping empty stack":
            var stack: Stack = Stack.create()
            val result = stack.pop()
            expect result == nil

        it "peeks without removing":
            var stack: Stack = Stack.create()
            stack.push(1)
            stack.push(2)
            val result = stack.peek()
            expect result == 2
            expect stack.size() == 2

        it "clears all items":
            var stack: Stack = Stack.create()
            stack.push(1)
            stack.push(2)
            stack.clear()
            expect stack.is_empty()
            expect stack.size() == 0

        it "converts to list":
            var stack: Stack = Stack.create()
            stack.push(1)
            stack.push(2)
            stack.push(3)
            val list = stack.to_list()
            expect list.len() == 3
            expect list[0] == 1
            expect list[2] == 3

    describe "Queue":
        it "creates empty queue":
            val queue: Queue = Queue.create()
            expect queue.is_empty()
            expect queue.size() == 0

        it "enqueues items":
            var queue: Queue = Queue.create()
            queue.enqueue(1)
            queue.enqueue(2)
            queue.enqueue(3)
            expect queue.size() == 3
            expect not queue.is_empty()

        it "dequeues items in FIFO order":
            var queue: Queue = Queue.create()
            queue.enqueue(1)
            queue.enqueue(2)
            queue.enqueue(3)
            val result1 = queue.dequeue()
            expect result1 == 1
            val result2 = queue.dequeue()
            expect result2 == 2
            expect queue.size() == 1

        it "returns nil when dequeuing empty queue":
            var queue: Queue = Queue.create()
            val result = queue.dequeue()
            expect result == nil

        it "peeks without removing":
            var queue: Queue = Queue.create()
            queue.enqueue(1)
            queue.enqueue(2)
            val result = queue.peek()
            expect result == 1
            expect queue.size() == 2

        it "clears all items":
            var queue: Queue = Queue.create()
            queue.enqueue(1)
            queue.enqueue(2)
            queue.clear()
            expect queue.is_empty()
            expect queue.size() == 0

    describe "Deque":
        it "creates empty deque":
            val deque: Deque = Deque.create()
            expect deque.is_empty()
            expect deque.size() == 0

        it "pushes to front":
            var deque: Deque = Deque.create()
            deque.push_front(1)
            deque.push_front(2)
            deque.push_front(3)
            expect deque.size() == 3
            val result = deque.peek_front()
            expect result == 3

        it "pushes to back":
            var deque: Deque = Deque.create()
            deque.push_back(1)
            deque.push_back(2)
            deque.push_back(3)
            expect deque.size() == 3
            val result = deque.peek_back()
            expect result == 3

        it "pops from front":
            var deque: Deque = Deque.create()
            deque.push_back(1)
            deque.push_back(2)
            deque.push_back(3)
            val result = deque.pop_front()
            expect result == 1
            expect deque.size() == 2

        it "pops from back":
            var deque: Deque = Deque.create()
            deque.push_back(1)
            deque.push_back(2)
            deque.push_back(3)
            val result = deque.pop_back()
            expect result == 3
            expect deque.size() == 2

        it "returns nil when popping empty deque":
            var deque: Deque = Deque.create()
            val result = deque.pop_front()
            expect result == nil
            val result = deque.pop_back()
            expect result == nil

        it "clears all items":
            var deque: Deque = Deque.create()
            deque.push_back(1)
            deque.push_back(2)
            deque.clear()
            expect deque.is_empty()

    describe "Helper Functions":
        it "creates stack from list":
            val stack = stack_from_list([1, 2, 3])
            expect stack.size() == 3
            val result = stack.peek()
            expect result == 3

        it "creates queue from list":
            val queue = queue_from_list([1, 2, 3])
            expect queue.size() == 3
            val result = queue.peek()
            expect result == 1

        it "creates deque from list":
            val deque = deque_from_list([1, 2, 3])
            expect deque.size() == 3

        it "gets element from stack by index":
            val stack = stack_from_list([1, 2, 3])
            val result = stack_get(stack, 0)
            expect result == 3
            val result = stack_get(stack, 2)
            expect result == 1

        it "returns nil for out of bounds stack access":
            val stack = stack_from_list([1, 2, 3])
            val result = stack_get(stack, 10)
            expect result == nil

        it "gets element from queue by index":
            val queue = queue_from_list([1, 2, 3])
            val result = queue_get(queue, 0)
            expect result == 1
            val result = queue_get(queue, 2)
            expect result == 3

        it "returns nil for out of bounds queue access":
            val queue = queue_from_list([1, 2, 3])
            val result = queue_get(queue, 10)
            expect result == nil

        it "reverses stack":
            val stack = stack_from_list([1, 2, 3])
            val reversed = reverse_stack(stack)
            val result = reversed.peek()
            expect result == 1

        it "merges queues":
            val q1 = queue_from_list([1, 2])
            val q2 = queue_from_list([3, 4])
            val merged = merge_queues(q1=q1, q2=q2)
            expect merged.size() == 4

    describe "Complex Scenarios":
        it "handles multiple stack operations":
            var stack: Stack = Stack.create()
            stack.push(1)
            stack.push(2)
            stack.pop()
            stack.push(3)
            stack.push(4)
            expect stack.size() == 3
            val result = stack.pop()
            expect result == 4

        it "handles multiple queue operations":
            var queue: Queue = Queue.create()
            queue.enqueue(1)
            queue.enqueue(2)
            queue.dequeue()
            queue.enqueue(3)
            queue.enqueue(4)
            expect queue.size() == 3
            val result = queue.dequeue()
            expect result == 2

        it "handles mixed deque operations":
            var deque: Deque = Deque.create()
            deque.push_back(1)
            deque.push_front(2)
            deque.push_back(3)
            deque.pop_front()
            expect deque.size() == 2
