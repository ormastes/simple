"""
# MCP Elicitation Support Specification

**Feature ID:** #MCP-068
**Category:** Tooling
**Difficulty:** 4/5
**Status:** Complete

## Overview

The MCP server can request structured user input from the client via
`elicitation/create`. This enables servers to gather information
directly from users through the client's UI.

### Key Concepts

| Concept | Description |
|---------|-------------|
| elicitation/create | Server-to-client request for user input |
| message | Human-readable explanation of what's needed |
| requestedSchema | JSON Schema for expected input format |
| accept | User submitted data |
| decline | User explicitly rejected |
| cancel | User dismissed without choosing |

## Behavior

- Server sends `elicitation/create` with message and requestedSchema
- Schema supports: string, number, integer, boolean, enum
- Client presents form to user and returns response
- Response action is one of: accept, decline, cancel
- Accept response includes content matching the schema
- Schema limited to flat objects with primitive properties

## Implementation Notes

The create_elicitation helper builds the JSON-RPC request with the
message and schema. The response is parsed to extract action and content.
"""


# ============================================================================
# Test Group 1: Elicitation Request
# ============================================================================

describe "MCP Elicitation Create":
    """
    ## Request Structure

    Tests the elicitation/create request format.
    """

    context "when building elicitation request":
        """
        ### Scenario: Request Fields

        The request includes a message and requestedSchema.
        """

        it "uses correct method":
            val method = "elicitation/create"
            expect(method).to_equal("elicitation/create")

        it "includes message":
            val message = "Please enter your API key"
            expect(message.len() > 0).to_equal(true)

        it "includes requestedSchema":
            val has_schema = true
            expect(has_schema).to_equal(true)

        it "is a request (has id)":
            val has_id = true
            expect(has_id).to_equal(true)

# ============================================================================
# Test Group 2: Schema Types
# ============================================================================

describe "MCP Elicitation Schema Types":
    """
    ## Supported Schema Types

    Tests the schema types supported in elicitation requests.
    """

    context "when using string schema":
        """
        ### Scenario: String Input

        Schema can request string input with optional format constraints.
        """

        it "supports basic string":
            val type = "string"
            expect(type).to_equal("string")

        it "supports email format":
            val format = "email"
            expect(format).to_equal("email")

        it "supports uri format":
            val format = "uri"
            expect(format).to_equal("uri")

        it "supports minLength/maxLength":
            val min_length = 1
            val max_length = 255
            expect(min_length < max_length).to_equal(true)

    context "when using numeric schema":
        """
        ### Scenario: Numeric Input

        Schema can request number or integer input.
        """

        it "supports number type":
            val type = "number"
            expect(type).to_equal("number")

        it "supports integer type":
            val type = "integer"
            expect(type).to_equal("integer")

        it "supports minimum/maximum":
            val minimum = 0
            val maximum = 100
            expect(minimum < maximum).to_equal(true)

    context "when using boolean schema":
        """
        ### Scenario: Boolean Input

        Schema can request boolean input.
        """

        it "supports boolean type":
            val type = "boolean"
            expect(type).to_equal("boolean")

        it "supports default value":
            val has_default = true
            expect(has_default).to_equal(true)

    context "when using enum schema":
        """
        ### Scenario: Dropdown Selection

        Schema can request selection from enum values.
        """

        it "supports string enum":
            val values = ["option1", "option2", "option3"]
            expect(values.len()).to_equal(3)

        it "supports enumNames for display":
            val names = ["Option 1", "Option 2", "Option 3"]
            expect(names.len()).to_equal(3)

# ============================================================================
# Test Group 3: Elicitation Response
# ============================================================================

describe "MCP Elicitation Response":
    """
    ## Response Actions

    Tests the three-action response model.
    """

    context "when user accepts":
        """
        ### Scenario: Accept Action

        User submitted data matching the schema.
        """

        it "action is accept":
            val action = "accept"
            expect(action).to_equal("accept")

        it "includes content":
            val has_content = true
            expect(has_content).to_equal(true)

    context "when user declines":
        """
        ### Scenario: Decline Action

        User explicitly rejected the request.
        """

        it "action is decline":
            val action = "decline"
            expect(action).to_equal("decline")

    context "when user cancels":
        """
        ### Scenario: Cancel Action

        User dismissed without making a choice.
        """

        it "action is cancel":
            val action = "cancel"
            expect(action).to_equal("cancel")
