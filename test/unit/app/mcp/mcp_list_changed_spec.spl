# MCP List Changed Notifications Specification
# Feature: MCP List Changed Notifications
# Category: MCP, Protocol
# Status: Complete

use std.spec
use app.mcp.helpers.{make_tools_list_changed, make_resources_list_changed, make_prompts_list_changed, make_notification_no_params}

describe "MCP Tools List Changed":
    context "when tools list changes":
        it "sends correct method":
            val notif = make_tools_list_changed()
            expect(notif.contains("notifications/tools/list_changed")).to_equal(true)

        it "is a notification (no id)":
            val notif = make_tools_list_changed()
            expect(notif.contains("\"id\"")).to_equal(false)

        it "includes jsonrpc version":
            val notif = make_tools_list_changed()
            expect(notif.contains("\"jsonrpc\":\"2.0\"")).to_equal(true)

describe "MCP Resources List Changed":
    context "when resources list changes":
        it "sends correct method":
            val notif = make_resources_list_changed()
            expect(notif.contains("notifications/resources/list_changed")).to_equal(true)

        it "is a notification (no id)":
            val notif = make_resources_list_changed()
            expect(notif.contains("\"id\"")).to_equal(false)

        it "includes jsonrpc version":
            val notif = make_resources_list_changed()
            expect(notif.contains("\"jsonrpc\":\"2.0\"")).to_equal(true)

describe "MCP Prompts List Changed":
    context "when prompts list changes":
        it "sends correct method":
            val notif = make_prompts_list_changed()
            expect(notif.contains("notifications/prompts/list_changed")).to_equal(true)

        it "is a notification (no id)":
            val notif = make_prompts_list_changed()
            expect(notif.contains("\"id\"")).to_equal(false)

        it "includes jsonrpc version":
            val notif = make_prompts_list_changed()
            expect(notif.contains("\"jsonrpc\":\"2.0\"")).to_equal(true)

describe "MCP List Changed Capabilities":
    context "when validating notification format":
        it "tools notification has method field":
            val notif = make_tools_list_changed()
            expect(notif.contains("\"method\":")).to_equal(true)

        it "resources notification has method field":
            val notif = make_resources_list_changed()
            expect(notif.contains("\"method\":")).to_equal(true)

        it "prompts notification has method field":
            val notif = make_prompts_list_changed()
            expect(notif.contains("\"method\":")).to_equal(true)

        it "generic notification_no_params works":
            val notif = make_notification_no_params("custom/method")
            expect(notif.contains("custom/method")).to_equal(true)
            expect(notif.contains("\"jsonrpc\":\"2.0\"")).to_equal(true)
