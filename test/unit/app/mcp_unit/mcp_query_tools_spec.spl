# MCP Query Tools (Tier 2) Specification
#
# **Feature IDs:** #MCP-QUERY-001
# **Category:** Tooling
# **Difficulty:** 2/5
# **Status:** Implemented
#
# ## Overview
#
# Tests the 5 Tier 2 MCP query tool handlers:
# simple_definition, simple_references, simple_hover, simple_completions, simple_type_at
#
# ## Behavior
#
# - Each tool delegates to bin/simple query CLI
# - Requires file and line parameters
# - Column parameter is optional

use std.spec

# ============================================================================
# Test Group 1: simple_definition tool
# ============================================================================

describe "simple_definition tool":
    it "requires file parameter":
        val file = ""
        val has_error = file == ""
        expect(has_error).to_equal(true)

    it "requires line parameter":
        val line = ""
        val has_error = line == ""
        expect(has_error).to_equal(true)

    it "builds definition command":
        val file = "src/app/cli/main.spl"
        val line = "42"
        var cmd = "timeout 30 bin/simple query definition " + file + " " + line
        cmd = cmd + " 2>&1"
        expect(cmd).to_contain("query definition")
        expect(cmd).to_contain(file)
        expect(cmd).to_contain(line)

    it "builds definition command with column":
        val file = "src/app/cli/main.spl"
        val line = "42"
        val column = "10"
        var cmd = "timeout 30 bin/simple query definition " + file + " " + line
        if column != "":
            cmd = cmd + " " + column
        expect(cmd).to_contain("42 10")

# ============================================================================
# Test Group 2: simple_references tool
# ============================================================================

describe "simple_references tool":
    it "builds references command":
        val file = "src/app/cli/main.spl"
        val line = "42"
        var cmd = "timeout 30 bin/simple query references " + file + " " + line
        cmd = cmd + " 2>&1"
        expect(cmd).to_contain("query references")

# ============================================================================
# Test Group 3: simple_hover tool
# ============================================================================

describe "simple_hover tool":
    it "builds hover command":
        val file = "src/app/cli/main.spl"
        val line = "42"
        var cmd = "timeout 30 bin/simple query hover " + file + " " + line
        cmd = cmd + " 2>&1"
        expect(cmd).to_contain("query hover")

# ============================================================================
# Test Group 4: simple_completions tool
# ============================================================================

describe "simple_completions tool":
    it "builds completions command":
        val file = "src/app/cli/main.spl"
        val line = "42"
        var cmd = "timeout 30 bin/simple query completions " + file + " " + line
        cmd = cmd + " 2>&1"
        expect(cmd).to_contain("query completions")

    it "builds completions command with prefix":
        val file = "src/app/cli/main.spl"
        val line = "42"
        val prefix = "cli_"
        var cmd = "timeout 30 bin/simple query completions " + file + " " + line
        if prefix != "":
            cmd = cmd + " --prefix " + prefix
        expect(cmd).to_contain("--prefix cli_")

# ============================================================================
# Test Group 5: simple_type_at tool
# ============================================================================

describe "simple_type_at tool":
    it "builds type-at command":
        val file = "src/app/cli/main.spl"
        val line = "42"
        var cmd = "timeout 30 bin/simple query type-at " + file + " " + line
        cmd = cmd + " 2>&1"
        expect(cmd).to_contain("query type-at")
