# MCP Content Types Specification
# Feature: MCP Multi-Modal Content
# Category: MCP, Content
# Status: Complete

use std.spec
use std.nogc_async_mut.mcp.helpers.{LB, RB, jp, js, make_image_content, make_audio_content, make_resource_link_content, make_embedded_resource_content, make_content_annotations, make_tool_result}

describe "MCP Image Content":
    it "builds with data and MIME type":
        val content = make_image_content("base64data==", "image/png")
        expect(content.contains("\"type\":\"image\"")).to_equal(true)
        expect(content.contains("\"data\":\"base64data==\"")).to_equal(true)
        expect(content.contains("\"mimeType\":\"image/png\"")).to_equal(true)

describe "MCP Audio Content":
    it "builds with data and MIME type":
        val content = make_audio_content("audiodata==", "audio/wav")
        expect(content.contains("\"type\":\"audio\"")).to_equal(true)
        expect(content.contains("\"mimeType\":\"audio/wav\"")).to_equal(true)

describe "MCP Resource Link Content":
    it "builds with URI and name":
        val content = make_resource_link_content("file:///test.spl", "test.spl")
        expect(content.contains("\"type\":\"resource_link\"")).to_equal(true)
        expect(content.contains("\"uri\":\"file:///test.spl\"")).to_equal(true)
        expect(content.contains("\"name\":\"test.spl\"")).to_equal(true)

describe "MCP Embedded Resource Content":
    it "builds with URI and text content":
        val content = make_embedded_resource_content("file:///test.spl", "fn main(): pass", "text/x-simple")
        expect(content.contains("\"type\":\"resource\"")).to_equal(true)
        expect(content.contains("fn main(): pass")).to_equal(true)

describe "MCP Content Annotations":
    it "builds with audience and priority":
        val annot = make_content_annotations(["user"], "0.8", "")
        expect(annot.contains("\"audience\"")).to_equal(true)
        expect(annot.contains("\"priority\":0.8")).to_equal(true)

describe "MCP Tool Result":
    it "wraps text content in proper structure":
        val result = make_tool_result("1", "Hello world")
        expect(result.contains("\"content\"")).to_equal(true)
        expect(result.contains("\"type\":\"text\"")).to_equal(true)
        expect(result.contains("Hello world")).to_equal(true)
