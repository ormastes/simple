# MCP Ping/Pong Specification
# Feature: MCP Ping/Pong Protocol
# Category: MCP, Protocol
# Status: Complete

use std.spec
use std.nogc_async_mut.mcp.helpers.{LB, RB, jp, js, jo2, jo3, make_result_response}

describe "MCP Ping Handler":
    context "when receiving ping request":
        it "responds with empty result object":
            val response = make_result_response("42", LB() + RB())
            expect(response.contains("\"result\"")).to_equal(true)

        it "preserves request ID in response":
            val response = make_result_response("42", LB() + RB())
            expect(response.contains("\"id\":42")).to_equal(true)

        it "uses correct JSON-RPC version":
            val response = make_result_response("1", LB() + RB())
            expect(response.contains("\"jsonrpc\":\"2.0\"")).to_equal(true)

    context "when validating response format":
        it "has jsonrpc field":
            val response = make_result_response("99", "null")
            expect(response.contains("\"jsonrpc\"")).to_equal(true)

        it "has id field matching request":
            val response = make_result_response("99", "null")
            expect(response.contains("\"id\":99")).to_equal(true)

        it "has result field":
            val response = make_result_response("1", LB() + RB())
            expect(response.contains("\"result\":")).to_equal(true)
