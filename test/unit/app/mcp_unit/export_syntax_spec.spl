# MCP Export Syntax Tests
# Feature: MCP Module Export Syntax
# Category: MCP, Module, Export
# Status: Complete
#
# Tests that MCP modules use correct 'export use' syntax in __init__.spl files.
# Regression test for parse error: 'expected expression, found Dot'.

use std.spec
use std.nogc_async_mut.mcp.helpers.{LB, RB, jp, js, jo1, jo2, extract_json_string, make_result_response}

describe "MCP module export syntax":
    slow_it "can import from mcp helpers":
        val response = make_result_response("1", jo1(jp("status", js("ok"))))
        expect(response.contains("jsonrpc")).to_equal(true)

    slow_it "can access protocol types from helpers":
        val method_name = "initialize"
        val req = jo1(jp("method", js(method_name)))
        val extracted = extract_json_string(req, "method")
        expect(extracted).to_equal("initialize")

    slow_it "can build JSON objects":
        val obj = jo2(jp("key1", js("value1")), jp("key2", js("value2")))
        expect(obj.contains("key1")).to_equal(true)
        expect(obj.contains("key2")).to_equal(true)

    slow_it "can use LB and RB helpers":
        val json = LB() + jp("test", js("value")) + RB()
        expect(json.contains("test")).to_equal(true)
