# MCP Progress Notifications Specification
# Feature: MCP Progress Tracking
# Category: MCP, Protocol
# Status: Complete

use std.spec
use std.nogc_async_mut.mcp.helpers.{make_progress_notification}

describe "MCP Progress Notification":
    slow_it "includes progress token":
        val notif = make_progress_notification("tok-abc", 5, 10, "Working")
        expect(notif.contains("\"progressToken\":\"tok-abc\"")).to_equal(true)

    slow_it "includes progress and total":
        val notif = make_progress_notification("tok-1", 50, 100, "")
        expect(notif.contains("\"progress\":50")).to_equal(true)
        expect(notif.contains("\"total\":100")).to_equal(true)

    slow_it "includes message when provided":
        val notif = make_progress_notification("tok-1", 3, 10, "Step 3 of 10")
        expect(notif.contains("Step 3 of 10")).to_equal(true)

    slow_it "uses notifications/progress method":
        val notif = make_progress_notification("tok-1", 0, 0, "")
        expect(notif.contains("\"method\":\"notifications/progress\"")).to_equal(true)

    slow_it "is valid JSON-RPC notification":
        val notif = make_progress_notification("tok-1", 1, 5, "test")
        expect(notif.contains("\"jsonrpc\":\"2.0\"")).to_equal(true)
