# EasyFix Rules - Spec File Lint Rules
#
# Rules that only apply to _spec.spl test files:
#   L:print_in_test_spec         — Replace print() with expect() in test specs
#   L:sspec_missing_docstrings   — Add template docstring to describe/context
#   L:sspec_manual_assertions    — Replace manual if/fail with expect()
#
# These rules are implemented in std.common.tooling.easy_fix.rules
# and comprehensively tested in test/feature/app/easy_fix_rules_spec.spl

use std.common.tooling.easy_fix.types.*
use std.common.tooling.easy_fix.rules.*

describe "Spec file lint rules":
    context "print_in_test_spec":
        it "detects print in spec files":
            val source = "it \"test\":\n    print(42)\n"
            val fixes = check_print_in_test_spec(source, "my_spec.spl")
            expect(fixes.len()).to_equal(1)

        it "ignores non-spec files":
            val source = "fn main():\n    print(42)\n"
            val fixes = check_print_in_test_spec(source, "main.spl")
            expect(fixes.len()).to_equal(0)

    context "sspec_missing_docstrings":
        it "detects missing docstrings":
            val source = "describe \"X\":\n    it \"y\":\n        expect true\n"
            val fixes = check_sspec_missing_docstrings(source, "test_spec.spl")
            expect(fixes.len() >= 1).to_equal(true)

    context "sspec_manual_assertions":
        it "detects manual assertions":
            val source = "    if x > 5: fail(\"too big\")\n"
            val fixes = check_sspec_manual_assertions(source, "test_spec.spl")
            expect(fixes.len()).to_equal(1)
