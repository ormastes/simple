"""
FFT Operations Test Suite
Feature: ML Fast Fourier Transform Operations
Category: ML, Signal Processing
Status: Complete

Tests for ml.torch.fft module including 1D/2D FFT, inverse FFT,
and real FFT operations.
"""

use ml.torch as torch
use ml.torch.fft as fft
use ml.torch.ffi_helpers as helpers
use ml.torch.dtype.DType.*

# Local Device enum (runtime can't handle imported enum constructors with data)
enum Device:
    CPU
    CUDA(index: i64)

describe "FFT Operations":
    """
    Tests for FFT and inverse FFT operations on tensors.
    """
    context "1D FFT":
        it "computes 1D FFT":
            val device = Device.CUDA(1)
            val signal = helpers.randn_1d(128, device=device)
            val spectrum = fft.fft(signal, n=-1, dim=0, norm=0)
            expect spectrum.shape() == [128]
            expect spectrum.device().cuda_id() == Some(1)

    context "2D FFT":
        it "computes 2D FFT":
            val device = Device.CUDA(1)
            val signal = helpers.randn_2d(16, 16, device=device)
            val spectrum = fft.fft(signal, n=-1, dim=0, norm=0)
            expect spectrum.shape() == [16, 16]
            expect spectrum.device().cuda_id() == Some(1)

    context "inverse FFT":
        it "computes inverse FFT":
            val device = Device.CUDA(1)
            val signal = helpers.randn_1d(64, device=device)
            val spectrum = fft.fft(signal, n=-1, dim=0, norm=0)
            val reconstructed = fft.ifft(spectrum, n=-1, dim=0, norm=0)
            expect reconstructed.shape() == [64]
            expect reconstructed.device().cuda_id() == Some(1)

    context "real FFT":
        it "computes real FFT":
            val device = Device.CUDA(1)
            val signal = helpers.randn_1d(128, device=device)
            val spectrum = fft.rfft(signal, n=-1, dim=0, norm=0)
            expect spectrum.device().cuda_id() == Some(1)
