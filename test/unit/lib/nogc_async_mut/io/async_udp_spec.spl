"""
# Async UDP I/O Specification

**Feature IDs:** #IO-ASYNC-UDP
**Category:** Stdlib
**Difficulty:** 3/5
**Status:** Implemented

## Overview

AsyncUdpSocket provides epoll-driven non-blocking UDP.
Implements AsyncClose (UDP is message-based, not stream-based).

## Syntax

```simple
val socket = await AsyncUdpSocket.bind("127.0.0.1:0")?
await socket.send_to([72, 105], "127.0.0.1:9001")?
val (data, sender) = await socket.recv_from(1024)?
await socket.close()?
```

## Key Concepts

| Concept | Description |
|---------|-------------|
| AsyncUdpSocket | Non-blocking UDP socket (epoll) — AsyncClose |
| send_to/recv_from | Addressed async datagram operations |
| connect/send/recv | Connected async datagram operations |

## Behavior

- bind() sets socket to non-blocking
- send_to/recv_from are epoll-driven futures
- connect() and local_addr() are sync (immediate operations)
- close() deregisters from event loop

## Sync vs Async Comparison

```simple
# Sync:
val socket = UdpSocket.bind("127.0.0.1:0")?
socket.send_to(data, addr)?

# Async — same names, just add await:
val socket = await AsyncUdpSocket.bind("127.0.0.1:0")?
await socket.send_to(data, addr)?
```
"""

use std.spec

# ============================================================================
# AsyncUdpSocket
# ============================================================================

describe "AsyncUdpSocket":
    """
    ## Non-Blocking UDP Socket

    Epoll-driven async datagram socket.
    """

    context "bind":
        it "documents async bind":
            # val socket = await AsyncUdpSocket.bind("127.0.0.1:0")?
            # expect socket.is_open() == true
            pass

    context "send_to and recv_from":
        """
        ### Addressed Mode (Async)
        """

        it "documents async datagram exchange":
            # val socket = await AsyncUdpSocket.bind("127.0.0.1:0")?
            # await socket.send_to([72, 105], "127.0.0.1:9001")?
            # val (data, sender) = await socket.recv_from(1024)?
            # await socket.close()?
            pass

    context "connected mode":
        """
        ### Connected Mode (Async)

        connect() is sync; send/recv are async.
        """

        it "documents async connected mode":
            # val socket = await AsyncUdpSocket.bind("127.0.0.1:0")?
            # socket.connect("127.0.0.1:9001")?  # sync
            # await socket.send([72, 105])?
            # val data = await socket.recv(1024)?
            # await socket.close()?
            pass

    context "broadcast (sync)":
        it "documents broadcast setup":
            # val socket = await AsyncUdpSocket.bind("0.0.0.0:0")?
            # socket.set_broadcast(true)?  # sync
            # await socket.send_to(data, "255.255.255.255:9000")?
            pass

    context "close":
        it "documents async close":
            # val socket = await AsyncUdpSocket.bind("127.0.0.1:0")?
            # await socket.close()?
            # expect socket.is_open() == false
            pass
