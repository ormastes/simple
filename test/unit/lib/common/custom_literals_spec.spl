# Custom String Literal Suffixes Specification
#
# Tests for custom string literal suffix infrastructure which allows
# defining domain-specific string types. Suffixes like _ip, _url, _regex
# are automatically mapped to corresponding type constructors.

describe "Custom String Literal Suffixes":
    # Tests for suffix-to-type mapping functionality.
    # Verifies that string suffixes correctly invoke type constructors.
    context "default suffix-to-type mapping":
        it "maps _ip to IP.from() when IP class is defined":
            class IP:
                value: text

                static fn from(s: text) -> IP:
                    IP(value: s)

            val addr = "192.168.1.1"_ip
            expect addr.value == "192.168.1.1"

        it "maps snake_case suffix to PascalCase type":
            class MyType:
                data: text

                static fn from(s: text) -> MyType:
                    MyType(data: s)

            val obj = "hello"_my_type
            expect obj.data == "hello"

        it "maps short suffix to UPPERCASE first (common acronyms)":
            class URL:
                link: text

                static fn from(s: text) -> URL:
                    URL(link: s)

            val link = "https://example.com"_url
            expect link.link == "https://example.com"

        it "maps longer suffix to PascalCase":
            class Regex:
                pattern: text

                static fn from(s: text) -> Regex:
                    Regex(pattern: s)

            val r = "test.*"_regex
            expect r.pattern == "test.*"

    context "multiple type name candidates":
        it "tries UPPERCASE before PascalCase for 2-letter suffix":
            class IP:
                v: text
                static fn from(s: text) -> IP:
                    IP(v: "IP:" + s)

            val addr = "127.0.0.1"_ip
            expect addr.v == "IP:127.0.0.1"

        it "tries UPPERCASE before PascalCase for 3-letter suffix":
            class XML:
                content: text
                static fn from(s: text) -> XML:
                    XML(content: s)

            val doc = "<root/>"_xml
            expect doc.content == "<root/>"

        it "uses PascalCase for 4+ letter suffix":
            class Json:
                data: text
                static fn from(s: text) -> Json:
                    Json(data: s)

            val j = '{"key": "value"}'_json
            expect j.data == '{"key": "value"}'

    context "suffix matching is case-sensitive":
        it "ip maps to IP not Ip":
            class IP:
                v: text
                static fn from(s: text) -> IP:
                    IP(v: s)

            val a = "test"_ip
            expect a.v == "test"
