# Result chaining methods spec
#
# Tests for src/lib/result.spl

use std.result.{
    result_map, result_map_err, result_and_then, result_or_else,
    result_unwrap_or, result_unwrap_or_else,
    result_is_ok, result_is_err, result_from_option
}

describe "Result stdlib":
    describe "result_is_ok and result_is_err":
        it "is_ok returns true for non-nil":
            expect(result_is_ok(42)).to_equal(true)

        it "is_ok returns false for nil":
            expect(result_is_ok(nil)).to_equal(false)

        it "is_err returns true for nil":
            expect(result_is_err(nil)).to_equal(true)

        it "is_err returns false for non-nil":
            expect(result_is_err("ok")).to_equal(false)

    describe "result_unwrap_or":
        it "returns value when ok":
            expect(result_unwrap_or(10, 99)).to_equal(10)

        it "returns default when nil":
            expect(result_unwrap_or(nil, 99)).to_equal(99)

    describe "result_map":
        it "maps ok value":
            val result = result_map(5, fn(x): x * 2)
            expect(result).to_equal(10)

        it "propagates nil":
            val result = result_map(nil, fn(x): x * 2)
            expect(result).to_be_nil()

    describe "result_and_then":
        it "chains success":
            val result = result_and_then(5, fn(x): x + 10)
            expect(result).to_equal(15)

        it "propagates nil":
            val result = result_and_then(nil, fn(x): x + 10)
            expect(result).to_be_nil()

    describe "result_map_err":
        it "maps nil to new value":
            val result = result_map_err(nil, fn(): "error occurred")
            expect(result).to_equal("error occurred")

        it "passes through ok value":
            val result = result_map_err(42, fn(): "error occurred")
            expect(result).to_equal(42)

    describe "result_or_else":
        it "returns original when ok":
            val result = result_or_else(42, fn(): 99)
            expect(result).to_equal(42)

        it "calls alternative when nil":
            val result = result_or_else(nil, fn(): 99)
            expect(result).to_equal(99)

    describe "result_from_option":
        it "returns value when some":
            val result = result_from_option(42, "no value")
            expect(result).to_equal(42)

        it "returns nil when nil":
            val result = result_from_option(nil, "no value")
            expect(result).to_be_nil()
