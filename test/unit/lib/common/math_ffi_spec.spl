# Math FFI Specification
#
# Tests for mathematical operations available through the runtime,
# including power/exponential via loops, absolute value, and special values.

describe "Math FFI Functions":
    # Validates mathematical operations including power, absolute value,
    # and special value handling.
    context "power and exponential":
        it "calculates power correctly via loop":
            var result = 1
            for _ in 0..3:
                result = result * 2
            expect(result).to_equal(8)

        it "handles zero exponent":
            # x^0 = 1 for any x
            var result = 1
            # 0 iterations = x^0
            expect(result).to_equal(1)

        it "handles base of 1":
            var result = 1
            for _ in 0..100:
                result = result * 1
            expect(result).to_equal(1)

    context "absolute value":
        it "calculates absolute value of negative":
            val x = -5
            var abs_x = x
            if abs_x < 0: abs_x = -abs_x
            expect(abs_x).to_equal(5)

        it "positive value unchanged":
            val x = 5
            var abs_x = x
            if abs_x < 0: abs_x = -abs_x
            expect(abs_x).to_equal(5)

        it "zero unchanged":
            val x = 0
            var abs_x = x
            if abs_x < 0: abs_x = -abs_x
            expect(abs_x).to_equal(0)

    context "integer square roots via approximation":
        it "sqrt(16) = 4 via search":
            var result = 0
            for i in 0..17:
                if i * i == 16:
                    result = i
            expect(result).to_equal(4)

        it "sqrt(9) = 3 via search":
            var result = 0
            for i in 0..10:
                if i * i == 9:
                    result = i
            expect(result).to_equal(3)

        it "sqrt(1) = 1 via search":
            var result = 0
            for i in 0..2:
                if i * i == 1:
                    result = i
            expect(result).to_equal(1)

        it "sqrt(0) = 0":
            expect(0 * 0).to_equal(0)

    context "special values":
        it "handles zero correctly":
            expect(0 * 2).to_equal(0)
            expect(0 + 5).to_equal(5)
            expect(0 - 3).to_equal(-3)

        it "handles one correctly":
            expect(1 * 100).to_equal(100)
            expect(1 + 0).to_equal(1)

        it "handles negative numbers":
            expect(-1 * -1).to_equal(1)
            expect(-3 * 2).to_equal(-6)
            expect(-10 + 10).to_equal(0)
