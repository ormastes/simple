# Unit Tests — std.traits Module (Wired to __traits built-in)
#
# Tests that std.traits wrapper functions correctly delegate to
# the __traits built-in for real introspection results.
# These tests run directly and verify actual runtime behavior
# of field_names(), method_names(), is_struct_type(), etc.

use std.spec.{describe, it, expect}
use std.traits.{
    field_names, method_names, all_member_names,
    field_count, has_field, has_method,
    is_struct_type, is_class_type, is_enum_type,
    enum_variant_names, enum_variant_count,
    is_integral_type, is_float_type, is_numeric_type,
    is_text_type, is_bool_type,
    is_array_type, is_dict_type,
    is_fn, enum_count, member_type
}

describe "std.traits wired — field queries":
    it "field_names returns a list":
        val names = field_names("SomeType")
        expect(names.len() >= 0).to_equal(true)

    it "field_count returns non-negative integer":
        val cnt = field_count("AnyType")
        expect(cnt >= 0).to_equal(true)

    it "has_field returns false for unknown type":
        val result = has_field("Nonexistent", "x")
        expect(result).to_equal(false)

    it "method_names returns a list":
        val names = method_names("AnyType")
        expect(names.len() >= 0).to_equal(true)

    it "has_method returns false for unknown type":
        val result = has_method("Nonexistent", "run")
        expect(result).to_equal(false)

    it "all_member_names returns a list":
        val names = all_member_names("AnyType")
        expect(names.len() >= 0).to_equal(true)

describe "std.traits wired — type classification":
    it "is_struct_type returns false for unknown type":
        val result = is_struct_type("Nonexistent")
        expect(result).to_equal(false)

    it "is_class_type returns false for unknown type":
        val result = is_class_type("Nonexistent")
        expect(result).to_equal(false)

    it "is_enum_type returns false for unknown type":
        val result = is_enum_type("Nonexistent")
        expect(result).to_equal(false)

    it "enum_variant_names returns list":
        val names = enum_variant_names("Nonexistent")
        expect(names.len() >= 0).to_equal(true)

    it "enum_variant_count returns 0 for unknown enum":
        val cnt = enum_variant_count("Nonexistent")
        expect(cnt).to_equal(0)

describe "std.traits wired — numeric classification via __traits":
    it "is_integral_type('i64') returns true":
        val result = is_integral_type("i64")
        expect(result).to_equal(true)

    it "is_integral_type('i32') returns true":
        val result = is_integral_type("i32")
        expect(result).to_equal(true)

    it "is_integral_type('u64') returns true":
        val result = is_integral_type("u64")
        expect(result).to_equal(true)

    it "is_integral_type('u8') returns true":
        val result = is_integral_type("u8")
        expect(result).to_equal(true)

    it "is_integral_type('text') returns false":
        val result = is_integral_type("text")
        expect(result).to_equal(false)

    it "is_integral_type('f64') returns false":
        val result = is_integral_type("f64")
        expect(result).to_equal(false)

    it "is_float_type('f64') returns true":
        val result = is_float_type("f64")
        expect(result).to_equal(true)

    it "is_float_type('f32') returns true":
        val result = is_float_type("f32")
        expect(result).to_equal(true)

    it "is_float_type('i64') returns false":
        val result = is_float_type("i64")
        expect(result).to_equal(false)

    it "is_numeric_type('i64') returns true":
        val result = is_numeric_type("i64")
        expect(result).to_equal(true)

    it "is_numeric_type('f64') returns true":
        val result = is_numeric_type("f64")
        expect(result).to_equal(true)

    it "is_numeric_type('text') returns false":
        val result = is_numeric_type("text")
        expect(result).to_equal(false)

describe "std.traits wired — other type classification":
    it "is_text_type('text') returns true":
        val result = is_text_type("text")
        expect(result).to_equal(true)

    it "is_text_type('i64') returns false":
        val result = is_text_type("i64")
        expect(result).to_equal(false)

    it "is_bool_type('bool') returns true":
        val result = is_bool_type("bool")
        expect(result).to_equal(true)

    it "is_bool_type('i64') returns false":
        val result = is_bool_type("i64")
        expect(result).to_equal(false)

    it "is_array_type('[i64]') returns true via __traits":
        val result = is_array_type("[i64]")
        expect(result).to_equal(true)

    it "is_array_type('[text]') returns true via __traits":
        val result = is_array_type("[text]")
        expect(result).to_equal(true)

    it "is_array_type('text') returns false via __traits":
        val result = is_array_type("text")
        expect(result).to_equal(false)

    it "is_dict_type('{text: i64}') returns true via __traits":
        val result = is_dict_type("{text: i64}")
        expect(result).to_equal(true)

    it "is_dict_type('text') returns false via __traits":
        val result = is_dict_type("text")
        expect(result).to_equal(false)

describe "std.traits wired — new functions":
    it "is_fn returns false for nonexistent function":
        val result = is_fn("ghost_function_xyz")
        expect(result).to_equal(false)

    it "enum_count returns 0 for unknown enum":
        val cnt = enum_count("Nonexistent")
        expect(cnt).to_equal(0)

    it "member_type returns empty for unknown type":
        val t = member_type("Ghost", "field")
        expect(t).to_equal("")
