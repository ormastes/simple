# Tests for std.repr module
# Covers: to_debug_text, pretty builders, latex builders

use std.repr.{to_debug_text}
use std.repr.{pretty_fraction, pretty_power, pretty_sub, pretty_sqrt}
use std.repr.{pretty_sum, pretty_integral, pretty_matrix, pretty_piecewise}
use std.repr.{latex_fraction, latex_power, latex_sub, latex_sqrt}
use std.repr.{latex_sum, latex_integral, latex_matrix, latex_piecewise}

describe "std.repr":

    describe "to_debug_text":
        it "wraps text value with type annotation":
            val result = to_debug_text("hello")
            expect(result).to_contain("text(")
            expect(result).to_contain("hello")

        it "handles empty string":
            val result = to_debug_text("")
            expect(result).to_contain("text(")

    describe "pretty_power":
        it "creates x squared":
            val result = pretty_power("x", "2")
            expect(result).to_equal("x²")

        it "creates y cubed":
            val result = pretty_power("y", "3")
            expect(result).to_equal("y³")

        it "creates x to the n":
            val result = pretty_power("x", "n")
            expect(result).to_equal("xⁿ")

        it "creates x to the n+1":
            val result = pretty_power("x", "n+1")
            expect(result).to_equal("xⁿ⁺¹")

    describe "pretty_sub":
        it "creates x sub 1":
            val result = pretty_sub("x", "1")
            expect(result).to_equal("x₁")

        it "creates a sub n":
            val result = pretty_sub("a", "n")
            expect(result).to_equal("aₙ")

        it "creates x sub i+1":
            val result = pretty_sub("x", "i+1")
            expect(result).to_equal("xᵢ₊₁")

    describe "pretty_sqrt":
        it "creates sqrt of simple expression":
            val result = pretty_sqrt("x+1")
            expect(result).to_equal("√(x+1)")

        it "creates sqrt of complex expression":
            val result = pretty_sqrt("x² + y²")
            expect(result).to_equal("√(x² + y²)")

    describe "pretty_fraction":
        it "creates simple fraction":
            val result = pretty_fraction("1", "2")
            expect(result).to_contain("1")
            expect(result).to_contain("2")
            expect(result).to_contain("─")

        it "contains three lines":
            val result = pretty_fraction("x+1", "x-1")
            expect(result).to_contain("x+1")
            expect(result).to_contain("x-1")
            expect(result).to_contain("─")

    describe "pretty_sum":
        it "contains sigma symbol":
            val result = pretty_sum("i", "i", "1", "n")
            expect(result).to_contain("∑")

        it "contains upper bound":
            val result = pretty_sum("i", "i", "1", "n")
            expect(result).to_contain("n")

        it "contains lower bound":
            val result = pretty_sum("i", "i", "1", "n")
            expect(result).to_contain("i=1")

        it "contains expression":
            val result = pretty_sum("x²", "i", "0", "n")
            expect(result).to_contain("x²")

    describe "pretty_integral":
        it "contains integral symbol":
            val result = pretty_integral("x", "x", "0", "1")
            expect(result).to_contain("∫")

        it "contains differential":
            val result = pretty_integral("x", "x", "0", "1")
            expect(result).to_contain("dx")

        it "contains upper bound":
            val result = pretty_integral("x", "x", "0", "1")
            expect(result).to_contain("1")

        it "contains lower bound":
            val result = pretty_integral("x", "x", "0", "1")
            expect(result).to_contain("0")

    describe "pretty_matrix":
        it "creates 2x2 matrix with brackets":
            val result = pretty_matrix([["1", "2"], ["3", "4"]])
            expect(result).to_contain("⎡")
            expect(result).to_contain("⎣")
            expect(result).to_contain("⎤")
            expect(result).to_contain("⎦")

        it "contains matrix values":
            val result = pretty_matrix([["a", "b"], ["c", "d"]])
            expect(result).to_contain("a")
            expect(result).to_contain("d")

        it "handles 1x1 matrix":
            val result = pretty_matrix([["42"]])
            expect(result).to_contain("42")
            expect(result).to_contain("⎡")

        it "handles empty matrix":
            val result = pretty_matrix([])
            expect(result).to_equal("⎡⎤")

    describe "pretty_piecewise":
        it "creates 2-case piecewise":
            val result = pretty_piecewise([["x", "x > 0"], ["-x", "x <= 0"]])
            expect(result).to_contain("⎧")
            expect(result).to_contain("⎩")

        it "contains expressions and conditions":
            val result = pretty_piecewise([["x", "x > 0"], ["-x", "x <= 0"]])
            expect(result).to_contain("x")
            expect(result).to_contain("-x")
            expect(result).to_contain("if x > 0")
            expect(result).to_contain("if x <= 0")

        it "handles empty cases":
            val result = pretty_piecewise([])
            expect(result).to_equal("")

        it "creates 3-case piecewise with mid brace":
            val result = pretty_piecewise([["1", "x > 0"], ["0", "x = 0"], ["-1", "x < 0"]])
            expect(result).to_contain("⎧")
            expect(result).to_contain("⎨")
            expect(result).to_contain("⎩")

    describe "latex_fraction":
        it "creates simple fraction":
            val result = latex_fraction("1", "2")
            expect(result).to_contain("frac")
            expect(result).to_contain("1")
            expect(result).to_contain("2")

        it "creates complex fraction":
            val result = latex_fraction("x+1", "x-1")
            expect(result).to_contain("x+1")
            expect(result).to_contain("x-1")

    describe "latex_power":
        it "creates single-char exponent without braces":
            val result = latex_power("x", "2")
            expect(result).to_equal("x^2")

        it "creates multi-char exponent with braces":
            val result = latex_power("x", "n+1")
            expect(result).to_contain("^")
            expect(result).to_contain("n+1")

    describe "latex_sub":
        it "creates single-char subscript without braces":
            val result = latex_sub("x", "1")
            expect(result).to_equal("x_1")

        it "creates multi-char subscript with braces":
            val result = latex_sub("x", "10")
            expect(result).to_contain("_")
            expect(result).to_contain("10")

    describe "latex_sqrt":
        it "creates sqrt command":
            val result = latex_sqrt("x+1")
            expect(result).to_contain("sqrt")
            expect(result).to_contain("x+1")

    describe "latex_sum":
        it "creates sum with bounds":
            val result = latex_sum("i", "i", "1", "n")
            expect(result).to_contain("sum")
            expect(result).to_contain("i=1")
            expect(result).to_contain("n")

    describe "latex_integral":
        it "creates integral with bounds and differential":
            val result = latex_integral("x", "x", "0", "1")
            expect(result).to_contain("int")
            expect(result).to_contain("0")
            expect(result).to_contain("1")
            expect(result).to_contain("dx")

    describe "latex_matrix":
        it "creates bmatrix environment":
            val result = latex_matrix([["1", "2"], ["3", "4"]])
            expect(result).to_contain("bmatrix")
            expect(result).to_contain("1 & 2")
            expect(result).to_contain("3 & 4")

    describe "latex_piecewise":
        it "creates cases environment":
            val result = latex_piecewise([["x", "x > 0"], ["-x", "x <= 0"]])
            expect(result).to_contain("cases")
            expect(result).to_contain("x > 0")
            expect(result).to_contain("x <= 0")
