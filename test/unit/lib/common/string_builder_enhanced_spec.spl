# StringBuilder Enhanced Methods Specification
#
# Tests for new StringBuilder convenience methods:
# push_all, push_sep, to_text_sep, from_parts
#
# Note: uses inline class definition because use std.string_builder.{...}
# does not resolve in interpreter mode (known limitation).

class StringBuilder:
    parts: [text]

    fn push(part: text):
        self.parts.push(part)

    fn to_text() -> text:
        self.parts.join("")

    fn is_empty() -> bool:
        self.parts.len() == 0

    fn push_all(parts: [text]):
        for p in parts:
            self.parts.push(p)

    fn push_sep(part: text, sep: text):
        if self.parts.len() > 0:
            self.parts.push(sep)
        self.parts.push(part)

    fn to_text_sep(sep: text) -> text:
        self.parts.join(sep)

    static fn from_parts(parts: [text]) -> StringBuilder:
        StringBuilder(parts: parts)

fn string_builder() -> StringBuilder:
    StringBuilder(parts: [])

# ============================================================================
# Test Group 1: push_all
# ============================================================================

describe "StringBuilder push_all":
    it "pushes multiple parts at once":
        val sb = string_builder()
        sb.push_all(["hello", " ", "world"])
        expect(sb.to_text()).to_equal("hello world")

    it "handles empty array":
        val sb = string_builder()
        sb.push("start")
        sb.push_all([])
        expect(sb.to_text()).to_equal("start")

    it "handles single element array":
        val sb = string_builder()
        sb.push_all(["only"])
        expect(sb.to_text()).to_equal("only")

# ============================================================================
# Test Group 2: push_sep
# ============================================================================

describe "StringBuilder push_sep":
    it "adds separator between parts":
        val sb = string_builder()
        sb.push_sep("a", ", ")
        sb.push_sep("b", ", ")
        sb.push_sep("c", ", ")
        expect(sb.to_text()).to_equal("a, b, c")

    it "does not add separator before first part":
        val sb = string_builder()
        sb.push_sep("first", ", ")
        expect(sb.to_text()).to_equal("first")

    it "works with newline separator":
        val sb = string_builder()
        sb.push_sep("line1", "\n")
        sb.push_sep("line2", "\n")
        expect(sb.to_text()).to_equal("line1\nline2")

# ============================================================================
# Test Group 3: to_text_sep
# ============================================================================

describe "StringBuilder to_text_sep":
    it "joins parts with separator":
        val sb = string_builder()
        sb.push("x")
        sb.push("y")
        sb.push("z")
        expect(sb.to_text_sep(", ")).to_equal("x, y, z")

    it "returns empty string for empty builder":
        val sb = string_builder()
        expect(sb.to_text_sep(", ")).to_equal("")

    it "returns single part without separator":
        val sb = string_builder()
        sb.push("only")
        expect(sb.to_text_sep(", ")).to_equal("only")

# ============================================================================
# Test Group 4: from_parts
# ============================================================================

describe "StringBuilder from_parts":
    it "creates builder from parts list":
        val sb = StringBuilder.from_parts(["a", "b", "c"])
        expect(sb.to_text()).to_equal("abc")

    it "creates builder from empty list":
        val sb = StringBuilder.from_parts([])
        expect(sb.to_text()).to_equal("")
        expect(sb.is_empty()).to_equal(true)

    it "allows further pushes after from_parts":
        val sb = StringBuilder.from_parts(["hello"])
        sb.push(" world")
        expect(sb.to_text()).to_equal("hello world")
