# DateTime FFI Specification
# Feature: DateTime FFI Functions
# Category: Host, FFI
# Status: Complete
#
# Tests for datetime operations using FFI functions including current time,
# datetime construction, arithmetic, and formatting.

use spec.{describe, context, it, expect}
use host.async_nogc_mut.datetime.{DateTime}

describe "DateTime FFI Functions":
    # Tests for DateTime FFI including current time, construction, arithmetic, and formatting.
    context "current datetime":
        it "should create current datetime":
            val now = DateTime__now()

            # Year should be reasonable (e.g., >= 2024)
            expect(now.year).to_be_greater_than_or_equal(2024)

            # Month should be 1-12
            expect(now.month).to_be_greater_than_or_equal(1)
            expect(now.month).to_be_less_than_or_equal(12)

            # Day should be 1-31
            expect(now.day).to_be_greater_than_or_equal(1)
            expect(now.day).to_be_less_than_or_equal(31)

            # Hour should be 0-23
            expect(now.hour).to_be_greater_than_or_equal(0)
            expect(now.hour).to_be_less_than_or_equal(23)

            # Minute should be 0-59
            expect(now.minute).to_be_greater_than_or_equal(0)
            expect(now.minute).to_be_less_than_or_equal(59)

            # Second should be 0-59
            expect(now.second).to_be_greater_than_or_equal(0)
            expect(now.second).to_be_less_than_or_equal(59)

    context "datetime construction":
        it "should create datetime from components":
            val dt = DateTime__new(2025, 1, 15, 10, 30, 45)

            expect(dt.year).to_equal(2025)
            expect(dt.month).to_equal(1)
            expect(dt.day).to_equal(15)
            expect(dt.hour).to_equal(10)
            expect(dt.minute).to_equal(30)
            expect(dt.second).to_equal(45)

    context "datetime arithmetic":
        it "should add days":
            val dt = DateTime__new(2025, 1, 1, 0, 0, 0)
            val dt_plus_10 = dt.add_days(10)

            # Should be January 11, 2025
            expect(dt_plus_10.year).to_equal(2025)
            expect(dt_plus_10.month).to_equal(1)
            expect(dt_plus_10.day).to_equal(11)

        it "should calculate day difference":
            val dt1 = DateTime__new(2025, 1, 1, 0, 0, 0)
            val dt2 = DateTime__new(2025, 1, 11, 0, 0, 0)

            val diff = dt1.diff_days(dt2)
            expect(diff).to_equal(10)

    context "datetime formatting":
        it "should format with full year":
            val dt = DateTime__new(2025, 1, 15, 0, 0, 0)
            val formatted = dt.format("%Y")
            expect(formatted).to_equal("2025")

        it "should format with month":
            val dt = DateTime__new(2025, 3, 15, 0, 0, 0)
            val formatted = dt.format("%m")
            expect(formatted).to_equal("03")

        it "should format with day":
            val dt = DateTime__new(2025, 1, 7, 0, 0, 0)
            val formatted = dt.format("%d")
            expect(formatted).to_equal("07")

        it "should format with ISO 8601":
            val dt = DateTime__new(2025, 1, 15, 10, 30, 45)
            val formatted = dt.format("%Y-%m-%d %H:%M:%S")
            expect(formatted).to_equal("2025-01-15 10:30:45")
