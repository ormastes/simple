# dig stdlib spec
#
# Tests for src/lib/dig.spl

use std.dig.{dig, dig_or}

describe "dig stdlib":
    describe "dig — nested array access":
        it "accesses a top-level index":
            val arr = [10, 20, 30]
            expect(dig(arr, [1])).to_equal(20)

        it "accesses a nested index":
            val matrix = [[1, 2], [3, 4]]
            expect(dig(matrix, [1, 0])).to_equal(3)

        it "accesses deeply nested value":
            val deep = [[[42]]]
            expect(dig(deep, [0, 0, 0])).to_equal(42)

        it "returns nil for out-of-bounds index":
            val arr = [1, 2, 3]
            expect(dig(arr, [5])).to_be_nil()

        it "returns nil for out-of-bounds nested index":
            val matrix = [[1, 2], [3, 4]]
            expect(dig(matrix, [0, 9])).to_be_nil()

        it "returns nil when intermediate value is nil":
            val arr = [nil, [1, 2]]
            expect(dig(arr, [0, 1])).to_be_nil()

        it "returns obj itself when keys list is empty":
            val arr = [1, 2, 3]
            val result = dig(arr, [])
            expect(result.len()).to_equal(3)

    describe "dig_or — with default":
        it "returns value when found":
            val matrix = [[1, 2], [3, 4]]
            expect(dig_or(matrix, [0, 1], 99)).to_equal(2)

        it "returns default when path is missing":
            val arr = [1, 2]
            expect(dig_or(arr, [5], 99)).to_equal(99)

        it "returns default when intermediate is nil":
            val arr = [nil, [1, 2]]
            expect(dig_or(arr, [0, 0], -1)).to_equal(-1)
