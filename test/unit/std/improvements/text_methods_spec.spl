# Text Method Improvement Tests
# Tests for text/string stdlib improvements


use std.string.{NL}
describe "text Method Improvements":

    context "Substring Operations":
        it "substring extracts range":
            val text = "hello world"
            expect text.substring(start=0, end=5) == "hello"

        it "substr extracts with length":
            val text = "hello world"
            expect text.substr(start=6, length=5) == "world"

        it "char_at gets single character":
            val text = "hello"
            expect text.char_at(0) == "h"
            expect text.char_at(4) == "o"

        it "chars returns list of characters":
            val text = "abc"
            val chars = text.chars()
            expect chars.len() == 3
            expect chars[0] == "a"

    context "Search Operations":
        it "find returns index of substring":
            val text = "hello world"
            val result = text.find("world")
            expect result.is_some()

        it "find_all returns all indices":
            val text = "abcabc"
            val indices = text.find_all("a")
            expect indices.len() == 2

        it "contains checks for substring":
            val text = "hello world"
            expect text.contains("world") == true
            expect text.contains("xyz") == false

        it "starts_with checks prefix":
            val text = "hello world"
            expect text.starts_with("hello") == true
            expect text.starts_with("world") == false

        it "ends_with checks suffix":
            val text = "hello world"
            expect text.ends_with("world") == true
            expect text.ends_with("hello") == false

    context "Whitespace Operations":
        it "strip removes leading and trailing whitespace":
            val text = "  hello  "
            expect text.strip() == "hello"

        it "trim removes leading and trailing whitespace":
            val text = "  hello  "
            expect text.trim() == "hello"

        it "trim_start removes leading whitespace":
            val text = "  hello  "
            expect text.trim_start() == "hello  "

        it "trim_end removes trailing whitespace":
            val text = "  hello  "
            expect text.trim_end() == "  hello"

    context "Case Operations":
        it "to_upper converts to uppercase":
            val text = "hello"
            expect text.upper() == "HELLO"

        it "to_lower converts to lowercase":
            val text = "HELLO"
            expect text.to_lower() == "hello"

        it "capitalize capitalizes first letter":
            val text = "hello world"
            expect text.capitalize() == "Hello world"

    context "Split and Join":
        it "split divides string by delimiter":
            val text = "a,b,c"
            val parts = text.split(",")
            expect parts.len() == 3
            expect parts[0] == "a"

        it "join combines list with delimiter":
            val parts = ["a", "b", "c"]
            expect ",".join(parts) == "a,b,c"

        it "lines splits by newlines":
            val text = "line1{NL}line2{NL}line3"
            val lines = text.lines()
            expect lines.len() == 3

    context "Replacement":
        it "replace replaces all occurrences":
            val text = "hello hello"
            expect text.replace(from="hello", to="hi") == "hi hi"

        it "replace_first replaces first occurrence":
            val text = "hello hello"
            expect text.replace_first(from="hello", to="hi") == "hi hello"
