# String Core Module Tests
# Tests for canonical string utility implementations

use std.spec.{describe, it, expect}
use std.string_core.{str_len, str_concat, str_eq}
use std.string_core.{str_slice, str_char_at, str_safe_slice}
use std.string_core.{str_contains, str_starts_with, str_ends_with}
use std.string_core.{str_index_of, str_last_index_of}
use std.string_core.{str_trim, str_trim_left, str_trim_right}
use std.string_core.{str_replace, str_replace_all}
use std.string_core.{str_split, str_join}
use std.string_core.{is_alpha_char, is_digit_char, is_alnum_char, is_whitespace_char}
use std.string_core.{str_to_lower, str_to_upper, str_capitalize}
use std.string_core.{str_reverse, str_repeat, str_truncate}
use std.string_core.{str_pad_left, str_pad_right, str_center}

describe "String Core - Basic Operations":
    it "str_len returns correct length":
        expect(str_len("hello")).to_equal(5)
        expect(str_len("")).to_equal(0)
        expect(str_len("a")).to_equal(1)

    it "str_concat joins strings":
        expect(str_concat("hello", " world")).to_equal("hello world")
        expect(str_concat("", "test")).to_equal("test")
        expect(str_concat("test", "")).to_equal("test")

    it "str_eq compares strings":
        expect(str_eq("hello", "hello")).to_equal(true)
        expect(str_eq("hello", "world")).to_equal(false)
        expect(str_eq("", "")).to_equal(true)

describe "String Core - Slicing and Access":
    it "str_slice extracts substring":
        expect(str_slice("hello", 0, 5)).to_equal("hello")
        expect(str_slice("hello", 1, 4)).to_equal("ell")
        expect(str_slice("hello", 0, 1)).to_equal("h")

    it "str_char_at gets character at index":
        expect(str_char_at("hello", 0)).to_equal("h")
        expect(str_char_at("hello", 4)).to_equal("o")
        expect(str_char_at("hello", -1)).to_equal("")
        expect(str_char_at("hello", 10)).to_equal("")

    it "str_safe_slice handles bounds":
        expect(str_safe_slice("hello", 0, 5)).to_equal("hello")
        expect(str_safe_slice("hello", -1, 3)).to_equal("hel")
        expect(str_safe_slice("hello", 0, 100)).to_equal("hello")
        expect(str_safe_slice("hello", 3, 2)).to_equal("")

describe "String Core - Search Operations":
    it "str_contains finds substrings":
        expect(str_contains("hello world", "world")).to_equal(true)
        expect(str_contains("hello world", "foo")).to_equal(false)
        expect(str_contains("hello", "")).to_equal(true)

    it "str_starts_with checks prefix":
        expect(str_starts_with("hello", "hel")).to_equal(true)
        expect(str_starts_with("hello", "llo")).to_equal(false)
        expect(str_starts_with("hello", "")).to_equal(true)

    it "str_ends_with checks suffix":
        expect(str_ends_with("hello", "llo")).to_equal(true)
        expect(str_ends_with("hello", "hel")).to_equal(false)
        expect(str_ends_with("hello", "")).to_equal(true)

    it "str_index_of finds first occurrence":
        expect(str_index_of("hello", "l")).to_equal(2)
        expect(str_index_of("hello", "o")).to_equal(4)
        expect(str_index_of("hello", "x")).to_equal(-1)

    it "str_last_index_of finds last occurrence":
        expect(str_last_index_of("hello", "l")).to_equal(3)
        expect(str_last_index_of("hello", "o")).to_equal(4)
        expect(str_last_index_of("hello", "x")).to_equal(-1)

describe "String Core - Trimming":
    it "is_whitespace_char identifies whitespace":
        expect(is_whitespace_char(" ")).to_equal(true)
        expect(is_whitespace_char("\t")).to_equal(true)
        expect(is_whitespace_char("\n")).to_equal(true)
        expect(is_whitespace_char("\r")).to_equal(true)
        expect(is_whitespace_char("a")).to_equal(false)

    it "str_trim removes both ends":
        expect(str_trim("  hello  ")).to_equal("hello")
        expect(str_trim("\thello\n")).to_equal("hello")
        expect(str_trim("hello")).to_equal("hello")

    it "str_trim_left removes leading":
        expect(str_trim_left("  hello")).to_equal("hello")
        expect(str_trim_left("\thello")).to_equal("hello")
        expect(str_trim_left("hello  ")).to_equal("hello  ")

    it "str_trim_right removes trailing":
        expect(str_trim_right("hello  ")).to_equal("hello")
        expect(str_trim_right("hello\n")).to_equal("hello")
        expect(str_trim_right("  hello")).to_equal("  hello")

describe "String Core - Replacement":
    it "str_replace changes first occurrence":
        expect(str_replace("hello", "l", "L")).to_equal("heLlo")
        expect(str_replace("hello", "x", "X")).to_equal("hello")

    it "str_replace_all changes all occurrences":
        expect(str_replace_all("hello", "l", "L")).to_equal("heLLo")
        expect(str_replace_all("aaa", "a", "b")).to_equal("bbb")
        expect(str_replace_all("hello", "x", "X")).to_equal("hello")

describe "String Core - Split and Join":
    it "str_split divides by delimiter":
        val parts = str_split("a,b,c", ",")
        expect(parts.len()).to_equal(3)
        expect(parts[0]).to_equal("a")
        expect(parts[1]).to_equal("b")
        expect(parts[2]).to_equal("c")

    it "str_join combines with separator":
        expect(str_join(["a", "b", "c"], ",")).to_equal("a,b,c")
        expect(str_join(["a"], ",")).to_equal("a")
        expect(str_join([], ",")).to_equal("")

describe "String Core - Character Classification":
    it "is_alpha_char identifies letters":
        expect(is_alpha_char("a")).to_equal(true)
        expect(is_alpha_char("Z")).to_equal(true)
        expect(is_alpha_char("5")).to_equal(false)
        expect(is_alpha_char(" ")).to_equal(false)

    it "is_digit_char identifies digits":
        expect(is_digit_char("0")).to_equal(true)
        expect(is_digit_char("9")).to_equal(true)
        expect(is_digit_char("a")).to_equal(false)

    it "is_alnum_char identifies alphanumeric":
        expect(is_alnum_char("a")).to_equal(true)
        expect(is_alnum_char("5")).to_equal(true)
        expect(is_alnum_char(" ")).to_equal(false)

describe "String Core - Case Conversion":
    it "str_to_lower converts to lowercase":
        expect(str_to_lower("HELLO")).to_equal("hello")
        expect(str_to_lower("HeLLo")).to_equal("hello")
        expect(str_to_lower("hello")).to_equal("hello")

    it "str_to_upper converts to uppercase":
        expect(str_to_upper("hello")).to_equal("HELLO")
        expect(str_to_upper("HeLLo")).to_equal("HELLO")
        expect(str_to_upper("HELLO")).to_equal("HELLO")

    it "str_capitalize capitalizes first char":
        expect(str_capitalize("hello")).to_equal("Hello")
        expect(str_capitalize("HELLO")).to_equal("HELLO")
        expect(str_capitalize("")).to_equal("")

describe "String Core - Manipulation":
    it "str_reverse reverses string":
        expect(str_reverse("hello")).to_equal("olleh")
        expect(str_reverse("a")).to_equal("a")
        expect(str_reverse("")).to_equal("")

    it "str_repeat repeats string":
        expect(str_repeat("ab", 3)).to_equal("ababab")
        expect(str_repeat("x", 0)).to_equal("")
        expect(str_repeat("x", 1)).to_equal("x")

    it "str_truncate shortens with ellipsis":
        expect(str_truncate("hello world", 8)).to_equal("hello wo...")
        expect(str_truncate("hello", 10)).to_equal("hello")

    it "str_pad_left pads on left":
        expect(str_pad_left("42", 5, "0")).to_equal("00042")
        expect(str_pad_left("hello", 3, " ")).to_equal("hello")

    it "str_pad_right pads on right":
        expect(str_pad_right("42", 5, "0")).to_equal("42000")
        expect(str_pad_right("hello", 3, " ")).to_equal("hello")

    it "str_center centers string":
        expect(str_center("hi", 6)).to_equal("  hi  ")
        expect(str_center("hello", 3)).to_equal("hello")
