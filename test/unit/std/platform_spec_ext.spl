# Tests for std.platform module
# Covers exported functions from src/std/platform.spl

use std.platform.{is_windows, is_unix, is_macos, is_linux}
use std.platform.{get_host_os, get_host_arch}
use std.platform.{dir_sep, path_sep, exe_ext, lib_ext}
use std.platform.{normalize_path, resolve_command, is_absolute_path, join_path}

describe "std.platform":
    describe "OS detection":
        it "is_unix returns true on Linux":
            expect(is_unix()).to_equal(true)

        it "is_windows returns false on Linux":
            expect(is_windows()).to_equal(false)

        it "is_linux returns true on Linux":
            expect(is_linux()).to_equal(true)

    describe "get_host_os":
        it "returns a known OS name":
            val os = get_host_os()
            expect(os.len()).to_be_greater_than(0)

    describe "get_host_arch":
        it "returns a known architecture":
            val arch = get_host_arch()
            expect(arch.len()).to_be_greater_than(0)

    describe "dir_sep":
        it "returns / on Unix":
            expect(dir_sep()).to_equal("/")

    describe "path_sep":
        it "returns : on Unix":
            expect(path_sep()).to_equal(":")

    describe "exe_ext":
        it "returns empty on Unix":
            expect(exe_ext()).to_equal("")

    describe "lib_ext":
        it "returns .so on Linux":
            expect(lib_ext()).to_equal(".so")

    describe "normalize_path":
        it "passes through Unix paths":
            expect(normalize_path("/usr/local")).to_equal("/usr/local")

        it "returns path unchanged on Unix":
            expect(normalize_path("usr\\local\\bin")).to_equal("usr\\local\\bin")

    describe "is_absolute_path":
        it "detects absolute paths":
            expect(is_absolute_path("/usr/bin")).to_equal(true)

        it "detects relative paths":
            expect(is_absolute_path("usr/bin")).to_equal(false)

    describe "join_path":
        it "joins directory and file":
            val result = join_path("/usr/local", "bin")
            expect(result).to_equal("/usr/local/bin")

    describe "resolve_command":
        it "resolves command name":
            val cmd = resolve_command("simple")
            expect(cmd.len()).to_be_greater_than(0)
