# MIR Test Utilities
#
# Helper functions for creating MIR structures in tests.

use compiler.mir_data.*
use compiler.lexer_types.Span
use compiler.hir.SymbolId

# ============================================================================
# Type Helpers
# ============================================================================

fn mir_i64_type() -> MirType:
    """Create i64 MIR type."""
    MirType(kind: MirTypeKind.I64)

fn mir_bool_type() -> MirType:
    """Create bool MIR type."""
    MirType(kind: MirTypeKind.Bool)

fn mir_unit_type() -> MirType:
    """Create unit MIR type."""
    MirType(kind: MirTypeKind.Unit)

# ============================================================================
# Span Helpers
# ============================================================================

fn dummy_span() -> Span:
    """Create a dummy span for testing."""
    Span(
        start: 0,
        end: 0,
        line: 1,
        col: 1
    )

# ============================================================================
# Function Helpers
# ============================================================================

fn mir_simple_signature(return_type: MirType) -> MirSignature:
    """Create a simple function signature with no parameters."""
    MirSignature(
        params: [],
        return_type: return_type,
        is_variadic: false
    )

fn mir_function_signature(params: [MirType], return_type: MirType) -> MirSignature:
    """Create a function signature."""
    MirSignature(
        params: params,
        return_type: return_type,
        is_variadic: false
    )

# ============================================================================
# Operand Helpers
# ============================================================================

fn mir_local_operand(id: i64) -> MirOperand:
    """Create a local variable operand."""
    MirOperand(
        kind: MirOperandKind.Copy(LocalId(id: id))
    )

fn mir_const_int(value: i64) -> MirOperand:
    """Create a constant integer operand."""
    MirOperand(
        kind: MirOperandKind.Const(
            MirConstValue.Int(value),
            mir_i64_type()
        )
    )

fn mir_const_bool(value: bool) -> MirOperand:
    """Create a constant boolean operand."""
    MirOperand(
        kind: MirOperandKind.Const(
            MirConstValue.Bool(value),
            mir_bool_type()
        )
    )

# ============================================================================
# Instruction Helpers
# ============================================================================

fn mir_binop_inst(dest: i64, op: MirBinOp, left: MirOperand, right: MirOperand) -> MirInst:
    """Create a binary operation instruction."""
    MirInst(
        kind: MirInstKind.BinOp(LocalId(id: dest), op, left, right),
        span: dummy_span()
    )

fn mir_copy_inst(dest: i64, src: i64) -> MirInst:
    """Create a copy instruction."""
    MirInst(
        kind: MirInstKind.Copy(LocalId(id: dest), LocalId(id: src)),
        span: dummy_span()
    )

fn mir_const_inst(dest: i64, value: MirConstValue) -> MirInst:
    """Create a constant assignment instruction."""
    MirInst(
        kind: MirInstKind.Const(LocalId(id: dest), value, mir_i64_type()),
        span: dummy_span()
    )

# ============================================================================
# Block Helpers
# ============================================================================

fn mir_simple_block(id: i64, instructions: [MirInst]) -> MirBlock:
    """Create a simple basic block with a return terminator."""
    MirBlock(
        id: BlockId(id: id),
        label: "bb{id}",
        instructions: instructions,
        terminator: MirTerminator.Return(nil)
    )

fn mir_block_with_term(id: i64, instructions: [MirInst], term: MirTerminator) -> MirBlock:
    """Create a basic block with a custom terminator."""
    MirBlock(
        id: BlockId(id: id),
        label: "bb{id}",
        instructions: instructions,
        terminator: term
    )

# ============================================================================
# Function Helpers
# ============================================================================

fn mir_test_function(name: text, blocks: [MirBlock]) -> MirFunction:
    """Create a test MIR function."""
    MirFunction(
        symbol: SymbolId(id: 0),
        name: name,
        signature: mir_simple_signature(mir_unit_type()),
        locals: [],
        blocks: blocks,
        entry_block: BlockId(id: 0),
        span: dummy_span(),
        generic_params: [],
        is_generic_template: false,
        specialization_of: nil,
        type_bindings: {}
    )

# ============================================================================
# Exports
# ============================================================================

export mir_i64_type, mir_bool_type, mir_unit_type
export dummy_span
export mir_simple_signature, mir_function_signature
export mir_local_operand, mir_const_int, mir_const_bool
export mir_binop_inst, mir_copy_inst, mir_const_inst
export mir_simple_block, mir_block_with_term
export mir_test_function
