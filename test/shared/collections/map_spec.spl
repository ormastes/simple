# @platform: all
# Map Type Specification
# Tests for dict (hash map) implementation
# NOTE: Using built-in dict type

# Test suite for the built-in dict (hash map) type in Simple.
#
# This specification covers:
# - Dict construction and initialization
# - Key-value insertion, retrieval, and update operations
# - Key existence checking with contains_key()
# - Iterating over keys and counting entries
# - Various value types (integers, strings, booleans)
# - Edge cases like empty string keys and similar key names
#
# The dict type provides O(1) average-case lookup and insertion using
# hash-based storage. Keys are strings and values can be any type.

describe "Dict (Map)":
    # Tests for Simple's built-in dictionary (hash map) data structure.
    #
    # The dict type provides key-value storage with the following operations:
    # - Literal syntax: {} for empty, {"key": value} for initialized
    # - Index access: m["key"] for get, m["key"] = value for set
    # - contains_key(key) to check key existence
    # - keys() to get list of all keys
    # - Iteration via for key in m.keys()
    #
    # Tests verify correct behavior for:
    # - Empty dict creation and population
    # - Single and multiple key-value pairs
    # - Key updates (overwriting existing values)
    # - Length tracking via keys().len()
    # - Different value types stored in the same dict
    # - Edge cases like empty string keys
    context "Construction":
        it "creates empty dict":
            val m = {}
            expect m.keys().len() == 0

    context "Basic operations":
        it "inserts and retrieves value":
            var m = {}
            m["name"] = "Alice"
            expect m["name"] == "Alice"

        it "updates existing key":
            var m = {}
            m["count"] = 1
            m["count"] = 2
            expect m["count"] == 2

        it "contains_key returns true for existing keys":
            var m = {}
            m["key"] = "value"
            expect m.contains_key("key")

        it "contains_key returns false for missing keys":
            val m = {}
            expect not m.contains_key("missing")

        it "len increases with insertions":
            var m = {}
            expect m.keys().len() == 0
            m["a"] = 1
            expect m.keys().len() == 1
            m["b"] = 2
            expect m.keys().len() == 2

        it "len does not increase for updates":
            var m = {}
            m["key"] = 1
            expect m.keys().len() == 1
            m["key"] = 2
            expect m.keys().len() == 1

    context "Keys, values":
        it "keys returns all keys":
            var m = {}
            m["a"] = 1
            m["b"] = 2
            m["c"] = 3
            val keys = m.keys()
            expect keys.len() == 3

        it "empty dict returns empty key list":
            val m = {}
            expect m.keys().len() == 0

    context "Multiple entries":
        it "handles many insertions":
            var m = {}
            for i in 0..10:
                m["key{i}"] = i
            expect m.keys().len() == 10
            expect m["key5"] == 5

    context "Different value types":
        it "stores integer values":
            var m = {}
            m["count"] = 42
            expect m["count"] == 42

        it "stores text values":
            var m = {}
            m["name"] = "Alice"
            expect m["name"] == "Alice"

        it "stores boolean values":
            var m = {}
            m["active"] = true
            expect m["active"] == true

    context "Edge cases":
        it "handles empty string key":
            var m = {}
            m[""] = "empty key"
            expect m[""] == "empty key"

        it "handles similar keys":
            var m = {}
            m["test"] = 1
            m["test1"] = 2
            m["test2"] = 3
            expect m["test"] == 1
            expect m["test1"] == 2

    context "Iteration":
        it "can iterate over entries":
            var m = {}
            m["a"] = 1
            m["b"] = 2
            m["c"] = 3
            var count = 0
            for key in m.keys():
                count = count + 1
            expect count == 3
