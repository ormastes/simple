# @platform: all
# Option Utilities Module Extended Specification
#
# Tests for std.option_utils module logic.
# Since the module uses Option<i64> generics (not supported by runtime parser),
# we test inline implementations of the same functions.

# Inline implementations mirroring std.option_utils

fn unwrap_or(opt, default_val: i64) -> i64:
    if opt != nil:
        opt
    else:
        default_val

fn is_some(opt) -> bool:
    opt != nil

fn is_none(opt) -> bool:
    opt == nil

# ============================================================================
# unwrap_or
# ============================================================================

describe "unwrap_or":

    it "returns value when present":
        val result = unwrap_or(42, 0)
        expect(result).to_equal(42)

    it "returns default when nil":
        val result = unwrap_or(nil, 10)
        expect(result).to_equal(10)

    it "returns zero value when present":
        val result = unwrap_or(0, 99)
        expect(result).to_equal(0)

    it "returns negative value when present":
        val result = unwrap_or(-5, 0)
        expect(result).to_equal(-5)

    it "returns default with negative default":
        val result = unwrap_or(nil, -1)
        expect(result).to_equal(-1)

    it "returns large value when present":
        val result = unwrap_or(999999, 0)
        expect(result).to_equal(999999)

# ============================================================================
# is_some
# ============================================================================

describe "is_some":

    it "returns true for non-nil value":
        val result = is_some(42)
        expect(result).to_equal(true)

    it "returns false for nil":
        val result = is_some(nil)
        expect(result).to_equal(false)

    it "returns true for zero":
        val result = is_some(0)
        expect(result).to_equal(true)

    it "returns true for negative":
        val result = is_some(-1)
        expect(result).to_equal(true)

    it "returns true for string":
        val result = is_some("hello")
        expect(result).to_equal(true)

    it "returns true for empty string":
        val result = is_some("")
        expect(result).to_equal(true)

# ============================================================================
# is_none
# ============================================================================

describe "is_none":

    it "returns true for nil":
        val result = is_none(nil)
        expect(result).to_equal(true)

    it "returns false for non-nil value":
        val result = is_none(42)
        expect(result).to_equal(false)

    it "returns false for zero":
        val result = is_none(0)
        expect(result).to_equal(false)

    it "returns false for negative":
        val result = is_none(-1)
        expect(result).to_equal(false)

    it "returns false for string":
        val result = is_none("hello")
        expect(result).to_equal(false)

    it "returns false for empty list":
        val result = is_none([])
        expect(result).to_equal(false)

# ============================================================================
# Combined usage patterns
# ============================================================================

describe "option_utils combined patterns":

    it "unwrap_or with is_some check":
        val opt = 42
        if is_some(opt):
            val val_result = unwrap_or(opt, 0)
            expect(val_result).to_equal(42)

    it "unwrap_or with is_none check":
        val opt = nil
        if is_none(opt):
            val val_result = unwrap_or(opt, -1)
            expect(val_result).to_equal(-1)

    it "chain of option operations":
        var values = [42, nil, 7, nil, 99]
        var sum = 0
        for v in values:
            sum = sum + unwrap_or(v, 0)
        expect(sum).to_equal(148)

    it "count non-nil values":
        var values = [1, nil, 3, nil, 5]
        var count = 0
        for v in values:
            if is_some(v):
                count = count + 1
        expect(count).to_equal(3)

    it "count nil values":
        var values = [1, nil, 3, nil, 5]
        var count = 0
        for v in values:
            if is_none(v):
                count = count + 1
        expect(count).to_equal(2)
