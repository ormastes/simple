# RISC-V Unaligned Access Crash Test
#
# This kernel causes an unaligned memory access
# to test fault detection and address analysis.

use baremetal.riscv.startup.{uart_init, uart_puts}
use std.text.{NL}

fn unaligned_access():
    """Access unaligned address."""
    unsafe:
        # Create unaligned pointer (odd address)
        val unaligned_addr = 0x80001001

        # Try to read 32-bit value from unaligned address
        val ptr = @address(unaligned_addr as u64) @volatile val: u32
        val value = ptr  # Should cause unaligned access fault

fn main():
    """Test kernel with unaligned access."""
    uart_init()
    uart_puts("About to crash (unaligned access)...\r{NL}")

    # Cause unaligned access
    unaligned_access()

    # Should never reach here
    uart_puts("ERROR: Survived crash!\r{NL}")
