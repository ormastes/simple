# RISC-V Stack Overflow Crash Test
#
# This kernel causes a stack overflow to test
# stack trace extraction and call depth analysis.

use baremetal.riscv.startup.{uart_init, uart_puts}
use std.text.{NL}

fn recursive_function(depth: i32):
    """Recursive function that overflows stack."""
    # Allocate stack space
    var buffer: [u8; 1024]

    # Recurse infinitely
    if depth < 1000:
        recursive_function(depth + 1)
    else:
        uart_puts("Depth {depth}\r{NL}")

fn main():
    """Test kernel with stack overflow."""
    uart_init()
    uart_puts("About to crash (stack overflow)...\r{NL}")

    # Cause stack overflow
    recursive_function(0)

    # Should never reach here
    uart_puts("ERROR: Survived crash!\r{NL}")
