# Enhanced C codegen test
# Tests: string ops, dynamic arrays, structs, enums, nil, use/export skip

use some.module (this_gets_skipped)
export also_skipped

struct Point:
    x: i64
    y: i64

enum Color:
    Red
    Green
    Blue

fn greet(name: text) -> text:
    "Hello, " + name + "!"

fn string_ops_test():
    val s = "Hello, World!"
    val has_world = s.contains("World")
    print "contains World: {has_world}"

    val starts = s.starts_with("Hello")
    print "starts with Hello: {starts}"

    val ends = s.ends_with("!")
    print "ends with !: {ends}"

    val sub = s.substring(0, 5)
    print "substring(0,5): {sub}"

    val idx = s.index_of(",") ?? -1
    print "index_of(,): {idx}"

    val trimmed = "  spaces  ".trim()
    print "trimmed: [{trimmed}]"

    val replaced = s.replace("World", "Simple")
    print "replaced: {replaced}"

    val slen = s.len()
    print "length: {slen}"

fn array_test():
    var parts: [text] = []
    parts.push("one")
    parts.push("two")
    parts.push("three")
    val joined = parts.join(", ")
    print "joined: {joined}"
    print "array len: {parts.len()}"

    # Split and iterate
    val csv = "a,b,c,d"
    val items = csv.split(",")
    print "split count: {items.len()}"
    for item in items:
        print "  item: {item}"

fn main():
    print "=== String Operations ==="
    string_ops_test()

    print ""
    print "=== Dynamic Arrays ==="
    array_test()

    print ""
    print "=== String Concat ==="
    val msg = greet("World")
    print msg

    print ""
    print "=== Nil Handling ==="
    var name = nil
    if name == nil:
        print "name is nil"
    name = "Alice"
    if name != nil:
        print "name is: {name}"

    print ""
    print "=== Old Features Still Work ==="
    val x = 42
    if x > 10:
        print "x > 10"
    for i in range(0, 3):
        print "  i = {i}"

    var acc = 0
    acc += 10
    acc -= 3
    print "acc = {acc}"

    print ""
    print "done"
