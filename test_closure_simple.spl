# Minimal test to verify closure analysis works

use std.spec
use core.lexer.{lex}
use core.parser.{parse}
use core.ast.{ast_reset}
use core.closure_analysis.{analyze_closure_capture, closure_warnings_get, closure_warnings_clear}

fn analyze_code(code: text) -> [text]:
    ast_reset()
    closure_warnings_clear()
    val tokens = lex(code)
    parse(tokens)
    analyze_closure_capture()
    closure_warnings_get()

describe "Test 1":
    it "simple test":
        val code = "var count = 0\nfn increment():\n    count = count + 1\n"
        val warnings = analyze_code(code)
        print "Warnings count: "
        print warnings.len()
        print "\n"
        for w in warnings:
            print w
            print "\n"
        expect(warnings.len()).to_be_greater_than(0)
