#!/usr/bin/env simple
# Comprehensive MCP file operations test

use app.io.mod (file_write, file_read, file_exists, file_delete, cwd)

fn main():
    print "=== MCP File Operations Test ==="
    print "Working directory: {cwd()}"
    print ""
    
    val test_file = "mcp_test_file.txt"
    val content1 = "Initial content\n"
    val content2 = "Updated content\n"
    
    # Test 1: Create file
    print "Test 1: Create file '{test_file}'"
    val created = file_write(test_file, content1)
    if created:
        print "  ✅ File created"
    else:
        print "  ❌ Failed to create file"
        return
    
    # Test 2: Verify file exists
    print "\nTest 2: Check file exists"
    if file_exists(test_file):
        print "  ✅ File exists"
    else:
        print "  ❌ File doesn't exist"
        return
    
    # Test 3: Read file
    print "\nTest 3: Read file content"
    val read_content = file_read(test_file)
    if read_content == content1:
        print "  ✅ Content matches: '{read_content.trim()}'"
    else:
        print "  ❌ Content mismatch"
        print "  Expected: '{content1.trim()}'"
        print "  Got: '{read_content.trim()}'"
    
    # Test 4: Write new content (overwrite)
    print "\nTest 4: Overwrite file with new content"
    val updated = file_write(test_file, content2)
    if updated:
        print "  ✅ File updated"
    else:
        print "  ❌ Failed to update file"
        return
    
    # Test 5: Verify updated content
    print "\nTest 5: Verify updated content"
    val new_content = file_read(test_file)
    if new_content == content2:
        print "  ✅ Content updated: '{new_content.trim()}'"
    else:
        print "  ❌ Content mismatch after update"
        print "  Expected: '{content2.trim()}'"
        print "  Got: '{new_content.trim()}'"
    
    # Test 6: Delete file
    print "\nTest 6: Delete file"
    val deleted = file_delete(test_file)
    if deleted:
        print "  ✅ File deleted"
    else:
        print "  ❌ Failed to delete file"
    
    # Test 7: Verify deletion
    print "\nTest 7: Verify file is gone"
    if not file_exists(test_file):
        print "  ✅ File no longer exists"
    else:
        print "  ❌ File still exists after deletion"
    
    print "\n=== All Tests Complete ==="
