# Simple Test Runner (Written in Simple)
#
# Refactored into modules for maintainability.
# See test_runner_*.spl files for implementation details.
#
# Usage:
#   simple_old src/app/test_runner_new/main.spl [path] [options]
#
# Options:
#   --unit              Run unit tests only
#   --integration       Run integration tests only
#   --system            Run system tests only
#   --fail-fast         Stop on first failure
#   --tag <name>        Filter by tag
#   --mode <mode>       Execution mode: interpreter (default), smf, native
#   --mode=<mode>       Equals syntax also supported
#   --timeout <secs>    Timeout per test file (default: 120)
#   --list              List test files without running
#   --list-ignored      List ignored tests
#   --only-slow         Run only slow tests
#   --only-skipped      Run only skipped tests
#   --show-tags         Show tags in output
#   --seed <N>          Shuffle tests deterministically
#   --safe-mode/--safe  Run in safe mode (subprocess, already default)
#   --force-rebuild     Force rebuild cached artifacts
#   --keep-artifacts    Keep compiled artifacts after run
#   --all               Run all tests including slow
#   --format doc        Nested RSpec-style output
#   --list-skip-features  List features from .skip files
#   --planned-only/--pending  Filter skip features to planned only
#   --gc-log            Enable GC logging
#   --gc=off            Disable GC

# Import all modules
use test_runner_types.*
use test_runner_args.*
use test_runner_files.*
use test_runner_execute.*
use test_runner_output.*
use test_runner_db.*
use test_runner_main.*

# New modules (Phase: Rust-to-Simple migration)
use string_interner.*
use test_db_types.*
use test_db_lock.*
use test_db_io.*
use test_db_parser.*
use test_db_serializer.*
use test_db_core.*
use test_stats.*
use test_db_validation.*
use test_config.*
use test_runner_parallel.*
use feature_db.*
use doc_generator.*
use doctest_runner.*
use rust_test_runner.*

# Re-export all public APIs
# Types
export TestExecutionMode, TestLevel, OutputFormat
export TestOptions, TestFileResult, TestRunResult
export SkipFeatureStatus, SkipFeatureInfo

# Args module
export parse_mode_str, parse_test_args

# Files module
export discover_test_files, shuffle_files
export extract_skip_feature_info, file_has_slow_test
export print_discovery_summary, is_test_file, strip_ansi, read_file_content

# Execute module
export find_simple_new_binary, find_runtime_lib_dir, find_simple_binary
export parse_test_output, extract_number_before
export build_child_args, make_result_from_output
export run_test_file_interpreter, run_test_file_smf
export run_test_file_native_old, run_test_file_native
export preprocess_sspec_file
export run_test_file_safe_mode
export list_tests_static

# Output module
export print_result_default, print_result_doc
export print_result, print_summary

# DB module (legacy)
export write_test_db_run, atomic_update_file_test_db
export acquire_file_lock, micros_to_iso

# New DB module
export TestDatabase, StringInterner, FileLock
export FeatureDatabase, FeatureRecord

# Stats module
export TimingStats, OutlierResult, OutlierMethod
export compute_statistics, detect_outliers, detect_outliers_mad, detect_outliers_zscore
export has_regression, has_significant_change, detect_flaky_test

# Validation module
export ValidationIssue, validate_database
export needs_qualification, count_unqualified_ignores

# Config module
export TestConfig, find_config_file

# Parallel execution
export ParallelConfig, run_tests_parallel

# Doc generation
export generate_all_docs

# Doctest
export extract_doctests, run_doctests

# Rust tests
export run_rust_tests, run_rust_doc_tests

# Main orchestration
export propagate_env_vars, run_tests, mode_to_str, run_single_test
export update_test_database
export main
