# FFI - Debug Operations
# Centralized debugging, ptrace, and DWARF FFI wrappers

# ============================================================================
# Debug Operations
# ============================================================================

extern fn rt_debug_is_active() -> i64

fn debug_is_active() -> i64:
    rt_debug_is_active()

extern fn rt_debug_set_active(active: i64)

fn debug_set_active(active: i64):
    rt_debug_set_active(active)

extern fn rt_debug_set_step_mode(mode: i64)

fn debug_set_step_mode(mode: i64):
    rt_debug_set_step_mode(mode)

extern fn rt_debug_pause()

fn debug_pause():
    rt_debug_pause()

extern fn rt_debug_continue()

fn debug_continue():
    rt_debug_continue()

# --- Breakpoints ---

extern fn rt_debug_add_breakpoint(file_ptr: i64, file_len: i64, line: i64) -> i64

fn debug_add_breakpoint(file: text, line: i64) -> i64:
    rt_debug_add_breakpoint(file.ptr(), file.len(), line)

extern fn rt_debug_remove_breakpoint(file_ptr: i64, file_len: i64, line: i64) -> i64

fn debug_remove_breakpoint(file: text, line: i64) -> i64:
    rt_debug_remove_breakpoint(file.ptr(), file.len(), line)

extern fn rt_debug_remove_all_breakpoints()

fn debug_remove_all_breakpoints():
    rt_debug_remove_all_breakpoints()

extern fn rt_debug_list_breakpoints() -> List<String>

fn debug_list_breakpoints() -> List<String>:
    rt_debug_list_breakpoints()

# --- Stack and Locals ---

extern fn rt_debug_stack_depth() -> i64

fn debug_stack_depth() -> i64:
    rt_debug_stack_depth()

extern fn rt_debug_stack_trace() -> List<String>

fn debug_stack_trace() -> List<String>:
    rt_debug_stack_trace()

extern fn rt_debug_locals() -> List<String>

fn debug_locals() -> List<String>:
    rt_debug_locals()

extern fn rt_debug_current_file() -> String

fn debug_current_file() -> String:
    rt_debug_current_file()

extern fn rt_debug_current_line() -> i64

fn debug_current_line() -> i64:
    rt_debug_current_line()

# ============================================================================
# Ptrace Operations (Linux Process Tracing)
# ============================================================================

extern fn rt_ptrace_attach(pid: i64) -> i64

fn ptrace_attach(pid: i64) -> i64:
    rt_ptrace_attach(pid)

extern fn rt_ptrace_detach(pid: i64) -> i64

fn ptrace_detach(pid: i64) -> i64:
    rt_ptrace_detach(pid)

extern fn rt_ptrace_continue(pid: i64) -> i64

fn ptrace_continue(pid: i64) -> i64:
    rt_ptrace_continue(pid)

extern fn rt_ptrace_single_step(pid: i64) -> i64

fn ptrace_single_step(pid: i64) -> i64:
    rt_ptrace_single_step(pid)

extern fn rt_ptrace_wait_stop(pid: i64) -> i64

fn ptrace_wait_stop(pid: i64) -> i64:
    rt_ptrace_wait_stop(pid)

extern fn rt_ptrace_get_registers(pid: i64) -> Dict<String, i64>

fn ptrace_get_registers(pid: i64) -> Dict<String, i64>:
    rt_ptrace_get_registers(pid)

extern fn rt_ptrace_read_memory(pid: i64, addr: i64, size: i64) -> List<i64>

fn ptrace_read_memory(pid: i64, addr: i64, size: i64) -> List<i64>:
    rt_ptrace_read_memory(pid, addr, size)

extern fn rt_ptrace_write_memory(pid: i64, addr: i64, data: i64) -> i64

fn ptrace_write_memory(pid: i64, addr: i64, data: i64) -> i64:
    rt_ptrace_write_memory(pid, addr, data)

# ============================================================================
# DWARF Operations (Debug Info Format)
# ============================================================================

extern fn rt_dwarf_load(binary_path: String) -> i64

fn dwarf_load(binary_path: String) -> i64:
    rt_dwarf_load(binary_path)

extern fn rt_dwarf_free(handle: i64)

fn dwarf_free(handle: i64):
    rt_dwarf_free(handle)

extern fn rt_dwarf_addr_to_line(handle: i64, addr: i64) -> String

fn dwarf_addr_to_line(handle: i64, addr: i64) -> String:
    rt_dwarf_addr_to_line(handle, addr)

extern fn rt_dwarf_line_to_addr(handle: i64, file: String, line: i64) -> i64

fn dwarf_line_to_addr(handle: i64, file: String, line: i64) -> i64:
    rt_dwarf_line_to_addr(handle, file, line)

extern fn rt_dwarf_function_at(handle: i64, addr: i64) -> String

fn dwarf_function_at(handle: i64, addr: i64) -> String:
    rt_dwarf_function_at(handle, addr)

extern fn rt_dwarf_locals_at(handle: i64, addr: i64, frame_base: i64) -> List<String>

fn dwarf_locals_at(handle: i64, addr: i64, frame_base: i64) -> List<String>:
    rt_dwarf_locals_at(handle, addr, frame_base)
