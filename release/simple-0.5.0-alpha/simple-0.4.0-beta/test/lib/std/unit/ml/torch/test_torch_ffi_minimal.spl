"""
Minimal Torch FFI Test
Tests the exact pattern that was failing in torch tests
"""

# These are the actual extern declarations from torch
extern fn rt_torch_linalg_det(x: u64) -> u64
extern fn rt_torch_linalg_inv(x: u64) -> u64
extern fn rt_torch_clamp(x: u64, min: f64, max: f64) -> u64
extern fn rt_torch_relu(x: u64) -> u64

fn test_linalg_det():
    """Test the original failing case from linalg.spl"""
    val dummy_handle = 12345u64

    # This was failing with: Undefined("undefined identifier: @rt_torch_linalg_det")
    val handle = @rt_torch_linalg_det(dummy_handle)

    print "✓ linalg.det FFI call works"

fn test_linalg_inv():
    """Test linalg.inv"""
    val dummy_handle = 12345u64
    val handle = @rt_torch_linalg_inv(dummy_handle)
    print "✓ linalg.inv FFI call works"

fn test_simple_math_clamp():
    """Test from simple_math.spl"""
    val dummy_handle = 12345u64
    val clamped = @rt_torch_clamp(dummy_handle, -1.0, 1.0)
    print "✓ simple_math.clamp FFI call works"

fn test_nn_relu():
    """Test from nn/activations.spl"""
    val dummy_handle = 12345u64
    val output = @rt_torch_relu(dummy_handle)
    print "✓ nn.relu FFI call works"

fn main():
    print "Testing Torch FFI Patterns..."
    print ""
    print "These are the exact patterns that were failing:"
    print ""

    test_linalg_det()
    test_linalg_inv()
    test_simple_math_clamp()
    test_nn_relu()

    print ""
    print "✅ All torch FFI patterns now work!"
    print ""
    print "Original error was:"
    print "  semantic: Undefined(\"undefined identifier: @rt_torch_linalg_det\")"
    print ""
    print "Root cause:"
    print "  @ prefix not stripped in HIR lowerer and type checker"
    print ""
    print "Fix applied to:"
    print "  1. src/rust/compiler/src/hir/lower/expr/mod.rs"
    print "  2. src/rust/type/src/checker_infer.rs"
