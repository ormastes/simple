"""
Unit Tests for @ FFI Operator
Minimal focused tests for the specific fix
"""

# Test 1: Basic @ operator resolution
extern fn rt_basic_test() -> i64

fn test_basic_ffi_call():
    val result = @rt_basic_test()
    print "✓ Basic @ FFI call compiled"

# Test 2: @ with arguments
extern fn rt_add(a: i64, b: i64) -> i64

fn test_ffi_with_args():
    val result = @rt_add(10, 20)
    print "✓ @ FFI call with arguments compiled"

# Test 3: Multiple @ calls
extern fn rt_mul(a: i64, b: i64) -> i64

fn test_multiple_ffi():
    val x = @rt_add(5, 3)
    val y = @rt_mul(2, 4)
    print "✓ Multiple @ FFI calls compiled"

# Test 4: @ in expression
extern fn rt_get() -> i64

fn test_ffi_in_expression():
    val result = @rt_get() + 100
    print "✓ @ FFI in expression compiled"

# Test 5: Nested @ calls
extern fn rt_double(x: i64) -> i64

fn test_nested_ffi():
    val result = @rt_double(@rt_double(5))
    print "✓ Nested @ FFI calls compiled"

# Test 6: Type checking with @
extern fn rt_get_u64() -> u64
extern fn rt_get_f64() -> f64

fn test_ffi_type_checking():
    val u: u64 = @rt_get_u64()
    val f: f64 = @rt_get_f64()
    print "✓ Type checking for @ FFI calls passed"

# Main test runner
fn main():
    print "Testing @ FFI Operator Fix..."
    print ""

    test_basic_ffi_call()
    test_ffi_with_args()
    test_multiple_ffi()
    test_ffi_in_expression()
    test_nested_ffi()
    test_ffi_type_checking()

    print ""
    print "✅ All @ FFI operator tests passed!"
    print ""
    print "This confirms:"
    print "  1. HIR lowerer strips @ prefix correctly"
    print "  2. Type checker handles @ identifiers"
    print "  3. @ operator works in all contexts"
