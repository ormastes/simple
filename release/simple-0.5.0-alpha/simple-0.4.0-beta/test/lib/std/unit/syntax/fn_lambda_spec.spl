# @pending
"""
# Lambda Syntax fn() Specification

**Category:** Syntax
**Status:** Implemented

Tests for fn() lambda syntax and its interchangeability with the \\ operator.
The fn() syntax provides an alternative way to define lambdas and is compatible
with BDD framework blocks like describe/context/it.
"""


describe "fn() Lambda Syntax":
    """
    Verifies the fn() lambda syntax for defining anonymous functions.
    This syntax is an alias for the backslash operator (\:) and supports
    parameters, multiple expressions, and nested contexts.
    """

    describe "basic inline lambdas":
        """
        Tests basic fn() lambda syntax with simple expressions.
        """

        it "supports fn() with no parameters":
            fn call_it(f) -> i64:
                f()

            val result = call_it(fn(): 42)
            expect result == 42

        it "supports fn(x) with single parameter":
            fn apply(x: i64, f) -> i64:
                f(x)

            val result = apply(5, fn(n): n * 2)
            expect result == 10

        it "supports fn(x, y) with multiple parameters":
            fn apply2(x: i64, y: i64, f) -> i64:
                f(x, y)

            val result = apply2(3, 4, fn(a, b): a + b)
            expect result == 7

    describe "block lambdas":
        """
        Tests fn() syntax with indented blocks containing multiple expressions.
        """

        it "supports fn() with indented block":
            fn execute(f) -> i64:
                f()

            fn sum_xy() -> i64:
                val x = 10
                val y = 20
                x + y

            val result = execute(sum_xy)
            expect result == 30

        it "supports fn(x) with parameter and block":
            fn transform(x: i64, f) -> i64:
                f(x)

            fn compute_square(n) -> i64:
                val doubled = n * 2
                val squared = doubled * doubled
                squared

            val result = transform(5, compute_square)
            expect result == 100

    describe "nested lambdas":
        """
        Tests fn() syntax with nested lambda definitions.
        """

        it "supports nested fn() lambdas":
            fn outer(f):
                f

            fn inner(g) -> i64:
                g()

            val result = inner(outer(fn(): 99))
            expect result == 99

    describe "compatibility with backslash operator":
        """
        Verifies that fn() and \\ syntax are interchangeable and can be mixed.
        """

        it "fn() and \\ are interchangeable":
            fn test_sum(f1, f2) -> i64:
                f1() + f2()

            # Mix both syntaxes
            val result = test_sum(fn(): 10, \: 20)
            expect result == 30

    describe "used in BDD framework":
        """
        Tests fn() lambda syntax within BDD framework context blocks.
        """

        it "works with context/it blocks":
            var executed = false

            fn mock_context(name: text, block):
                block()

            fn set_executed():
                executed = true

            mock_context("test", set_executed)

            expect executed == true
