# @Feature 803: Config Module - Comprehensive Tests
# @Description: Test configuration loading and management (54 branches)

use std.src.config.*

# ============================================================================
# Test Group 1: LogConfig Creation (5 factory methods)
# ============================================================================

describe "LogConfig default":
    it "creates default log config":
        val config = LogConfig.default()
        expect config.global_level == 4  # INFO
        expect config.timestamps == true
        expect config.format == "text"
        expect config.scopes.len() == 0

describe "LogConfig testing":
    it "creates testing log config":
        val config = LogConfig.testing()
        expect config.global_level == 5  # DEBUG
        expect config.timestamps == false
        expect config.format == "text"

describe "LogConfig development":
    it "creates development log config":
        val config = LogConfig.development()
        expect config.global_level == 5  # DEBUG
        expect config.timestamps == true

describe "LogConfig production":
    it "creates production log config":
        val config = LogConfig.production()
        expect config.global_level == 3  # WARN
        expect config.format == "json"
        expect config.timestamps == true

describe "LogConfig sdn":
    it "creates SDN log config":
        val config = LogConfig.sdn()
        expect config.global_level == 2  # ERROR
        expect config.timestamps == false

# ============================================================================
# Test Group 2: DiConfig Creation (4 factory methods)
# ============================================================================

describe "DiConfig default":
    it "creates default DI config":
        val config = DiConfig.default()
        expect config.profile == "dev"
        expect config.bindings.len() == 0

describe "DiConfig testing":
    it "creates testing DI config":
        val config = DiConfig.testing()
        expect config.profile == "test"

describe "DiConfig development":
    it "creates development DI config":
        val config = DiConfig.development()
        expect config.profile == "dev"

describe "DiConfig production":
    it "creates production DI config":
        val config = DiConfig.production()
        expect config.profile == "prod"

# ============================================================================
# Test Group 3: ParserConfig Creation (4 factory methods)
# ============================================================================

describe "ParserConfig default":
    it "creates default parser config":
        val config = ParserConfig.default()
        expect config.mode == "full"
        expect config.error_recovery == true
        expect config.max_errors == 100

describe "ParserConfig testing":
    it "creates testing parser config":
        val config = ParserConfig.testing()
        expect config.error_recovery == false

describe "ParserConfig development":
    it "creates development parser config":
        val config = ParserConfig.development()
        expect config.error_recovery == true

describe "ParserConfig production":
    it "creates production parser config":
        val config = ParserConfig.production()
        expect config.error_recovery == false

# ============================================================================
# Test Group 4: AopConfig Creation (4 factory methods)
# ============================================================================

describe "AopConfig default":
    it "creates default AOP config":
        val config = AopConfig.default()
        expect config.enabled == true
        expect config.log_calls == false
        expect config.log_errors == true
        expect config.log_level == 4  # INFO

describe "AopConfig testing":
    it "creates testing AOP config":
        val config = AopConfig.testing()
        expect config.enabled == true
        expect config.log_calls == true
        expect config.log_level == 5  # DEBUG

describe "AopConfig development":
    it "creates development AOP config":
        val config = AopConfig.development()
        expect config.enabled == true
        expect config.log_errors == true

describe "AopConfig production":
    it "creates production AOP config":
        val config = AopConfig.production()
        expect config.enabled == false

# ============================================================================
# Test Group 5: ExecutionConfig Creation (4 factory methods)
# ============================================================================

describe "ExecutionConfig default":
    it "creates default execution config":
        val config = ExecutionConfig.default()
        expect config.mode == "interpret"
        expect config.debug == false
        expect config.optimize == 0
        expect config.gc_threshold > 0

describe "ExecutionConfig testing":
    it "creates testing execution config":
        val config = ExecutionConfig.testing()
        expect config.debug == true
        expect config.optimize == 0

describe "ExecutionConfig development":
    it "creates development execution config":
        val config = ExecutionConfig.development()
        expect config.debug == true

describe "ExecutionConfig production":
    it "creates production execution config":
        val config = ExecutionConfig.production()
        expect config.mode == "jit"
        expect config.debug == false
        expect config.optimize == 3

# ============================================================================
# Test Group 6: AppConfig Creation (4 factory methods)
# ============================================================================

describe "AppConfig default":
    it "creates default app config":
        val config = AppConfig.default()
        expect config.log.global_level == 4
        expect config.di.profile == "dev"
        expect config.parser.mode == "full"
        expect config.aop.enabled == true
        expect config.execution.mode == "interpret"

describe "AppConfig testing":
    it "creates testing app config":
        val config = AppConfig.testing()
        expect config.log.global_level == 5
        expect config.di.profile == "test"
        expect config.aop.log_calls == true
        expect config.execution.debug == true

describe "AppConfig development":
    it "creates development app config":
        val config = AppConfig.development()
        expect config.log.global_level == 5
        expect config.di.profile == "dev"
        expect config.execution.debug == true

describe "AppConfig production":
    it "creates production app config":
        val config = AppConfig.production()
        expect config.log.global_level == 3
        expect config.log.format == "json"
        expect config.di.profile == "prod"
        expect config.aop.enabled == false
        expect config.execution.mode == "jit"
        expect config.execution.optimize == 3

# ============================================================================
# Test Group 7: Direct Construction
# ============================================================================

describe "Direct config construction":
    it "constructs LogConfig directly":
        val config = LogConfig(
            global_level: 10,
            scopes: {"test": 5},
            timestamps: false,
            format: "json"
        )
        expect config.global_level == 10
        expect config.scopes.len() == 1
        expect config.format == "json"

    it "constructs DiConfig directly":
        val config = DiConfig(
            profile: "custom",
            bindings: {"Foo": "BarImpl"}
        )
        expect config.profile == "custom"
        expect config.bindings.len() == 1

    it "constructs ParserConfig directly":
        val config = ParserConfig(
            mode: "outline",
            error_recovery: true,
            max_errors: 50
        )
        expect config.mode == "outline"
        expect config.max_errors == 50

    it "constructs AopConfig directly":
        val config = AopConfig(
            enabled: false,
            log_calls: false,
            log_errors: false,
            log_level: 0
        )
        expect config.enabled == false
        expect config.log_level == 0

    it "constructs ExecutionConfig directly":
        val config = ExecutionConfig(
            mode: "aot",
            debug: false,
            optimize: 2,
            gc_threshold: 1000000
        )
        expect config.mode == "aot"
        expect config.optimize == 2
        expect config.gc_threshold == 1000000
