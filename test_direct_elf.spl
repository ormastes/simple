# Standalone test for direct ELF writing

# Direct FFI
extern fn rt_file_write_bytes(path: text, data: [u8]) -> bool
extern fn rt_file_read_bytes(path: text) -> [i64]
extern fn rt_file_exists(path: text) -> bool
extern fn rt_file_delete(path: text) -> bool

fn test_write_elf():
    # Create minimal ELF file
    val elf_bytes: [u8] = [127, 69, 76, 70, 2, 1, 1, 0]
    val test_path = "/tmp/test_elf.o"

    # Write file
    val success = rt_file_write_bytes(test_path, elf_bytes)
    print "Write success: {success}"

    # Verify exists
    val exists = rt_file_exists(test_path)
    print "File exists: {exists}"

    # Read back and verify
    if exists:
        val read_bytes = rt_file_read_bytes(test_path)
        print "Read {read_bytes.len()} bytes"
        if read_bytes.len() >= 4:
            print "Magic: [{read_bytes[0]}, {read_bytes[1]}, {read_bytes[2]}, {read_bytes[3]}]"
            val valid = read_bytes[0] == 127 and read_bytes[1] == 69 and read_bytes[2] == 76 and read_bytes[3] == 70
            print "Valid ELF magic: {valid}"

        # Cleanup
        rt_file_delete(test_path)

test_write_elf()
