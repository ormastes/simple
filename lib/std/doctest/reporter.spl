/// Doctest Reporter
/// 
/// Formats and reports doctest results

use runner::{ExampleResult}
use matcher::{MatchResult}

/// Report summary of doctest run
struct DoctestReport:
    total: Int
    passed: Int
    failed: Int
    execution_time_ms: Int
    
    fn pass_rate(self) -> Float:
        if self.total == 0:
            return 0.0
        return (self.passed as Float) / (self.total as Float)

/// Format results as human-readable output
fn format_results(results: List[ExampleResult]) -> String:
    output = []
    
    for result in results:
        location = result.example.location.to_string()
        status = if result.passed() then "✓" else "✗"
        code_summary = result.example.code.join("; ")
        
        line = "${location}: ${status} ${code_summary}"
        output.push(line)
        
        # Show failure details
        if not result.passed():
            match result.result:
                case MatchResult.Fail(msg):
                    output.push("  ${msg}")
    
    return output.join("\n")

/// Generate summary report
fn generate_summary(results: List[ExampleResult]) -> DoctestReport:
    total = results.len
    passed = results.filter(|r| r.passed()).len
    failed = total - passed
    total_time = results.map(|r| r.execution_time_ms).sum()
    
    return DoctestReport(
        total: total,
        passed: passed,
        failed: failed,
        execution_time_ms: total_time
    )

/// Print summary to console
fn print_summary(report: DoctestReport):
    print "Finished in ${report.execution_time_ms}ms"
    print "${report.total} examples, ${report.failed} failures"
    if report.failed == 0:
        print "All doctests passed! ✓"
    else:
        print "Pass rate: ${(report.pass_rate() * 100).round()}%"
