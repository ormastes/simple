# Dependency Injection Container
#
# Simple DI container for compiler services.

# Local panic function for DI errors
fn di_panic(msg: text):
    print "DI PANIC: {msg}"
    # Return early - caller should check for valid binding

class DiContainer:
    """Dependency injection container."""
    bindings: Dict<text, fn() -> Any>
    singletons: Dict<text, Any>
    profile: text

impl DiContainer:
    me bind(name: text, factory: fn() -> Any):
        """Bind a factory function to a name."""
        var b = self.bindings
        b[name] = factory
        self.bindings = b

    fn resolve(name: text) -> Any:
        """Resolve a binding by name."""
        if self.singletons.contains(name):
            return self.singletons[name]
        if self.bindings.contains(name):
            val instance = self.bindings[name]()
            return instance
        di_panic("No binding found for: {name}")
        nil  # Return nil on error
