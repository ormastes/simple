# Simple Language Server
# LSP server for Simple language (self-hosted implementation)
# Usage: simple_lsp (communicates via stdin/stdout)

import sys
import lsp.server as server
import lsp.transport as transport

fn main():
    # Check for help flag
    val args = sys.args()
    if args.contains("--help") or args.contains("-h"):
        print_usage()
        sys.exit(0)

    # Check for version flag
    if args.contains("--version") or args.contains("-v"):
        print("simple-lsp 0.1.0")
        print("Simple Language Server (LSP)")
        sys.exit(0)

    # Log startup (only if debug enabled)
    transport.log_debug("Starting Simple LSP server")

    # Create and run server
    val lsp_server = server.LspServer.new()

    match lsp_server.run():
        case Ok(_):
            transport.log_debug("LSP server exited normally")
            sys.exit(0)
        case Err(error):
            transport.log_error("LSP server error: {error}")
            sys.exit(1)

fn print_usage():
    print("Simple Language Server (LSP)")
    print("")
    print("Usage: simple_lsp [options]")
    print("")
    print("The language server communicates via stdin/stdout using the")
    print("Language Server Protocol (LSP) with JSON-RPC 2.0 messages.")
    print("")
    print("Options:")
    print("  -h, --help       Show this help message")
    print("  -v, --version    Show version information")
    print("")
    print("Environment Variables:")
    print("  SIMPLE_LSP_DEBUG  Enable debug logging to stderr")
    print("")
    print("Editor Integration:")
    print("  VS Code: Configure in settings.json")
    print("    \"simple.lsp.path\": \"path/to/simple_lsp\"")
    print("")
    print("  Neovim: Use nvim-lspconfig")
    print("    require('lspconfig').simple.setup{}")
    print("")
    print("Documentation:")
    print("  https://github.com/simple-lang/simple/doc/status/lsp_implementation.md")
