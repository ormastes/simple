# Conditional Statements
#
# if/elif/else evaluation.

import ..core.{Interpreter, Value, InterpreterError}
import ..expr.{evaluate}

export eval_if, eval_elif

# Evaluate an if statement
fn eval_if(interp: &Interpreter, condition: &Expr, then_block: &Block, else_branch: Option[&ElseBranch]) -> Result[Value, InterpreterError]:
    # Evaluate condition
    let cond_val = evaluate(interp, condition)?

    if cond_val.is_truthy():
        # Execute then block
        return interp.eval_block(then_block)
    else:
        # Check for else branch
        match else_branch:
            case Some(branch):
                return eval_else_branch(interp, branch)
            case None:
                return Ok(Value::nil())

# Evaluate an elif chain
fn eval_elif(interp: &Interpreter, condition: &Expr, then_block: &Block, else_branch: Option[&ElseBranch]) -> Result[Value, InterpreterError]:
    # Same logic as if
    return eval_if(interp, condition, then_block, else_branch)

# Evaluate else branch (could be else block or elif)
fn eval_else_branch(interp: &Interpreter, branch: &ElseBranch) -> Result[Value, InterpreterError]:
    match branch:
        case ElseBranch::Else(block):
            return interp.eval_block(block)

        case ElseBranch::ElseIf { condition, then_block, else_branch }:
            return eval_if(interp, condition, then_block, *else_branch)
