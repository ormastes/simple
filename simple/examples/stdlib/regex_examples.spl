# Regular Expression Examples
#
# Demonstrates practical usage of Simple's regex utilities
# for common text processing tasks.

import tooling.regex_utils.{
    regex_is_match, regex_find, regex_find_all,
    regex_captures, regex_replace, regex_replace_all,
    regex_split, is_valid_email, is_valid_url,
    extract_emails, extract_numbers, extract_words
}

# ============================================================================
# Example 1: Email Validation and Extraction
# ============================================================================

fn example_email_processing():
    print("\n=== Example 1: Email Processing ===")

    val text = """
    Please contact support@example.com for help.
    Sales inquiries: sales@company.org
    Invalid email: not-an-email
    Another valid: user.name+tag@test.co.uk
    """

    # Validate individual emails
    val test_emails = ["support@example.com", "not-an-email", "user@test.org"]
    for email in test_emails:
        if is_valid_email(email):
            print("âœ“ Valid: {email}")
        else:
            print("âœ— Invalid: {email}")

    # Extract all emails from text
    val emails = extract_emails(text)
    print("\nFound {emails.len()} emails:")
    for email in emails:
        print("  - {email}")

# ============================================================================
# Example 2: Phone Number Formatting
# ============================================================================

fn example_phone_formatting():
    print("\n=== Example 2: Phone Number Formatting ===")

    val phones = [
        "5551234567",
        "555-123-4567",
        "555.123.4567",
        "(555) 123-4567"
    ]

    # Normalize all to XXX-XXX-XXXX format
    for phone in phones:
        # Extract just the digits
        val digits = regex_replace_all(r"[^\d]", phone, "")

        # Format as XXX-XXX-XXXX if we have 10 digits
        if digits.len() == 10:
            match regex_captures(r"(\d{3})(\d{3})(\d{4})", digits):
                case Some(caps):
                    val formatted = "{caps.groups[0]}-{caps.groups[1]}-{caps.groups[2]}"
                    print("{phone} â†’ {formatted}")
                case None:
                    print("{phone} â†’ (invalid)")
        else:
            print("{phone} â†’ (wrong length)")

# ============================================================================
# Example 3: Log File Parsing
# ============================================================================

fn example_log_parsing():
    print("\n=== Example 3: Log File Parsing ===")

    val log_lines = [
        "[2026-01-20 14:32:15] ERROR: Connection timeout at 192.168.1.100",
        "[2026-01-20 14:32:16] INFO: Request processed in 42ms",
        "[2026-01-20 14:32:17] WARN: High memory usage: 85%",
        "[2026-01-20 14:32:18] ERROR: Failed to connect to database"
    ]

    # Pattern to extract log components
    val log_pattern = r"\[([^\]]+)\]\s+(\w+):\s+(.+)"

    for line in log_lines:
        match regex_captures(log_pattern, line):
            case Some(caps):
                val timestamp = caps.groups[0].unwrap()
                val level = caps.groups[1].unwrap()
                val message = caps.groups[2].unwrap()

                if level == "ERROR":
                    print("ðŸ”´ [{timestamp}] {message}")
                else if level == "WARN":
                    print("ðŸŸ¡ [{timestamp}] {message}")
                else:
                    print("  [{timestamp}] {message}")
            case None:
                print("Invalid log line: {line}")

# ============================================================================
# Example 4: Data Sanitization
# ============================================================================

fn example_data_sanitization():
    print("\n=== Example 4: Data Sanitization ===")

    val sensitive_data = """
    Credit card: 1234-5678-9012-3456
    SSN: 123-45-6789
    Email: john.doe@example.com
    Phone: 555-123-4567
    """

    # Redact credit cards
    var sanitized = regex_replace_all(
        r"\b\d{4}-\d{4}-\d{4}-\d{4}\b",
        sensitive_data,
        "****-****-****-****"
    )

    # Redact SSNs
    sanitized = regex_replace_all(
        r"\b\d{3}-\d{2}-\d{4}\b",
        sanitized,
        "***-**-****"
    )

    # Redact emails (keep domain)
    sanitized = regex_replace_all(
        r"\b[a-zA-Z0-9._%+-]+@",
        sanitized,
        "****@"
    )

    print("Original length: {sensitive_data.len()} chars")
    print("Sanitized:\n{sanitized}")

# ============================================================================
# Example 5: Code Comment Extraction
# ============================================================================

fn example_comment_extraction():
    print("\n=== Example 5: Comment Extraction ===")

    val code = """
    # This is a comment
    fn hello():
        print("Hello")  # Inline comment
        # Another comment
        return 42
    """

    # Extract all comments (lines starting with # or inline #)
    val comment_pattern = r"#\s*(.+?)(?:\n|$)"
    val comments = regex_find_all(comment_pattern, code)

    print("Found {comments.len()} comments:")
    for match in comments:
        print("  - {match.text.trim()}")

# ============================================================================
# Example 6: URL Parameter Parsing
# ============================================================================

fn example_url_parsing():
    print("\n=== Example 6: URL Parameter Parsing ===")

    val url = "https://example.com/search?q=simple+lang&page=2&sort=desc"

    # Extract query parameters
    val param_pattern = r"([^&=?]+)=([^&]*)"
    val params = regex_find_all(param_pattern, url)

    print("URL: {url}\nParameters:")
    for match in params:
        # Would need capture groups here, showing simplified version
        print("  - Found parameter: {match.text}")

# ============================================================================
# Example 7: Text Transformation
# ============================================================================

fn example_text_transformation():
    print("\n=== Example 7: Text Transformation ===")

    # Convert snake_case to camelCase
    fn to_camel_case(text: text) -> text:
        # Replace _x with X
        regex_replace_all(r"_([a-z])", text, \m: m.groups[0].unwrap().to_upper())

    # Convert CamelCase to snake_case
    fn to_snake_case(text: text) -> text:
        # Insert _ before uppercase letters
        var result = regex_replace_all(r"([A-Z])", text, "_$1")
        result.to_lower()

    val examples = [
        "hello_world",
        "getUserName",
        "HTTPServer",
        "simple_lang_compiler"
    ]

    for example in examples:
        print("{example}")
        # Would show transformations here

# ============================================================================
# Example 8: Markdown Link Extraction
# ============================================================================

fn example_markdown_links():
    print("\n=== Example 8: Markdown Link Extraction ===")

    val markdown = """
    Check out [Simple Lang](https://simple-lang.org) for more info.
    Also see the [documentation](https://docs.simple-lang.org/guide).
    And [this link](https://example.com/path?query=value).
    """

    # Pattern for markdown links: [text](url)
    val link_pattern = r"\[([^\]]+)\]\(([^\)]+)\)"
    val links = regex_find_all(link_pattern, markdown)

    print("Found {links.len()} links:")
    for match in links:
        # Would extract text and URL from capture groups
        print("  - {match.text}")

# ============================================================================
# Example 9: Data Validation
# ============================================================================

fn example_data_validation():
    print("\n=== Example 9: Data Validation ===")

    struct UserInput:
        email: text
        url: text
        phone: text

    val inputs = [
        UserInput("user@example.com", "https://example.com", "555-123-4567"),
        UserInput("invalid-email", "not-a-url", "123"),
        UserInput("test@test.org", "http://localhost", "555.123.4567")
    ]

    for input in inputs:
        print("\nValidating input:")
        print("  Email: {input.email} â†’ {if is_valid_email(input.email) then "âœ“" else "âœ—"}")
        print("  URL: {input.url} â†’ {if is_valid_url(input.url) then "âœ“" else "âœ—"}")
        print("  Phone: {input.phone} â†’ {if is_valid_phone_us(input.phone) then "âœ“" else "âœ—"}")

# ============================================================================
# Example 10: Text Statistics
# ============================================================================

fn example_text_statistics():
    print("\n=== Example 10: Text Statistics ===")

    val text = """
    Simple is a programming language designed for clarity and simplicity.
    It features 42 built-in functions and supports 3 paradigms.
    Contact us at info@simple-lang.org for more information.
    """

    val word_count = extract_words(text).len()
    val number_count = extract_numbers(text).len()
    val email_count = extract_emails(text).len()
    val sentence_count = regex_find_all(r"[.!?]+", text).len()

    print("Text Statistics:")
    print("  Words: {word_count}")
    print("  Numbers: {number_count}")
    print("  Emails: {email_count}")
    print("  Sentences: {sentence_count}")

# ============================================================================
# Main
# ============================================================================

fn main():
    print("========================================")
    print("  Simple Language: Regex Examples")
    print("========================================")

    example_email_processing()
    example_phone_formatting()
    example_log_parsing()
    example_data_sanitization()
    example_comment_extraction()
    example_url_parsing()
    example_text_transformation()
    example_markdown_links()
    example_data_validation()
    example_text_statistics()

    print("\n========================================")
    print("  All examples complete!")
    print("========================================")

# Run examples
if __name__ == "__main__":
    main()
