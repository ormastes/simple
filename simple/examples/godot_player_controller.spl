# Godot Player Controller Example
#
# Demonstrates Simple language integration with Godot Engine.
# This script can be attached to a Node2D in Godot and will control
# player movement using WASD keys.
#
# Usage in Godot:
# 1. Build Simple GDExtension library
# 2. Load this script on a Node2D or Sprite2D
# 3. Run the game

import godot.node2d
import godot.signal
import godot.variant

# Player controller class
# In Godot, this will be registered as a custom node type
class PlayerController extends godot.node2d.Node2D:
    # Properties
    speed: f64 = 200.0
    velocity: (f64, f64) = (0.0, 0.0)

    # Called when node enters the scene tree
    pub fn _ready(mut self):
        println("Player controller ready!")
        
        # Get initial position
        let (x, y) = self.get_position()
        println(f"Starting position: ({x}, {y})")

    # Called every frame
    pub fn _process(mut self, delta: f64):
        # Get input (simplified - actual input handling TBD)
        let mut move_x: f64 = 0.0
        let mut move_y: f64 = 0.0

        # Move based on input
        # TODO: Integrate with Godot Input singleton
        # if Input.is_action_pressed("move_right"):
        #     move_x = 1.0
        # if Input.is_action_pressed("move_left"):
        #     move_x = -1.0
        # ...

        # Update velocity
        self.velocity = (move_x * self.speed, move_y * self.speed)

        # Get current position
        let (x, y) = self.get_position()

        # Update position
        let new_x = x + self.velocity.0 * delta
        let new_y = y + self.velocity.1 * delta
        self.set_position(new_x, new_y)

    # Custom method callable from Godot
    pub fn take_damage(mut self, amount: i64):
        println(f"Player took {amount} damage!")

        # Emit signal to notify other systems
        let damage_signal = godot.signal.Signal::new(
            self.as_node().as_object(),
            "health_changed"
        )
        let damage_var = godot.variant.Variant::from_int(amount)
        damage_signal.emit1(damage_var)

    # Collision callback
    pub fn _on_body_entered(mut self, body: godot.node.Node):
        let body_name = body.get_name()
        println(f"Collided with: {body_name}")

        # Check if it's an enemy
        if body_name.starts_with("Enemy"):
            self.take_damage(10)

# Main entry point for standalone testing
fn main():
    println("Godot Player Controller Example")
    println("This file should be loaded as a GDExtension in Godot.")
    println("")
    println("To use:")
    println("1. Build Simple GDExtension library")
    println("2. Add to Godot project")
    println("3. Attach PlayerController to a Node2D")
