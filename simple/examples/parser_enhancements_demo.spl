# Parser Enhancements Demo
# Demonstrates all 7 major parser enhancements implemented for ML/Physics modules

# ============================================================================
# Enhancement 1: Bare Exports
# ============================================================================
export DemoClass, helper_function

# ============================================================================
# Enhancement 2: Triple-Quoted Strings (Docstrings)
# ============================================================================
"""This is a module-level docstring.

It can span multiple lines and doesn't support f-string interpolation.
Perfect for documentation!
"""

# ============================================================================
# Enhancement 3: Bare Module Imports
# ============================================================================
# These work now (single-segment imports treated as import *)
# use core
# import torch

# ============================================================================
# Enhancement 4: Module-Qualified Static Method Calls
# ============================================================================
class Device:
    """Device enumeration."""

    fn CPU() -> Device:
        """Create CPU device."""
        return Device()

    fn CUDA(id: i32) -> Device:
        """Create CUDA device."""
        return Device()

# ============================================================================
# Enhancement 5 & 6: Multiline Function Parameters + Docstrings in Classes
# ============================================================================
class DemoClass:
    """Demo class showing Python-style syntax.

    This docstring is parsed correctly thanks to enhancement #3.
    The class demonstrates multiline parameters and other features.
    """

    name: str
    value: f64
    device: Device

    fn __init__(
        self,
        name: str = "default",
        value: f64 = 0.0,
        device: Device = Device::CPU()
    ):
        """Initialize demo class.

        Args:
            name: Object name
            value: Initial value
            device: Compute device
        """
        self.name = name
        self.value = value
        self.device = device

    fn process(
        self,
        input: f64,
        scale: f64 = 1.0,
        offset: f64 = 0.0
    ) -> f64:
        """Process input value.

        Demonstrates multiline parameters in methods.

        Args:
            input: Input value
            scale: Scaling factor
            offset: Offset to add

        Returns:
            Processed value
        """
        return (input * scale) + offset

# ============================================================================
# Enhancement 7: Keyword Path Segments
# ============================================================================
# Can use 'result', 'crate', etc. in module paths
# import result.handling
# from crate.utils import helper

# ============================================================================
# Helper Function (for bare export demo)
# ============================================================================
fn helper_function(x: f64, y: f64) -> f64:
    """Helper function exported at module level.

    Args:
        x: First value
        y: Second value

    Returns:
        Sum of values
    """
    return x + y

# ============================================================================
# Main Function
# ============================================================================
fn main():
    """Test all parser enhancements."""

    # Test 1: Create object with multiline constructor
    let obj = DemoClass(
        name="test",
        value=42.0,
        device=Device::CPU()
    )

    # Test 2: Call method with multiline parameters
    let result = obj.process(
        input=10.0,
        scale=2.0,
        offset=5.0
    )

    # Test 3: Use helper function (bare export)
    let sum = helper_function(result, 3.0)

    print(f"Result: {result}")
    print(f"Sum: {sum}")

    return 0
