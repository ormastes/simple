# Time Module - Unified time and sleep functions
# Provides high-level time measurement and sleep functionality

# FFI declarations
extern fn rt_time_now_unix_micros() -> i32
extern fn rt_thread_sleep(millis: i64)

# ============================================================================
# Time Measurement
# ============================================================================

#[allow(primitive_api)]
pub fn now_micros() -> i64:
    """Get current time in microseconds since Unix epoch.

    Returns:
        Microseconds since 1970-01-01 00:00:00 UTC

    Example:
        val start = time.now_micros()
        # ... do work ...
        val elapsed = time.now_micros() - start
    """
    rt_time_now_unix_micros() as i64

#[allow(primitive_api)]
pub fn now_nanos() -> i64:
    """Get current time in nanoseconds (approximate).

    Note: This is an approximation based on microsecond precision.
    True nanosecond precision is not available.

    Returns:
        Approximate nanoseconds since Unix epoch

    Example:
        val start = time.now_nanos()
        # ... do work ...
        val elapsed = time.now_nanos() - start
    """
    rt_time_now_unix_micros() as i64 * 1000

#[allow(primitive_api)]
pub fn now_ms() -> i64:
    """Get current time in milliseconds since Unix epoch.

    Returns:
        Milliseconds since 1970-01-01 00:00:00 UTC

    Example:
        val timestamp = time.now_ms()
    """
    rt_time_now_unix_micros() as i64 / 1000

#[allow(primitive_api)]
pub fn now() -> f64:
    """Get current time in seconds since Unix epoch.

    Returns:
        Seconds (with fractional microsecond precision)

    Example:
        val start = time.now()
        # ... do work ...
        val elapsed = time.now() - start
    """
    rt_time_now_unix_micros() as f64 / 1_000_000.0

# ============================================================================
# Sleep
# ============================================================================

#[allow(primitive_api)]
pub fn sleep(seconds: f64):
    """Sleep for specified duration.

    Args:
        seconds: Duration to sleep (supports fractional seconds)

    Example:
        time.sleep(1.5)   # Sleep for 1.5 seconds
        time.sleep(0.1)   # Sleep for 100 milliseconds
    """
    val millis = (seconds * 1000.0) as i64
    rt_thread_sleep(millis)

#[allow(primitive_api)]
pub fn sleep_ms(milliseconds: i64):
    """Sleep for specified milliseconds.

    Args:
        milliseconds: Duration to sleep in milliseconds

    Example:
        time.sleep_ms(500)  # Sleep for 500ms
    """
    rt_thread_sleep(milliseconds)

#[allow(primitive_api)]
pub fn sleep_micros(microseconds: i64):
    """Sleep for specified microseconds (approximate).

    Note: Actual precision depends on OS scheduler.
    Very short sleeps may be longer than requested.

    Args:
        microseconds: Duration to sleep in microseconds

    Example:
        time.sleep_micros(1000)  # Sleep for ~1ms
    """
    val millis = microseconds / 1000
    if millis > 0:
        rt_thread_sleep(millis)
    else:
        # Sleep at least 1ms for very short durations
        rt_thread_sleep(1)

# ============================================================================
# Export
# ============================================================================

pub use now_micros
pub use now_nanos
pub use now_ms
pub use now
pub use sleep
pub use sleep_ms
pub use sleep_micros
