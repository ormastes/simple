# Startup Optimization Module
#
# Provides decorators for startup performance optimization.
# Features #1979 (@app_type) and #1986 (@window_hints).
#
# Usage:
#   @app_type("gui")
#   @window_hints(width=1920, height=1080, title="My App")
#   fn main():
#       pass
#
# App Types:
#   - "cli"     - Command-line tool (minimal resources)
#   - "tui"     - Terminal UI application
#   - "gui"     - Graphical application (window, GPU context)
#   - "service" - Background daemon
#   - "repl"    - Interactive REPL

## Application type decorator for startup optimization.
##
## Specifies the type of application to enable early resource pre-allocation.
## This decorator should be applied to the main function.
##
## Params:
##   app_type: str - One of "cli", "tui", "gui", "service", "repl"
##
## Example:
##   @app_type("gui")
##   fn main():
##       # Window and GPU context pre-allocated before main() runs
##       pass
pub fn app_type(app_type: str) -> Decorator:
    """
    Marks the application type for startup optimization.

    When applied to main(), enables the runtime to pre-allocate
    resources appropriate for the application type:
    - cli: Minimal stdio and heap setup
    - tui: Terminal mode, input buffers, screen buffers
    - gui: Window handle, GPU context, event loop
    - service: IPC channels, signal handlers
    - repl: History buffer, line editor, completion engine
    """
    return Decorator("app_type", [app_type])


## Window hints decorator for GUI applications.
##
## Provides window configuration hints that allow the runtime to create
## the window before main() runs, improving perceived startup time.
## This decorator should be applied to the main function.
##
## Params:
##   width: int - Initial window width in pixels (default: 1280)
##   height: int - Initial window height in pixels (default: 720)
##   title: str - Window title (default: "Simple Application")
##
## Example:
##   @app_type("gui")
##   @window_hints(width=1920, height=1080, title="My Game")
##   fn main():
##       # Window already created when main() starts
##       pass
pub fn window_hints(width: int = 1280, height: int = 720, title: str = "Simple Application") -> Decorator:
    """
    Provides window hints for early window creation.

    When applied to main() in GUI apps, the runtime creates the window
    before any Simple runtime initialization, improving perceived
    startup time. The window will show a loading indicator while
    the runtime initializes.
    """
    return Decorator("window_hints", [], {
        "width": width,
        "height": height,
        "title": title,
    })


## Get the current application type at runtime.
##
## Returns the app type from the main function's @app_type decorator,
## or "cli" if not specified.
pub fn get_app_type() -> str:
    """Returns the current application type."""
    return extern("startup_get_app_type")


## Get the current window hints at runtime.
##
## Returns a dict with width, height, and title from the main function's
## @window_hints decorator, or default values if not specified.
pub fn get_window_hints() -> dict:
    """Returns the current window hints."""
    return extern("startup_get_window_hints")
