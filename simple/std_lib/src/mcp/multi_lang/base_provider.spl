# Base Provider Utilities - Common helpers for language providers
#
# Provides factory functions and utilities shared across all
# language-specific MCP providers to reduce code duplication.

use core.*
use mcp.core.protocol.*

# =============================================================================
# Provider Factory Helpers
# =============================================================================

# Create a TreeSitterParser for the given language
pub fn create_parser(language: &str) -> TreeSitterParser:
    return TreeSitterParser::new(language)

# =============================================================================
# McpItem Factory Functions
# =============================================================================

# Create a function McpItem with standard formatting
pub fn make_function_item(
    name: &str,
    params: &str,
    marker: &str,
    visibility: &str
) -> McpItem:
    return McpItem {
        kind: ItemKind::Function,
        line: format!("{}fn {}({})", marker, name, params),
        children: [],
        metadata: McpMetadata {
            visibility: visibility.to_string(),
            name: name.to_string(),
            location: SourceLocation::default()
        }
    }

# Create a class/struct McpItem with standard formatting
pub fn make_class_item(
    name: &str,
    marker: &str,
    visibility: &str
) -> McpItem:
    return McpItem {
        kind: ItemKind::Struct,
        line: format!("{}class {}", marker, name),
        children: [],
        metadata: McpMetadata {
            visibility: visibility.to_string(),
            name: name.to_string(),
            location: SourceLocation::default()
        }
    }

# Create a struct McpItem
pub fn make_struct_item(
    name: &str,
    marker: &str,
    visibility: &str
) -> McpItem:
    return McpItem {
        kind: ItemKind::Struct,
        line: format!("{}struct {}", marker, name),
        children: [],
        metadata: McpMetadata {
            visibility: visibility.to_string(),
            name: name.to_string(),
            location: SourceLocation::default()
        }
    }

# Create an enum McpItem
pub fn make_enum_item(
    name: &str,
    marker: &str,
    visibility: &str
) -> McpItem:
    return McpItem {
        kind: ItemKind::Enum,
        line: format!("{}enum {}", marker, name),
        children: [],
        metadata: McpMetadata {
            visibility: visibility.to_string(),
            name: name.to_string(),
            location: SourceLocation::default()
        }
    }

# Create a trait/interface McpItem
pub fn make_trait_item(
    name: &str,
    marker: &str,
    visibility: &str
) -> McpItem:
    return McpItem {
        kind: ItemKind::Trait,
        line: format!("{}trait {}", marker, name),
        children: [],
        metadata: McpMetadata {
            visibility: visibility.to_string(),
            name: name.to_string(),
            location: SourceLocation::default()
        }
    }

# Create a module McpItem
pub fn make_module_item(
    name: &str,
    marker: &str,
    visibility: &str
) -> McpItem:
    return McpItem {
        kind: ItemKind::Module,
        line: format!("{}mod {}", marker, name),
        children: [],
        metadata: McpMetadata {
            visibility: visibility.to_string(),
            name: name.to_string(),
            location: SourceLocation::default()
        }
    }

# Create an import McpItem
pub fn make_import_item(path: &str) -> McpItem:
    return McpItem {
        kind: ItemKind::Import,
        line: format!("import {}", path),
        children: [],
        metadata: McpMetadata {
            visibility: "public".to_string(),
            name: path.to_string(),
            location: SourceLocation::default()
        }
    }

# Create a constant McpItem
pub fn make_const_item(
    name: &str,
    marker: &str,
    visibility: &str
) -> McpItem:
    return McpItem {
        kind: ItemKind::Constant,
        line: format!("{}const {}", marker, name),
        children: [],
        metadata: McpMetadata {
            visibility: visibility.to_string(),
            name: name.to_string(),
            location: SourceLocation::default()
        }
    }

# =============================================================================
# Marker Helpers
# =============================================================================

# Get marker string based on item kind and options
pub fn get_marker(opts: &FoldOptions, kind: ItemKind) -> text:
    if not opts.use_markers:
        return "".to_string()

    return match kind:
        case ItemKind::Function: "F> ".to_string()
        case ItemKind::Struct: "S> ".to_string()
        case ItemKind::Enum: "E> ".to_string()
        case ItemKind::Trait: "T> ".to_string()
        case ItemKind::Module: "M> ".to_string()
        case ItemKind::Import: "I> ".to_string()
        case ItemKind::Constant: "C> ".to_string()
        case _: "".to_string()

# =============================================================================
# Default Implementations
# =============================================================================

# Default empty symbols implementation
pub fn default_get_symbols(_source: &str) -> Result<Array<Symbol>, McpError>:
    return Ok([])

# Default empty diagnostics implementation
pub fn default_get_diagnostics(_source: &str) -> Result<Array<Diagnostic>, McpError>:
    return Ok([])

# =============================================================================
# SourceLocation Default
# =============================================================================

impl SourceLocation:
    pub fn default() -> SourceLocation:
        return SourceLocation { line: 0, column: 0, offset: 0 }
