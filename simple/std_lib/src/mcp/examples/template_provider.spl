# MCP Provider Template
# Copy this file and customize it for your own language/tool

use core.*
use mcp.core.*

# Example: Custom language provider
pub class MyLanguageProvider:
    pub base: BaseProvider
    
    pub fn new(root_path: text) -> MyLanguageProvider:
        return MyLanguageProvider:
            base: BaseProvider.new(root_path)
    
    # Add your custom methods here
    pub fn parse_my_language_file(self, source: text):
        # Parse custom language using line-based pattern matching
        # This is a template - implement language-specific parsing here
        var symbols: List<Symbol> = []
        var current_line = 0

        for line in source.lines():
            current_line += 1
            val trimmed = line.trim()

            # Example patterns - customize for your language:
            # Function: func name(...) or def name(...)
            if trimmed.starts_with("func ") or trimmed.starts_with("def "):
                val keyword_len = if trimmed.starts_with("func "): 5 else: 4
                val after_keyword = trimmed.substring(keyword_len, trimmed.len())
                val name = after_keyword.split("(")[0].trim()
                symbols.append(Symbol::new(name, SymbolKind::Function, current_line))

            # Class: class Name
            elif trimmed.starts_with("class "):
                val name = trimmed.substring(6, trimmed.len()).split(" ")[0].split(":")[0].trim()
                symbols.append(Symbol::new(name, SymbolKind::Class, current_line))

        return symbols

impl ResourceProvider for MyLanguageProvider:
    fn list_resources() -> List<Resource>:
        # TODO: [stdlib][P3] Return list of resources for your language
        return []
    
    fn read_resource(uri: text) -> ResourceContents:
        # TODO: [stdlib][P3] Read and format resource for your language
        text = "# Custom language resource: " + uri
        return ResourceContents.new(uri, "text/x-custom", text)
    
    fn search_resources(query: text) -> List<Resource>:
        # TODO: [stdlib][P3] Search in your language
        return []

# Example: Create MCP server for your language
pub fn create_my_language_server() -> McpServer:
    # Create provider
    provider = MyLanguageProvider.new(".")
    
    # Create server
    server = McpServer.new("My Language MCP", "1.0.0", provider)
    
    # Register custom tools
    analyze_tool = Tool.new("analyze_code", "Analyze code in my language")
    analyze_handler = fn(args: Dict<text, Any>) -> text:
        code = args.get("code")
        # TODO: [stdlib][P3] Analyze your language
        return "Analysis result for: " + code
    
    server.register_tool(analyze_tool, create_text_tool(
        "analyze_code",
        "Analyze code",
        analyze_handler
    ))
    
    return server

# Example: Main entry point for your MCP server
pub fn main_example():
    # Create server
    server = create_my_language_server()
    
    # Create transport (stdio for MCP)
    transport = StdioTransport.new()
    
    # Server loop
    while transport.is_alive():
        # Read request
        request_opt = transport.read_message()
        
        if request_opt.is_some():
            request = request_opt.unwrap()
            
            # Handle request
            response = server.handle_request(request)
            
            # Send response
            transport.write_response(response)
