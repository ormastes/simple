# Process Management System Library
#
# Provides process spawning and management operations.

# FFI declarations
extern fn native_process_spawn_with_pty(command: str, args: [str], slave_fd: int) -> int

class Process:
    """
    Represents a running process.

    Attributes:
        pid: Process ID
    """

    def __init__(self, pid: int):
        self.pid = pid

    def wait(self) -> int:
        """
        Wait for process to exit and return exit code.

        Returns:
            Exit code of the process
        """
        return native_process_wait(self.pid)

    def terminate(self):
        """
        Send SIGTERM to the process.
        """
        native_process_terminate(self.pid)

    def kill(self):
        """
        Send SIGKILL to the process.
        """
        native_process_kill(self.pid)


def spawn_with_pty(command: str, args: [str], slave_fd: int) -> Process:
    """
    Spawn a process with its stdin/stdout/stderr connected to a PTY slave.

    Args:
        command: Program to execute
        args: Command line arguments
        slave_fd: File descriptor of PTY slave

    Returns:
        Process object representing the spawned process
    """
    pid = native_process_spawn_with_pty(command, args, slave_fd)
    if pid < 0:
        raise RuntimeError("Failed to spawn process")
    return Process(pid)


# FFI declarations for process control
extern fn native_process_wait(pid: int) -> int
extern fn native_process_terminate(pid: int) -> bool
extern fn native_process_kill(pid: int) -> bool
