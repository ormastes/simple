# Math - Mathematical functions and constants for Simple
# Provides trigonometric, exponential, logarithmic, and utility functions

# Extern declarations for runtime math FFI
extern fn rt_math_pow(base: f32, exp: f32) -> f32
extern fn rt_math_log(x: f32) -> f32
extern fn rt_math_log10(x: f32) -> f32
extern fn rt_math_log2(x: f32) -> f32
extern fn rt_math_exp(x: f32) -> f32
extern fn rt_math_cbrt(x: f32) -> f32
extern fn rt_math_sin(x: f32) -> f32
extern fn rt_math_cos(x: f32) -> f32
extern fn rt_math_tan(x: f32) -> f32
extern fn rt_math_asin(x: f32) -> f32
extern fn rt_math_acos(x: f32) -> f32
extern fn rt_math_atan(x: f32) -> f32
extern fn rt_math_atan2(y: f32, x: f32) -> f32
extern fn rt_math_sinh(x: f32) -> f32
extern fn rt_math_cosh(x: f32) -> f32
extern fn rt_math_tanh(x: f32) -> f32
extern fn rt_math_sqrt(x: f32) -> f32
extern fn rt_math_floor(x: f32) -> f32
extern fn rt_math_ceil(x: f32) -> f32

# Mathematical Constants (use functions since pub val not supported)
pub fn PI() -> f32:
    return 3.141592653589793

pub fn E() -> f32:
    return 2.718281828459045

pub fn TAU() -> f32:
    return 6.283185307179586

pub fn INF() -> f32:
    return 1.0 / 0.0

pub fn NAN() -> f32:
    return 0.0 / 0.0

# Absolute value
pub fn abs(x: f32) -> f32:
    if x < 0.0:
        return -x
    return x

pub fn abs_int(x: i32) -> i32:
    if x < 0:
        return -x
    return x

# Sign function
pub fn sign(x: f32) -> f32:
    if x > 0.0:
        return 1.0
    elif x < 0.0:
        return -1.0
    else:
        return 0.0

# Floor, ceiling, and rounding
pub fn floor(x: f32) -> i32:
    return rt_math_floor(x) as i32

pub fn ceil(x: f32) -> i32:
    return rt_math_ceil(x) as i32

pub fn round(x: f32) -> i32:
    if x >= 0.0:
        return floor(x + 0.5)
    else:
        return ceil(x - 0.5)

pub fn trunc(x: f32) -> i32:
    return x as i32

# Power and roots
pub fn pow(base: f32, exp: f32) -> f32:
    return rt_math_pow(base, exp)

pub fn sqrt(x: f32) -> f32:
    return rt_math_sqrt(x)

pub fn cbrt(x: f32) -> f32:
    return rt_math_cbrt(x)

# Exponential and logarithm
pub fn exp(x: f32) -> f32:
    return rt_math_exp(x)

pub fn log(x: f32) -> f32:
    return rt_math_log(x)

pub fn log10(x: f32) -> f32:
    return rt_math_log10(x)

pub fn log2(x: f32) -> f32:
    return rt_math_log2(x)

pub fn sin(x: f32) -> f32:
    return rt_math_sin(x)

pub fn cos(x: f32) -> f32:
    return rt_math_cos(x)

pub fn tan(x: f32) -> f32:
    return rt_math_tan(x)

# Inverse trigonometric functions
pub fn asin(x: f32) -> f32:
    return rt_math_asin(x)

pub fn acos(x: f32) -> f32:
    return rt_math_acos(x)

pub fn atan(x: f32) -> f32:
    return rt_math_atan(x)

pub fn atan2(y: f32, x: f32) -> f32:
    return rt_math_atan2(y, x)

# Hyperbolic functions
pub fn sinh(x: f32) -> f32:
    return rt_math_sinh(x)

pub fn cosh(x: f32) -> f32:
    return rt_math_cosh(x)

pub fn tanh(x: f32) -> f32:
    return rt_math_tanh(x)

# Utility functions
pub fn min(a: f32, b: f32) -> f32:
    if a < b:
        return a
    return b

pub fn max(a: f32, b: f32) -> f32:
    if a > b:
        return a
    return b

pub fn min_int(a: i32, b: i32) -> i32:
    if a < b:
        return a
    return b

pub fn max_int(a: i32, b: i32) -> i32:
    if a > b:
        return a
    return b

pub fn clamp(x: f32, min_val: f32, max_val: f32) -> f32:
    if x < min_val:
        return min_val
    if x > max_val:
        return max_val
    return x

pub fn clamp_int(x: i32, min_val: i32, max_val: i32) -> i32:
    if x < min_val:
        return min_val
    if x > max_val:
        return max_val
    return x

# Degree/radian conversion
pub fn radians(degrees: f32) -> f32:
    return degrees * PI / 180.0

pub fn degrees(radians: f32) -> f32:
    return radians * 180.0 / PI

# Factorial
pub fn factorial(n: i32) -> i32:
    if n < 0:
        return 0
    if n == 0 or n == 1:
        return 1

    var result = 1
    for i in 2..(n + 1):
        result = result * i

    return result

# Greatest common divisor
pub fn gcd(a: i32, b: i32) -> i32:
    var x = abs_int(a)
    var y = abs_int(b)

    while y != 0:
        val temp = y
        y = x % y
        x = temp

    return x

# Least common multiple
pub fn lcm(a: i32, b: i32) -> i32:
    if a == 0 or b == 0:
        return 0
    return abs_int(a * b) / gcd(a, b)

# Check if number is close to another (for floating-point comparisons)
pub fn isclose(a: f32, b: f32, rel_tol: f32 = 0.000001, abs_tol: f32 = 0.0) -> bool:
    val diff = abs(a - b)
    return diff <= max(rel_tol * max(abs(a), abs(b)), abs_tol)

# Check for special values
pub fn isnan(x: f32) -> bool:
    return x != x

pub fn isinf(x: f32) -> bool:
    return x == INF() or x == -INF()

pub fn isfinite(x: f32) -> bool:
    return not isnan(x) and not isinf(x)

# Export all functions and constants
export PI
export E
export TAU
export INF
export NAN
export abs
export abs_int
export sign
export floor
export ceil
export round
export trunc
export pow
export sqrt
export cbrt
export exp
export log
export log10
export log2
export sin
export cos
export tan
export asin
export acos
export atan
export atan2
export sinh
export cosh
export tanh
export min
export max
export min_int
export max_int
export clamp
export clamp_int
export radians
export degrees
export factorial
export gcd
export lcm
export isclose
export isnan
export isinf
export isfinite
