# Math - Mathematical functions and constants for Simple
# Provides trigonometric, exponential, logarithmic, and utility functions

# Extern declarations for runtime math FFI
extern fn rt_math_pow(base: Float, exp: Float) -> Float
extern fn rt_math_log(x: Float) -> Float
extern fn rt_math_log10(x: Float) -> Float
extern fn rt_math_log2(x: Float) -> Float
extern fn rt_math_exp(x: Float) -> Float
extern fn rt_math_cbrt(x: Float) -> Float
extern fn rt_math_sin(x: Float) -> Float
extern fn rt_math_cos(x: Float) -> Float
extern fn rt_math_tan(x: Float) -> Float
extern fn rt_math_asin(x: Float) -> Float
extern fn rt_math_acos(x: Float) -> Float
extern fn rt_math_atan(x: Float) -> Float
extern fn rt_math_atan2(y: Float, x: Float) -> Float
extern fn rt_math_sinh(x: Float) -> Float
extern fn rt_math_cosh(x: Float) -> Float
extern fn rt_math_tanh(x: Float) -> Float
extern fn rt_math_sqrt(x: Float) -> Float
extern fn rt_math_floor(x: Float) -> Float
extern fn rt_math_ceil(x: Float) -> Float

# Mathematical Constants (use functions since pub let not supported)
pub fn PI() -> Float:
    return 3.141592653589793

pub fn E() -> Float:
    return 2.718281828459045

pub fn TAU() -> Float:
    return 6.283185307179586

pub fn INF() -> Float:
    return 1.0 / 0.0

pub fn NAN() -> Float:
    return 0.0 / 0.0

# Absolute value
pub fn abs(x: Float) -> Float:
    if x < 0.0:
        return -x
    return x

pub fn abs_int(x: Int) -> Int:
    if x < 0:
        return -x
    return x

# Sign function
pub fn sign(x: Float) -> Float:
    if x > 0.0:
        return 1.0
    elif x < 0.0:
        return -1.0
    else:
        return 0.0

# Floor, ceiling, and rounding
pub fn floor(x: Float) -> Int:
    return rt_math_floor(x) as Int

pub fn ceil(x: Float) -> Int:
    return rt_math_ceil(x) as Int

pub fn round(x: Float) -> Int:
    if x >= 0.0:
        return floor(x + 0.5)
    else:
        return ceil(x - 0.5)

pub fn trunc(x: Float) -> Int:
    return x as Int

# Power and roots
pub fn pow(base: Float, exp: Float) -> Float:
    return rt_math_pow(base, exp)

pub fn sqrt(x: Float) -> Float:
    return rt_math_sqrt(x)

pub fn cbrt(x: Float) -> Float:
    return rt_math_cbrt(x)

# Exponential and logarithm
pub fn exp(x: Float) -> Float:
    return rt_math_exp(x)

pub fn log(x: Float) -> Float:
    return rt_math_log(x)

pub fn log10(x: Float) -> Float:
    return rt_math_log10(x)

pub fn log2(x: Float) -> Float:
    return rt_math_log2(x)

pub fn sin(x: Float) -> Float:
    return rt_math_sin(x)

pub fn cos(x: Float) -> Float:
    return rt_math_cos(x)

pub fn tan(x: Float) -> Float:
    return rt_math_tan(x)

# Inverse trigonometric functions
pub fn asin(x: Float) -> Float:
    return rt_math_asin(x)

pub fn acos(x: Float) -> Float:
    return rt_math_acos(x)

pub fn atan(x: Float) -> Float:
    return rt_math_atan(x)

pub fn atan2(y: Float, x: Float) -> Float:
    return rt_math_atan2(y, x)

# Hyperbolic functions
pub fn sinh(x: Float) -> Float:
    return rt_math_sinh(x)

pub fn cosh(x: Float) -> Float:
    return rt_math_cosh(x)

pub fn tanh(x: Float) -> Float:
    return rt_math_tanh(x)

# Utility functions
pub fn min(a: Float, b: Float) -> Float:
    if a < b:
        return a
    return b

pub fn max(a: Float, b: Float) -> Float:
    if a > b:
        return a
    return b

pub fn min_int(a: Int, b: Int) -> Int:
    if a < b:
        return a
    return b

pub fn max_int(a: Int, b: Int) -> Int:
    if a > b:
        return a
    return b

pub fn clamp(x: Float, min_val: Float, max_val: Float) -> Float:
    if x < min_val:
        return min_val
    if x > max_val:
        return max_val
    return x

pub fn clamp_int(x: Int, min_val: Int, max_val: Int) -> Int:
    if x < min_val:
        return min_val
    if x > max_val:
        return max_val
    return x

# Degree/radian conversion
pub fn radians(degrees: Float) -> Float:
    return degrees * PI / 180.0

pub fn degrees(radians: Float) -> Float:
    return radians * 180.0 / PI

# Factorial
pub fn factorial(n: Int) -> Int:
    if n < 0:
        return 0
    if n == 0 or n == 1:
        return 1

    let mut result = 1
    for i in 2..(n + 1):
        result = result * i

    return result

# Greatest common divisor
pub fn gcd(a: Int, b: Int) -> Int:
    let mut x = abs_int(a)
    let mut y = abs_int(b)

    while y != 0:
        let temp = y
        y = x % y
        x = temp

    return x

# Least common multiple
pub fn lcm(a: Int, b: Int) -> Int:
    if a == 0 or b == 0:
        return 0
    return abs_int(a * b) / gcd(a, b)

# Check if number is close to another (for floating-point comparisons)
pub fn isclose(a: Float, b: Float, rel_tol: Float = 0.000001, abs_tol: Float = 0.0) -> Bool:
    let diff = abs(a - b)
    return diff <= max(rel_tol * max(abs(a), abs(b)), abs_tol)

# Check for special values
pub fn isnan(x: Float) -> Bool:
    return x != x

pub fn isinf(x: Float) -> Bool:
    return x == INF() or x == -INF()

pub fn isfinite(x: Float) -> Bool:
    return not isnan(x) and not isinf(x)

# Export all functions and constants
export PI
export E
export TAU
export INF
export NAN
export abs
export abs_int
export sign
export floor
export ceil
export round
export trunc
export pow
export sqrt
export cbrt
export exp
export log
export log10
export log2
export sin
export cos
export tan
export asin
export acos
export atan
export atan2
export sinh
export cosh
export tanh
export min
export max
export min_int
export max_int
export clamp
export clamp_int
export radians
export degrees
export factorial
export gcd
export lcm
export isclose
export isnan
export isinf
export isfinite
