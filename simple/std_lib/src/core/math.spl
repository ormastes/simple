# Math - Mathematical functions and constants for Simple
# Provides trigonometric, exponential, logarithmic, and utility functions

# Extern declarations for runtime math FFI
extern fn rt_math_pow(base: f32, exp: f32) -> f32
extern fn rt_math_log(x: f32) -> f32
extern fn rt_math_log10(x: f32) -> f32
extern fn rt_math_log2(x: f32) -> f32
extern fn rt_math_exp(x: f32) -> f32
extern fn rt_math_cbrt(x: f32) -> f32
extern fn rt_math_sin(x: f32) -> f32
extern fn rt_math_cos(x: f32) -> f32
extern fn rt_math_tan(x: f32) -> f32
extern fn rt_math_asin(x: f32) -> f32
extern fn rt_math_acos(x: f32) -> f32
extern fn rt_math_atan(x: f32) -> f32
extern fn rt_math_atan2(y: f32, x: f32) -> f32
extern fn rt_math_sinh(x: f32) -> f32
extern fn rt_math_cosh(x: f32) -> f32
extern fn rt_math_tanh(x: f32) -> f32
extern fn rt_math_sqrt(x: f32) -> f32
extern fn rt_math_floor(x: f32) -> f32
extern fn rt_math_ceil(x: f32) -> f32

# Mathematical Constants (use functions since pub val not supported)
@pure
pub fn PI() -> f32:
    return 3.141592653589793

@pure
pub fn E() -> f32:
    return 2.718281828459045

@pure
pub fn TAU() -> f32:
    return 6.283185307179586

@pure
pub fn INF() -> f32:
    return 1.0 / 0.0

@pure
pub fn NAN() -> f32:
    return 0.0 / 0.0

# Absolute value
@pure
pub fn abs(x: f32) -> f32:
    if x < 0.0:
        return -x
    return x

@pure
pub fn abs_int(x: i32) -> i32:
    if x < 0:
        return -x
    return x

# Sign function
@pure
pub fn sign(x: f32) -> f32:
    if x > 0.0:
        return 1.0
    elif x < 0.0:
        return -1.0
    else:
        return 0.0

# Floor, ceiling, and rounding
@pure
pub fn floor(x: f32) -> i32:
    return rt_math_floor(x) as i32

@pure
pub fn ceil(x: f32) -> i32:
    return rt_math_ceil(x) as i32

@pure
pub fn round(x: f32) -> i32:
    if x >= 0.0:
        return floor(x + 0.5)
    else:
        return ceil(x - 0.5)

@pure
pub fn trunc(x: f32) -> i32:
    return x as i32

# Power and roots
@pure
pub fn pow(base: f32, exp: f32) -> f32:
    return rt_math_pow(base, exp)

@pure
pub fn sqrt(x: f32) -> f32:
    return rt_math_sqrt(x)

@pure
pub fn cbrt(x: f32) -> f32:
    return rt_math_cbrt(x)

# Exponential and logarithm
@pure
pub fn exp(x: f32) -> f32:
    return rt_math_exp(x)

@pure
pub fn log(x: f32) -> f32:
    return rt_math_log(x)

@pure
pub fn log10(x: f32) -> f32:
    return rt_math_log10(x)

@pure
pub fn log2(x: f32) -> f32:
    return rt_math_log2(x)

@pure
pub fn sin(x: f32) -> f32:
    return rt_math_sin(x)

@pure
pub fn cos(x: f32) -> f32:
    return rt_math_cos(x)

@pure
pub fn tan(x: f32) -> f32:
    return rt_math_tan(x)

# Inverse trigonometric functions
@pure
pub fn asin(x: f32) -> f32:
    return rt_math_asin(x)

@pure
pub fn acos(x: f32) -> f32:
    return rt_math_acos(x)

@pure
pub fn atan(x: f32) -> f32:
    return rt_math_atan(x)

@pure
pub fn atan2(y: f32, x: f32) -> f32:
    return rt_math_atan2(y, x)

# Hyperbolic functions
@pure
pub fn sinh(x: f32) -> f32:
    return rt_math_sinh(x)

@pure
pub fn cosh(x: f32) -> f32:
    return rt_math_cosh(x)

@pure
pub fn tanh(x: f32) -> f32:
    return rt_math_tanh(x)

# Utility functions
@pure
pub fn min(a: f32, b: f32) -> f32:
    if a < b:
        return a
    return b

@pure
pub fn max(a: f32, b: f32) -> f32:
    if a > b:
        return a
    return b

@pure
pub fn min_int(a: i32, b: i32) -> i32:
    if a < b:
        return a
    return b

@pure
pub fn max_int(a: i32, b: i32) -> i32:
    if a > b:
        return a
    return b

@pure
pub fn clamp(x: f32, min_val: f32, max_val: f32) -> f32:
    if x < min_val:
        return min_val
    if x > max_val:
        return max_val
    return x

@pure
pub fn clamp_int(x: i32, min_val: i32, max_val: i32) -> i32:
    if x < min_val:
        return min_val
    if x > max_val:
        return max_val
    return x

# Degree/radian conversion
@pure
pub fn radians(degrees: f32) -> f32:
    return degrees * PI / 180.0

@pure
pub fn degrees(radians: f32) -> f32:
    return radians * 180.0 / PI

# Factorial
@pure
pub fn factorial(n: i32) -> i32:
    if n < 0:
        return 0
    if n == 0 or n == 1:
        return 1

    var result = 1
    for i in 2..(n + 1):
        result = result * i

    return result

# Greatest common divisor
@pure
pub fn gcd(a: i32, b: i32) -> i32:
    var x = abs_int(a)
    var y = abs_int(b)

    while y != 0:
        val temp = y
        y = x % y
        x = temp

    return x

# Least common multiple
@pure
pub fn lcm(a: i32, b: i32) -> i32:
    if a == 0 or b == 0:
        return 0
    return abs_int(a * b) / gcd(a, b)

# Check if number is close to another (for floating-point comparisons)
@pure
pub fn is_close(a: f32, b: f32, rel_tol: f32 = 0.000001, abs_tol: f32 = 0.0) -> bool:
    val diff = abs(a - b)
    return diff <= max(rel_tol * max(abs(a), abs(b)), abs_tol)

# Check for special values
@pure
pub fn is_nan(x: f32) -> bool:
    return x != x

@pure
pub fn is_inf(x: f32) -> bool:
    return x == INF() or x == -INF()

@pure
pub fn is_finite(x: f32) -> bool:
    return not is_nan(x) and not is_inf(x)

# Export all functions and constants
export PI
export E
export TAU
export INF
export NAN
export abs
export abs_int
export sign
export floor
export ceil
export round
export trunc
export pow
export sqrt
export cbrt
export exp
export log
export log10
export log2
export sin
export cos
export tan
export asin
export acos
export atan
export atan2
export sinh
export cosh
export tanh
export min
export max
export min_int
export max_int
export clamp
export clamp_int
export radians
export degrees
export factorial
export gcd
export lcm
export is_close
export is_nan
export is_inf
export is_finite
