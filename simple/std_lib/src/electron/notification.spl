# Electron Notifications API
# Display native system notifications

# External FFI declarations
extern fn electron_notification_show(title: String, body: String, options_json: String): i64
extern fn electron_notification_close(notification_id: i64): void

# Notification urgency levels
pub val URGENCY_LOW: String = "low"
pub val URGENCY_NORMAL: String = "normal"
pub val URGENCY_CRITICAL: String = "critical"

# Notification class
pub class Notification:
    pub id: i64
    pub title: String
    pub body: String
    pub icon: String
    pub urgency: String
    pub silent: bool
    pub timeout: i32  # milliseconds

    pub fn new(title: String, body: String): Notification =
        """Create a new notification.

        Example:
            notif = Notification.new(
                "Task Complete",
                "File processing finished"
            )
            notif.show()
        """
        Notification {
            id: -1,
            title: title,
            body: body,
            icon: "",
            urgency: URGENCY_NORMAL,
            silent: false,
            timeout: 5000
        }

    pub fn set_icon(self, icon_path: String): Notification =
        """Set notification icon."""
        self.icon = icon_path
        self

    pub fn set_urgency(self, urgency: String): Notification =
        """Set notification urgency level.

        Args:
            urgency: "low", "normal", or "critical"
        """
        self.urgency = urgency
        self

    pub fn set_silent(self, silent: bool): Notification =
        """Set whether notification plays sound."""
        self.silent = silent
        self

    pub fn set_timeout(self, timeout_ms: i32): Notification =
        """Set notification timeout in milliseconds."""
        self.timeout = timeout_ms
        self

    pub fn show(self):
        """Display the notification.

        Example:
            Notification.new("Alert", "Important message")
                .set_urgency("critical")
                .show()
        """
        # Build options JSON
        val options = '{'
        options = options + '"icon":"' + self.icon + '",'
        options = options + '"urgency":"' + self.urgency + '",'
        options = options + '"silent":' + self.silent.to_string() + ','
        options = options + '"timeoutType":"default"'
        options = options + '}'

        # Show notification
        self.id = electron_notification_show(self.title, self.body, options)

    pub fn close(self):
        """Close the notification."""
        if self.id >= 0:
            electron_notification_close(self.id)

    # =========================================================================
    # Helper Methods
    # =========================================================================

    pub fn has_id(self) -> bool:
        """Check if notification has been shown.

        Returns:
            true if notification has a valid ID

        Example:
            notif.has_id()  # → true after show()
        """
        return self.id >= 0

    pub fn is_shown(self) -> bool:
        """Check if notification is shown (alias for has_id).

        Returns:
            true if shown

        Example:
            notif.is_shown()  # → false before show()
        """
        return self.has_id()

    pub fn is_critical(self) -> bool:
        """Check if notification has critical urgency.

        Returns:
            true if urgency is critical

        Example:
            notif.is_critical()  # → false
        """
        return self.urgency == URGENCY_CRITICAL

    pub fn is_silent(self) -> bool:
        """Check if notification is silent.

        Returns:
            true if silent

        Example:
            notif.is_silent()  # → false
        """
        return self.silent

    pub fn has_icon(self) -> bool:
        """Check if notification has an icon set.

        Returns:
            true if icon path is not empty

        Example:
            notif.has_icon()  # → false
        """
        return self.icon.len() > 0

    pub fn get_urgency_level(self) -> String:
        """Get urgency level (alias for urgency field).

        Returns:
            Urgency level string

        Example:
            notif.get_urgency_level()  # → "normal"
        """
        return self.urgency

    pub fn summary(self) -> String:
        """Get notification summary.

        Returns:
            Human-readable summary

        Example:
            notif.summary()
            # → "Notification: 'Alert' (critical, timeout=5000ms)"
        """
        val id_str = if self.has_id() { "shown" } else { "not shown" }
        val sound = if self.silent { "silent" } else { "with sound" }
        return "Notification: '{self.title}' ({self.urgency}, timeout={self.timeout}ms, {sound}, {id_str})"

# Convenience functions
pub fn show(title: String, body: String):
    """Show a simple notification.

    Example:
        notification.show("Success", "Operation completed")
    """
    val notif = Notification.new(title, body)
    notif.show()

pub fn show_error(title: String, body: String):
    """Show an error notification (critical urgency)."""
    Notification.new(title, body)
        .set_urgency(URGENCY_CRITICAL)
        .show()

pub fn show_info(title: String, body: String):
    """Show an info notification (normal urgency)."""
    Notification.new(title, body)
        .set_urgency(URGENCY_NORMAL)
        .show()

pub fn show_warning(title: String, body: String):
    """Show a warning notification."""
    Notification.new(title, body)
        .set_urgency(URGENCY_NORMAL)
        .show()
