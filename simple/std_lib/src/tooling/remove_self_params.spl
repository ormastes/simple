# Simple Language Syntax Migration Tool - remove self parameters
# Migrated from: scripts/remove_self_params.py
# Purpose: Remove explicit self parameters from method signatures

# TODO: [stdlib][P1] Add regex library to Simple
# TODO: [stdlib][P1] Add file I/O library to Simple
# TODO: [stdlib][P1] Add datetime library to Simple

# Migration statistics
struct RemoveSelfStats:
    files_processed: u64
    files_modified: u64
    lines_changed: u64
    backup_dir: text

impl RemoveSelfStats:
    # Create empty stats
    static fn new(backup_dir: text) -> RemoveSelfStats:
        RemoveSelfStats(
            files_processed: 0,
            files_modified: 0,
            lines_changed: 0,
            backup_dir: backup_dir
        )

    # Record processed file
    me add_processed():
        self.files_processed = self.files_processed + 1

    # Record modified file
    me add_modified(lines: u64):
        self.files_modified = self.files_modified + 1
        self.lines_changed = self.lines_changed + lines

    # Generate summary report
    fn summary() -> text:
        var report = ""
        report = report + "=== Migration Complete ===\n"
        report = report + "Files processed: {self.files_processed}\n"
        report = report + "Files modified: {self.files_modified}\n"
        report = report + "Lines changed: {self.lines_changed}\n"
        report = report + "Backups saved to: {self.backup_dir}\n"
        report

# File migration result
struct MigrationResult:
    modified: bool
    lines_changed: u64
    error: text

impl MigrationResult:
    # No changes made
    static fn unchanged() -> MigrationResult:
        MigrationResult(
            modified: false,
            lines_changed: 0,
            error: ""
        )

    # Changes made successfully
    static fn changed(lines: u64) -> MigrationResult:
        MigrationResult(
            modified: true,
            lines_changed: lines,
            error: ""
        )

    # Error occurred
    static fn error(message: text) -> MigrationResult:
        MigrationResult(
            modified: false,
            lines_changed: 0,
            error: message
        )

# TODO: [stdlib][P1] Add regex support
# Remove self parameters from method signatures
fn migrate_remove_self_content(content: text) -> text:
    # Stub: Needs regex for pattern replacements
    # Transformations (ORDER MATTERS!):
    # 1. method(self) -> method()        (MUST come before method(self, ...))
    # 2. method(self, params) -> method(params)

    # Regex patterns needed:
    # Pattern 1: r'^(\s*(?:me|fn)\s+\w+)\s*\(\s*self\s*\)(\s*(?:->)?)'
    #            Replace with: r'\1()\2'
    # Pattern 2: r'^(\s*(?:me|fn)\s+\w+)\s*\(\s*self\s*,\s*'
    #            Replace with: r'\1('

    content  # Return unchanged for now

# TODO: [stdlib][P1] Add file I/O and regex
# Migrate a single file
fn migrate_remove_self_file(filepath: text, backup_dir: text) -> MigrationResult:
    # Stub: Needs file I/O and regex
    # Would:
    # 1. Read file content
    # 2. Apply migrate_remove_self_content()
    # 3. If changed:
    #    - Backup original to backup_dir
    #    - Write migrated content
    #    - Count changed lines
    #    - Return MigrationResult.changed(count)
    # 4. Else return MigrationResult.unchanged()
    MigrationResult.error("file I/O not yet implemented")

# TODO: [stdlib][P1] Add directory operations
# Find all .spl files in directory
fn find_spl_files(root_dir: text) -> List<text>:
    # Stub: Needs glob/directory listing
    # Would:
    # 1. Glob for **/*.spl
    # 2. Skip target, .git, .migration_backup directories
    # 3. Return list of file paths
    []

# TODO: [stdlib][P1] Add file I/O and datetime
# Run migration on all .spl files
fn run_remove_self_migration(root_dir: text) -> RemoveSelfStats:
    # Stub: Needs file I/O, regex, directory ops, datetime
    # Would:
    # 1. Create backup directory with timestamp
    # 2. Find all .spl files
    # 3. Process each file
    # 4. Track statistics
    # 5. Return stats

    val backup_dir = ".migration_backup_remove_self_stub"
    RemoveSelfStats.new(backup_dir)

# Syntax transformation patterns (for documentation)
struct RemoveSelfPattern:
    order: u64
    name: text
    description: text
    before: text
    after: text

impl RemoveSelfPattern:
    # Create a transformation pattern
    static fn new(order: u64, name: text, desc: text, before: text, after: text) -> RemoveSelfPattern:
        RemoveSelfPattern(
            order: order,
            name: name,
            description: desc,
            before: before,
            after: after
        )

# Get all transformation patterns
fn get_remove_self_patterns() -> List<RemoveSelfPattern>:
    [
        RemoveSelfPattern.new(
            1,
            "remove_self_only",
            "Remove self from method(self)",
            "me method(self) ->",
            "me method() ->"
        ),
        RemoveSelfPattern.new(
            2,
            "remove_self_with_params",
            "Remove self from method(self, params)",
            "fn method(self, x: i64) ->",
            "fn method(x: i64) ->"
        )
    ]

# Print transformation examples
fn print_remove_self_examples() -> text:
    var output = ""
    output = output + "=== Remove Self Parameters Migration Patterns ===\n\n"
    output = output + "⚠️  ORDER MATTERS! Transformations must run in sequence:\n\n"

    val patterns = get_remove_self_patterns()
    var i = 0
    while i < patterns.len():
        val pattern = patterns[i]
        output = output + "{pattern.order}. {pattern.name}\n"
        output = output + "   {pattern.description}\n"
        output = output + "   Before: {pattern.before}\n"
        output = output + "   After:  {pattern.after}\n\n"
        i = i + 1

    output

# TODO: [stdlib][P1] Add CLI argument parsing
# Main entry point
fn main_remove_self_params(args: List<text>) -> Result<(), text>:
    # Stub: Needs argument parsing and file I/O
    # Would handle:
    # --dry-run         Preview changes without writing
    # --backup-dir      Custom backup directory
    # <root_dir>        Directory to migrate (default: current)
    Err("CLI not yet implemented - use as library instead")
