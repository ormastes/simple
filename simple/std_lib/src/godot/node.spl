# Godot Node Base Class
#
# Node is the base class for all scene tree objects.
# Provides lifecycle methods, hierarchy management, and signal support.
#
# Reference: https://docs.godotengine.org/en/stable/classes/class_node.html

import godot.ffi
import godot.variant
import godot.object

# Node wrapper
pub struct Node:
    base: object.Object

impl Node:
    # Wrap an existing Node pointer
    pub fn from_ptr(ptr: ffi.GDExtensionObjectPtr) -> Node:
        return Node(base: object.Object::from_ptr(ptr))

    # Add a child node
    pub fn add_child(mut self, child: Node):
        val child_var = variant.Variant::from_object(child.base.ptr())
        self.base.call1("add_child", child_var)

    # Remove a child node
    pub fn remove_child(mut self, child: Node):
        val child_var = variant.Variant::from_object(child.base.ptr())
        self.base.call1("remove_child", child_var)

    # Get parent node
    pub fn get_parent(self) -> Option<Node>:
        val result = self.base.call0("get_parent")
        val ptr = result.as_object()
        if ptr == 0:
            return None
        return Some(Node::from_ptr(ptr))

    # Get child count
    pub fn get_child_count(self) -> i64:
        val result = self.base.call0("get_child_count")
        return result.as_int()

    # Get child by index
    pub fn get_child(self, idx: i64) -> Option<Node>:
        val idx_var = variant.Variant::from_int(idx)
        val result = self.base.call1("get_child", idx_var)
        val ptr = result.as_object()
        if ptr == 0:
            return None
        return Some(Node::from_ptr(ptr))

    # Get node name
    pub fn get_name(self) -> text:
        val result = self.base.call0("get_name")
        return result.as_string()

    # Set node name
    pub fn set_name(mut self, name: text):
        val name_var = variant.Variant::from_string(name)
        self.base.call1("set_name", name_var)

    # Virtual methods (to be overridden in Simple subclasses)
    pub fn _ready(mut self):
        # Called when node enters scene tree
        pass

    pub fn _process(mut self, delta: f64):
        # Called every frame
        pass

    pub fn _physics_process(mut self, delta: f64):
        # Called every physics frame
        pass

    # Queue free (delete node)
    pub fn queue_free(mut self):
        self.base.call0("queue_free")

    # Get object pointer
    pub fn ptr(self) -> ffi.GDExtensionObjectPtr:
        return self.base.ptr()

    # Get base object
    pub fn as_object(self) -> object.Object:
        return self.base
