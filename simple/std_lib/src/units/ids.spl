# Common ID Unit Types
# Semantic types for identifiers to prevent mixing different ID domains

# User identifier
unit UserId: i64 as uid

# Session identifier
unit SessionId: i64 as sid

# Request/transaction identifier
unit RequestId: str as rid

# Generic entity identifier
unit EntityId: i64 as eid

# Database row identifier
unit RowId: i64 as rowid

# UUID string representation
unit Uuid: str as uuid

# Implementation for UserId
impl UserId:
    fn from_int(n: i64) -> UserId:
        return n_uid

    fn to_int(self) -> i64:
        return self as i64

    fn is_valid(self) -> bool:
        return (self as i64) > 0

    # =========================================================================
    # Helper Methods
    # =========================================================================

    fn is_zero(self) -> bool:
        """Check if user ID is zero (invalid)."""
        return (self as i64) == 0

    fn is_negative(self) -> bool:
        """Check if user ID is negative (invalid)."""
        return (self as i64) < 0

    fn is_system(self) -> bool:
        """Check if this is a system user (ID < 100)."""
        let id = self as i64
        return id > 0 and id < 100

    fn is_regular(self) -> bool:
        """Check if this is a regular user (ID >= 100)."""
        let id = self as i64
        return id >= 100

    fn summary(self) -> String:
        """Get summary of user ID."""
        let id = self as i64
        let status = if self.is_valid(): "valid" else: "invalid"
        let type_str = if self.is_system(): "system" else if self.is_regular(): "regular" else: "special"
        return "UserId: {id} ({status}, {type_str})"

# Implementation for SessionId
impl SessionId:
    fn from_int(n: i64) -> SessionId:
        return n_sid

    fn to_int(self) -> i64:
        return self as i64

    fn is_valid(self) -> bool:
        return (self as i64) > 0

    # =========================================================================
    # Helper Methods
    # =========================================================================

    fn is_zero(self) -> bool:
        """Check if session ID is zero (invalid)."""
        return (self as i64) == 0

    fn is_negative(self) -> bool:
        """Check if session ID is negative (invalid)."""
        return (self as i64) < 0

    fn is_expired(self, current_id: SessionId) -> bool:
        """Check if session is expired (ID less than current)."""
        return (self as i64) < (current_id as i64)

    fn summary(self) -> String:
        """Get summary of session ID."""
        let id = self as i64
        let status = if self.is_valid(): "valid" else: "invalid"
        return "SessionId: {id} ({status})"

# Implementation for Uuid
impl Uuid:
    fn from_str(s: str) -> Result[Uuid, UuidError]:
        # Basic UUID validation: 8-4-4-4-12 format
        if s.len() != 36:
            return Err(UuidError::InvalidLength)
        return Ok(s_uuid)

    fn as_str(self) -> &str:
        return &(self as str)

    fn is_nil(self) -> bool:
        return (self as str) == "00000000-0000-0000-0000-000000000000"

    # =========================================================================
    # Helper Methods
    # =========================================================================

    fn is_empty(self) -> bool:
        """Check if UUID string is empty."""
        return (self as str).is_empty()

    fn is_valid_length(self) -> bool:
        """Check if UUID has valid length (36 characters)."""
        return (self as str).len() == 36

    fn has_hyphens(self) -> bool:
        """Check if UUID contains hyphens in expected positions."""
        let s = self as str
        if s.len() != 36:
            return false
        return s.char_at(8) == '-' and s.char_at(13) == '-' and
               s.char_at(18) == '-' and s.char_at(23) == '-'

    fn summary(self) -> String:
        """Get summary of UUID."""
        let s = self as str
        let nil = if self.is_nil(): "nil" else: "non-nil"
        let valid = if self.is_valid_length(): "valid length" else: "invalid length"
        return "Uuid: {s} ({nil}, {valid})"

# Implementation for RequestId
impl RequestId:
    fn from_str(s: str) -> RequestId:
        return s_rid

    fn as_str(self) -> &str:
        return &(self as str)

    fn is_empty(self) -> bool:
        """Check if request ID is empty."""
        return (self as str).is_empty()

    fn summary(self) -> String:
        """Get summary of request ID."""
        let s = self as str
        return "RequestId: {s}"

# Implementation for EntityId
impl EntityId:
    fn from_int(n: i64) -> EntityId:
        return n_eid

    fn to_int(self) -> i64:
        return self as i64

    fn is_valid(self) -> bool:
        """Check if entity ID is valid (positive)."""
        return (self as i64) > 0

    fn is_zero(self) -> bool:
        """Check if entity ID is zero."""
        return (self as i64) == 0

    fn is_negative(self) -> bool:
        """Check if entity ID is negative."""
        return (self as i64) < 0

    fn summary(self) -> String:
        """Get summary of entity ID."""
        let id = self as i64
        let status = if self.is_valid(): "valid" else: "invalid"
        return "EntityId: {id} ({status})"

# Implementation for RowId
impl RowId:
    fn from_int(n: i64) -> RowId:
        return n_rowid

    fn to_int(self) -> i64:
        return self as i64

    fn is_valid(self) -> bool:
        """Check if row ID is valid (positive)."""
        return (self as i64) > 0

    fn is_zero(self) -> bool:
        """Check if row ID is zero."""
        return (self as i64) == 0

    fn is_negative(self) -> bool:
        """Check if row ID is negative."""
        return (self as i64) < 0

    fn summary(self) -> String:
        """Get summary of row ID."""
        let id = self as i64
        let status = if self.is_valid(): "valid" else: "invalid"
        return "RowId: {id} ({status})"

# UUID error type
enum UuidError:
    InvalidLength
    InvalidFormat
    InvalidCharacter

impl UuidError:
    # =========================================================================
    # Helper Methods
    # =========================================================================

    fn to_string(self) -> String:
        """Convert error to string."""
        match self:
            case InvalidLength: return "InvalidLength"
            case InvalidFormat: return "InvalidFormat"
            case InvalidCharacter: return "InvalidCharacter"

    fn description(self) -> String:
        """Get detailed error description."""
        match self:
            case InvalidLength: return "UUID must be 36 characters (8-4-4-4-12 format)"
            case InvalidFormat: return "Invalid UUID format (expected 8-4-4-4-12)"
            case InvalidCharacter: return "UUID contains invalid characters"

    fn is_invalid_length(self) -> bool:
        """Check if this is InvalidLength error."""
        match self:
            case InvalidLength: true
            case _: false

    fn is_invalid_format(self) -> bool:
        """Check if this is InvalidFormat error."""
        match self:
            case InvalidFormat: true
            case _: false

    fn is_invalid_character(self) -> bool:
        """Check if this is InvalidCharacter error."""
        match self:
            case InvalidCharacter: true
            case _: false
