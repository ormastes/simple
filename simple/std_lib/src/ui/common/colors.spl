# Color Utilities - Shared color parsing for UI components
#
# Provides color parsing from string names and hex values,
# used by both TUI and GUI renderers.

use core.*

# Color enum for UI rendering
pub enum Color:
    Black
    Red
    Green
    Yellow
    Blue
    Magenta
    Cyan
    White
    Default
    Rgb(u8, u8, u8)

impl Color:
    # Create color from hex value (0xRRGGBB)
    pub fn hex(value: u32) -> Color:
        let r = ((value >> 16) & 0xFF) as u8
        let g = ((value >> 8) & 0xFF) as u8
        let b = (value & 0xFF) as u8
        return Color::Rgb(r, g, b)

    # Create color from RGB values
    pub fn rgb(r: u8, g: u8, b: u8) -> Color:
        return Color::Rgb(r, g, b)

# Parse color string to Color enum
# Supports named colors (black, red, green, etc.) and hex (#RRGGBB)
pub fn parse_color(s: &str) -> Color:
    match s.to_lowercase().as_str():
        case "black": return Color::Black
        case "red": return Color::Red
        case "green": return Color::Green
        case "yellow": return Color::Yellow
        case "blue": return Color::Blue
        case "magenta": return Color::Magenta
        case "cyan": return Color::Cyan
        case "white": return Color::White
        case "default" | "": return Color::Default
        case _:
            # Try hex color
            if s.starts_with("#") and s.len() == 7:
                let hex = s[1..].parse_hex().unwrap_or(0)
                return Color::hex(hex as u32)
            # Try rgb(...) format
            if s.starts_with("rgb(") and s.ends_with(")"):
                return parse_rgb_string(s)
            return Color::Default

# Parse rgb(r, g, b) format
fn parse_rgb_string(s: &str) -> Color:
    # Extract "r, g, b" from "rgb(r, g, b)"
    let inner = s[4..s.len()-1]  # Remove "rgb(" and ")"
    let parts = inner.split(",")
    if parts.len() == 3:
        let r = parts[0].trim().parse_u8().unwrap_or(0)
        let g = parts[1].trim().parse_u8().unwrap_or(0)
        let b = parts[2].trim().parse_u8().unwrap_or(0)
        return Color::Rgb(r, g, b)
    return Color::Default

# Alias for compatibility
pub fn parse_color_string(s: &str) -> Color:
    return parse_color(s)

# Convert Color to ANSI escape code index
pub fn color_to_ansi(color: Color) -> Option[u8]:
    match color:
        case Color::Black: return Some(0)
        case Color::Red: return Some(1)
        case Color::Green: return Some(2)
        case Color::Yellow: return Some(3)
        case Color::Blue: return Some(4)
        case Color::Magenta: return Some(5)
        case Color::Cyan: return Some(6)
        case Color::White: return Some(7)
        case Color::Default: return None
        case Color::Rgb(_, _, _): return None  # Not a simple ANSI color

# Convert Color to CSS-compatible string
pub fn color_to_css(color: Color) -> String:
    match color:
        case Color::Black: return "black".to_string()
        case Color::Red: return "red".to_string()
        case Color::Green: return "green".to_string()
        case Color::Yellow: return "yellow".to_string()
        case Color::Blue: return "blue".to_string()
        case Color::Magenta: return "magenta".to_string()
        case Color::Cyan: return "cyan".to_string()
        case Color::White: return "white".to_string()
        case Color::Default: return "inherit".to_string()
        case Color::Rgb(r, g, b): return format("rgb({}, {}, {})", r, g, b)
