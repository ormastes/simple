# Key Code Utilities - Shared keyboard input handling
#
# Provides key code conversion between terminal and UI
# representations, used by TUI renderers.

use core.*
use host.async_nogc_mut.io.term as term

# UI-agnostic key code enum
pub enum KeyCode:
    Char(char)
    Enter
    Escape
    Backspace
    Tab
    Delete
    Insert
    Home
    End
    PageUp
    PageDown
    Up
    Down
    Left
    Right
    F(u8)
    Null

# Key modifiers
pub struct KeyModifiers:
    pub shift: bool
    pub ctrl: bool
    pub alt: bool

impl KeyModifiers:
    pub fn none() -> KeyModifiers:
        return KeyModifiers { shift: false, ctrl: false, alt: false }

    pub fn shift() -> KeyModifiers:
        return KeyModifiers { shift: true, ctrl: false, alt: false }

    pub fn ctrl() -> KeyModifiers:
        return KeyModifiers { shift: false, ctrl: true, alt: false }

    pub fn alt() -> KeyModifiers:
        return KeyModifiers { shift: false, ctrl: false, alt: true }

# Full keyboard event
pub struct KeyEvent:
    pub code: KeyCode
    pub modifiers: KeyModifiers

impl KeyEvent:
    pub fn new(code: KeyCode) -> KeyEvent:
        return KeyEvent { code: code, modifiers: KeyModifiers::none() }

    pub fn with_modifiers(code: KeyCode, modifiers: KeyModifiers) -> KeyEvent:
        return KeyEvent { code: code, modifiers: modifiers }

# Convert terminal KeyCode to UI KeyCode
pub fn convert_terminal_key_code(code: term.KeyCode) -> KeyCode:
    match code:
        case term.KeyCode::Char(c): return KeyCode::Char(c)
        case term.KeyCode::Enter: return KeyCode::Enter
        case term.KeyCode::Escape: return KeyCode::Escape
        case term.KeyCode::Backspace: return KeyCode::Backspace
        case term.KeyCode::Tab: return KeyCode::Tab
        case term.KeyCode::Delete: return KeyCode::Delete
        case term.KeyCode::Insert: return KeyCode::Insert
        case term.KeyCode::Home: return KeyCode::Home
        case term.KeyCode::End: return KeyCode::End
        case term.KeyCode::PageUp: return KeyCode::PageUp
        case term.KeyCode::PageDown: return KeyCode::PageDown
        case term.KeyCode::Up: return KeyCode::Up
        case term.KeyCode::Down: return KeyCode::Down
        case term.KeyCode::Left: return KeyCode::Left
        case term.KeyCode::Right: return KeyCode::Right
        case term.KeyCode::F(n): return KeyCode::F(n)
        case _: return KeyCode::Null

# Alias for backward compatibility
pub fn convert_key_code(code: term.KeyCode) -> KeyCode:
    return convert_terminal_key_code(code)

# Check if key code is a printable character
pub fn is_printable(code: KeyCode) -> bool:
    match code:
        case KeyCode::Char(_): return true
        case _: return false

# Check if key is a navigation key
pub fn is_navigation(code: KeyCode) -> bool:
    match code:
        case KeyCode::Up | KeyCode::Down | KeyCode::Left | KeyCode::Right: return true
        case KeyCode::Home | KeyCode::End | KeyCode::PageUp | KeyCode::PageDown: return true
        case _: return false
