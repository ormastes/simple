# Theme - GUI Theming and Styling
#
# Defines color themes and visual styles for GUI rendering.
# Supports light/dark themes and customization.

use core.*
use ui.attrs.*

# Theme color palette
pub struct ThemePalette:
    # Primary colors
    primary: Color
    primary_light: Color
    primary_dark: Color
    # Secondary colors
    secondary: Color
    secondary_light: Color
    secondary_dark: Color
    # Background colors
    background: Color
    surface: Color
    # Text colors
    text_primary: Color
    text_secondary: Color
    text_disabled: Color
    # Semantic colors
    error: Color
    warning: Color
    success: Color
    info: Color
    # Border colors
    border: Color
    border_focus: Color
    # Interactive states
    hover: Color
    pressed: Color
    selected: Color

impl ThemePalette:
    # Light theme (default)
    pub fn light() -> ThemePalette:
        return ThemePalette {
            primary: Color::hex(0x1976D2),
            primary_light: Color::hex(0x63A4FF),
            primary_dark: Color::hex(0x004BA0),
            secondary: Color::hex(0x424242),
            secondary_light: Color::hex(0x6D6D6D),
            secondary_dark: Color::hex(0x1B1B1B),
            background: Color::hex(0xFAFAFA),
            surface: Color::hex(0xFFFFFF),
            text_primary: Color::hex(0x212121),
            text_secondary: Color::hex(0x757575),
            text_disabled: Color::hex(0xBDBDBD),
            error: Color::hex(0xD32F2F),
            warning: Color::hex(0xFFA000),
            success: Color::hex(0x388E3C),
            info: Color::hex(0x1976D2),
            border: Color::hex(0xE0E0E0),
            border_focus: Color::hex(0x1976D2),
            hover: Color::hex(0xF5F5F5),
            pressed: Color::hex(0xEEEEEE),
            selected: Color::hex(0xE3F2FD)
        }

    # Dark theme
    pub fn dark() -> ThemePalette:
        return ThemePalette {
            primary: Color::hex(0x90CAF9),
            primary_light: Color::hex(0xC3FDFF),
            primary_dark: Color::hex(0x5D99C6),
            secondary: Color::hex(0xCE93D8),
            secondary_light: Color::hex(0xFFC4FF),
            secondary_dark: Color::hex(0x9C64A6),
            background: Color::hex(0x121212),
            surface: Color::hex(0x1E1E1E),
            text_primary: Color::hex(0xFFFFFF),
            text_secondary: Color::hex(0xB0B0B0),
            text_disabled: Color::hex(0x6B6B6B),
            error: Color::hex(0xCF6679),
            warning: Color::hex(0xFFB74D),
            success: Color::hex(0x81C784),
            info: Color::hex(0x64B5F6),
            border: Color::hex(0x424242),
            border_focus: Color::hex(0x90CAF9),
            hover: Color::hex(0x2C2C2C),
            pressed: Color::hex(0x383838),
            selected: Color::hex(0x1E3A5F)
        }

    # High contrast theme
    pub fn high_contrast() -> ThemePalette:
        return ThemePalette {
            primary: Color::hex(0x0000FF),
            primary_light: Color::hex(0x6666FF),
            primary_dark: Color::hex(0x0000AA),
            secondary: Color::hex(0x00FF00),
            secondary_light: Color::hex(0x66FF66),
            secondary_dark: Color::hex(0x00AA00),
            background: Color::hex(0x000000),
            surface: Color::hex(0x000000),
            text_primary: Color::hex(0xFFFFFF),
            text_secondary: Color::hex(0xFFFF00),
            text_disabled: Color::hex(0x808080),
            error: Color::hex(0xFF0000),
            warning: Color::hex(0xFFFF00),
            success: Color::hex(0x00FF00),
            info: Color::hex(0x00FFFF),
            border: Color::hex(0xFFFFFF),
            border_focus: Color::hex(0xFFFF00),
            hover: Color::hex(0x333333),
            pressed: Color::hex(0x666666),
            selected: Color::hex(0x0000AA)
        }

# Typography settings
pub struct Typography:
    # Font family names
    font_family: String
    font_family_mono: String
    # Font sizes
    font_size_xs: u16
    font_size_sm: u16
    font_size_base: u16
    font_size_lg: u16
    font_size_xl: u16
    font_size_2xl: u16
    font_size_3xl: u16
    # Line heights
    line_height_tight: f32
    line_height_normal: f32
    line_height_relaxed: f32
    # Font weights
    font_weight_normal: u16
    font_weight_medium: u16
    font_weight_bold: u16

impl Typography:
    pub fn default() -> Typography:
        return Typography {
            font_family: "system-ui, -apple-system, sans-serif".to_string(),
            font_family_mono: "ui-monospace, monospace".to_string(),
            font_size_xs: 12,
            font_size_sm: 14,
            font_size_base: 16,
            font_size_lg: 18,
            font_size_xl: 20,
            font_size_2xl: 24,
            font_size_3xl: 30,
            line_height_tight: 1.25,
            line_height_normal: 1.5,
            line_height_relaxed: 1.75,
            font_weight_normal: 400,
            font_weight_medium: 500,
            font_weight_bold: 700
        }

# Spacing scale
pub struct Spacing:
    xs: u16   # 4px
    sm: u16   # 8px
    md: u16   # 16px
    lg: u16   # 24px
    xl: u16   # 32px
    xxl: u16  # 48px

impl Spacing:
    pub fn default() -> Spacing:
        return Spacing {
            xs: 4,
            sm: 8,
            md: 16,
            lg: 24,
            xl: 32,
            xxl: 48
        }

# Border radius scale
pub struct BorderRadius:
    none: u16
    sm: u16
    md: u16
    lg: u16
    xl: u16
    full: u16  # For circular elements

impl BorderRadius:
    pub fn default() -> BorderRadius:
        return BorderRadius {
            none: 0,
            sm: 2,
            md: 4,
            lg: 8,
            xl: 16,
            full: 9999
        }

# Shadow definitions
pub struct Shadow:
    offset_x: i16
    offset_y: i16
    blur: u16
    spread: u16
    color: Color

impl Shadow:
    pub fn none() -> Shadow:
        return Shadow { offset_x: 0, offset_y: 0, blur: 0, spread: 0, color: Color::Default }

    pub fn sm() -> Shadow:
        return Shadow { offset_x: 0, offset_y: 1, blur: 2, spread: 0, color: Color::hex(0x1A000000) }

    pub fn md() -> Shadow:
        return Shadow { offset_x: 0, offset_y: 4, blur: 6, spread: -1, color: Color::hex(0x1A000000) }

    pub fn lg() -> Shadow:
        return Shadow { offset_x: 0, offset_y: 10, blur: 15, spread: -3, color: Color::hex(0x1A000000) }

    pub fn xl() -> Shadow:
        return Shadow { offset_x: 0, offset_y: 20, blur: 25, spread: -5, color: Color::hex(0x1A000000) }

# Complete theme definition
pub struct Theme:
    name: String
    palette: ThemePalette
    typography: Typography
    spacing: Spacing
    border_radius: BorderRadius

impl Theme:
    pub fn light() -> Theme:
        return Theme {
            name: "Light".to_string(),
            palette: ThemePalette::light(),
            typography: Typography::default(),
            spacing: Spacing::default(),
            border_radius: BorderRadius::default()
        }

    pub fn dark() -> Theme:
        return Theme {
            name: "Dark".to_string(),
            palette: ThemePalette::dark(),
            typography: Typography::default(),
            spacing: Spacing::default(),
            border_radius: BorderRadius::default()
        }

    pub fn high_contrast() -> Theme:
        return Theme {
            name: "High Contrast".to_string(),
            palette: ThemePalette::high_contrast(),
            typography: Typography::default(),
            spacing: Spacing::default(),
            border_radius: BorderRadius::default()
        }

    # Generate CSS variables for theme
    pub fn to_css_variables(self) -> String:
        let p = &self.palette
        let t = &self.typography
        let s = &self.spacing
        let r = &self.border_radius

        return ":root {{
  --color-primary: {color_to_css(&p.primary)};
  --color-primary-light: {color_to_css(&p.primary_light)};
  --color-primary-dark: {color_to_css(&p.primary_dark)};
  --color-secondary: {color_to_css(&p.secondary)};
  --color-background: {color_to_css(&p.background)};
  --color-surface: {color_to_css(&p.surface)};
  --color-text-primary: {color_to_css(&p.text_primary)};
  --color-text-secondary: {color_to_css(&p.text_secondary)};
  --color-error: {color_to_css(&p.error)};
  --color-warning: {color_to_css(&p.warning)};
  --color-success: {color_to_css(&p.success)};
  --color-info: {color_to_css(&p.info)};
  --color-border: {color_to_css(&p.border)};
  --color-border-focus: {color_to_css(&p.border_focus)};
  --font-family: {t.font_family};
  --font-family-mono: {t.font_family_mono};
  --font-size-base: {t.font_size_base}px;
  --spacing-xs: {s.xs}px;
  --spacing-sm: {s.sm}px;
  --spacing-md: {s.md}px;
  --spacing-lg: {s.lg}px;
  --spacing-xl: {s.xl}px;
  --radius-sm: {r.sm}px;
  --radius-md: {r.md}px;
  --radius-lg: {r.lg}px;
}}"

# Convert color to CSS string
fn color_to_css(color: &Color) -> String:
    let rgba = color.to_rgba()
    let r = (rgba >> 16) & 0xFF
    let g = (rgba >> 8) & 0xFF
    let b = rgba & 0xFF
    return "rgb({r}, {g}, {b})"
