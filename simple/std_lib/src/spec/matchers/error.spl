# Error Matchers - raise_error
# Exception and error handling matchers

import matchers.{Matcher, MatchResult}

# Raise error matcher: expect_raises ValueError: ...
class RaiseErrorMatcher:
    expected_type: Option[Type]
    expected_message: Option[String]
    
    fn new(expected_type: Option[Type] = None, expected_message: Option[String] = None) -> RaiseErrorMatcher:
        return RaiseErrorMatcher {
            expected_type: expected_type,
            expected_message: expected_message
        }

impl Matcher[Option[Error]] for RaiseErrorMatcher:
    fn match(self, actual: Option[Error]) -> MatchResult:
        match actual:
            case None:
                return MatchResult.failure("Expected an error to be raised but nothing was raised")
            case Some(error):
                # Check type if specified
                match self.expected_type:
                    case Some(typ):
                        if not error is typ:
                            return MatchResult.failure(
                                "Expected ${typ} but got ${error.type}"
                            )
                    case None:
                        pass
                
                # Check message if specified
                match self.expected_message:
                    case Some(msg):
                        if error.message != msg:
                            return MatchResult.failure(
                                "Expected message '${msg}' but got '${error.message}'"
                            )
                    case None:
                        pass
                
                return MatchResult.success()

fn raise_error(expected_type: Type = None, message: String = None) -> RaiseErrorMatcher:
    return RaiseErrorMatcher.new(
        expected_type=if expected_type is None then None else Some(expected_type),
        expected_message=if message is None then None else Some(message)
    )
