# Feature Documentation File Writer
# Writes generated markdown documentation to files

use core.collections.{List, Dict}
use core.string.String
use core.io.{File, Directory}
use spec.feature_doc.metadata.FeatureMetadata
use spec.feature_doc.registry.{get_all_features, get_all_categories, get_features_by_category}
use spec.feature_doc.generator.generate_markdown

## Write markdown content to a file
fn write_file(path: String, content: String):
    # Ensure parent directory exists
    let dir_path = path.rsplit_once("/").map(\(dir, _): dir).unwrap_or(".")
    Directory.create_all(dir_path)

    # Write file
    File.write(path, content)

## Write documentation for a single feature
fn write_feature(feature: FeatureMetadata):
    let markdown = generate_markdown(feature)
    let full_path = feature.full_path()

    write_file(full_path, markdown)

## Write documentation for all features
fn write_all_features():
    let features = get_all_features()

    for feature in features:
        write_feature(feature)

## Write documentation for features in a category
fn write_category(category: String):
    let features = get_features_by_category(category)

    for feature in features:
        write_feature(feature)

## Ensure all category directories exist
fn create_category_directories():
    let categories = get_all_categories()

    for category in categories:
        let dir_path = f"doc/features/{category.to_lowercase()}"
        Directory.create_all(dir_path)

## Clear generated documentation (for testing)
fn clear_generated_docs():
    # Remove all generated markdown files in doc/features/
    # Keep doc/old_features/ intact
    # This is destructive - use with caution!

    let categories = get_all_categories()

    for category in categories:
        let dir_path = f"doc/features/{category.to_lowercase()}"

        if Directory.exists(dir_path):
            # Remove all .md files in the category
            let files = Directory.list(dir_path)
            for file in files:
                if file.ends_with(".md"):
                    let file_path = f"{dir_path}/{file}"
                    File.remove(file_path)
