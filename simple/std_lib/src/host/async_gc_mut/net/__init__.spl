# Network Module - Unified async networking API (NoGC Mutable Variant)
# Combines monoio runtime with semantic types for type-safe networking
#
# Features:
# - TCP server and client (monoio-based)
# - UDP socket
# - HTTP client
# - FTP client
# - Monoio async runtime (thread-per-core, io_uring)
# - Context manager support (with...as syntax)
# - Both string convenience API and semantic types
#
# Quick Start:
#   use host.async_nogc_mut.net as net
#
#   # Simple string API
#   let listener = await net.TcpListener::bind("127.0.0.1:8080")?
#
#   # Type-safe semantic API
#   let addr = SocketAddr::new(IpAddr::v4(127, 0, 0, 1), Port(8080))
#   let listener = await net.TcpListener::bind_addr(addr)?

mod net

# Re-export all submodules
pub use tcp.*
pub use udp.*
pub use http.*
pub use ftp.*
pub use runtime.*

# Network error types
pub enum NetError:
    IoError(message: String)
    AddrParseError(message: String)
    ConnectionRefused
    ConnectionReset
    TimedOut
    WouldBlock
    NotConnected
    AlreadyConnected
    InvalidData
    PermissionDenied

impl NetError:
    # Convert from error code
    pub fn from_code(code: i64) -> NetError:
        match code:
            case -1:
                return NetError::IoError("I/O operation failed")
            case -2:
                return NetError::ConnectionRefused
            case -3:
                return NetError::ConnectionReset
            case -4:
                return NetError::TimedOut
            case -5:
                return NetError::WouldBlock
            case -6:
                return NetError::NotConnected
            case -7:
                return NetError::AlreadyConnected
            case -8:
                return NetError::InvalidData
            case -9:
                return NetError::PermissionDenied
            case _:
                return NetError::IoError("Unknown error")

    # Convert to string message
    pub fn to_string(self) -> String:
        match self:
            case NetError::IoError(msg):
                return msg
            case NetError::AddrParseError(msg):
                return "Address parse error: {msg}"
            case NetError::ConnectionRefused:
                return "Connection refused"
            case NetError::ConnectionReset:
                return "Connection reset"
            case NetError::TimedOut:
                return "Operation timed out"
            case NetError::WouldBlock:
                return "Operation would block"
            case NetError::NotConnected:
                return "Not connected"
            case NetError::AlreadyConnected:
                return "Already connected"
            case NetError::InvalidData:
                return "Invalid data"
            case NetError::PermissionDenied:
                return "Permission denied"
