# Common I/O Error Types
# Shared across all host variants (async_nogc_mut, async_gc_immut, etc.)

use core.traits.*

# I/O Error type - common across all I/O operations
pub enum IoError:
    NotFound
    PermissionDenied
    AlreadyExists
    InvalidPath
    IsDirectory
    NotDirectory
    DirectoryNotEmpty
    ReadOnly
    FileTooLarge
    OutOfSpace
    Interrupted
    TimedOut
    ConnectionRefused
    ConnectionReset
    BrokenPipe
    WouldBlock
    InvalidData
    UnexpectedEof
    WriteZero
    Other(str)

impl IoError:
    pub fn message(self) -> str:
        match self:
            case NotFound: "file or directory not found"
            case PermissionDenied: "permission denied"
            case AlreadyExists: "file or directory already exists"
            case InvalidPath: "invalid path"
            case IsDirectory: "is a directory"
            case NotDirectory: "not a directory"
            case DirectoryNotEmpty: "directory not empty"
            case ReadOnly: "read-only file system"
            case FileTooLarge: "file too large"
            case OutOfSpace: "out of disk space"
            case Interrupted: "operation interrupted"
            case TimedOut: "operation timed out"
            case ConnectionRefused: "connection refused"
            case ConnectionReset: "connection reset"
            case BrokenPipe: "broken pipe"
            case WouldBlock: "operation would block"
            case InvalidData: "invalid data"
            case UnexpectedEof: "unexpected end of file"
            case WriteZero: "write returned zero bytes"
            case Other(msg): msg

    pub fn to_string(self) -> str:
        """Convert error to string.

        Returns:
            Error name

        Example:
            IoError::NotFound.to_string()  # â†’ "not-found"
        """
        match self:
            case NotFound: "not-found"
            case PermissionDenied: "permission-denied"
            case AlreadyExists: "already-exists"
            case InvalidPath: "invalid-path"
            case IsDirectory: "is-directory"
            case NotDirectory: "not-directory"
            case DirectoryNotEmpty: "directory-not-empty"
            case ReadOnly: "read-only"
            case FileTooLarge: "file-too-large"
            case OutOfSpace: "out-of-space"
            case Interrupted: "interrupted"
            case TimedOut: "timed-out"
            case ConnectionRefused: "connection-refused"
            case ConnectionReset: "connection-reset"
            case BrokenPipe: "broken-pipe"
            case WouldBlock: "would-block"
            case InvalidData: "invalid-data"
            case UnexpectedEof: "unexpected-eof"
            case WriteZero: "write-zero"
            case Other(_): "other"

    pub fn description(self) -> str:
        """Get error description.

        Returns:
            Human-readable description
        """
        self.message()

    pub fn is_file_error(self) -> bool:
        """Check if this is a file system error.

        Returns:
            True for file/directory errors
        """
        match self:
            case NotFound: true
            case PermissionDenied: true
            case AlreadyExists: true
            case InvalidPath: true
            case IsDirectory: true
            case NotDirectory: true
            case DirectoryNotEmpty: true
            case ReadOnly: true
            case FileTooLarge: true
            case OutOfSpace: true
            case _: false

    pub fn is_network_error(self) -> bool:
        """Check if this is a network error.

        Returns:
            True for network-related errors
        """
        match self:
            case ConnectionRefused: true
            case ConnectionReset: true
            case BrokenPipe: true
            case TimedOut: true
            case _: false

    pub fn is_timeout_error(self) -> bool:
        """Check if this is a timeout error.

        Returns:
            True for timeout
        """
        match self:
            case TimedOut: true
            case _: false

    pub fn is_recoverable(self) -> bool:
        """Check if error might be recoverable.

        Returns:
            True if retry might succeed
        """
        match self:
            case NotFound: false
            case PermissionDenied: false
            case AlreadyExists: false
            case InvalidPath: false
            case IsDirectory: false
            case NotDirectory: false
            case DirectoryNotEmpty: false
            case ReadOnly: false
            case FileTooLarge: false
            case OutOfSpace: false
            case Interrupted: true
            case TimedOut: true
            case ConnectionRefused: true
            case ConnectionReset: true
            case BrokenPipe: false
            case WouldBlock: true
            case InvalidData: false
            case UnexpectedEof: false
            case WriteZero: false
            case Other(_): false

    pub fn is_fatal(self) -> bool:
        """Check if error is fatal.

        Returns:
            True for unrecoverable errors
        """
        not self.is_recoverable()

impl Display for IoError:
    fn fmt(self) -> str:
        self.message()

impl Error for IoError
