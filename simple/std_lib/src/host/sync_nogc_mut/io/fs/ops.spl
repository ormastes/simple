# File System Operations - Sync NoGC Mutable Variant
# Testing what causes hang

export read_text, write_text, exists, append_text, read_text_result

extern fn native_fs_read_string(path: str) -> str
extern fn native_fs_write_string(path: str, content: str) -> Int
extern fn native_fs_exists(path: str) -> bool

type FilePath = str

enum IoError:
    NotFound
    Other(str)

pub fn read_text(path: FilePath) -> str:
    return native_fs_read_string(path)

pub fn write_text(path: FilePath, text: str) -> Int:
    return native_fs_write_string(path, text)

pub fn exists(path: FilePath) -> bool:
    return native_fs_exists(path)

# Test: function with match expression
pub fn append_text(path: FilePath, text: str) -> Int:
    let existing = read_text(path)
    let combined = match existing:
        "" => text
        _ => existing + text
    return write_text(path, combined)

# Test: function returning Result
pub fn read_text_result(path: FilePath) -> Result[str, IoError]:
    if exists(path):
        return Ok(read_text(path))
    else:
        return Err(IoError.NotFound)
