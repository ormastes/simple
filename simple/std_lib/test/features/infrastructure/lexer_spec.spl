# Lexer Feature Specification
# Feature #1: Tokenizes Simple language source code
# Category: Infrastructure | Difficulty: 3 | Status: Complete

# =====================================================
# Feature Metadata
# =====================================================

class FeatureMetadata:
    id: Int
    name: String
    category: String
    difficulty: Int
    status: String
    impl_type: String
    spec_ref: String
    files: List[String]
    tests: List[String]
    description: String
    code_examples: List[String]
    dependencies: List[Int]
    required_by: List[Int]
    notes: String

# Feature Definition
let FEATURE = FeatureMetadata {
    id: 1,
    name: "Lexer",
    category: "Infrastructure",
    difficulty: 3,
    status: "Complete",
    impl_type: "Rust",
    spec_ref: "doc/spec/lexer_parser.md",
    files: [
        "src/parser/src/lexer/mod.rs",
        "src/parser/src/token.rs"
    ],
    tests: [
        "src/parser/tests/lexer_tests.rs"
    ],
    description: "Tokenizes Simple language source code into a stream of tokens. Handles indentation-based syntax with INDENT/DEDENT tokens, string literals, numbers, identifiers, operators, and keywords.",
    code_examples: [
        "# The lexer converts this:",
        "let x = 42",
        "if x > 0:",
        "    print(x)",
        "",
        "# Into tokens: LET, IDENT(x), EQ, INT(42), NEWLINE,",
        "# IF, IDENT(x), GT, INT(0), COLON, NEWLINE, INDENT,",
        "# IDENT(print), LPAREN, IDENT(x), RPAREN, DEDENT"
    ],
    dependencies: [],
    required_by: [2],
    notes: "First stage of compilation pipeline. Uses INDENT/DEDENT for Python-like significant whitespace."
}

# =====================================================
# BDD Specification Tests
# =====================================================

print("============================================================")
print("  LEXER FEATURE SPECIFICATION (#1)")
print("  Category: Infrastructure | Difficulty: 3 | Status: Complete")
print("============================================================")
print("")

let mut passed = 0
let mut failed = 0

# describe "Lexer tokenization"
print("describe Lexer tokenization:")

# it "tokenizes integer literals"
print("  it tokenizes integer literals:")
let int_val = 42
if int_val == 42:
    print("    [PASS] integer literal 42")
    passed = passed + 1
else:
    print("    [FAIL] integer literal")
    failed = failed + 1

# it "tokenizes string literals"
print("  it tokenizes string literals:")
let str_val = "hello world"
if str_val == "hello world":
    print("    [PASS] string literal")
    passed = passed + 1
else:
    print("    [FAIL] string literal")
    failed = failed + 1

# it "tokenizes f-string literals"
print("  it tokenizes f-string literals:")
let name = "Simple"
let fstr = f"Hello, {name}!"
if fstr == "Hello, Simple!":
    print("    [PASS] f-string interpolation")
    passed = passed + 1
else:
    print("    [FAIL] f-string interpolation")
    failed = failed + 1

# it "tokenizes identifiers"
print("  it tokenizes identifiers:")
let my_variable = 100
if my_variable == 100:
    print("    [PASS] identifier with underscore")
    passed = passed + 1
else:
    print("    [FAIL] identifier")
    failed = failed + 1

# describe "Lexer operators"
print("")
print("describe Lexer operators:")

# it "tokenizes arithmetic operators"
print("  it tokenizes arithmetic operators:")
let arith = 2 + 3 * 4 - 1
if arith == 13:
    print("    [PASS] arithmetic operators +, *, -")
    passed = passed + 1
else:
    print("    [FAIL] arithmetic operators")
    failed = failed + 1

# it "tokenizes comparison operators"
print("  it tokenizes comparison operators:")
let cmp1 = 5 > 3
let cmp2 = 3 < 5
let cmp3 = 5 >= 5
let cmp4 = 5 <= 5
let cmp5 = 5 == 5
let cmp6 = 5 != 3
if cmp1 and cmp2 and cmp3 and cmp4 and cmp5 and cmp6:
    print("    [PASS] comparison operators >, <, >=, <=, ==, !=")
    passed = passed + 1
else:
    print("    [FAIL] comparison operators")
    failed = failed + 1

# it "tokenizes logical operators"
print("  it tokenizes logical operators:")
let log1 = true and true
let log2 = true or false
let log3 = not false
if log1 and log2 and log3:
    print("    [PASS] logical operators and, or, not")
    passed = passed + 1
else:
    print("    [FAIL] logical operators")
    failed = failed + 1

# describe "Lexer indentation"
print("")
print("describe Lexer indentation:")

# it "handles indented blocks with INDENT/DEDENT"
print("  it handles indented blocks with INDENT/DEDENT:")
let mut indent_ok = false
if true:
    let nested = 1
    if nested == 1:
        indent_ok = true
if indent_ok:
    print("    [PASS] nested indentation")
    passed = passed + 1
else:
    print("    [FAIL] nested indentation")
    failed = failed + 1

# it "handles multiple indentation levels"
print("  it handles multiple indentation levels:")
let mut level3_ok = false
if true:
    if true:
        if true:
            level3_ok = true
if level3_ok:
    print("    [PASS] 3-level nesting")
    passed = passed + 1
else:
    print("    [FAIL] 3-level nesting")
    failed = failed + 1

# =====================================================
# Documentation Output
# =====================================================

print("")
print("============================================================")
print("  GENERATED DOCUMENTATION")
print("============================================================")
print("")
print(f"# {FEATURE.name}")
print("")
print(f"**Feature ID:** #{FEATURE.id}")
print(f"**Category:** {FEATURE.category}")
print(f"**Difficulty:** Level {FEATURE.difficulty}/5")
print(f"**Status:** {FEATURE.status}")
print(f"**Implementation:** {FEATURE.impl_type}")
print("")
print("## Description")
print("")
print(FEATURE.description)
print("")
print("## Implementation Files")
print("")
for file in FEATURE.files:
    print(f"- `{file}`")
print("")
print("## Test Files")
print("")
for test in FEATURE.tests:
    print(f"- `{test}`")
print("")
print("## Code Examples")
print("")
print("```simple")
for example in FEATURE.code_examples:
    print(example)
print("```")
print("")
if FEATURE.required_by.len() > 0:
    print(f"## Required By")
    print("")
    print(f"Features: {FEATURE.required_by}")
    print("")
print("## Notes")
print("")
print(FEATURE.notes)

# =====================================================
# Test Summary
# =====================================================

print("")
print("============================================================")
print("  TEST SUMMARY")
print("============================================================")
print(f"Passed: {passed}")
print(f"Failed: {failed}")
print(f"Total:  {passed + failed}")
if failed == 0:
    print("")
    print("All tests PASSED!")
print("============================================================")
