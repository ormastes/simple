# Inline If Expression Specification
#
# Tests that if expressions work inline in val/var declarations
# including support for both 'elif' and 'else if' syntax

import std.spec

describe "Basic inline if expressions":
    context "Simple if-else":
        it "assigns value based on condition":
            val x = 5
            val result = if x == 5: "match" else: "no match"
            expect result == "match"

        it "evaluates else branch when condition is false":
            val x = 3
            val result = if x == 5: "match" else: "no match"
            expect result == "no match"

    context "Boolean conditions":
        it "works with boolean expressions":
            val flag = true
            val result = if flag: "yes" else: "no"
            expect result == "yes"

        it "works with comparison operators":
            val count = 10
            val result = if count > 5: "large" else: "small"
            expect result == "large"

describe "If-elif-else chains":
    context "Using elif keyword":
        it "supports elif syntax":
            val x = 2
            val result = if x == 1: "one" elif x == 2: "two" else: "other"
            expect result == "two"

        it "supports multiple elif branches":
            val x = 3
            val result = if x == 1: "one" elif x == 2: "two" elif x == 3: "three" else: "other"
            expect result == "three"

    context "Using else if syntax":
        it "supports else if syntax (Scala/Python-style)":
            val x = 2
            val result = if x == 1: "one" else if x == 2: "two" else: "other"
            expect result == "two"

        it "supports multiple else if branches":
            val x = 3
            val result = if x == 1: "one" else if x == 2: "two" else if x == 3: "three" else: "other"
            expect result == "three"

        it "handles final else branch":
            val x = 5
            val result = if x == 1: "one" else if x == 2: "two" else if x == 3: "three" else: "other"
            expect result == "other"

describe "Complex inline if expressions":
    context "Method calls in conditions":
        it "evaluates method calls in conditions":
            val text = "hello"
            val result = if text.len() > 0: "non-empty" else: "empty"
            expect result == "non-empty"

    context "Numeric expressions":
        it "works with integer values":
            val count = 42
            val result = if count < 10: 1 else if count < 50: 2 else: 3
            expect result == 2

        it "works with arithmetic in branches":
            val x = 5
            val result = if x > 0: x * 2 else: x * -1
            expect result == 10

describe "Mutable variables with inline if":
    context "Var declarations":
        it "works with mutable variables":
            var x = 5
            var result = if x > 0: "positive" else: "non-positive"
            expect result == "positive"

        it "allows reassignment after declaration":
            val x = 3
            var result = if x < 5: "small" else: "large"
            result = "changed"
            expect result == "changed"

describe "Edge cases":
    context "Nested if expressions":
        it "supports nesting in then branch":
            val x = 5
            val y = 10
            val result = if x > 0: (if y > 5: "both" else: "x only") else: "neither"
            expect result == "both"

    context "Without else branch":
        skip "allows optional else for nullable types":
            # This would return Some("match") or None
            # val result = if x == 5: Some("match")
            expect true

# =============================================================================
# Summary
# =============================================================================
#
# **Status:** âœ… FULLY WORKING (as of 2026-01-17)
#
# Simple supports inline if expressions in variable declarations with both:
# - `elif` keyword (Simple-style)
# - `else if` syntax (Scala/Python-style)
#
# **Syntax:**
# ```simple
# val x = if condition: then_value else: else_value
# val x = if cond1: val1 elif cond2: val2 else: val3
# val x = if cond1: val1 else if cond2: val2 else: val3  # Also supported
# ```
#
# **Fix:** Modified `src/parser/src/expressions/helpers.rs:108-115` to handle
# `else if` syntax in addition to `elif`, matching the statement parser behavior.
#
# **Impact:** Unblocks vulkan_ffi.spl line 545 and other inline if usage.
#
