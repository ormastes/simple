/// Feature Documentation Tests
/// Tests that also generate feature documentation

import std.spec

describe "Infrastructure: Lexer (#1)":
    # Register feature metadata
    # feature_metadata() call would go here once the module is available

    it "tokenizes simple code":
        let x = 42
        expect x == 42

    it "handles strings":
        let s = "hello"
        expect s == "hello"

    it "handles indentation":
        if true:
            let nested = 1
            expect nested == 1

describe "Infrastructure: Parser (#2)":
    # feature_metadata() for Parser

    it "parses expressions with precedence":
        let result = 2 + 3 * 4
        expect result == 14

    it "parses if statements":
        let x = if true: 1 else: 2
        expect x == 1

    it "parses match expressions":
        let x = 2
        let result = match x:
            1 => "one"
            2 => "two"
            _ => "other"
        expect result == "two"

describe "AOP: Predicate Grammar (#1000)":
    # feature_metadata() for Predicate Grammar

    it "supports boolean operators":
        expect (true and true) == true
        expect (true or false) == true
        expect (not false) == true

    it "supports pattern matching":
        let x = 42
        let result = match x:
            42 => "found"
            _ => "not found"
        expect result == "found"

describe "Language: Functions (#12)":
    # feature_metadata() for Functions

    it "defines and calls functions":
        # Test basic function definition and calling
        let x = 2
        let y = 3
        expect x + y == 5

    it "handles closures with map":
        let numbers = [1, 2, 3]
        let doubled = numbers.map(\x: x * 2)
        expect doubled == [2, 4, 6]

    it "supports higher-order functions":
        let numbers = [1, 2, 3, 4, 5]
        let evens = numbers.filter(\x: x % 2 == 0)
        expect evens == [2, 4]
