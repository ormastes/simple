# Suspension Operator Feature Specification
# Feature #45: Explicit suspension with ~ operator
# Category: Concurrency | Difficulty: 3 | Status: Planned

# =====================================================
# Feature Metadata
# =====================================================

class FeatureMetadata:
    id: Int
    name: String
    category: String
    difficulty: Int
    status: String
    impl_type: String
    spec_ref: String
    files: List[String]
    tests: List[String]
    description: String
    code_examples: List[String]
    dependencies: List[Int]
    required_by: List[Int]
    notes: String

# Feature Definition
let FEATURE = FeatureMetadata {
    id: 45,
    name: 'Suspension Operator (~)',
    category: 'Concurrency',
    difficulty: 3,
    status: 'Planned',
    impl_type: 'Rust',
    spec_ref: 'doc/spec/suspension_operator.md',
    files: [
        'src/parser/src/expressions/mod.rs',
        'src/parser/src/statements/mod.rs',
        'src/compiler/src/interpreter.rs'
    ],
    tests: [
        'src/driver/tests/runner_async_tests.rs'
    ],
    description: 'The ~ operator marks explicit suspension points. Includes ~= for suspending assignment, if~/while~/for~ for suspending guards, and ~+= for compound operations.',
    code_examples: [],
    dependencies: [41, 43],
    required_by: [44, 46],
    notes: 'Suspension operator makes async control flow visible at the syntax level. Composes with ? error propagation.'
}

# =====================================================
# BDD Specification Tests
# =====================================================

print('============================================================')
print('  SUSPENSION OPERATOR FEATURE SPECIFICATION (#45)')
print('  Category: Concurrency | Difficulty: 3 | Status: Planned')
print('============================================================')
print('')

let mut passed = 0
let mut failed = 0
let mut skipped = 0

# -----------------------------------------------------
# Suspending Assignment (~=)
# -----------------------------------------------------

print('describe Suspending assignment (~=):')
print('  context basic usage:')

print('    [SKIP] it awaits and assigns with ~=:')
skipped = skipped + 1
# TODO: Implement when lexer/parser supports ~=
# let user ~= fetch_user(id)

print('    [SKIP] it discards result with _ ~=:')
skipped = skipped + 1
# TODO: Implement when lexer/parser supports ~=
# _ ~= timer.sleep(100_ms)

print('')
print('  context type inference:')

print('    [SKIP] it infers type from awaited value:')
skipped = skipped + 1
# TODO: Implement when type inference handles ~=
# let data ~= fetch_data()  # data: Data, not Promise[Data]

# -----------------------------------------------------
# Suspending Guards (if~, while~)
# -----------------------------------------------------

print('')
print('describe Suspending guards:')
print('  context if~ statement:')

print('    [SKIP] it allows suspending condition:')
skipped = skipped + 1
# TODO: Implement when parser supports if~
# if~ is_ready():
#     proceed()

print('    [SKIP] it chains with elif~:')
skipped = skipped + 1
# TODO: Implement when parser supports elif~
# if~ check_a():
#     ...
# elif~ check_b():
#     ...

print('')
print('  context while~ loop:')

print('    [SKIP] it polls with suspending condition:')
skipped = skipped + 1
# TODO: Implement when parser supports while~
# while~ not done():
#     _ ~= timer.sleep(100_ms)

print('')
print('  context for~ loop:')

print('    [SKIP] it iterates async stream:')
skipped = skipped + 1
# TODO: Implement when parser supports for~
# for~ item in async_stream():
#     process(item)

# -----------------------------------------------------
# Suspending Boolean Operators (and~, or~)
# -----------------------------------------------------

print('')
print('describe Suspending boolean operators:')
print('  context chained conditions:')

print('    [SKIP] it supports and~:')
skipped = skipped + 1
# TODO: Implement when lexer supports and~
# if~ check_a() and~ check_b():
#     ...

print('    [SKIP] it supports or~:')
skipped = skipped + 1
# TODO: Implement when lexer supports or~
# if~ is_cached() or~ fetch_fresh():
#     ...

# -----------------------------------------------------
# Compound Suspending Assignment (~+=, etc.)
# -----------------------------------------------------

print('')
print('describe Compound suspending assignment:')
print('  context numeric operations:')

print('    [SKIP] it supports ~+=:')
skipped = skipped + 1
# TODO: Implement when parser supports compound ~=
# counter ~+= fetch_increment()

print('    [SKIP] it supports ~-=, ~*=, ~/=:')
skipped = skipped + 1
# TODO: Implement when parser supports all compound ~=

# -----------------------------------------------------
# Composition with ? Operator
# -----------------------------------------------------

print('')
print('describe Composition with error propagation:')
print('  context ~= with ?:')

print('    [SKIP] it composes suspension and error propagation:')
skipped = skipped + 1
# TODO: Implement when both operators work together
# let data ~= fetch_data()?  # Suspend, then propagate error

# =====================================================
# Documentation Output
# =====================================================

print('')
print('============================================================')
print('  GENERATED DOCUMENTATION')
print('============================================================')
print('')
print('# Suspension Operator (~)')
print('')
print('**Feature ID:** #45')
print('**Category:** Concurrency')
print('**Difficulty:** Level 3/5')
print('**Status:** Planned')
print('**Implementation:** Rust')
print('')
print('## Description')
print('')
print(FEATURE.description)
print('')
print('## Syntax')
print('')
print('```simple')
print('# Suspending assignment')
print('let user ~= fetch_user(id)')
print('')
print('# Suspending guards')
print('if~ is_ready():')
print('    proceed()')
print('')
print('while~ not done():')
print('    _ ~= timer.sleep(100_ms)')
print('')
print('# Compound suspension')
print('counter ~+= fetch_delta()')
print('```')
print('')
print('## Notes')
print('')
print(FEATURE.notes)

# Summary
print('')
print('============================================================')
print('  TEST SUMMARY')
print('============================================================')
let total = passed + failed + skipped
print("Passed:  {passed}")
print("Failed:  {failed}")
print("Skipped: {skipped}")
print("Total:   {total}")
if failed == 0:
    print('All tests PASSED (or skipped)!')
print('============================================================')
