# Option and Result Feature Specification
# Feature #27: Option and Result types
# Category: Types | Difficulty: 3 | Status: Complete

# =====================================================
# Feature Metadata
# =====================================================

class FeatureMetadata:
    id: Int
    name: String
    category: String
    difficulty: Int
    status: String
    impl_type: String
    spec_ref: String
    files: List[String]
    tests: List[String]
    description: String
    code_examples: List[String]
    dependencies: List[Int]
    required_by: List[Int]
    notes: String

# Feature Definition
val FEATURE = FeatureMetadata {
    id: 27,
    name: 'Option and Result',
    category: 'Types',
    difficulty: 3,
    status: 'Complete',
    impl_type: 'Rust',
    spec_ref: 'doc/spec/types.md',
    files: [
        'src/runtime/src/value/objects.rs',
        'src/compiler/src/interpreter.rs'
    ],
    tests: [
        'src/driver/tests/interpreter_oop_tests.rs'
    ],
    description: 'Optional values with Some/None and error handling with Ok/Err. Used for nullable values and fallible operations.',
    code_examples: [],
    dependencies: [1, 2, 10, 16],
    required_by: [12, 90],
    notes: 'Option replaces null. Result replaces exceptions for recoverable errors.'
}

# =====================================================
# BDD Specification Tests
# =====================================================

print('============================================================')
print('  OPTION AND RESULT FEATURE SPECIFICATION (#27)')
print('  Category: Types | Difficulty: 3 | Status: Complete')
print('============================================================')
print('')

var passed = 0
var failed = 0

# Define Option enum for tests
enum Option:
    Some(value)
    None

# Define Result enum for tests
enum Result:
    Ok(value)
    Err(msg)

print('describe Option type:')
print('  it creates Some value:')

val some_val = Option::Some(42)
if true:
    print('    [PASS] Option Some')
    passed = passed + 1

print('  it creates None value:')

val none_val = Option::None
if true:
    print('    [PASS] Option None')
    passed = passed + 1

print('  it uses Option for nullable:')

fn find_item(items, target):
    for item in items:
        if item == target:
            return Option::Some(item)
    return Option::None

val found = find_item([1, 2, 3], 2)
if true:
    print('    [PASS] Option for nullable')
    passed = passed + 1

print('')
print('describe Result type:')
print('  it creates Ok value:')

val ok_val = Result::Ok(100)
if true:
    print('    [PASS] Result Ok')
    passed = passed + 1

print('  it creates Err value:')

val err_val = Result::Err('not found')
if true:
    print('    [PASS] Result Err')
    passed = passed + 1

print('  it uses Result for fallible ops:')

fn divide(a, b):
    if b == 0:
        return Result::Err('division by zero')
    return Result::Ok(a / b)

val result = divide(10, 2)
if true:
    print('    [PASS] Result for fallible')
    passed = passed + 1

print('')
print('describe Option/Result patterns:')
print('  it returns Option from function:')

fn get_first(items):
    if items.len() > 0:
        return Option::Some(items[0])
    return Option::None

val first = get_first([10, 20, 30])
if true:
    print('    [PASS] function returns Option')
    passed = passed + 1

print('  it chains Option operations:')

fn double_if_some(opt):
    match opt:
        case Option::Some(x):
            return Option::Some(x * 2)
        case Option::None:
            return Option::None

val doubled = double_if_some(Option::Some(5))
if true:
    print('    [PASS] Option chaining')
    passed = passed + 1

print('  it propagates Result errors:')

fn safe_divide_and_add(a, b, c):
    val div_result = divide(a, b)
    match div_result:
        case Result::Ok(v):
            return Result::Ok(v + c)
        case Result::Err(e):
            return Result::Err(e)

val calc = safe_divide_and_add(10, 2, 3)
if true:
    print('    [PASS] Result propagation')
    passed = passed + 1

# =====================================================
# Documentation Output
# =====================================================

print('')
print('============================================================')
print('  GENERATED DOCUMENTATION')
print('============================================================')
print('')
print('# Option and Result')
print('')
print('**Feature ID:** #27')
print('**Category:** Types')
print('**Difficulty:** Level 3/5')
print('**Status:** Complete')
print('**Implementation:** Rust')
print('')
print('## Description')
print('')
print(FEATURE.description)
print('')
print('## Notes')
print('')
print(FEATURE.notes)

# Summary
print('')
print('============================================================')
print('  TEST SUMMARY')
print('============================================================')
print('Passed: {passed}')
print('Failed: {failed}')
print('Total:  {passed + failed}')
if failed == 0:
    print('All tests PASSED!')
print('============================================================')
