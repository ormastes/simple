# Bug Reproduction: Implicit return with inline if expression fails
#
# **Bug ID:** Parser fails with "expected Newline, found Integer"
# **Severity:** P1 - Blocks common functional programming patterns
# **Component:** Parser (statement vs expression parsing)
#
# **Root Cause:**
# When a function body consists of a single inline if expression as implicit return,
# the parser incorrectly expects a newline after the colon in `if cond: expr`.
# It treats the expression as a statement requiring newline instead of an expression.
#
# **Reproduction:**
# ```simple
# fn abs(x: i32) -> i32:
#     if x < 0: 0 - x else: x  # ERROR: expected Newline, found Integer(0)
# ```
#
# **Workaround:**
# Use explicit return keyword:
# ```simple
# fn abs(x: i32) -> i32:
#     return if x < 0: 0 - x else: x  # Works
# ```
#
# **Expected Behavior:**
# Inline if expression should work as implicit return value without `return` keyword.

import std.spec

describe "Bug: Implicit return with inline if expression":
    context "Minimal reproduction":
        it "fails with inline if as implicit return":
            # This pattern should work but currently fails
            fn abs(x: i32) -> i32:
                if x < 0: 0 - x else: x

            expect abs(-5) == 5
            expect abs(5) == 5

        it "fails with inline if starting with literal":
            fn max(a: i32, b: i32) -> i32:
                if a > b: a else: b

            expect max(3, 7) == 7
            expect max(10, 2) == 10

    context "Working workarounds":
        it "works with explicit return":
            fn abs_explicit(x: i32) -> i32:
                return if x < 0: 0 - x else: x

            expect abs_explicit(-5) == 5

        it "works with variable assignment":
            fn abs_var(x: i32) -> i32:
                val result = if x < 0: 0 - x else: x
                result

            expect abs_var(-5) == 5

        it "works with multi-line if":
            fn abs_multiline(x: i32) -> i32:
                if x < 0:
                    0 - x
                else:
                    x

            expect abs_multiline(-5) == 5

    context "Related patterns that should work":
        it "inline if in val declaration works":
            val x = 5
            val result = if x < 0: 0 - x else: x
            expect result == 5

        it "nested inline if as implicit return":
            fn classify(x: i32) -> text:
                if x < 0: "negative" else: if x == 0: "zero" else: "positive"

            expect classify(-1) == "negative"
            expect classify(0) == "zero"
            expect classify(1) == "positive"
