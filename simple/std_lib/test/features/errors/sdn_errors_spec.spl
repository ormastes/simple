"""
# SDN Error Messages Specification

**Feature IDs:** #E1801-E1808
**Category:** Errors / SDN
**Difficulty:** 2/5 (Basic)
**Status:** Draft

## Overview

SDN (Self-Describing Notation) is Simple's native configuration format,
similar to YAML but designed for self-hosting. SDN is used for:

- Package manifests (`simple.sdn`)
- AOP/DI configuration
- Build profiles
- Feature flags

## Syntax

```simple
# simple.sdn example
package:
    name: "my-app"
    version: "1.0.0"

dependencies:
    std: "^1.0"
    http: "~2.3"

aspects:
    enabled: true
```

## Error Codes

| Code | Name | Description |
|------|------|-------------|
| E1801 | SDN Syntax Error | Invalid SDN syntax |
| E1802 | Unknown SDN Key | Unrecognized configuration key |
| E1803 | SDN Type Mismatch | Value type doesn't match expected |
| E1804 | Missing Required SDN Key | Required key is missing |
| E1805 | Duplicate SDN Key | Same key appears twice |
| E1806 | Invalid SDN Value | Invalid value for key |
| E1807 | SDN Nesting Limit | Too deeply nested |
| E1808 | SDN Circular Reference | Circular reference in config |
"""

import std.spec


# ============================================================================
# E1801: SDN Syntax Error
# ============================================================================

describe "E1801 SDN Syntax Error":
    """
    ## SDN Syntax Errors

    SDN uses indentation-based nesting similar to YAML.
    Syntax errors include incorrect indentation, missing colons, etc.
    """

    context "when SDN has syntax errors":
        """
        ### Scenario: Malformed SDN

        Invalid indentation or structure.
        """

        it "reports error for syntax error":
            # Code that would trigger E1801:
            # package
            #   name "missing-colon"
            val error_code = "E1801"
            val error_title = "SDN Syntax Error"
            expect(error_code).to(eq("E1801"))


# ============================================================================
# E1802: Unknown SDN Key
# ============================================================================

describe "E1802 Unknown SDN Key":
    """
    ## Unknown Key Errors

    SDN configurations have defined schemas. Unknown keys are flagged
    to catch typos and invalid configurations.
    """

    context "when key is not recognized":
        it "reports error for unknown key":
            # Code that would trigger E1802:
            # pakage:  # Typo for 'package'
            #     name: "test"
            val error_code = "E1802"
            val error_title = "Unknown SDN Key"
            expect(error_code).to(eq("E1802"))


# ============================================================================
# E1803: SDN Type Mismatch
# ============================================================================

describe "E1803 SDN Type Mismatch":
    """
    ## Type Mismatch Errors

    SDN keys have expected types. Providing wrong types triggers errors.
    """

    context "when value type is wrong":
        it "reports error for type mismatch":
            # Code that would trigger E1803:
            # package:
            #     version: 1.0  # Should be string "1.0.0"
            val error_code = "E1803"
            val error_title = "SDN Type Mismatch"
            expect(error_code).to(eq("E1803"))


# ============================================================================
# E1804: Missing Required SDN Key
# ============================================================================

describe "E1804 Missing Required SDN Key":
    """
    ## Missing Required Key Errors

    Some SDN keys are required (e.g., package.name).
    """

    context "when required key is missing":
        it "reports error for missing key":
            # Code that would trigger E1804:
            # package:
            #     # Missing 'name' which is required
            #     version: "1.0.0"
            val error_code = "E1804"
            val error_title = "Missing Required SDN Key"
            expect(error_code).to(eq("E1804"))


# ============================================================================
# E1805: Duplicate SDN Key
# ============================================================================

describe "E1805 Duplicate SDN Key":
    """
    ## Duplicate Key Errors

    Each key can only appear once in an SDN block.
    """

    context "when key appears multiple times":
        it "reports error for duplicate key":
            # Code that would trigger E1805:
            # package:
            #     name: "first"
            #     name: "second"  # Duplicate
            val error_code = "E1805"
            val error_title = "Duplicate SDN Key"
            expect(error_code).to(eq("E1805"))


# ============================================================================
# E1806: Invalid SDN Value
# ============================================================================

describe "E1806 Invalid SDN Value":
    """
    ## Invalid Value Errors

    Some keys have constrained value sets (e.g., license types).
    """

    context "when value is invalid":
        it "reports error for invalid value":
            # Code that would trigger E1806:
            # package:
            #     license: "INVALID-LICENSE"
            val error_code = "E1806"
            val error_title = "Invalid SDN Value"
            expect(error_code).to(eq("E1806"))


# ============================================================================
# E1807: SDN Nesting Limit
# ============================================================================

describe "E1807 SDN Nesting Limit":
    """
    ## Nesting Limit Errors

    SDN has a maximum nesting depth to prevent infinite structures.
    """

    context "when nesting is too deep":
        it "reports error for nesting limit":
            val error_code = "E1807"
            val error_title = "SDN Nesting Limit"
            expect(error_code).to(eq("E1807"))


# ============================================================================
# E1808: SDN Circular Reference
# ============================================================================

describe "E1808 SDN Circular Reference":
    """
    ## Circular Reference Errors

    SDN values can reference other values using anchors/aliases,
    but circular references are not allowed.
    """

    context "when references are circular":
        it "reports error for circular reference":
            val error_code = "E1808"
            val error_title = "SDN Circular Reference"
            expect(error_code).to(eq("E1808"))


# ============================================================================
# Korean Language Support Tests
# ============================================================================

describe "SDN Error Messages - Korean (한국어)":
    """
    ## i18n 검증: SDN 오류 메시지 한국어 번역

    모든 SDN 오류 코드는 한국어 번역을 지원합니다.
    """

    it "E1801 has Korean translation":
        val ko_title = "SDN 구문 오류"
        expect(ko_title).to(contain("SDN"))

    it "E1804 has Korean translation":
        val ko_title = "필수 SDN 키 누락"
        expect(ko_title).to(contain("키"))

    it "E1808 has Korean translation":
        val ko_title = "SDN 순환 참조"
        expect(ko_title).to(contain("순환"))
