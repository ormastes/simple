/// Comprehensive tests for BDD matchers
/// Tests core, comparison, collection, and error matchers

import test.unit.*
import std.spec

describe "BDD Matchers":
    context "core matchers":
        it "eq matcher tests equality":
            expect 5 to eq 5
            expect "hello" to eq "hello"
            expect true to eq true

        it "be matcher tests identity":
            let x = 5
            expect x to be 5

        it "be_nil matcher tests None":
            let nothing: Option[Int] = None
            expect nothing to be_nil

    context "comparison matchers (numbers)":
        it "gt (greater than) matcher":
            expect 10 to gt 5
            expect 100 to gt 50

        it "lt (less than) matcher":
            expect 3 to lt 10
            expect 1 to lt 100

        it "gte (greater than or equal) matcher":
            expect 10 to gte 5
            expect 5 to gte 5

        it "lte (less than or equal) matcher":
            expect 3 to lte 10
            expect 5 to lte 5

        it "comparison matchers with strings":
            expect "beta" to gt "alpha"
            expect "alpha" to lt "beta"

        it "multiple comparisons in one test":
            expect 5 to gt 0
            expect 5 to gte 5
            expect 5 to lt 10
            expect 5 to lte 5

    context "string matchers":
        it "include matcher for strings":
            expect "hello world" to include "world"
            expect "hello world" to include "hello"

        it "start_with matcher":
            expect "hello world" to start_with "hello"
            expect "Simple Language" to start_with "Simple"

        it "end_with matcher":
            expect "hello world" to end_with "world"
            expect "Simple Language" to end_with "Language"

        it "case insensitive string matching":
            expect "Hello" to include "ello"
            expect "HELLO" to start_with "HEL"

    context "collection matchers":
        it "include matcher for arrays":
            let arr = [1, 2, 3, 4, 5]
            expect arr to include 3
            expect arr to include 1

        it "be_empty matcher for empty collections":
            let empty_arr: [Int] = []
            expect empty_arr to be_empty

        it "be_empty fails for non-empty collections":
            let arr = [1]
            expect (arr.len == 1)

        it "include matcher for multiple items":
            let arr = ["a", "b", "c"]
            expect arr to include "b"
            expect arr to include "a"

    context "negated assertions":
        it "not_to with eq":
            expect 5 not_to eq 6
            expect "hello" not_to eq "world"

        it "not_to with comparison":
            expect 5 not_to gt 10
            expect 5 not_to lt 1

        it "not_to with include":
            expect "hello" not_to include "xyz"
            let arr = [1, 2, 3]
            expect arr not_to include 5

    context "complex matcher chains":
        it "chains multiple matchers on same value":
            expect 10 to gt 5
            expect 10 to gte 10
            expect 10 to lt 20
            expect 10 to lte 10

        it "uses matchers with method calls":
            let text = "hello world"
            expect text to include "world"
            expect text to start_with "hello"
            expect text to end_with "world"

        it "matchers with computed values":
            let x = 5
            let y = 3
            let res_val = x + y
            expect result to eq 8
            expect result to gt 7
            expect result to lt 10

    context "type-generic matchers":
        it "works with different numeric types":
            expect 42 to eq 42
            expect 100 to gt 50

        it "works with strings":
            expect "test" to eq "test"
            expect "test" to include "es"

        it "works with booleans":
            expect true to eq true
            expect false to eq false

    context "edge cases":
        it "handles zero":
            expect 0 to eq 0
            expect 0 to gte 0
            expect 0 to lte 0

        it "handles empty strings":
            let empty = ""
            expect empty to eq ""

        it "handles empty collections":
            let empty_list: [Int] = []
            expect empty_list to be_empty

        it "handles negative numbers":
            expect (-5) to lt 0
            expect (-10) to lt (-5)

    context "matcher composition":
        it "multiple assertions with same matcher":
            let arr = [1, 2, 3, 4, 5]
            expect arr to include 1
            expect arr to include 2
            expect arr to include 3

        it "alternating positive and negative":
            let arr = [1, 2, 3]
            expect arr to include 2
            expect arr not_to include 10
            expect arr to include 1
            expect arr not_to include 5
