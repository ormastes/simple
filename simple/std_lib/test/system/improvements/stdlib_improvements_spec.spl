# Standard Library Improvement Tests
# Tests for stdlib improvements documented in simple/improve_request.md
#
# Tests marked with `it` are WORKING features.
# Tests marked with `skip` are NOT YET IMPLEMENTED.

import spec

describe "String Method Improvements":

    # IMPROVEMENT: Enhanced String Methods
    # Status: MOSTLY IMPLEMENTED
    context "Substring Operations":
        it "substring extracts range":
            let text = "hello world"
            expect text.substring(0, 5) == "hello"

        skip "substr extracts with length":
            # Note: substring takes (start, end), not (start, length)
            let text = "hello world"
            expect text.substr(6, 5) == "world"

        it "char_at gets single character":
            let text = "hello"
            expect text.char_at(0) == "h"
            expect text.char_at(4) == "o"

        it "chars returns list of characters":
            let text = "abc"
            let chars = text.chars()
            expect chars.len() == 3
            expect chars[0] == "a"

    context "Search Operations":
        it "find returns index of substring":
            let text = "hello world"
            # find returns Some(index) or None
            let result = text.find("world")
            expect result.is_some()

        skip "find_all returns all indices":
            let text = "abcabc"
            let indices = text.find_all("a")
            expect indices.len() == 2

        it "contains checks for substring":
            let text = "hello world"
            expect text.contains("world") == true
            expect text.contains("xyz") == false

        it "starts_with checks prefix":
            let text = "hello world"
            expect text.starts_with("hello") == true
            expect text.starts_with("world") == false

        it "ends_with checks suffix":
            let text = "hello world"
            expect text.ends_with("world") == true
            expect text.ends_with("hello") == false

    context "Whitespace Operations":
        it "strip removes leading and trailing whitespace":
            let text = "  hello  "
            expect text.strip() == "hello"

        it "trim removes leading and trailing whitespace":
            let text = "  hello  "
            expect text.trim() == "hello"

        it "trim_start removes leading whitespace":
            let text = "  hello  "
            expect text.trim_start() == "hello  "

        it "trim_end removes trailing whitespace":
            let text = "  hello  "
            expect text.trim_end() == "  hello"

    context "Case Operations":
        it "to_upper converts to uppercase":
            let text = "hello"
            expect text.to_upper() == "HELLO"

        it "to_lower converts to lowercase":
            let text = "HELLO"
            expect text.to_lower() == "hello"

        skip "capitalize capitalizes first letter":
            let text = "hello world"
            expect text.capitalize() == "Hello world"

    context "Split and Join":
        it "split divides string by delimiter":
            let text = "a,b,c"
            let parts = text.split(",")
            expect parts.len() == 3
            expect parts[0] == "a"

        skip "join combines list with delimiter":
            let parts = ["a", "b", "c"]
            expect ",".join(parts) == "a,b,c"

        it "lines splits by newlines":
            let text = "line1\nline2\nline3"
            let lines = text.lines()
            expect lines.len() == 3

    context "Replacement":
        it "replace replaces all occurrences":
            let text = "hello hello"
            # Note: replace() replaces ALL occurrences
            expect text.replace("hello", "hi") == "hi hi"

        it "replace_first replaces first occurrence":
            let text = "hello hello"
            expect text.replace_first("hello", "hi") == "hi hello"

describe "File I/O Improvements":

    # IMPROVEMENT: Comprehensive File I/O API
    # Status: NOT IMPLEMENTED
    context "File Reading":
        skip "read_file returns file contents":
            # Would need:
            # import host.async_nogc_mut.io.fs
            # let content = fs.read_file("/tmp/test.txt")
            expect true == true  # Placeholder

        skip "read_bytes returns raw bytes":
            expect true == true  # Placeholder

        skip "read_lines returns list of lines":
            expect true == true  # Placeholder

    context "File Writing":
        skip "write_file writes string to file":
            expect true == true  # Placeholder

        skip "write_bytes writes raw bytes":
            expect true == true  # Placeholder

        skip "append_file appends to existing file":
            expect true == true  # Placeholder

    context "File Metadata":
        skip "exists checks if path exists":
            expect true == true  # Placeholder

        skip "is_file checks if path is file":
            expect true == true  # Placeholder

        skip "is_dir checks if path is directory":
            expect true == true  # Placeholder

        skip "file_size returns size in bytes":
            expect true == true  # Placeholder

    context "Directory Operations":
        skip "list_dir returns directory contents":
            expect true == true  # Placeholder

        skip "create_dir creates new directory":
            expect true == true  # Placeholder

        skip "remove_file deletes file":
            expect true == true  # Placeholder

        skip "remove_dir deletes directory":
            expect true == true  # Placeholder

describe "JSON Library Improvements":

    # IMPROVEMENT: JSON Library for Structured Output
    # Status: NOT IMPLEMENTED
    context "JSON Parsing":
        skip "from_json parses JSON string":
            # Would need:
            # import core.json
            # let value = json.from_json('{"key": "value"}')
            expect true == true  # Placeholder

        skip "parses JSON arrays":
            expect true == true  # Placeholder

        skip "parses nested JSON":
            expect true == true  # Placeholder

    context "JSON Generation":
        skip "to_json converts dict to JSON":
            expect true == true  # Placeholder

        skip "to_json handles nested structures":
            expect true == true  # Placeholder

        skip "escapes special characters":
            expect true == true  # Placeholder

    context "JSON Builder":
        skip "builds JSON objects fluently":
            expect true == true  # Placeholder

        skip "builds JSON arrays fluently":
            expect true == true  # Placeholder

describe "Error Handling Improvements":

    # IMPROVEMENT: ? Operator for Error Propagation
    # Status: NOT IMPLEMENTED
    context "Question Mark Operator":
        skip "propagates Result errors":
            # Would allow:
            # fn process() -> Result[Int, String]:
            #     let value = may_fail()?
            #     return Ok(value * 2)
            expect true == true  # Placeholder

        skip "propagates Option None":
            # Would allow:
            # fn process() -> Option[Int]:
            #     let value = may_be_none()?
            #     return Some(value * 2)
            expect true == true  # Placeholder

        skip "chains multiple ? operations":
            expect true == true  # Placeholder
