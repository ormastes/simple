# Basic macro system test

# Define macros at module level
macro answer() -> (returns result: Int):
    emit result:
        42

macro double(n: Int const) -> (returns result: Int):
    const_eval:
        let doubled = n * 2
    emit result:
        doubled

macro make_getter(name: Str const) -> (
    intro func:
        enclosing.module.fn "get_{name}"() -> Str
):
    emit func:
        fn "get_{name}"() -> Str:
            return "{name} value"

make_getter!("test")

describe "Basic Macros":
    it "expands simple macro":
        let x = answer!()
        expect x == 42

    it "uses const parameter":
        expect double!(5) == 10

    it "generates function with template":
        let result = get_test()
        expect result == "test value"
