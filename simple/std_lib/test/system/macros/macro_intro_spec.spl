# Test for intro contracts and function generation

# Simple intro contract - returns fixed values
macro make_answer(name: Str const) -> (
    intro func:
        enclosing.module.fn "name"() -> Int
):
    emit func:
        fn "name"() -> Int:
            return 42

make_answer!("get_42")
make_answer!("get_answer")

# Intro with parameters - fixed implementation
macro make_adder(suffix: Str const) -> (
    intro func:
        enclosing.module.fn "add_{suffix}"(x: Int) -> Int
):
    emit func:
        fn "add_{suffix}"(x: Int) -> Int:
            return x + 5

make_adder!("five")
make_adder!("also_five")

# Multiple functions with loop
macro make_three_axes(base: Str const) -> (
    intro axes:
        for i in 0..3:
            enclosing.module.fn "{base}{i}"() -> Int
):
    emit axes:
        fn "{base}0"() -> Int:
            return 0
        fn "{base}1"() -> Int:
            return 1
        fn "{base}2"() -> Int:
            return 2

make_three_axes!("axis")

# Getter generation with string template
macro make_getter(field: Str const, value: Str const) -> (
    intro getter:
        enclosing.module.fn "get_{field}"() -> Str
):
    emit getter:
        fn "get_{field}"() -> Str:
            return "value"

make_getter!("name", "Alice")
make_getter!("city", "Tokyo")

# Boolean checker - fixed threshold
macro make_positive_checker(name: Str const) -> (
    intro func:
        enclosing.module.fn "is_name"(val: Int) -> Bool
):
    emit func:
        fn "is_name"(val: Int) -> Bool:
            return val > 0

make_positive_checker!("positive")

describe "Intro Contracts":
    describe "Simple function introduction":
        it "generates functions":
            expect get_42() == 42
            expect get_answer() == 42

        it "generates functions with parameters":
            expect add_five(10) == 15
            expect add_also_five(20) == 25

    describe "Multiple function generation":
        it "generates axis functions from loop":
            expect axis0() == 0
            expect axis1() == 1
            expect axis2() == 2

    describe "Template substitution in names":
        it "generates getter functions with string values":
            expect get_name() == "Alice"
            expect get_city() == "Tokyo"

        it "generates checker functions":
            expect is_positive(5) == true
            expect is_positive(-5) == false
