# Physics Rigid Body Dynamics Tests

import physics.core as core
import physics.dynamics as dynamics

describe "RigidBody":
    describe "creation":
        it "creates rigid body with mass and position":
            let body = dynamics.RigidBody(
                mass=1.0,
                position=core.Vector3(0.0, 0.0, 0.0)
            )
            expect body.mass == 1.0
            expect body.position.x == 0.0

        it "creates static body with zero mass":
            let body = dynamics.RigidBody(
                mass=0.0,
                position=core.Vector3(0.0, 0.0, 0.0)
            )
            expect body.mass == 0.0
            expect body.is_static() == true

    describe "forces":
        it "adds force to body":
            let body = dynamics.RigidBody(
                mass=1.0,
                position=core.Vector3(0.0, 0.0, 0.0)
            )
            let force = core.Vector3(0.0, -9.81, 0.0)
            body.add_force(force)
            expect body.force.y == -9.81

        it "clears accumulated forces":
            let body = dynamics.RigidBody(
                mass=1.0,
                position=core.Vector3(0.0, 0.0, 0.0)
            )
            body.add_force(core.Vector3(10.0, 20.0, 30.0))
            body.clear_forces()
            expect body.force.x == 0.0
            expect body.force.y == 0.0
            expect body.force.z == 0.0

    describe "impulses":
        it "applies impulse to velocity":
            let body = dynamics.RigidBody(
                mass=1.0,
                position=core.Vector3(0.0, 0.0, 0.0)
            )
            let impulse = core.Vector3(5.0, 0.0, 0.0)
            body.apply_impulse(impulse)
            expect body.velocity.x == 5.0

    describe "integration":
        it "integrates position with velocity":
            let body = dynamics.RigidBody(
                mass=1.0,
                position=core.Vector3(0.0, 0.0, 0.0)
            )
            body.velocity = core.Vector3(1.0, 0.0, 0.0)
            body.integrate(1.0)
            expect body.position.x == 1.0

        it "integrates velocity with force":
            let body = dynamics.RigidBody(
                mass=1.0,
                position=core.Vector3(0.0, 0.0, 0.0)
            )
            body.add_force(core.Vector3(10.0, 0.0, 0.0))
            body.integrate(1.0)
            expect body.velocity.x >= 9.0
            expect body.velocity.x <= 11.0

describe "Gravity":
    describe "force application":
        it "applies gravity force to body":
            let gravity = dynamics.Gravity(core.Vector3(0.0, -9.81, 0.0))
            let body = dynamics.RigidBody(
                mass=1.0,
                position=core.Vector3(0.0, 10.0, 0.0)
            )
            gravity.apply(body)
            expect body.force.y <= -9.0
            expect body.force.y >= -10.0

describe "Drag":
    describe "velocity damping":
        it "applies drag force opposing motion":
            let drag = dynamics.Drag(coefficient=0.1)
            let body = dynamics.RigidBody(
                mass=1.0,
                position=core.Vector3(0.0, 0.0, 0.0)
            )
            body.velocity = core.Vector3(10.0, 0.0, 0.0)
            drag.apply(body)
            expect body.force.x < 0.0
