# Log Module Tests
#
# Tests for simple/std_lib/src/log.spl

import std_lib.src.log as log

describe "Log Levels":
    it "has correct level constants":
        expect log.LOG_OFF == 0
        expect log.LOG_FATAL == 1
        expect log.LOG_ERROR == 2
        expect log.LOG_WARN == 3
        expect log.LOG_INFO == 4
        expect log.LOG_DEBUG == 5
        expect log.LOG_TRACE == 6
        expect log.LOG_VERBOSE == 7
        expect log.LOG_ALL == 10

describe "Level Configuration":
    describe "set_level":
        it "sets global log level":
            log.set_level(log.LOG_DEBUG)
            expect log.get_level("any") == log.LOG_DEBUG

            # Reset to default
            log.set_level(log.LOG_INFO)

    describe "set_scope_level":
        it "sets level for specific scope":
            log.set_scope_level("parser", log.LOG_TRACE)
            expect log.get_level("parser") == log.LOG_TRACE

            # Other scopes use global
            expect log.get_level("other") == log.LOG_INFO

    describe "get_level":
        it "returns scope level if set":
            log.set_scope_level("test", log.LOG_WARN)
            expect log.get_level("test") == log.LOG_WARN

        it "returns global level if scope not set":
            log.set_level(log.LOG_INFO)
            expect log.get_level("unset_scope") == log.LOG_INFO

describe "Logging Functions":
    # These tests just verify the functions don't crash
    # Actual output verification would require capturing stderr

    it "fatal logs at level 1":
        log.set_level(log.LOG_ALL)
        log.fatal("test", "fatal message")

    it "error logs at level 2":
        log.set_level(log.LOG_ALL)
        log.error("test", "error message")

    it "warn logs at level 3":
        log.set_level(log.LOG_ALL)
        log.warn("test", "warning message")

    it "info logs at level 4":
        log.set_level(log.LOG_ALL)
        log.info("test", "info message")

    it "debug logs at level 5":
        log.set_level(log.LOG_ALL)
        log.debug("test", "debug message")

    it "trace logs at level 6":
        log.set_level(log.LOG_ALL)
        log.trace("test", "trace message")

    it "verbose logs at level 7":
        log.set_level(log.LOG_ALL)
        log.verbose("test", "verbose message")

describe "Convenience Functions":
    it "log_info uses default scope":
        log.set_level(log.LOG_ALL)
        log.log_info("test message")

    it "log_error uses default scope":
        log.set_level(log.LOG_ALL)
        log.log_error("error message")

    it "log_debug uses default scope":
        log.set_level(log.LOG_ALL)
        log.log_debug("debug message")
