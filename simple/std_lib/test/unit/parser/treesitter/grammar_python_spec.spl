# Unit tests for Python grammar

import spec.{describe, it, expect}
import parser.treesitter.grammar_python as python_grammar
import parser.treesitter.grammar_test as gt

describe "PythonGrammar":
    it "creates Python grammar":
        let grammar = python_grammar.PythonGrammar.new()

        expect grammar.grammar.name == "python"
        expect grammar.grammar.entry_point == "module"

describe "Python parsing":
    it "parses function definition":
        let suite = gt.GrammarTestBuilder.new()
            .test("function", "python", "def hello():\n    pass\n", "module")
            .build()

        let result = suite.run()

        expect(result.all_passed()).to_be(true)

    it "parses class definition":
        let suite = gt.GrammarTestBuilder.new()
            .test("class", "python", "class Point:\n    pass\n", "module")
            .build()

        let result = suite.run()

        expect(result.all_passed()).to_be(true)

    it "parses if statement":
        let suite = gt.GrammarTestBuilder.new()
            .test("if", "python", "if x > 0:\n    print(x)\n", "module")
            .build()

        let result = suite.run()

        expect(result.all_passed()).to_be(true)

    it "parses for loop":
        let suite = gt.GrammarTestBuilder.new()
            .test("for", "python", "for i in range(10):\n    print(i)\n", "module")
            .build()

        let result = suite.run()

        expect(result.all_passed()).to_be(true)

    it "parses list comprehension":
        let suite = gt.GrammarTestBuilder.new()
            .test("list_comp", "python", "[x for x in range(10)]\n", "module")
            .build()

        let result = suite.run()

        expect(result.all_passed()).to_be(true)

    it "parses import":
        let suite = gt.GrammarTestBuilder.new()
            .test("import", "python", "import os\n", "module")
            .build()

        let result = suite.run()

        expect(result.all_passed()).to_be(true)

    it "parses decorators":
        let suite = gt.GrammarTestBuilder.new()
            .test("decorator", "python", "@property\ndef name(self):\n    return self._name\n", "module")
            .build()

        let result = suite.run()

        expect(result.all_passed()).to_be(true)

    it "parses lambda":
        let suite = gt.GrammarTestBuilder.new()
            .test("lambda", "python", "lambda x: x + 1\n", "module")
            .build()

        let result = suite.run()

        expect(result.all_passed()).to_be(true)
