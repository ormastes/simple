# Path Manipulation FFI Specification
# Tests for path manipulation operations using FFI functions from shell module

import spec.{describe, context, it, expect}
import shell.path

describe("Path Manipulation FFI Functions"):
    context("path.basename"):
        it("should extract filename from path"):
            val result = path.basename("/home/user/file.txt")
            expect(result).to_equal("file.txt")

        it("should handle path with no directory"):
            val result = path.basename("file.txt")
            expect(result).to_equal("file.txt")

        it("should handle directory path"):
            val result = path.basename("/home/user/dir/")
            expect(result).to_equal("dir")

        it("should handle root path"):
            val result = path.basename("/")
            expect(result).to_equal("")

        it("should handle empty path"):
            val result = path.basename("")
            expect(result).to_equal("")

    context("path.dirname"):
        it("should extract directory from path"):
            val result = path.dirname("/home/user/file.txt")
            expect(result).to_equal("/home/user")

        it("should handle path with single directory"):
            val result = path.dirname("/file.txt")
            expect(result).to_equal("/")

        it("should handle relative path"):
            val result = path.dirname("dir/file.txt")
            expect(result).to_equal("dir")

        it("should handle file with no directory"):
            val result = path.dirname("file.txt")
            expect(result).to_equal("")

        it("should handle empty path"):
            val result = path.dirname("")
            expect(result).to_equal("")

    context("path.ext"):
        it("should extract file extension"):
            val result = path.ext("/home/user/file.txt")
            expect(result).to_equal("txt")

        it("should handle multiple dots"):
            val result = path.ext("file.tar.gz")
            expect(result).to_equal("gz")

        it("should handle no extension"):
            val result = path.ext("/home/user/file")
            expect(result).to_equal("")

        it("should handle hidden file with extension"):
            val result = path.ext(".bashrc")
            expect(result).to_equal("")

        it("should handle hidden file with dot and extension"):
            val result = path.ext(".config.json")
            expect(result).to_equal("json")

    context("path.absolute"):
        it("should convert relative path to absolute"):
            val result = path.absolute(".")
            expect(result).to_contain("/")
            expect(result.len()).to_be_greater_than(0)

        it("should keep absolute path absolute"):
            val result = path.absolute("/tmp")
            expect(result).to_start_with("/")

        it("should handle current directory"):
            val result = path.absolute(".")
            expect(result).to_not_equal("")
            expect(result).to_not_equal(".")

        it("should handle parent directory"):
            val result = path.absolute("..")
            expect(result).to_contain("/")

    context("path.join"):
        it("should join path components"):
            val result = path.join("home", "user", "file.txt")
            expect(result).to_equal("home/user/file.txt")

        it("should handle single component"):
            val result = path.join("home")
            expect(result).to_equal("home")

        it("should handle empty components"):
            val result = path.join()
            expect(result).to_equal("")

        it("should not add separator if already present"):
            val result = path.join("home/", "user")
            expect(result).to_equal("home/user")
