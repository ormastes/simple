# File System FFI Specification
# Tests for file system operations using FFI functions from shell module

import spec.{describe, context, it, expect}
import shell.{file, dir}

describe("File System FFI Functions"):
    context("file operations"):
        it("should check if file exists"):
            # This test file should exist
            let exists = file.exists("simple/std_lib/test/unit/shell/file_system_spec.spl")
            expect(exists).to_be(true)

        it("should return false for non-existent files"):
            let exists = file.exists("/nonexistent/test/file.txt")
            expect(exists).to_be(false)

        it("should write and read text file"):
            let test_path = "/tmp/simple_test_file.txt"
            let test_content = "Hello from Simple test!"

            # Write to file
            file.write_text(test_path, test_content)

            # Read back
            let read_content = file.read_text(test_path)
            expect(read_content).to_equal(test_content)

            # Clean up
            file.remove(test_path)

        it("should append text to file"):
            let test_path = "/tmp/simple_test_append.txt"

            # Write initial content
            file.write_text(test_path, "Line 1\n")

            # Append more content
            file.append_text(test_path, "Line 2\n")

            # Read all
            let content = file.read_text(test_path)
            expect(content).to_equal("Line 1\nLine 2\n")

            # Clean up
            file.remove(test_path)

        it("should copy file"):
            let src_path = "/tmp/simple_test_src.txt"
            let dest_path = "/tmp/simple_test_dest.txt"

            # Write source file
            file.write_text(src_path, "Copy me!")

            # Copy it
            file.copy(src_path, dest_path)

            # Verify destination exists and has same content
            expect(file.exists(dest_path)).to_be(true)
            let dest_content = file.read_text(dest_path)
            expect(dest_content).to_equal("Copy me!")

            # Clean up
            file.remove(src_path)
            file.remove(dest_path)

        it("should move/rename file"):
            let old_path = "/tmp/simple_test_old.txt"
            let new_path = "/tmp/simple_test_new.txt"

            # Create file
            file.write_text(old_path, "Move me!")

            # Move it
            file.move(old_path, new_path)

            # Verify old doesn't exist, new does
            expect(file.exists(old_path)).to_be(false)
            expect(file.exists(new_path)).to_be(true)

            # Clean up
            file.remove(new_path)

    context("directory operations"):
        it("should create and remove directory"):
            let test_dir = "/tmp/simple_test_dir"

            # Create directory
            dir.create(test_dir)

            # Verify it exists
            expect(dir.exists(test_dir)).to_be(true)

            # Remove it
            dir.remove(test_dir)

            # Verify it's gone
            expect(dir.exists(test_dir)).to_be(false)

        it("should create recursive directory"):
            let test_dir = "/tmp/simple_test/nested/deep"

            # Create nested directories
            dir.create_recursive(test_dir)

            # Verify it exists
            expect(dir.exists(test_dir)).to_be(true)

            # Clean up (recursive remove)
            dir.remove_recursive("/tmp/simple_test")

        it("should list directory entries"):
            let test_dir = "/tmp/simple_test_list"

            # Create directory
            dir.create(test_dir)

            # Create some files
            file.write_text("{test_dir}/file1.txt", "content1")
            file.write_text("{test_dir}/file2.txt", "content2")
            file.write_text("{test_dir}/file3.txt", "content3")

            # List entries
            let entries = dir.list(test_dir)

            # Should have 3 entries
            expect(entries.len()).to_equal(3)

            # Clean up
            file.remove("{test_dir}/file1.txt")
            file.remove("{test_dir}/file2.txt")
            file.remove("{test_dir}/file3.txt")
            dir.remove(test_dir)
