# File System FFI Specification
# Tests for file system operations using FFI functions from shell module

import shell.{file, dir}

describe "File System FFI Functions":
    context "file operations":
        it "should check if file exists":
            # This test file should exist
            val exists = file.exists("simple/std_lib/test/unit/shell/file_system_spec.spl")
            expect(exists)

        it "should return false for non-existent files":
            val exists = file.exists("/nonexistent/test/file.txt")
            expect(not exists)

        it "should write and read text file":
            val test_path = "/tmp/simple_test_file.txt"
            val test_content = "Hello from Simple test!"

            # Write to file
            file.write_text(test_path, test_content)

            # Read back
            val read_content = file.read_text(test_path)
            expect(read_content == test_content)

            # Clean up
            file.remove(test_path)

        it "should append text to file":
            val test_path = "/tmp/simple_test_append.txt"

            # Write initial content
            file.write_text(test_path, "Line 1\n")

            # Append more content
            file.append_text(test_path, "Line 2\n")

            # Read all
            val content = file.read_text(test_path)
            expect(content == "Line 1\nLine 2\n")

            # Clean up
            file.remove(test_path)

        it "should copy file":
            val src_path = "/tmp/simple_test_src.txt"
            val dest_path = "/tmp/simple_test_dest.txt"

            # Write source file
            file.write_text(src_path, "Copy me!")

            # Copy it
            file.copy(src_path, dest_path)

            # Verify destination exists and has same content
            expect(file.exists(dest_path))
            val dest_content = file.read_text(dest_path)
            expect(dest_content == "Copy me!")

            # Clean up
            file.remove(src_path)
            file.remove(dest_path)

        skip "should move/rename file":
            # Note: file.move() uses 'move' keyword - needs stdlib fix
            pass

            # Clean up
            file.remove(new_path)

    context "directory operations":
        it "should create and remove directory":
            val test_dir = "/tmp/simple_test_dir"

            # Create directory
            dir.create(test_dir)

            # Verify it exists
            expect(dir.exists(test_dir))

            # Remove it
            dir.remove(test_dir)

            # Verify it's gone
            expect(not dir.exists(test_dir))

        it "should create recursive directory":
            val test_dir = "/tmp/simple_test/nested/deep"

            # Create nested directories
            dir.create_recursive(test_dir)

            # Verify it exists
            expect(dir.exists(test_dir))

            # Clean up (recursive remove)
            dir.remove_recursive("/tmp/simple_test")

        it "should list directory entries":
            val test_dir = "/tmp/simple_test_list"

            # Create directory
            dir.create(test_dir)

            # Create some files
            file.write_text("{test_dir}/file1.txt", "content1")
            file.write_text("{test_dir}/file2.txt", "content2")
            file.write_text("{test_dir}/file3.txt", "content3")

            # List entries
            val entries = dir.list(test_dir)

            # Should have 3 entries
            expect(entries.len() == 3)

            # Clean up
            file.remove("{test_dir}/file1.txt")
            file.remove("{test_dir}/file2.txt")
            file.remove("{test_dir}/file3.txt")
            dir.remove(test_dir)
