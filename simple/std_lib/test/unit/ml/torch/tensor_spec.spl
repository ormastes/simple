# ML Tensor Operations Tests

import ml.torch as torch

describe "PyTorch Tensor":
    describe "device management":
        it "detects CUDA availability":
            let available = torch.cuda_available()
            expect available == true or available == false

        it "gets CUDA device count":
            let count = torch.cuda_device_count()
            expect count >= 0

    describe "tensor creation":
        it "creates zeros tensor on CPU":
            let t = torch.zeros([2, 3])
            let shape = t.shape()
            expect shape[0] == 2
            expect shape[1] == 3
            expect t.numel() == 6

        it "creates ones tensor on CPU":
            let t = torch.ones([3, 4])
            let shape = t.shape()
            expect shape[0] == 3
            expect shape[1] == 4
            expect t.numel() == 12

        it "creates randn tensor":
            let t = torch.randn([5, 5])
            let shape = t.shape()
            expect shape[0] == 5
            expect shape[1] == 5
            expect t.numel() == 25

        it "creates arange tensor":
            let t = torch.arange(0, 10, 1)
            expect t.numel() == 10

    describe "arithmetic operations":
        it "adds tensors":
            let a = torch.ones([2, 2])
            let b = torch.ones([2, 2])
            let c = a + b
            let shape = c.shape()
            expect shape[0] == 2
            expect shape[1] == 2

        it "subtracts tensors":
            let a = torch.ones([2, 2])
            let b = torch.ones([2, 2])
            let c = a - b
            let shape = c.shape()
            expect shape[0] == 2
            expect shape[1] == 2

        it "multiplies tensors element-wise":
            let a = torch.ones([3, 3])
            let b = torch.ones([3, 3])
            let c = a * b
            let shape = c.shape()
            expect shape[0] == 3
            expect shape[1] == 3

        it "performs matrix multiplication":
            let a = torch.randn([4, 6])
            let b = torch.randn([6, 8])
            let c = a @ b
            let shape = c.shape()
            expect shape[0] == 4
            expect shape[1] == 8

    describe "shape operations":
        it "reshapes tensor":
            let t = torch.randn([2, 6])
            let reshaped = t.reshape([3, 4])
            let shape = reshaped.shape()
            expect shape[0] == 3
            expect shape[1] == 4
            expect reshaped.numel() == 12

        it "transposes tensor":
            let t = torch.randn([3, 5])
            let transposed = t.transpose(0, 1)
            let shape = transposed.shape()
            expect shape[0] == 5
            expect shape[1] == 3

    describe "device transfer":
        it "transfers to CPU":
            let t = torch.randn([10, 10])
            let cpu_t = t.to_cpu()
            let shape = cpu_t.shape()
            expect shape[0] == 10
            expect shape[1] == 10

    describe "data access":
        it "clones tensor":
            let t = torch.randn([5, 5])
            let cloned = t.clone()
            expect cloned.numel() == t.numel()
