# Experiment Tracking Unit Tests

import ml.tracking.{Track, Artifact}


# ============================================================================
# Test: Run Creation and Logging
# ============================================================================

print("=" * 70)
print("EXPERIMENT TRACKING UNIT TESTS")
print("=" * 70)

var passed = 0
var failed = 0


# Test 1: Create run
print("\n<Test 1> Create run")
Track.set_mode("offline")
val run = Track.run(project="test-project", name="test-run", config={"lr": 0.001}, tags=["test"])

if run.project == "test-project":
    print("  ✓ PASS: Run project set correctly")
    passed += 1
else:
    print("  ✗ FAIL: Run project incorrect")
    failed += 1

if run.name == "test-run":
    print("  ✓ PASS: Run name set correctly")
    passed += 1
else:
    print("  ✗ FAIL: Run name incorrect")
    failed += 1

if run.id is not null and run.id.len() > 0:
    print("  ✓ PASS: Run ID generated")
    passed += 1
else:
    print("  ✗ FAIL: Run ID not generated")
    failed += 1


# Test 2: Log metrics
print("\n<Test 2> Log metrics")
run.log({"loss": 0.5, "acc": 0.9}, step=0)
run.log({"loss": 0.3, "acc": 0.95}, step=1)

print("  ✓ PASS: Metrics logged (no errors)")
passed += 1


# Test 3: Create artifact
print("\n<Test 3> Create artifact")
val artifact = Artifact("test-model", type="model", description="Test model artifact")

if artifact.name == "test-model":
    print("  ✓ PASS: Artifact name set")
    passed += 1
else:
    print("  ✗ FAIL: Artifact name incorrect")
    failed += 1

if artifact.type == "model":
    print("  ✓ PASS: Artifact type set")
    passed += 1
else:
    print("  ✗ FAIL: Artifact type incorrect")
    failed += 1


# Test 4: Finish run
print("\n<Test 4> Finish run")
run.finish()

if run.end_time is not null:
    print("  ✓ PASS: Run end time set")
    passed += 1
else:
    print("  ✗ FAIL: Run end time not set")
    failed += 1


# Summary
print("\n" + "=" * 70)
print("SUMMARY")
print("=" * 70)
print(f"Passed: {passed}")
print(f"Failed: {failed}")
print(f"Total:  {passed + failed}")

if failed == 0:
    print("\n✓ All tests passed!")
else:
    print(f"\n✗ {failed} test(s) failed")

print("=" * 70)
