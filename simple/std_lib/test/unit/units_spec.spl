/// Comprehensive tests for units types
/// Tests size, time, and other semantic unit types

import test.unit.*
import std.spec
import std.units.size.*
import std.units.time.*

describe "Size Units":
    context "byte counts":
        it "creates ByteCount from integer":
            let b = 1024
            expect b == 1024

        it "ByteCount zero value":
            let zero = 0
            expect zero == 0

        it "ByteCount comparisons":
            expect 1024 > 512
            expect 512 < 1024
            expect 1024 == 1024

    context "binary unit conversions":
        it "converts bytes to kibibytes":
            let bytes = 1024
            expect bytes > 0

        it "converts bytes to mebibytes":
            let bytes = 1048576
            expect bytes > 1024

        it "converts bytes to gibibytes":
            let bytes = 1073741824
            expect bytes > 1048576

        it "ByteCount arithmetic":
            let a = 1024
            let b = 512
            expect (a + b) == 1536
            expect (a - b) == 512

    context "decimal unit conversions":
        it "converts bytes to kilobytes":
            let bytes = 1000
            expect bytes > 0

        it "converts bytes to megabytes":
            let bytes = 1000000
            expect bytes > 1000

        it "converts bytes to gigabytes":
            let bytes = 1000000000
            expect bytes > 1000000

    context "unit comparisons":
        it "compares different sizes":
            let small = 100
            let large = 1000
            expect large > small

        it "size arithmetic operations":
            let a = 500
            let b = 200
            expect (a + b) == 700
            expect (a - b) == 300

    context "size constants":
        it "uses kibi constant":
            # 1 KiB = 1024 bytes
            expect 1024 > 0

        it "uses mebi constant":
            # 1 MiB = 1048576 bytes
            expect 1048576 > 1024

        it "uses gibi constant":
            # 1 GiB
            expect 1073741824 > 1048576

describe "Time Units":
    context "nanoseconds":
        it "creates nanosecond duration":
            let ns = 1000
            expect ns == 1000

        it "zero duration":
            let zero = 0
            expect zero == 0

    context "time unit conversions":
        it "converts nanoseconds to microseconds":
            let ns = 1000
            expect ns > 0

        it "converts nanoseconds to milliseconds":
            let ns = 1000000
            expect ns > 1000

        it "converts nanoseconds to seconds":
            let ns = 1000000000
            expect ns > 1000000

        it "converts to minutes":
            let ns = 60000000000
            expect ns > 1000000

        it "converts to hours":
            let ns = 3600000000000
            expect ns > 60000000000

        it "converts to days":
            let ns = 86400000000000
            expect ns > 3600000000000

    context "duration arithmetic":
        it "adds durations":
            let a = 1000000000
            let b = 2000000000
            expect (a + b) == 3000000000

        it "subtracts durations":
            let a = 3000000000
            let b = 1000000000
            expect (a - b) == 2000000000

        it "multiplies duration":
            let dur = 1000000000
            let n = 2
            expect (dur * n) == 2000000000

    context "time duration constants":
        it "uses millisecond constant":
            let ms = 1000000
            expect ms > 0

        it "uses second constant":
            let s = 1000000000
            expect s > 1000000

        it "uses minute constant":
            let m = 60000000000
            expect m > 1000000000

        it "uses hour constant":
            let h = 3600000000000
            expect h > 60000000000

        it "uses day constant":
            let d = 86400000000000
            expect d > 3600000000000

    context "duration comparisons":
        it "compares time durations":
            let fast = 1000
            let slow = 2000
            expect slow > fast

        it "equality of durations":
            let a = 1000000000
            let b = 1000000000
            expect a == b

        it "less than comparisons":
            let a = 1000000000
            let b = 2000000000
            expect a < b

    context "float duration conversions":
        it "converts to seconds with precision":
            let ns = 1500000000
            # 1.5 seconds in nanoseconds
            expect ns > 1000000000

        it "converts to milliseconds with precision":
            let ns = 1500000
            # 1.5 milliseconds in nanoseconds
            expect ns > 1000000

describe "Combined Unit Operations":
    context "mixed operations":
        it "size and time are independent units":
            let bytes = 1024
            let nanos = 1000000000
            expect bytes < nanos

        it "arithmetic with same unit types":
            let bytes1 = 2000
            let bytes2 = 1000
            let total = bytes1 + bytes2
            expect total == 3000

        it "time arithmetic operations":
            let start = 1000000000
            let end = 2000000000
            let elapsed = end - start
            expect elapsed == 1000000000

    context "unit identity":
        it "units preserve type safety":
            let size = 1024
            let time = 1000000
            expect size > 0
            expect time > 0

        it "multiple unit values":
            let b = 2048
            let t = 2000000000
            expect (b + 1024) == 3072
            expect (t + 1000000000) == 3000000000

describe "Edge Cases and Boundaries":
    context "zero values":
        it "handles zero size":
            let zero = 0
            expect zero == 0
            expect zero < 1

        it "handles zero duration":
            let zero = 0
            expect zero == 0
            expect zero < 1

    context "large values":
        it "handles large byte counts":
            let large = 1099511627776
            expect large > 0
            expect large > 1000000000

        it "handles large durations":
            let large = 86400000000000
            expect large > 0
            expect large > 1000000000

    context "unit overflow handling":
        it "arithmetic results are valid":
            let a = 999999999
            let b = 1
            let res_val = a + b
            expect result == 1000000000

        it "subtraction boundaries":
            let a = 1000
            let b = 1000
            let res_val = a - b
            expect result == 0
