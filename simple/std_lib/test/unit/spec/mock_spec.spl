# Mock Library Tests
# Tests for MOCK-001 through MOCK-012

describe "Mock Library":
    describe "MOCK-001: mock creation":
        it "creates a mock for a type":
            let m = mock("Service")
            expect m != nil

        it "allows type name as argument":
            let calc = mock("Calculator")
            expect calc != nil

    describe "MOCK-002: spy creation":
        it "creates a spy object":
            let s = spy("Service")
            expect s != nil

    describe "MOCK-003: when configuration":
        it "configures method with symbol":
            let m = mock("Service")
            m.when(:getData)
            expect m != nil

        it "supports chained configuration":
            let m = mock("Service")
            m.when(:getData).returns(42)
            expect m != nil

    describe "MOCK-005: returns value":
        it "returns configured value":
            let m = mock("Calculator")
            m.when(:add).returns(100)
            expect m.add(1, 2) == 100

        it "returns different values for different methods":
            let m = mock("Service")
            m.when(:getA).returns("valueA")
            m.when(:getB).returns("valueB")
            expect m.getA() == "valueA"
            expect m.getB() == "valueB"

    describe "MOCK-006: returnsOnce":
        it "returns value only for first call":
            let m = mock("Service")
            m.when(:getValue).returns_once(1)
            m.when(:getValue).returns_once(2)
            m.when(:getValue).returns(0)
            expect m.getValue() == 1
            expect m.getValue() == 2
            expect m.getValue() == 0
            expect m.getValue() == 0

    describe "MOCK-007: verify":
        it "verifies method was called":
            let m = mock("Service")
            m.when(:process).returns(true)
            m.process()
            expect m.verify(:process).called() == true

        it "verifies method was not called":
            let m = mock("Service")
            m.when(:process).returns(true)
            expect m.verify(:process).called() == false

    describe "MOCK-008: calledTimes":
        it "counts exactly N calls":
            let m = mock("Service")
            m.when(:action).returns(nil)
            m.action()
            m.action()
            m.action()
            expect m.verify(:action).calledTimes(3) == true
            expect m.verify(:action).calledTimes(2) == false

    describe "MOCK-009: calledWith arguments":
        it "verifies specific argument":
            let m = mock("Calculator")
            m.when(:square).returns(25)
            m.square(5)
            expect m.verify(:square).calledWith(5) == true
            expect m.verify(:square).calledWith(10) == false

    describe "MOCK-010: reset":
        it "clears call history":
            let m = mock("Service")
            m.when(:action).returns(nil)
            m.action()
            m.action()
            expect m.verify(:action).calledTimes(2) == true
            m.reset()
            expect m.verify(:action).called() == false

    describe "MOCK-011: getCalls":
        it "returns all calls to a method":
            let m = mock("Service")
            m.when(:log).returns(nil)
            m.log("first")
            m.log("second")
            let calls = m.getCalls(:log)
            expect len(calls) == 2

    describe "Argument Matchers":
        it "any() matches any value":
            let m = mock("Service")
            m.when(:process).withArgs(any()).returns(true)
            expect m.process(42) == true
            expect m.process("hello") == true

        it "gt() matches greater than":
            let m = mock("Service")
            m.when(:check).withArgs(gt(10)).returns(true)
            m.when(:check).returns(false)
            expect m.check(15) == true
            expect m.check(5) == false

        it "lt() matches less than":
            let m = mock("Service")
            m.when(:check).withArgs(lt(10)).returns(true)
            m.when(:check).returns(false)
            expect m.check(5) == true
            expect m.check(15) == false

        it "gte() matches greater or equal":
            let m = mock("Service")
            m.when(:check).withArgs(gte(10)).returns(true)
            m.when(:check).returns(false)
            expect m.check(10) == true
            expect m.check(11) == true
            expect m.check(9) == false

        it "lte() matches less or equal":
            let m = mock("Service")
            m.when(:check).withArgs(lte(10)).returns(true)
            m.when(:check).returns(false)
            expect m.check(10) == true
            expect m.check(9) == true
            expect m.check(11) == false

        it "contains() matches substring":
            let m = mock("Service")
            m.when(:process).withArgs(contains("hello")).returns(true)
            m.when(:process).returns(false)
            expect m.process("say hello world") == true
            expect m.process("goodbye") == false

        it "starts_with() matches prefix":
            let m = mock("Service")
            m.when(:check).withArgs(starts_with("http")).returns(true)
            m.when(:check).returns(false)
            expect m.check("https://example.com") == true
            expect m.check("ftp://example.com") == false

        it "ends_with() matches suffix":
            let m = mock("Service")
            m.when(:check).withArgs(ends_with(".txt")).returns(true)
            m.when(:check).returns(false)
            expect m.check("file.txt") == true
            expect m.check("file.pdf") == false

        it "of_type() matches by type":
            let m = mock("Service")
            m.when(:process).withArgs(of_type("Int")).returns("integer")
            m.when(:process).withArgs(of_type("String")).returns("string")
            m.when(:process).returns("unknown")
            expect m.process(42) == "integer"
            expect m.process("hello") == "string"

main = 0
