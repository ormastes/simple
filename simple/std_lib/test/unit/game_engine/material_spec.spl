/// Material Abstraction Tests
/// Tests for the cross-engine material system

import std.spec
import game_engine.material
import sys.ffi

describe "MaterialParameter":
    it "creates Float parameter":
        let param = MaterialParameter::Float(0.5)
        match param:
            MaterialParameter::Float(value) =>
                expect value == 0.5

    it "creates Vec3 parameter":
        let param = MaterialParameter::Vec3(1.0, 0.5, 0.0)
        match param:
            MaterialParameter::Vec3(x, y, z) =>
                expect x == 1.0
                expect y == 0.5
                expect z == 0.0

    it "creates Color parameter":
        let param = MaterialParameter::Color(1.0, 0.0, 0.0, 1.0)
        match param:
            MaterialParameter::Color(r, g, b, a) =>
                expect r == 1.0
                expect g == 0.0
                expect b == 0.0
                expect a == 1.0

    it "creates Texture parameter":
        let null_ptr: ffi.VoidPtr = 0 as ffi.VoidPtr
        let param = MaterialParameter::Texture(null_ptr)
        expect param is MaterialParameter::Texture

describe "PBR Material Properties":
    it "validates albedo color range":
        let (r, g, b, a) = (0.5, 0.5, 0.5, 1.0)
        expect r >= 0.0 and r <= 1.0
        expect g >= 0.0 and g <= 1.0
        expect b >= 0.0 and b <= 1.0
        expect a >= 0.0 and a <= 1.0

    it "validates roughness range":
        let valid_roughness = 0.5
        expect valid_roughness >= 0.0
        expect valid_roughness <= 1.0

    it "validates metallic range":
        let valid_metallic = 0.8
        expect valid_metallic >= 0.0
        expect valid_metallic <= 1.0

    it "validates emission intensity":
        let valid_emission = 2.0
        expect valid_emission >= 0.0

describe "Material Rendering State":
    it "creates opaque blend mode":
        let mode = BlendMode::Opaque
        expect mode is BlendMode::Opaque

    it "creates transparent blend mode":
        let mode = BlendMode::Transparent
        expect mode is BlendMode::Transparent

    it "creates additive blend mode":
        let mode = BlendMode::Additive
        expect mode is BlendMode::Additive

    it "creates multiply blend mode":
        let mode = BlendMode::Multiply
        expect mode is BlendMode::Multiply

describe "Cull Mode":
    it "creates back cull mode":
        let mode = CullMode::Back
        expect mode is CullMode::Back

    it "creates front cull mode":
        let mode = CullMode::Front
        expect mode is CullMode::Front

    it "creates none cull mode":
        let mode = CullMode::None
        expect mode is CullMode::None

describe "Depth Test":
    it "creates less depth test":
        let test = DepthTest::Less
        expect test is DepthTest::Less

    it "creates less or equal depth test":
        let test = DepthTest::LessOrEqual
        expect test is DepthTest::LessOrEqual

    it "creates greater depth test":
        let test = DepthTest::Greater
        expect test is DepthTest::Greater

    it "creates always depth test":
        let test = DepthTest::Always
        expect test is DepthTest::Always

    it "creates never depth test":
        let test = DepthTest::Never
        expect test is DepthTest::Never

describe "Material Parameter Conversion":
    it "converts float to parameter":
        let param = MaterialParameter::Float(0.75)
        match param:
            MaterialParameter::Float(value) =>
                expect value == 0.75

    it "converts vector to parameter":
        let param = MaterialParameter::Vec3(0.5, 0.5, 0.5)
        match param:
            MaterialParameter::Vec3(x, y, z) =>
                expect x == 0.5
                expect y == 0.5
                expect z == 0.5

    it "converts color to parameter":
        let red = MaterialParameter::Color(1.0, 0.0, 0.0, 1.0)
        match red:
            MaterialParameter::Color(r, g, b, a) =>
                expect r == 1.0
                expect a == 1.0
