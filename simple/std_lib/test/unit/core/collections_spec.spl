/// Comprehensive tests for stdlib collections
/// Tests Option, Result, Array, List, and Dictionary operations

import test.unit.*
import std.spec

describe "Option Type":
    context "creation and checks":
        it "creates Some value":
            let opt = Some(42)
            expect opt.is_some == true

        it "creates None value":
            let opt: Option[Int] = None
            expect opt.is_none == true

        it "is_some returns true for Some":
            let opt = Some(10)
            expect opt.is_some to eq true

        it "is_none returns true for None":
            let opt: Option[Int] = None
            expect opt.is_none == true

    context "unwrap operations":
        it "unwrap extracts Some value":
            let opt = Some(42)
            expect opt.unwrap() == 42

        it "expect returns value with message":
            let opt = Some(99)
            expect opt.expect("Should have value") == 99

        it "unwrap_or returns default for None":
            let opt: Option[Int] = None
            expect opt.unwrap_or(0) == 0

        it "unwrap_or returns Some value":
            let opt = Some(5)
            expect opt.unwrap_or(0) == 5

    context "or and conversion":
        it "or returns self if Some":
            let opt1 = Some(1)
            let opt2 = Some(2)
            expect opt1.or(opt2).unwrap() == 1

        it "or returns other if None":
            let opt1: Option[Int] = None
            let opt2 = Some(2)
            expect opt1.or(opt2).unwrap() == 2

        it "ok_or converts Some to Ok":
            let opt = Some(42)
            let res_obj = opt.ok_or("error")
            expect res_obj.is_ok == true

        it "ok_or converts None to Err":
            let opt: Option[Int] = None
            let res_obj = opt.ok_or("error")
            expect res_obj.is_err == true

describe "Result Type":
    context "creation and checks":
        it "creates Ok value":
            let res_obj = Ok(42)
            expect res_obj.is_ok == true

        it "creates Err value":
            let res_obj: Result[Int, String] = Err("error")
            expect res_obj.is_err == true

        it "is_ok returns true for Ok":
            let res_obj = Ok(10)
            expect res_obj.is_ok to eq true

        it "is_err returns true for Err":
            let res_obj: Result[Int, String] = Err("error")
            expect res_obj.is_err to eq true

    context "unwrap operations":
        it "unwrap extracts Ok value":
            let res_obj = Ok(42)
            expect res_obj.unwrap() == 42

        it "unwrap_err extracts Err value":
            let res_obj: Result[Int, String] = Err("failure")
            expect res_obj.unwrap_err() == "failure"

        it "unwrap_or returns default for Err":
            let res_obj: Result[Int, String] = Err("error")
            expect res_obj.unwrap_or(0) == 0

        it "unwrap_or returns Ok value":
            let res_obj = Ok(5)
            expect res_obj.unwrap_or(0) == 5

        it "expect returns value with message":
            let res_obj = Ok(99)
            expect res_obj.expect("Should succeed") == 99

    context "or operations":
        it "or returns self if Ok":
            let res1 = Ok(1)
            let res2: Result[Int, String] = Err("error2")
            expect res1.or(res2).unwrap() == 1

        it "or returns other if Err":
            let res1: Result[Int, String] = Err("error1")
            let res2 = Ok(2)
            expect res1.or(res2).unwrap() == 2

    context "conversion operations":
        it "ok converts Ok to Some":
            let res_obj = Ok(42)
            let opt = res_obj.ok()
            expect opt.is_some == true
            expect opt.unwrap() == 42

        it "ok converts Err to None":
            let res_obj: Result[Int, String] = Err("error")
            let opt = res_obj.ok()
            expect opt.is_none == true

        it "err converts Err to Some":
            let res_obj: Result[Int, String] = Err("error")
            let opt = res_obj.err()
            expect opt.is_some == true
            expect opt.unwrap() == "error"

        it "err converts Ok to None":
            let res_obj = Ok(42)
            let opt = res_obj.err()
            expect opt.is_none == true

describe "Array Type":
    context "creation and access":
        it "creates array with literals":
            let arr = [1, 2, 3, 4, 5]
            expect arr.len to eq 5

        it "accesses elements by index":
            let arr = [10, 20, 30]
            expect arr[0] == 10
            expect arr[1] == 20
            expect arr[2] == 30

        it "creates empty array":
            let empty: [Int] = []
            expect empty.len == 0

    context "array methods":
        it "push adds element":
            let arr = [1, 2]
            arr.push(3)
            expect arr.len == 3
            expect arr[2] == 3

        it "pop removes last element":
            let arr = [1, 2, 3]
            let item = arr.pop()
            expect item == 3
            expect arr.len == 2

        it "contains checks for element":
            let arr = [1, 2, 3]
            expect arr.contains(2) to eq true
            expect arr.contains(5) to eq false

        it "is_empty checks length":
            let empty: [Int] = []
            expect empty.is_empty to eq true
            let full = [1]
            expect full.is_empty to eq false

describe "List Type":
    context "creation and operations":
        it "creates empty list":
            let list: List[Int] = List.new()
            expect list.is_empty to eq true

        it "append adds elements":
            let list = List.new()
            list.append(1)
            list.append(2)
            expect list.len to eq 2

        it "length tracking":
            let list = List.new()
            expect list.len == 0
            list.append(1)
            expect list.len == 1

        it "access elements":
            let list = List.new()
            list.append(10)
            list.append(20)
            expect list[0] == 10
            expect list[1] == 20

    context "list methods":
        it "contains checks membership":
            let list = List.new()
            list.append(1)
            list.append(2)
            list.append(3)
            expect list.contains(2) to eq true
            expect list.contains(5) to eq false

        it "is_empty returns correct status":
            let list = List.new()
            expect list.is_empty to eq true
            list.append(1)
            expect list.is_empty to eq false

describe "Dictionary (Dict) Type":
    context "creation and operations":
        it "creates empty dict":
            let dict: Dict[String, Int] = {}
            expect dict.is_empty to eq true

        it "inserts and retrieves values":
            let dict: Dict[String, Int] = {}
            dict["key1"] = 10
            expect dict["key1"] == 10

        it "checks for key existence":
            let dict: Dict[String, Int] = {}
            dict["exists"] = 1
            expect dict.contains("exists") to eq true
            expect dict.contains("missing") to eq false

        it "counts items":
            let dict: Dict[String, Int] = {}
            dict["a"] = 1
            dict["b"] = 2
            expect dict.len to eq 2

    context "dict methods":
        it "keys returns all keys":
            let dict: Dict[String, Int] = {}
            dict["x"] = 1
            dict["y"] = 2
            let keys = dict.keys()
            expect keys.len to eq 2

        it "values returns all values":
            let dict: Dict[String, Int] = {}
            dict["a"] = 10
            dict["b"] = 20
            let values = dict.values()
            expect values.len to eq 2

        it "remove deletes entries":
            let dict: Dict[String, Int] = {}
            dict["key"] = 1
            expect dict.len == 1
            dict.remove("key")
            expect dict.len == 0

        it "clear removes all entries":
            let dict: Dict[String, Int] = {}
            dict["a"] = 1
            dict["b"] = 2
            dict.clear()
            expect dict.is_empty to eq true
