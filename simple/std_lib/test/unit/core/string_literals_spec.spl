/// BDD tests for all string literal syntax variants
/// Tests: "...", '...', """...""", r"...", r"""...""", f"...", f"""..."""

import std.spec

describe "String Literal Syntax":
    context "double-quoted strings (interpolated by default)":
        it "creates simple string":
            let s = "hello"
            expect s == "hello"

        it "supports escape sequences":
            let s = "hello\nworld"
            expect s.contains("\n") == true

        it 'supports interpolation with {expr}':
            let name = "World"
            let greeting = "Hello, {name}!"
            expect greeting == "Hello, World!"

        it "supports expression interpolation":
            let result = "Sum: {1 + 2}"
            expect result == "Sum: 3"

        it "escapes braces with double braces":
            let json = "{{key}}"
            expect json == '{key}'  # Raw string for comparison

    context "single-quoted strings (raw)":
        it "creates raw string":
            let s = 'hello'
            expect s == "hello"

        it "preserves backslashes literally":
            let s = 'hello\nworld'
            expect s.contains("\\n") == true

        it "preserves braces literally":
            let s = '{name}'
            expect s == '{name}'  # Raw string preserves {name} literally

        it "is useful for regex patterns":
            let pattern = '\d+\.\d+'
            expect pattern.contains("\\d") == true

    context "triple-quoted strings (docstrings)":
        it "creates multi-line string":
            let s = """line1
line2"""
            expect s.contains("\n") == true

        it "preserves braces literally":
            let s = """{name}"""
            expect s == '{name}'  # Raw string for comparison

        it "allows embedded double quotes":
            let s = """He said "hello" """
            expect s.contains("\"") == true

    context "raw double-quoted strings (r prefix)":
        it "creates raw string with double quotes":
            let s = r"hello"
            expect s == "hello"

        it "preserves backslashes":
            let s = r"C:\Users\name"
            expect s.contains("\\") == true

        it "preserves braces":
            let s = r"{name}"
            expect s == '{name}'  # Raw string for comparison

        it "is useful for Windows paths":
            let path = r"C:\Program Files\App"
            expect path.starts_with("C:") == true

    context "raw triple-quoted strings (r prefix)":
        it "creates multi-line raw string":
            let s = r"""line1
line2"""
            expect s.contains("\n") == true

        it "preserves backslashes in multi-line":
            let s = r"""path\to
file"""
            expect s.contains("\\") == true

    context "explicit f-string prefix (redundant but valid)":
        it "works same as regular double-quoted":
            let name = "World"
            let s = f"Hello, {name}!"
            expect s == "Hello, World!"

        it "supports expressions":
            let s = f"Result: {2 * 3}"
            expect s == "Result: 6"

    context "triple-quoted f-strings (f prefix)":
        it "creates multi-line interpolated string":
            let name = "World"
            let s = f"""Hello, {name}!
Welcome!"""
            expect s.contains("Hello, World!") == true
            expect s.contains("\n") == true

        it "supports expressions in multi-line":
            let s = f"""Sum: {1 + 2}
Product: {2 * 3}"""
            expect s.contains("Sum: 3") == true
            expect s.contains("Product: 6") == true

        it "allows embedded double quotes":
            let name = "test"
            let s = f"""He said "{name}" """
            expect s.contains("\"test\"") == true

        it "escapes braces with double braces":
            let value = 42
            let json = f"""{{"key": {value}}}"""
            expect json.contains('{') == true  # Use raw string to check for literal {
            expect json.contains("42") == true

    context "string type compatibility":
        it "all string types are compatible":
            let a = "hello"
            let b = 'hello'
            let c = """hello"""
            let d = r"hello"
            expect a == b
            expect b == c
            expect c == d
