# BDD Tests for Math Module
# Feature #220-229: Math and Numeric features

# Direct imports (module alias doesn't work for property access)
use core.math.PI
use core.math.E
use core.math.TAU
use core.math.INF
use core.math.NAN
use core.math.abs
use core.math.abs_int
use core.math.sign
use core.math.floor
use core.math.ceil
use core.math.round
use core.math.sqrt
use core.math.exp
use core.math.sin
use core.math.cos
use core.math.tan
use core.math.min
use core.math.max
use core.math.min_int
use core.math.max_int
use core.math.clamp
use core.math.clamp_int
use core.math.radians
use core.math.degrees
use core.math.factorial
use core.math.gcd
use core.math.lcm
use core.math.isclose
use core.math.isnan
use core.math.isinf
use core.math.isfinite

describe "Math module":
    describe "Constants":
        it "should provide PI constant":
            expect abs(PI - 3.14159) < 0.0001

        it "should provide E constant":
            expect abs(E - 2.71828) < 0.0001

        it "should provide TAU constant":
            expect abs(TAU - 6.28318) < 0.0001

    describe "Basic operations":
        it "should calculate absolute value":
            expect abs(-5.5) == 5.5
            expect abs(5.5) == 5.5
            expect abs(0.0) == 0.0

        it "should calculate integer absolute value":
            expect abs_int(-42) == 42
            expect abs_int(42) == 42

        it "should calculate sign":
            expect sign(5.5) == 1.0
            expect sign(-5.5) == -1.0
            expect sign(0.0) == 0.0

        it "should floor numbers":
            expect floor(3.7) == 3
            expect floor(3.2) == 3
            expect floor(-3.7) == -4

        it "should ceil numbers":
            expect ceil(3.2) == 4
            expect ceil(3.7) == 4
            expect ceil(-3.2) == -3

        it "should round numbers":
            expect round(3.4) == 3
            expect round(3.5) == 4
            expect round(3.6) == 4

    describe "Square root":
        it "should calculate square root":
            let result = sqrt(4.0)
            expect abs(result - 2.0) < 0.0001

        it "should calculate square root of 9":
            let result = sqrt(9.0)
            expect abs(result - 3.0) < 0.0001

        it "should calculate square root of 2":
            let result = sqrt(2.0)
            expect abs(result - 1.41421) < 0.0001

        it "should return NaN for negative numbers":
            let result = sqrt(-1.0)
            expect isnan(result)

    describe "Exponential":
        it "should calculate e^0":
            let result = exp(0.0)
            expect abs(result - 1.0) < 0.0001

        it "should calculate e^1":
            let result = exp(1.0)
            expect abs(result - 2.71828) < 0.001

        it "should calculate e^2":
            let result = exp(2.0)
            expect abs(result - 7.38906) < 0.01

    describe "Trigonometry":
        it "should calculate sin(0)":
            let result = sin(0.0)
            expect abs(result - 0.0) < 0.0001

        it "should calculate sin(PI/2)":
            let result = sin(PI / 2.0)
            expect abs(result - 1.0) < 0.001

        it "should calculate sin(PI)":
            let result = sin(PI)
            expect abs(result - 0.0) < 0.001

        it "should calculate cos(0)":
            let result = cos(0.0)
            expect abs(result - 1.0) < 0.001

        it "should calculate cos(PI/2)":
            let result = cos(PI / 2.0)
            expect abs(result - 0.0) < 0.001

        it "should calculate cos(PI)":
            let result = cos(PI)
            expect abs(result - -1.0) < 0.001

        it "should calculate tan":
            let result = tan(PI / 4.0)
            expect abs(result - 1.0) < 0.01

    describe "Min/Max":
        it "should find minimum of two floats":
            expect min(3.5, 7.2) == 3.5
            expect min(7.2, 3.5) == 3.5

        it "should find maximum of two floats":
            expect max(3.5, 7.2) == 7.2
            expect max(7.2, 3.5) == 7.2

        it "should find minimum of two integers":
            expect min_int(3, 7) == 3
            expect min_int(7, 3) == 3

        it "should find maximum of two integers":
            expect max_int(3, 7) == 7
            expect max_int(7, 3) == 7

    describe "Clamp":
        it "should clamp values within range":
            expect clamp(5.0, 0.0, 10.0) == 5.0
            expect clamp(-5.0, 0.0, 10.0) == 0.0
            expect clamp(15.0, 0.0, 10.0) == 10.0

        it "should clamp integer values":
            expect clamp_int(5, 0, 10) == 5
            expect clamp_int(-5, 0, 10) == 0
            expect clamp_int(15, 0, 10) == 10

    describe "Degree/Radian conversion":
        it "should convert degrees to radians":
            let rad = radians(180.0)
            expect abs(rad - PI) < 0.0001

        it "should convert radians to degrees":
            let deg = degrees(PI)
            expect abs(deg - 180.0) < 0.0001

    describe "Integer operations":
        it "should calculate factorial":
            expect factorial(0) == 1
            expect factorial(1) == 1
            expect factorial(5) == 120
            expect factorial(6) == 720

        it "should calculate GCD":
            expect gcd(48, 18) == 6
            expect gcd(100, 50) == 50
            expect gcd(17, 19) == 1

        it "should calculate LCM":
            expect lcm(4, 6) == 12
            expect lcm(21, 6) == 42

    describe "Floating-point utilities":
        it "should check if numbers are close":
            expect isclose(1.0, 1.0000001)
            expect not isclose(1.0, 1.1)

        it "should detect NaN":
            expect isnan(NAN)
            expect not isnan(1.0)

        it "should detect infinity":
            expect isinf(INF)
            expect not isinf(1.0)

        it "should detect finite numbers":
            expect isfinite(1.0)
            expect not isfinite(INF)
            expect not isfinite(NAN)
