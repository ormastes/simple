# Manual mode tests - must set mode before any futures are created
# This file tests the embedded/manual execution mode for futures

# Set manual mode at module level before any futures
async_mode("manual")

describe "Manual Mode Execution":
    it "is in manual mode":
        let mode = async_mode()
        expect mode == "manual"

    it "futures are pending until polled":
        let f = future(42)
        # In manual mode, future doesn't execute until polled
        let completed = poll_future(f)
        expect completed
        expect await f == 42

    it "polling multiple futures individually":
        let f1 = future(10)
        let f2 = future(20)
        # Poll each future
        poll_future(f1)
        poll_future(f2)
        expect await f1 == 10
        expect await f2 == 20

    it "await auto-polls in manual mode":
        let f = future(100)
        # await should auto-poll if needed
        expect await f == 100

    it "resolved futures work in manual mode":
        let f = resolved(42)
        expect is_ready(f)
        expect await f == 42

    it "futures with captures in manual mode":
        let base = 40
        let f = future(base + 2)
        poll_future(f)
        expect await f == 42

    it "computation in manual mode":
        let f = future(10 + 20 + 30)
        poll_future(f)
        expect await f == 60

    it "multiple captures in manual mode":
        let a = 10
        let b = 20
        let c = 12
        let f = future(a + b + c)
        poll_future(f)
        expect await f == 42
