# Unit tests for miscellaneous command handling

describe "misc_commands module compilation":
    it "compiles successfully":
        expect 1 + 1 == 2

describe "help flag detection":
    it "detects -h flag":
        val args = ["simple", "diagram", "-h"]
        val has_help = args.any(\a: a == "-h" or a == "--help")
        expect has_help == true

    it "detects --help flag":
        val args = ["simple", "diagram", "--help"]
        val has_help = args.any(\a: a == "-h" or a == "--help")
        expect has_help == true

    it "no help when absent":
        val args = ["simple", "diagram", "file.json"]
        val has_help = args.any(\a: a == "-h" or a == "--help")
        expect has_help == false

describe "lock command flags":
    it "detects --check flag":
        val args = ["simple", "lock", "--check"]
        val check_only = args.any(\a: a == "--check")
        expect check_only == true

    it "detects --info flag":
        val args = ["simple", "lock", "--info"]
        val info_only = args.any(\a: a == "--info")
        expect info_only == true

    it "no flags when absent":
        val args = ["simple", "lock"]
        val check_only = args.any(\a: a == "--check")
        val info_only = args.any(\a: a == "--info")
        expect check_only == false
        expect info_only == false

describe "argument length validation":
    it "run requires 2 args minimum":
        val args = ["simple", "run", "script.spl"]
        expect args.len() >= 2 == true

    it "run fails with insufficient args":
        val args = ["simple"]
        expect args.len() < 2 == true

describe "list slicing":
    it "slices from index to end":
        val args = ["simple", "diagram", "-f", "file.json"]
        val diagram_args = args.slice(1, args.len())
        expect diagram_args.len() == 3

    it "empty slice when start equals end":
        val args = ["simple"]
        val diagram_args = args.slice(1, args.len())
        expect diagram_args.len() == 0

describe "Option handling":
    it "Some wraps value":
        val opt = Some("file.json")
        expect opt.is_some() == true

    it "unwrap gets value":
        val opt = Some("file.json")
        val value = opt.unwrap()
        expect value == "file.json"

describe "conditional branches":
    it "info_only takes precedence":
        val info_only = true
        val check_only = true
        val branch = if info_only: "info" elif check_only: "check" else: "generate"
        expect branch == "info"

    it "check_only when not info":
        val info_only = false
        val check_only = true
        val branch = if info_only: "info" elif check_only: "check" else: "generate"
        expect branch == "check"

    it "default when no flags":
        val info_only = false
        val check_only = false
        val branch = if info_only: "info" elif check_only: "check" else: "generate"
        expect branch == "generate"

describe "Result patterns":
    it "Ok unwraps value":
        expect Ok(42).is_ok() == true

    it "Err contains error":
        expect Err("error").is_err() == true

describe "nested match patterns":
    it "outer match selects Some":
        val outer = Some("value")
        val selected = match outer:
            Some(v) => "has value"
            None => "no value"
        expect selected == "has value"

    it "checks None option":
        val none_outer: Option<text> = None
        expect none_outer.is_none() == true

describe "list length checks":
    it "detects non-empty patterns":
        val patterns = ["*.spl", "*.txt"]
        expect patterns.len() > 0 == true

    it "list comparison works":
        val test_list = ["a", "b"]
        expect test_list.len() == 2

describe "string formatting":
    it "interpolates variable":
        val name = "test"
        val events_count = 5
        val msg = "Loaded profile: {name} ({events_count} events)"
        expect msg.contains("test") == true
        expect msg.contains("5") == true

    it "interpolates path":
        val path = "output/diagram.puml"
        val msg = "  Sequence diagram: {path}"
        expect msg.contains("output/diagram.puml") == true

describe "exit code conventions":
    it "success returns 0":
        expect 0 == 0

    it "error returns 1":
        expect 1 == 1

describe "boolean parameters":
    it "both gc flags false":
        val gc_log = false
        val gc_off = false
        expect gc_log == false
        expect gc_off == false

    it "gc_log true":
        val gc_log = true
        val gc_off = false
        expect gc_log == true

    it "gc_off true":
        val gc_log = false
        val gc_off = true
        expect gc_off == true

describe "early return pattern":
    it "validates condition for early return":
        val args_len = 1
        val should_return = args_len < 2
        expect should_return == true

    it "continues when condition false":
        val args_len = 3
        val should_return = args_len < 2
        expect should_return == false
