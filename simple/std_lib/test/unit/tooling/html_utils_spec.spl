# Tests for HTML utilities

use tooling.html_utils.*

# =====================================
# HTML Escaping Tests
# =====================================

fn test_escape_html_ampersand():
    assert(escape_html("A & B") == "A &amp; B")

fn test_escape_html_less_than():
    assert(escape_html("A < B") == "A &lt; B")

fn test_escape_html_greater_than():
    assert(escape_html("A > B") == "A &gt; B")

fn test_escape_html_quote():
    assert(escape_html("Say \"hello\"") == "Say &quot;hello&quot;")

fn test_unescape_html():
    assert(unescape_html("A &amp; B") == "A & B")
    assert(unescape_html("A &lt; B") == "A < B")

# =====================================
# Basic HTML Elements Tests
# =====================================

fn test_tag_simple():
    val result = tag("p", "Hello")
    assert(result == "<p>Hello</p>")

fn test_self_closing_tag():
    val result = self_closing_tag("br")
    assert(result == "<br />")

fn test_tag_with_attrs():
    val result = tag_with_attrs("a", [("href", "/home")], "Home")
    assert(result.contains("href=\"/home\""))
    assert(result.contains(">Home</a>"))

# =====================================
# Document Structure Tests
# =====================================

fn test_html_document():
    val result = html_document("<title>Test</title>", "<p>Content</p>")
    assert(result.contains("<!DOCTYPE html>"))
    assert(result.contains("<html>"))
    assert(result.contains("<head>"))

fn test_html5_document():
    val result = html5_document("en", "<title>Test</title>", "<p>Content</p>")
    assert(result.contains("lang=\"en\""))
    assert(result.contains("<!DOCTYPE html>"))

fn test_doctype_html5():
    assert(doctype_html5() == "<!DOCTYPE html>")

# =====================================
# Head Elements Tests
# =====================================

fn test_title():
    val result = title("My Page")
    assert(result == "<title>My Page</title>")

fn test_meta():
    val result = meta("description", "Page description")
    assert(result.contains("name=\"description\""))
    assert(result.contains("content=\"Page description\""))

fn test_meta_charset():
    val result = meta_charset("UTF-8")
    assert(result.contains("charset=\"UTF-8\""))

fn test_link_stylesheet():
    val result = link_stylesheet("style.css")
    assert(result.contains("rel=\"stylesheet\""))
    assert(result.contains("href=\"style.css\""))

# =====================================
# Text Elements Tests
# =====================================

fn test_h1():
    assert(h1("Title") == "<h1>Title</h1>")

fn test_h2():
    assert(h2("Subtitle") == "<h2>Subtitle</h2>")

fn test_p():
    assert(p("Paragraph") == "<p>Paragraph</p>")

fn test_div():
    val result = div("<p>Content</p>")
    assert(result == "<div><p>Content</p></div>")

fn test_span():
    assert(span("Text") == "<span>Text</span>")

# =====================================
# Formatting Elements Tests
# =====================================

fn test_strong():
    assert(strong("Bold") == "<strong>Bold</strong>")

fn test_em():
    assert(em("Italic") == "<em>Italic</em>")

fn test_code():
    assert(code("x = 1") == "<code>x = 1</code>")

fn test_br():
    assert(br() == "<br />")

fn test_hr():
    assert(hr() == "<hr />")

# =====================================
# Link Elements Tests
# =====================================

fn test_a():
    val result = a("/page", "Click here")
    assert(result.contains("href=\"/page\""))
    assert(result.contains(">Click here</a>"))

fn test_a_external():
    val result = a_external("https://example.com", "Example")
    assert(result.contains("target=\"_blank\""))

# =====================================
# Image Elements Tests
# =====================================

fn test_img():
    val result = img("pic.jpg", "A picture")
    assert(result.contains("src=\"pic.jpg\""))
    assert(result.contains("alt=\"A picture\""))

# =====================================
# List Elements Tests
# =====================================

fn test_ul():
    val result = ul(["Item 1", "Item 2", "Item 3"])
    assert(result.contains("<ul>"))
    assert(result.contains("<li>Item 1</li>"))
    assert(result.contains("</ul>"))

fn test_ol():
    val result = ol(["First", "Second", "Third"])
    assert(result.contains("<ol>"))
    assert(result.contains("<li>First</li>"))
    assert(result.contains("</ol>"))

fn test_li():
    assert(li("Item") == "<li>Item</li>")

# =====================================
# Table Elements Tests
# =====================================

fn test_table():
    val result = table(["Name", "Age"], [["Alice", "30"], ["Bob", "25"]])
    assert(result.contains("<table>"))
    assert(result.contains("<thead>"))
    assert(result.contains("<th>Name</th>"))
    assert(result.contains("<tbody>"))
    assert(result.contains("<td>Alice</td>"))
    assert(result.contains("</table>"))

fn test_tr():
    val result = tr(["A", "B", "C"])
    assert(result.contains("<tr>"))
    assert(result.contains("<td>A</td>"))
    assert(result.contains("</tr>"))

fn test_th():
    assert(th("Header") == "<th>Header</th>")

fn test_td():
    assert(td("Data") == "<td>Data</td>")

# =====================================
# Form Elements Tests
# =====================================

fn test_form():
    val result = form("/submit", "POST", "<input>")
    assert(result.contains("action=\"/submit\""))
    assert(result.contains("method=\"POST\""))

fn test_input_text():
    val result = input_text("email", "user@example.com")
    assert(result.contains("type=\"text\""))
    assert(result.contains("name=\"email\""))

fn test_button_submit():
    val result = button_submit("Send")
    assert(result.contains("type=\"submit\""))

# =====================================
# Semantic Elements Tests
# =====================================

fn test_header():
    val result = header("<h1>Title</h1>")
    assert(result == "<header><h1>Title</h1></header>")

fn test_footer():
    val result = footer("<p>Copyright</p>")
    assert(result == "<footer><p>Copyright</p></footer>")

fn test_nav():
    val result = nav("<ul><li>Home</li></ul>")
    assert(result == "<nav><ul><li>Home</li></ul></nav>")

fn test_main():
    val result = main("<p>Content</p>")
    assert(result == "<main><p>Content</p></main>")

# =====================================
# Builder Pattern Tests
# =====================================

fn test_html_builder_basic():
    var builder = HtmlBuilder.new()
    builder.add_heading(1, "Title")
    builder.add_paragraph("Content")

    val result = builder.build()
    assert(result.contains("<h1>Title</h1>"))
    assert(result.contains("<p>Content</p>"))

fn test_html_builder_document():
    var builder = HtmlBuilder.new()
    builder.add_heading(1, "Welcome")
    builder.add_paragraph("Hello world")

    val result = builder.build_document("My Page")
    assert(result.contains("<!DOCTYPE html>"))
    assert(result.contains("<title>My Page</title>"))
    assert(result.contains("<h1>Welcome</h1>"))

# =====================================
# Common Patterns Tests
# =====================================

fn test_simple_page():
    val result = simple_page("Test", "Welcome", "<p>Content</p>")
    assert(result.contains("<title>Test</title>"))
    assert(result.contains("<h1>Welcome</h1>"))
    assert(result.contains("<!DOCTYPE html>"))

fn test_page_with_css():
    val result = page_with_css("Styled", "style.css", "<p>Content</p>")
    assert(result.contains("<title>Styled</title>"))
    assert(result.contains("rel=\"stylesheet\""))
    assert(result.contains("href=\"style.css\""))
