# Unit tests for file walking utilities

describe "file_walker module compilation":
    it "compiles successfully":
        expect 1 + 1 == 2

describe "is_file detection":
    it "detects file with extension":
        val path = "test.spl"
        val has_ext = path.contains(".")
        expect has_ext == true

    it "detects directory without extension":
        val path = "src"
        val has_ext = path.contains(".")
        expect has_ext == false

    it "detects file in path":
        val path = "src/test.spl"
        val has_ext = path.contains(".")
        expect has_ext == true

describe "single file handling":
    it "returns single file as list":
        val path = "test.spl"
        val is_single_file = true
        val result = if is_single_file: [path] else: []
        expect result.len() == 1

    it "returns directory walk result":
        val is_single_file = false
        val files = ["file1.spl", "file2.spl"]
        val result = if is_single_file: [] else: files
        expect result.len() == 2

describe "spec file filtering":
    it "filters _spec.spl files":
        val files = ["test_spec.spl", "example.spl", "other_spec.spl"]
        val specs = files.filter(\f: f.ends_with("_spec.spl"))
        expect specs.len() == 2

    it "no specs in list":
        val files = ["test.spl", "example.spl"]
        val specs = files.filter(\f: f.ends_with("_spec.spl"))
        expect specs.len() == 0

    it "all files are specs":
        val files = ["test_spec.spl", "example_spec.spl"]
        val specs = files.filter(\f: f.ends_with("_spec.spl"))
        expect specs.len() == 2

describe "filename extraction":
    it "extracts filename from path":
        val path = "src/test/example.spl"
        val parts = path.split("/")
        val filename = parts[parts.len() - 1]
        expect filename == "example.spl"

    it "handles filename without directory":
        val path = "example.spl"
        val parts = path.split("/")
        val filename = if parts.len() > 0: parts[parts.len() - 1] else: path
        expect filename == "example.spl"

describe "summary calculations":
    it "calculates unchanged count":
        val total = 10
        val modified = 3
        val errors = 1
        val unchanged = total - modified - errors
        expect unchanged == 6

    it "no errors":
        val total = 10
        val modified = 5
        val errors = 0
        val unchanged = total - modified - errors
        expect unchanged == 5

    it "all modified":
        val total = 5
        val modified = 5
        val errors = 0
        val unchanged = total - modified - errors
        expect unchanged == 0

describe "modified count check":
    it "has modifications":
        val modified = 3
        expect modified > 0 == true

    it "no modifications":
        val modified = 0
        expect modified > 0 == false

describe "string interpolation in summary":
    it "interpolates modified count":
        val count = 5
        val msg = "  Would modify: {count}"
        expect msg.contains("5") == true

    it "interpolates unchanged count":
        val unchanged = 3
        val msg = "  Unchanged: {unchanged}"
        expect msg.contains("3") == true

    it "interpolates errors":
        val errors = 2
        val msg = "  Errors: {errors}"
        expect msg.contains("2") == true

describe "conditional print":
    it "prints additional message when modified":
        val modified = 3
        val should_print = modified > 0
        expect should_print == true

    it "no additional message when zero":
        val modified = 0
        val should_print = modified > 0
        expect should_print == false

describe "extension check":
    it "checks .spl extension":
        val filename = "test.spl"
        expect filename.ends_with(".spl") == true

    it "rejects other extensions":
        val filename = "test.rs"
        expect filename.ends_with(".spl") == false

describe "list construction":
    it "single element list":
        val path = "test.spl"
        val list = [path]
        expect list.len() == 1

    it "empty list":
        val list = []
        expect list.len() == 0

    it "multi-element list":
        val list = ["a.spl", "b.spl", "c.spl"]
        expect list.len() == 3
