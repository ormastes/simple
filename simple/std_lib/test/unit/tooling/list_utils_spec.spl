# Tests for list utilities

use tooling.list_utils.*

# =====================================
# Basic List Operations Tests
# =====================================

fn test_reverse():
    assert(reverse([1, 2, 3, 4]) == [4, 3, 2, 1])
    assert(reverse([1]) == [1])

    val empty: List<i32> = []
    assert(reverse(empty).is_empty())

fn test_chunk():
    val chunks = chunk([1, 2, 3, 4, 5], 2)
    assert(chunks.len() == 3)
    assert(chunks[0] == [1, 2])
    assert(chunks[1] == [3, 4])
    assert(chunks[2] == [5])

fn test_chunk_exact_fit():
    val chunks = chunk([1, 2, 3, 4], 2)
    assert(chunks.len() == 2)

fn test_chunk_size_larger_than_list():
    val chunks = chunk([1, 2], 5)
    assert(chunks.len() == 1)
    assert(chunks[0] == [1, 2])

# =====================================
# Interleaving Tests
# =====================================

fn test_interleave():
    val result = interleave([1, 2, 3], [4, 5, 6])
    assert(result == [1, 4, 2, 5, 3, 6])

fn test_interleave_different_lengths():
    val result = interleave([1, 2], [3, 4, 5, 6])
    assert(result.len() == 6)
    # Should have [1, 3, 2, 4] then rest of second list

# =====================================
# Zip/Unzip Tests
# =====================================

fn test_zip():
    val pairs = zip([1, 2, 3], ["a", "b", "c"])
    assert(pairs.len() == 3)
    assert(pairs[0] == (1, "a"))
    assert(pairs[1] == (2, "b"))
    assert(pairs[2] == (3, "c"))

fn test_zip_different_lengths():
    val pairs = zip([1, 2], ["a", "b", "c"])
    assert(pairs.len() == 2)

fn test_unzip():
    val pairs = [(1, "a"), (2, "b"), (3, "c")]
    val (numbers, letters) = unzip(pairs)
    assert(numbers == [1, 2, 3])
    assert(letters == ["a", "b", "c"])

# =====================================
# Rotation Tests
# =====================================

fn test_rotate_left():
    assert(rotate_left([1, 2, 3, 4, 5], 2) == [3, 4, 5, 1, 2])
    assert(rotate_left([1, 2, 3], 0) == [1, 2, 3])

fn test_rotate_left_full_cycle():
    val list = [1, 2, 3]
    assert(rotate_left(list, 3) == list)

fn test_rotate_right():
    assert(rotate_right([1, 2, 3, 4, 5], 2) == [4, 5, 1, 2, 3])

# =====================================
# Finding Tests
# =====================================

fn test_find_index():
    match find_index([1, 2, 3, 4], \x: x == 3):
        Some(idx) =>
            assert(idx == 2)
        None =>
            assert(false)

fn test_find_index_not_found():
    match find_index([1, 2, 3], \x: x == 10):
        Some(_) =>
            assert(false)
        None =>
            assert(true)

fn test_find_element():
    match find_element([1, 2, 3, 4], \x: x > 2):
        Some(elem) =>
            assert(elem == 3)
        None =>
            assert(false)

# =====================================
# Grouping Tests
# =====================================

fn test_group():
    val groups = group([1, 2, 3, 4, 5, 6], \x: x % 2 == 0)
    assert(groups.len() == 2)
    # First group: evens [2, 4, 6]
    # Second group: odds [1, 3, 5]

# =====================================
# Windows Tests
# =====================================

fn test_windows():
    val wins = windows([1, 2, 3, 4], 2)
    assert(wins.len() == 3)
    assert(wins[0] == [1, 2])
    assert(wins[1] == [2, 3])
    assert(wins[2] == [3, 4])

fn test_windows_size_too_large():
    val wins = windows([1, 2], 5)
    assert(wins.is_empty())

# =====================================
# Deduplication Tests
# =====================================

fn test_dedup():
    assert(dedup([1, 1, 2, 2, 3, 3]) == [1, 2, 3])
    assert(dedup([1, 2, 1, 2]) == [1, 2, 1, 2])  # Only consecutive duplicates

fn test_dedup_all():
    assert(dedup_all([1, 2, 1, 3, 2]) == [1, 2, 3])

# =====================================
# Partition Tests
# =====================================

fn test_partition():
    val (evens, odds) = partition([1, 2, 3, 4, 5, 6], \x: x % 2 == 0)
    assert(evens == [2, 4, 6])
    assert(odds == [1, 3, 5])

# =====================================
# Flattening Tests
# =====================================

fn test_flatten():
    val nested = [[1, 2], [3, 4], [5]]
    assert(flatten(nested) == [1, 2, 3, 4, 5])

fn test_flatten_empty():
    val empty: List<List<i32>> = []
    assert(flatten(empty).is_empty())

# =====================================
# Mapping Tests
# =====================================

fn test_map_list():
    assert(map_list([1, 2, 3], \x: x * 2) == [2, 4, 6])

fn test_filter_list():
    assert(filter_list([1, 2, 3, 4, 5], \x: x > 2) == [3, 4, 5])

# =====================================
# Folding Tests
# =====================================

fn test_fold_left():
    val sum = fold_left([1, 2, 3, 4], 0, \acc, x: acc + x)
    assert(sum == 10)

fn test_fold_left_subtract():
    val result = fold_left([1, 2, 3], 10, \acc, x: acc - x)
    assert(result == 4)  # 10 - 1 - 2 - 3 = 4

fn test_fold_right():
    val result = fold_right([1, 2, 3], 0, \x, acc: x + acc)
    assert(result == 6)

# =====================================
# Any/All Tests
# =====================================

fn test_any():
    assert(any([1, 2, 3, 4], \x: x > 3))
    assert(not any([1, 2, 3], \x: x > 5))

fn test_all():
    assert(all([2, 4, 6], \x: x % 2 == 0))
    assert(not all([1, 2, 3], \x: x % 2 == 0))

# =====================================
# Slicing Tests
# =====================================

fn test_take():
    assert(take([1, 2, 3, 4, 5], 3) == [1, 2, 3])
    assert(take([1, 2], 5) == [1, 2])

fn test_drop():
    assert(drop([1, 2, 3, 4, 5], 2) == [3, 4, 5])
    assert(drop([1, 2], 5).is_empty())

fn test_take_while():
    assert(take_while([1, 2, 3, 4, 1], \x: x < 4) == [1, 2, 3])

fn test_drop_while():
    assert(drop_while([1, 2, 3, 4, 5], \x: x < 3) == [3, 4, 5])

# =====================================
# Comparison Tests
# =====================================

fn test_list_equals():
    assert(list_equals([1, 2, 3], [1, 2, 3]))
    assert(not list_equals([1, 2], [1, 2, 3]))
    assert(not list_equals([1, 2, 3], [1, 3, 2]))

# =====================================
# Sorting Helpers Tests
# =====================================

fn test_is_sorted():
    assert(is_sorted([1, 2, 3, 4]))
    assert(not is_sorted([1, 3, 2, 4]))
    assert(is_sorted([]))
    assert(is_sorted([1]))

# =====================================
# Other Operations Tests
# =====================================

fn test_intersperse():
    assert(intersperse([1, 2, 3], 0) == [1, 0, 2, 0, 3])
    assert(intersperse([1], 0) == [1])

fn test_concat_lists():
    assert(concat_lists([[1, 2], [3, 4], [5]]) == [1, 2, 3, 4, 5])
