# Tests for string utilities

use tooling.string_utils.*

# =====================================
# Basic String Operations Tests
# =====================================

fn test_repeat():
    assert(repeat("ab", 3) == "ababab")
    assert(repeat("x", 5) == "xxxxx")
    assert(repeat("test", 0) == "")
    assert(repeat("", 5) == "")

fn test_capitalize():
    assert(capitalize("hello") == "Hello")
    assert(capitalize("WORLD") == "World")
    assert(capitalize("") == "")
    assert(capitalize("a") == "A")

fn test_title_case():
    assert(title_case("hello world") == "Hello World")
    assert(title_case("the quick brown fox") == "The Quick Brown Fox")
    assert(title_case("") == "")

fn test_reverse():
    assert(reverse("hello") == "olleh")
    assert(reverse("12345") == "54321")
    assert(reverse("") == "")
    assert(reverse("a") == "a")

# =====================================
# Trimming Tests
# =====================================

fn test_trim():
    assert(trim("  hello  ") == "hello")
    assert(trim("\thello\n") == "hello")
    assert(trim("  ") == "")
    assert(trim("hello") == "hello")

fn test_trim_start():
    assert(trim_start("  hello  ") == "hello  ")
    assert(trim_start("\nhello") == "hello")

fn test_trim_end():
    assert(trim_end("  hello  ") == "  hello")
    assert(trim_end("hello\t") == "hello")

# =====================================
# Padding Tests
# =====================================

fn test_pad_left():
    assert(pad_left("hi", 5, " ") == "   hi")
    assert(pad_left("test", 4, " ") == "test")
    assert(pad_left("a", 3, "0") == "00a")

fn test_pad_right():
    assert(pad_right("hi", 5, " ") == "hi   ")
    assert(pad_right("test", 4, " ") == "test")
    assert(pad_right("a", 3, "0") == "a00")

fn test_center():
    assert(center("hi", 6, " ") == "  hi  ")
    assert(center("test", 4, " ") == "test")

# =====================================
# Substring Tests
# =====================================

fn test_safe_substring_normal():
    assert(safe_substring("hello", 1, 4) == "ell")
    assert(safe_substring("world", 0, 5) == "world")

fn test_safe_substring_out_of_bounds():
    assert(safe_substring("hi", -1, 1) == "h")
    assert(safe_substring("hi", 0, 10) == "hi")
    assert(safe_substring("test", 1, 1) == "")

# =====================================
# Splitting Tests
# =====================================

fn test_split_on_char():
    val parts = split_on_char("a,b,c", ',')
    assert(parts.len() == 3)
    assert(parts[0] == "a")
    assert(parts[1] == "b")
    assert(parts[2] == "c")

fn test_split_on_char_no_delimiter():
    val parts = split_on_char("hello", ',')
    assert(parts.len() == 1)
    assert(parts[0] == "hello")

fn test_split_once():
    match split_once("key=value", '='):
        Some((left, right)) =>
            assert(left == "key")
            assert(right == "value")
        None =>
            assert(false)

fn test_split_once_not_found():
    match split_once("nodelimiter", '='):
        Some(_) =>
            assert(false)
        None =>
            assert(true)

fn test_lines():
    val ls = lines("line1\nline2\nline3")
    assert(ls.len() == 3)
    assert(ls[0] == "line1")
    assert(ls[1] == "line2")
    assert(ls[2] == "line3")

# =====================================
# Joining Tests
# =====================================

fn test_join():
    assert(join(["a", "b", "c"], ",") == "a,b,c")
    assert(join(["hello", "world"], " ") == "hello world")
    assert(join([], ",") == "")
    assert(join(["single"], ",") == "single")

# =====================================
# Replacement Tests
# =====================================

fn test_replace_first():
    assert(replace_first("hello world", "l", "L") == "heLlo world")
    assert(replace_first("test", "x", "y") == "test")

fn test_replace_all():
    assert(replace_all("hello hello", "l", "L") == "heLLo heLLo")
    assert(replace_all("aaa", "a", "b") == "bbb")

# =====================================
# Character Checking Tests
# =====================================

fn test_is_ascii():
    assert(is_ascii("hello123"))
    assert(is_ascii(""))
    # Would fail with non-ASCII: assert(not is_ascii("hÃ©llo"))

fn test_is_whitespace():
    assert(is_whitespace("   "))
    assert(is_whitespace("\t\n"))
    assert(not is_whitespace("hello"))
    assert(is_whitespace(""))

fn test_starts_with_char():
    assert(starts_with_char("hello", 'h'))
    assert(not starts_with_char("hello", 'w'))
    assert(not starts_with_char("", 'a'))

fn test_ends_with_char():
    assert(ends_with_char("hello", 'o'))
    assert(not ends_with_char("hello", 'x'))
    assert(not ends_with_char("", 'a'))

# =====================================
# Search Tests
# =====================================

fn test_contains_char():
    assert(contains_char("hello", 'e'))
    assert(not contains_char("hello", 'x'))

fn test_index_of_char():
    match index_of_char("hello", 'e'):
        Some(idx) =>
            assert(idx == 1)
        None =>
            assert(false)

fn test_index_of_char_not_found():
    match index_of_char("hello", 'x'):
        Some(_) =>
            assert(false)
        None =>
            assert(true)

fn test_count_char():
    assert(count_char("hello", 'l') == 2)
    assert(count_char("hello", 'e') == 1)
    assert(count_char("hello", 'x') == 0)

# =====================================
# Substring Presence Tests
# =====================================

fn test_substring_count():
    assert(substring_count("ababab", "ab") == 3)
    assert(substring_count("hello", "ll") == 1)
    assert(substring_count("test", "x") == 0)

# =====================================
# Case Tests
# =====================================

fn test_to_lowercase_ascii():
    assert(to_lowercase_ascii("HELLO") == "hello")
    assert(to_lowercase_ascii("Hello123") == "hello123")
    assert(to_lowercase_ascii("") == "")

fn test_to_uppercase_ascii():
    assert(to_uppercase_ascii("hello") == "HELLO")
    assert(to_uppercase_ascii("Hello123") == "HELLO123")
    assert(to_uppercase_ascii("") == "")

# =====================================
# Truncation Tests
# =====================================

fn test_truncate():
    assert(truncate("hello world", 5, "...") == "hello...")
    assert(truncate("short", 10, "...") == "short")
    assert(truncate("exact", 5, "...") == "exact")

# =====================================
# Extraction Tests
# =====================================

fn test_extract_between():
    match extract_between("(hello)", '(', ')'):
        Some(content) =>
            assert(content == "hello")
        None =>
            assert(false)

fn test_extract_between_not_found():
    match extract_between("no brackets", '(', ')'):
        Some(_) =>
            assert(false)
        None =>
            assert(true)

# =====================================
# Normalization Tests
# =====================================

fn test_normalize_whitespace():
    assert(normalize_whitespace("hello  world\t\ntest") == "hello world test")
    assert(normalize_whitespace("  a  b  ") == "a b")

fn test_remove_whitespace():
    assert(remove_whitespace("h e l l o") == "hello")
    assert(remove_whitespace(" test ") == "test")

# =====================================
# Comparison Tests
# =====================================

fn test_compare_case_insensitive():
    assert(compare_case_insensitive("Hello", "hello"))
    assert(compare_case_insensitive("WORLD", "world"))
    assert(not compare_case_insensitive("test", "best"))
