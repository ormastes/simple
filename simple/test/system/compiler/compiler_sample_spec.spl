# System Test: Simple Compiler

use spec.*

describe "Simple Compiler":
    context "when compiling valid source":
        it "produces correct output":
            # Test basic arithmetic
            let result = 2 + 3
            expect(result).to_equal(5)

        it "handles variables":
            let x = 10
            let y = 20
            let sum = x + y
            expect(sum).to_equal(30)

        it "supports functions":
            fn add(a: i64, b: i64) -> i64:
                return a + b

            let result = add(5, 7)
            expect(result).to_equal(12)

    context "when using control flow":
        it "handles if statements":
            let x = 10
            let result = if x > 5:
                "greater"
            else:
                "smaller"
            expect(result).to_equal("greater")

        it "handles loops":
            let sum = 0
            for i in range(1, 6):  # 1, 2, 3, 4, 5
                sum = sum + i
            expect(sum).to_equal(15)

    context "when using collections":
        it "handles arrays":
            let arr = [1, 2, 3]
            expect(arr.len()).to_equal(3)
            expect(arr[0]).to_equal(1)

        it "handles dicts":
            let d = {name: "Alice", age: 30}
            expect(d["name"]).to_equal("Alice")
            expect(d["age"]).to_equal(30)
