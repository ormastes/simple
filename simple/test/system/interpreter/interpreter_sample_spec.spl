# System Test: Simple Interpreter

use spec.*

describe "Simple Interpreter":
    context "when evaluating expressions":
        it "handles arithmetic operations":
            expect(1 + 1).to_equal(2)
            expect(10 - 3).to_equal(7)
            expect(4 * 5).to_equal(20)
            expect(15 / 3).to_equal(5)

        it "handles comparison operations":
            expect(5 > 3).to_be_true()
            expect(2 < 10).to_be_true()
            expect(5 == 5).to_be_true()
            expect(3 != 4).to_be_true()

        it "handles boolean operations":
            expect(true and true).to_be_true()
            expect(true and false).to_be_false()
            expect(true or false).to_be_true()
            expect(not false).to_be_true()

    context "when working with strings":
        it "supports string concatenation":
            let s = "Hello" + " " + "World"
            expect(s).to_equal("Hello World")

        it "supports string interpolation":
            let name = "Alice"
            let age = 30
            let msg = f"Name: {name}, Age: {age}"
            expect(msg).to_equal("Name: Alice, Age: 30")

    context "when using pattern matching":
        it "handles simple patterns":
            let value = 42
            let result = match value:
                case 0:
                    "zero"
                case 42:
                    "answer"
                case _:
                    "other"
            expect(result).to_equal("answer")

        it "handles Option patterns":
            let some_val = Some(10)
            let result = match some_val:
                case Some(x):
                    x * 2
                case None:
                    0
            expect(result).to_equal(20)

    context "when using closures":
        it "captures environment":
            let x = 10
            let add_x = fn (y): x + y
            let result = add_x(5)
            expect(result).to_equal(15)

        it "supports higher-order functions":
            let numbers = [1, 2, 3, 4, 5]
            let doubled = numbers.map(fn (x): x * 2)
            expect(doubled).to_equal([2, 4, 6, 8, 10])
