# System Test: File Watcher Integration

use spec.*

describe "File Watcher":
    context "when monitoring source files":
        it "detects basic changes":
            # Test basic functionality that would be monitored
            let x = 1
            let y = 2
            let sum = x + y
            expect(sum).to_equal(3)

        it "handles multiple file operations":
            let data = [1, 2, 3]
            data.push(4)
            expect(data.len()).to_equal(4)

    context "when rebuilding on changes":
        it "recompiles successfully":
            # Test that code compiles correctly after changes
            fn calculate(x: i64) -> i64:
                return x * 2

            let result = calculate(21)
            expect(result).to_equal(42)

        it "maintains state correctly":
            # Test that state is preserved/reset correctly
            let counter = 0
            for i in range(1, 4):  # 1, 2, 3
                counter = counter + i
            expect(counter).to_equal(6)

    context "when handling errors":
        it "recovers from errors gracefully":
            # Test error handling
            let safe_result = Result::Ok(10)
            match safe_result:
                case Ok(value):
                    expect(value).to_equal(10)
                case Err(_):
                    # Should not reach here
                    expect(false).to_be_true()
