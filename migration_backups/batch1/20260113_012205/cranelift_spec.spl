# Cranelift Backend Feature Specification
# Feature #100: Cranelift code generation backend
# Category: Codegen | Difficulty: 4 | Status: Complete

class FeatureMetadata:
    id: i32
    name: text
    category: text
    difficulty: i32
    status: text
    impl_type: text
    spec_ref: text
    files: List<text>
    tests: List<text>
    description: text
    code_examples: List<text>
    dependencies: List<i32>
    required_by: List<i32>
    notes: text

val FEATURE = FeatureMetadata {
    id: 100,
    name: "Cranelift Backend",
    category: "Codegen",
    difficulty: 4,
    status: "Complete",
    impl_type: "Rust",
    spec_ref: "doc/codegen_technical.md",
    files: [
        "src/compiler/src/codegen/cranelift.rs",
        "src/compiler/src/codegen/jit.rs"
    ],
    tests: [
        "src/driver/tests/interpreter_jit_tests.rs"
    ],
    description: "Cranelift-based code generation backend for AOT and JIT compilation. Provides fast compilation with good runtime performance.",
    code_examples: [
        "# Compile with Cranelift backend",
        "simple compile app.spl -o app",
        "",
        "# JIT compilation for fast iteration",
        "simple run --jit app.spl"
    ],
    dependencies: [2, 5],
    required_by: [],
    notes: "Primary backend for AOT compilation. JIT mode enables fast development iteration."
}

print("============================================================")
print("  CRANELIFT BACKEND FEATURE SPECIFICATION (#100)")
print("  Category: Codegen | Difficulty: 4 | Status: Complete")
print("============================================================")
print("")

var passed = 0
var failed = 0

print("describe Cranelift compilation:")

print("  it compiles simple functions:")
fn add(a, b):
    return a + b
if add(2, 3) == 5:
    print("    [PASS] function compilation")
    passed = passed + 1
else:
    print("    [FAIL] function compilation")
    failed = failed + 1

print("  it compiles with control flow:")
fn abs_val(x):
    if x < 0:
        return -x
    return x
if abs_val(-5) == 5 and abs_val(5) == 5:
    print("    [PASS] control flow compilation")
    passed = passed + 1
else:
    print("    [FAIL] control flow compilation")
    failed = failed + 1

print("  it compiles loops:")
fn sum_to(n):
    var total = 0
    var i = 1
    while i <= n:
        total = total + i
        i = i + 1
    return total
if sum_to(5) == 15:
    print("    [PASS] loop compilation")
    passed = passed + 1
else:
    print("    [FAIL] loop compilation")
    failed = failed + 1

print("  it compiles recursion:")
fn fib(n):
    if n <= 1:
        return n
    return fib(n - 1) + fib(n - 2)
if fib(10) == 55:
    print("    [PASS] recursive compilation")
    passed = passed + 1
else:
    print("    [FAIL] recursive compilation")
    failed = failed + 1

# Documentation
print("")
print("============================================================")
print("  GENERATED DOCUMENTATION")
print("============================================================")
print("")
print("# {FEATURE.name}")
print("")
print("**Feature ID:** #{FEATURE.id}")
print("**Category:** {FEATURE.category}")
print("**Difficulty:** Level {FEATURE.difficulty}/5")
print("**Status:** {FEATURE.status}")
print("**Implementation:** {FEATURE.impl_type}")
print("")
print("## Description")
print("")
print(FEATURE.description)
print("")
print("## Implementation Files")
for file in FEATURE.files:
    print("- `{file}`")
print("")
print("## Notes")
print(FEATURE.notes)

# Summary
print("")
print("============================================================")
print("  TEST SUMMARY")
print("============================================================")
print("Passed: {passed}")
print("Failed: {failed}")
if failed == 0:
    print("All tests PASSED!")
print("============================================================")
