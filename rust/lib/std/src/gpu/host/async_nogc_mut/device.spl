# GPU Device Enumeration and Query

use std.core.option.*
use std.core.result.*

# Device information
struct DeviceInfo:
    name: str
    memory_mb: u64
    compute_units: u32
    supports_f64: bool
    shared_memory_size: u64

    # =========================================================================
    # Helper Methods
    # =========================================================================

    fn get_name(self) -> str:
        """Get device name.

        Returns:
            Device name string

        Example:
            info.get_name()  # → "NVIDIA GeForce RTX 3080"
        """
        return self.name

    fn get_memory_mb(self) -> u64:
        """Get memory size in megabytes.

        Returns:
            Total memory in MB

        Example:
            info.get_memory_mb()  # → 10240
        """
        return self.memory_mb

    fn get_memory_gb(self) -> f64:
        """Get memory size in gigabytes.

        Returns:
            Total memory in GB

        Example:
            info.get_memory_gb()  # → 10.0
        """
        return self.memory_mb as f64 / 1024.0

    fn get_compute_units(self) -> u32:
        """Get number of compute units.

        Returns:
            Number of compute units (SMs/CUs)

        Example:
            info.get_compute_units()  # → 68
        """
        return self.compute_units

    fn has_f64_support(self) -> bool:
        """Check if device supports double precision (f64).

        Returns:
            true if f64 is supported

        Example:
            info.has_f64_support()  # → true
        """
        return self.supports_f64

    fn get_shared_memory_size(self) -> u64:
        """Get shared memory size per block.

        Returns:
            Shared memory size in bytes

        Example:
            info.get_shared_memory_size()  # → 49152
        """
        return self.shared_memory_size

    fn is_high_memory(self, threshold_gb: f64 = 8.0) -> bool:
        """Check if device has high memory capacity.

        Args:
            threshold_gb: Memory threshold in GB (default: 8.0)

        Returns:
            true if memory exceeds threshold

        Example:
            info.is_high_memory()  # → true
            info.is_high_memory(threshold_gb: 16.0)  # → false
        """
        return self.get_memory_gb() >= threshold_gb

    fn is_low_memory(self, threshold_gb: f64 = 4.0) -> bool:
        """Check if device has low memory capacity.

        Args:
            threshold_gb: Memory threshold in GB (default: 4.0)

        Returns:
            true if memory is below threshold

        Example:
            info.is_low_memory()  # → false
        """
        return self.get_memory_gb() < threshold_gb

    fn summary(self) -> str:
        """Get device summary.

        Returns:
            Human-readable summary

        Example:
            info.summary()
            # → "DeviceInfo: NVIDIA GeForce RTX 3080, 10.0 GB, 68 CUs, f64: true"
        """
        val memory_gb = self.get_memory_gb()
        val f64_str = if self.supports_f64 { "true" } else { "false" }
        return "DeviceInfo: {self.name}, {memory_gb} GB, {self.compute_units} CUs, f64: {f64_str}"

# Device enumeration
extern fn devices() -> Array<DeviceInfo>
extern fn default_device() -> Option<DeviceInfo>
extern fn device_count() -> u32
