# HTTP Method Types
# Extracted from types.spl

use core.traits.*

pub enum HttpMethod:
    Get
    Post
    Put
    Delete
    Patch
    Head
    Options
    Connect
    Trace

impl HttpMethod:
    pub fn as_str(self) -> &str:
        match self:
            case Get: "GET"
            case Post: "POST"
            case Put: "PUT"
            case Delete: "DELETE"
            case Patch: "PATCH"
            case Head: "HEAD"
            case Options: "OPTIONS"
            case Connect: "CONNECT"
            case Trace: "TRACE"

impl Display for HttpMethod:
    fn fmt() -> str:
        match self:
            case Get: "GET"
            case Post: "POST"
            case Put: "PUT"
            case Delete: "DELETE"
            case Patch: "PATCH"
            case Head: "HEAD"
            case Options: "OPTIONS"
            case Connect: "CONNECT"
            case Trace: "TRACE"

    # =========================================================================
    # Helper Methods
    # =========================================================================

    pub fn is_get(self) -> bool:
        """Check if method is GET.

        Returns:
            True if GET
        """
        match self:
            case Get: true
            case _: false

    pub fn is_post(self) -> bool:
        """Check if method is POST.

        Returns:
            True if POST
        """
        match self:
            case Post: true
            case _: false

    pub fn is_put(self) -> bool:
        """Check if method is PUT.

        Returns:
            True if PUT
        """
        match self:
            case Put: true
            case _: false

    pub fn is_delete(self) -> bool:
        """Check if method is DELETE.

        Returns:
            True if DELETE
        """
        match self:
            case Delete: true
            case _: false

    pub fn is_patch(self) -> bool:
        """Check if method is PATCH.

        Returns:
            True if PATCH
        """
        match self:
            case Patch: true
            case _: false

    pub fn is_head(self) -> bool:
        """Check if method is HEAD.

        Returns:
            True if HEAD
        """
        match self:
            case Head: true
            case _: false

    pub fn is_safe(self) -> bool:
        """Check if method is safe (GET, HEAD, OPTIONS, TRACE).

        Returns:
            True if safe method
        """
        match self:
            case Get: true
            case Head: true
            case Options: true
            case Trace: true
            case _: false

    pub fn is_idempotent(self) -> bool:
        """Check if method is idempotent (GET, HEAD, PUT, DELETE, OPTIONS, TRACE).

        Returns:
            True if idempotent method
        """
        match self:
            case Get: true
            case Head: true
            case Put: true
            case Delete: true
            case Options: true
            case Trace: true
            case _: false

    pub fn has_request_body(self) -> bool:
        """Check if method typically has a request body.

        Returns:
            True if POST, PUT, or PATCH
        """
        match self:
            case Post: true
            case Put: true
            case Patch: true
            case _: false

    pub fn to_string(self) -> text:
        """Convert HTTP method to string.

        Returns:
            Method name in uppercase

        Example:
            HttpMethod.Post.to_string()  # → "POST"
        """
        match self:
            case Get: "GET"
            case Post: "POST"
            case Put: "PUT"
            case Delete: "DELETE"
            case Patch: "PATCH"
            case Head: "HEAD"
            case Options: "OPTIONS"
            case Connect: "CONNECT"
            case Trace: "TRACE"

    pub fn description(self) -> text:
        """Get HTTP method description.

        Returns:
            Human-readable description

        Example:
            HttpMethod.Post.description()
            # → "POST: Create or submit data"
        """
        match self:
            case Get: "GET: Retrieve resource"
            case Post: "POST: Create or submit data"
            case Put: "PUT: Update or replace resource"
            case Delete: "DELETE: Remove resource"
            case Patch: "PATCH: Partially update resource"
            case Head: "HEAD: Retrieve headers only"
            case Options: "OPTIONS: Query supported methods"
            case Connect: "CONNECT: Establish tunnel"
            case Trace: "TRACE: Echo request for debugging"

    pub fn summary(self) -> str:
        """Get summary of HTTP method.

        Returns:
            Human-readable summary

        Example:
            HttpMethod.Get.summary()
            # → "HttpMethod: GET (safe, idempotent)"
        """
        val name = self.as_str()
        val props = []
        if self.is_safe():
            props.push("safe")
        if self.is_idempotent():
            props.push("idempotent")
        if self.has_request_body():
            props.push("has body")
        val props_str = if props.len() > 0: " ({props.join(\", \")})" else: ""
        return "HttpMethod: {name}{props_str}"

# HTTP status code
pub unit StatusCode: u16 as status

impl StatusCode:
    pub fn from_u16(code: u16) -> StatusCode:
        return code_status

    pub fn as_u16(self) -> u16:
        return self as u16

    pub fn is_informational(self) -> bool:
        val code = self as u16
        return code >= 100 and code < 200

    pub fn is_success(self) -> bool:
        val code = self as u16
        return code >= 200 and code < 300

    pub fn is_redirect(self) -> bool:
        val code = self as u16
        return code >= 300 and code < 400

    pub fn is_client_error(self) -> bool:
        val code = self as u16
        return code >= 400 and code < 500

    pub fn is_server_error(self) -> bool:
        val code = self as u16
        return code >= 500 and code < 600

    pub fn reason_phrase(self) -> str:
        match self as u16:
            case 200: return "OK"
            case 201: return "Created"
            case 204: return "No Content"
            case 301: return "Moved Permanently"
            case 302: return "Found"
            case 304: return "Not Modified"
            case 400: return "Bad Request"
            case 401: return "Unauthorized"
            case 403: return "Forbidden"
            case 404: return "Not Found"
            case 405: return "Method Not Allowed"
            case 408: return "Request Timeout"
            case 429: return "Too Many Requests"
            case 500: return "Internal Server Error"
            case 502: return "Bad Gateway"
            case 503: return "Service Unavailable"
            case 504: return "Gateway Timeout"
            case _: return "Unknown"

    # Common status codes
    pub fn ok() -> StatusCode:
        return 200_status

    pub fn created() -> StatusCode:
        return 201_status

    pub fn no_content() -> StatusCode:
        return 204_status

    pub fn bad_request() -> StatusCode:
        return 400_status

    pub fn unauthorized() -> StatusCode:
        return 401_status

    pub fn forbidden() -> StatusCode:
        return 403_status

    pub fn not_found() -> StatusCode:
        return 404_status

    pub fn internal_server_error() -> StatusCode:
        return 500_status

    # =========================================================================
    # Helper Methods
    # =========================================================================

    pub fn is_error(self) -> bool:
        """Check if status is an error (4xx or 5xx).

        Returns:
            True if client or server error
        """
        return self.is_client_error() or self.is_server_error()

    pub fn is_ok(self) -> bool:
        """Check if status is 200 OK.

        Returns:
            True if 200
        """
        return (self as u16) == 200

    pub fn is_created(self) -> bool:
        """Check if status is 201 Created.

        Returns:
            True if 201
        """
        return (self as u16) == 201

    pub fn is_not_found(self) -> bool:
        """Check if status is 404 Not Found.

        Returns:
            True if 404
        """
        return (self as u16) == 404

    pub fn is_unauthorized(self) -> bool:
        """Check if status is 401 Unauthorized.

        Returns:
            True if 401
        """
        return (self as u16) == 401

    pub fn is_forbidden(self) -> bool:
        """Check if status is 403 Forbidden.

        Returns:
            True if 403
        """
        return (self as u16) == 403

    pub fn allows_body(self) -> bool:
        """Check if status code typically has a response body.

        Returns:
            True if status usually includes body (not 1xx, 204, 304)
        """
        val code = self as u16
        return not (self.is_informational() or code == 204 or code == 304)

    pub fn requires_location_header(self) -> bool:
        """Check if status requires Location header.

        Returns:
            True for 201, 301, 302, 303, 307, 308
        """
        val code = self as u16
        match code:
            case 201: true
            case 301: true
            case 302: true
            case 303: true
            case 307: true
            case 308: true
            case _: false

    pub fn is_cacheable(self) -> bool:
        """Check if response is cacheable by default.

        Returns:
            True for 200, 203, 204, 206, 300, 301, 404, 405, 410, 414, 501
        """
        val code = self as u16
        match code:
            case 200: true
            case 203: true
            case 204: true
            case 206: true
            case 300: true
            case 301: true
            case 404: true
            case 405: true
            case 410: true
            case 414: true
            case 501: true
            case _: false

    pub fn summary(self) -> str:
        """Get summary of status code.

        Returns:
            Human-readable summary

        Example:
            StatusCode.ok().summary()
            # → "StatusCode: 200 OK (success, cacheable)"
        """
        val code = self as u16
        val phrase = self.reason_phrase()
        val category = if self.is_informational(): "informational"
                       else if self.is_success(): "success"
                       else if self.is_redirect(): "redirect"
                       else if self.is_client_error(): "client error"
                       else if self.is_server_error(): "server error"
                       else: "unknown"
        val props = []
        if self.is_cacheable():
            props.push("cacheable")
        if not self.allows_body():
            props.push("no body")
        val props_str = if props.len() > 0: ", {props.join(\", \")}" else: ""
        return "StatusCode: {code} {phrase} ({category}{props_str})"

impl Display for StatusCode:
    fn fmt() -> str:
        "{self as u16} {self.reason_phrase()}"

# HTTP header name (case-insensitive)
pub unit HeaderName: str as header

impl HeaderName:
    pub fn from_str(s: str) -> HeaderName:
        return s.to_lower()_header

    # Common headers
    pub fn content_type() -> HeaderName:
        return "content-type"_header

    pub fn content_length() -> HeaderName:
        return "content-length"_header

    pub fn authorization() -> HeaderName:
        return "authorization"_header

    pub fn user_agent() -> HeaderName:
        return "user-agent"_header

    pub fn accept() -> HeaderName:
        return "accept"_header

    pub fn host() -> HeaderName:
        return "host"_header

    pub fn connection() -> HeaderName:
        return "connection"_header

    pub fn cache_control() -> HeaderName:
        return "cache-control"_header

    pub fn cookie() -> HeaderName:
        return "cookie"_header

    pub fn set_cookie() -> HeaderName:
        return "set-cookie"_header

impl Display for HeaderName:
    fn fmt() -> str:
        self as str

    # =========================================================================
    # Helper Methods
    # =========================================================================

    pub fn as_str(self) -> str:
        """Get header name as string.

        Returns:
            Header name string
        """
        return self as str

    pub fn is_empty(self) -> bool:
        """Check if header name is empty.

        Returns:
            True if empty
        """
        return (self as str).is_empty()

    pub fn len(self) -> usize:
        """Get length of header name.

        Returns:
            Character count
        """
        return (self as str).len()

    pub fn is_content_type(self) -> bool:
        """Check if header is Content-Type.

        Returns:
            True if content-type
        """
        return (self as str) == "content-type"

    pub fn is_authorization(self) -> bool:
        """Check if header is Authorization.

        Returns:
            True if authorization
        """
        return (self as str) == "authorization"

    pub fn is_cookie(self) -> bool:
        """Check if header is Cookie or Set-Cookie.

        Returns:
            True if cookie-related
        """
        val name = self as str
        return name == "cookie" or name == "set-cookie"

    pub fn is_standard(self) -> bool:
        """Check if header is a standard HTTP header.

        Returns:
            True if standard header
        """
        val name = self as str
        match name:
            case "content-type": true
            case "content-length": true
            case "authorization": true
            case "user-agent": true
            case "accept": true
            case "host": true
            case "connection": true
            case "cache-control": true
            case "cookie": true
            case "set-cookie": true
            case _: false

    pub fn is_custom(self) -> bool:
        """Check if header is a custom (non-standard) header.

        Returns:
            True if custom header
        """
        return not self.is_standard()

    pub fn summary(self) -> str:
        """Get summary of header name.

        Returns:
            Human-readable summary

        Example:
            HeaderName.content_type().summary()
            # → "HeaderName: content-type (standard)"
        """
        val name = self as str
        val kind = if self.is_standard(): "standard" else: "custom"
        return "HeaderName: {name} ({kind})"

# HTTP header value
pub unit HeaderValue: str as hval

impl HeaderValue:
    pub fn from_str(s: str) -> HeaderValue:
        return s_hval

    # Common content types
    pub fn json() -> HeaderValue:
        return "application/json"_hval

    pub fn form() -> HeaderValue:
        return "application/x-www-form-urlencoded"_hval

    pub fn multipart() -> HeaderValue:
        return "multipart/form-data"_hval

    pub fn text() -> HeaderValue:
        return "text/plain"_hval

    pub fn html() -> HeaderValue:
        return "text/html"_hval

    pub fn xml() -> HeaderValue:
        return "application/xml"_hval

impl Display for HeaderValue:
    fn fmt() -> str:
        self as str

    # =========================================================================
    # Helper Methods
    # =========================================================================

    pub fn as_str(self) -> str:
        """Get header value as string.

        Returns:
            Header value string
        """
        return self as str

    pub fn is_empty(self) -> bool:
        """Check if header value is empty.

        Returns:
            True if empty
        """
        return (self as str).is_empty()

    pub fn len(self) -> usize:
        """Get length of header value.

        Returns:
            Character count
        """
        return (self as str).len()

    pub fn is_json(self) -> bool:
        """Check if value is JSON content type.

        Returns:
            True if application/json
        """
        return (self as str).contains("application/json")

    pub fn is_form(self) -> bool:
        """Check if value is form content type.

        Returns:
            True if form-urlencoded or multipart
        """
        val val = self as str
        return val.contains("application/x-www-form-urlencoded") or
               val.contains("multipart/form-data")

    pub fn is_text(self) -> bool:
        """Check if value is text content type.

        Returns:
            True if text/* content type
        """
        return (self as str).starts_with("text/")

    pub fn is_binary(self) -> bool:
        """Check if value is binary content type.

        Returns:
            True if application/octet-stream or similar
        """
        val val = self as str
        return val.contains("application/octet-stream") or
               val.contains("application/pdf") or
               val.contains("image/") or
               val.contains("video/") or
               val.contains("audio/")

    pub fn content_type_base(self) -> str:
        """Extract base content type (without charset, etc.).

        Returns:
            Base content type

        Example:
            "text/html; charset=utf-8".content_type_base()
            # → "text/html"
        """
        val val = self as str
        val parts = val.split(";")
        if parts.len() > 0:
            return parts[0].trim()
        return val

    pub fn summary(self) -> str:
        """Get summary of header value.

        Returns:
            Human-readable summary

        Example:
            HeaderValue.json().summary()
            # → "HeaderValue: application/json (JSON, 16 chars)"
        """
        val val = self as str
        val len = self.len()
        val types = []
        if self.is_json():
            types.push("JSON")
        if self.is_text():
            types.push("text")
        if self.is_binary():
            types.push("binary")
        if self.is_form():
            types.push("form")
        val types_str = if types.len() > 0: types.join("/") + ", " else: ""
        return "HeaderValue: {val} ({types_str}{len} chars)"

# HTTP error type
