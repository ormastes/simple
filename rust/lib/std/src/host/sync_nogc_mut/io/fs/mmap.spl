# Memory-Mapped File Operations - Sync NoGC Mutable Variant
#
# Zero-copy file access via memory mapping.
# All operations are synchronous (blocking).

use units.file.*
use units.size.*
use host.common.io.*

export MmapRegion
export open_mmap, open_mmap_with

# Re-export MmapRegion from common module
export host.common.io.mmap_common.MmapRegion

# Open file as memory-mapped region (blocking)
pub fn open_mmap(path: FilePath) -> Result<MmapRegion, IoError>:
    return open_mmap_with(path, MmapMode.ReadOnly, MmapAdvice.Normal)

# Open file as memory-mapped region with mode and advice (blocking)
pub fn open_mmap_with(path: FilePath, mode: MmapMode, advice: MmapAdvice) -> Result<MmapRegion, IoError>:
    return open_mmap_impl(path, mode, advice)

# Context manager implementations
impl ContextManager<MmapRegion> for MmapRegion:
    fn __enter__() -> MmapRegion:
        return self

    fn __exit__(exc: Option<Exception>) -> bool:
        val _ = self.close()
        return false

