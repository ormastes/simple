# Simplified System module - Process control and standard streams
# Minimal version without complex dependencies

# Extern declarations for FFI
extern fn rt_get_args() -> List<text>
extern fn rt_exit(code: i32) -> void
extern fn rt_stdout_write(s: text) -> i64
extern fn rt_stdout_flush() -> i32

# Standard output stream
pub class Stdout:
    pub fn new() -> Stdout:
        return Stdout {}

    @io
    pub fn write(self, s: text) -> Result<i32, text>:
        val written = rt_stdout_write(s)
        if written < 0:
            return Err("Write error: {written}")
        return Ok(written as i32)

    @io
    pub fn flush(self) -> Result<(), text>:
        val result = rt_stdout_flush()
        if result != 0:
            return Err("Flush error: {result}")
        return Ok(())

# Standard error stream
pub class Stderr:
    pub fn new() -> Stderr:
        return Stderr {}

# Command line arguments
pub class Args:
    pub fn get_args() -> List<text>:
        """Get command-line arguments.

        Returns:
            List of arguments including program name

        Example:
            Args.get_args()  # → ["program", "arg1", "arg2"]
        """
        return rt_get_args()

    pub fn len() -> i64:
        """Get number of arguments.

        Returns:
            Number of arguments

        Example:
            Args.len()  # → 3
        """
        return rt_get_args().len()

    pub fn has_args() -> bool:
        """Check if there are any arguments beyond program name.

        Returns:
            true if arguments present

        Example:
            Args.has_args()  # → true
        """
        return rt_get_args().len() > 1

# Get the global stdout instance
pub fn stdout() -> Stdout:
    Stdout.new()

# Get the global stderr instance
pub fn stderr() -> Stderr:
    Stderr.new()

# Get the global args instance
pub fn args() -> Args:
    Args.new()

# Exit the process with the given code
@io
pub fn exit(code: i32) -> Never:
    rt_exit(code)
    # Unreachable, but needed for type system
    loop:
        pass
