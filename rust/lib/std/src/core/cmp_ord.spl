# Comparison and Ordering - Comparison traits and utilities
#
# Provides traits for equality and ordering comparisons.

# Ordering enum for comparison results
enum Ordering:
    Less
    Equal
    Greater

    fn is_lt(self) -> bool:
        match self:
            Ordering.Less: return true
            _: return false

    fn is_eq(self) -> bool:
        match self:
            Ordering.Equal: return true
            _: return false

    fn is_gt(self) -> bool:
        match self:
            Ordering.Greater: return true
            _: return false

    fn is_le(self) -> bool:
        match self:
            Ordering.Less: return true
            Ordering.Equal: return true
            _: return false

    fn is_ge(self) -> bool:
        match self:
            Ordering.Greater: return true
            Ordering.Equal: return true
            _: return false

    fn reverse(self) -> Ordering:
        match self:
            Ordering.Less: return Ordering.Greater
            Ordering.Greater: return Ordering.Less
            Ordering.Equal: return Ordering.Equal

    fn then(self, other: Ordering) -> Ordering:
        match self:
            Ordering.Equal: return other
            _: return self

# Equality trait
trait Eq<T>:
    fn eq(other: T) -> bool
    fn ne(other: T) -> bool:
        return not self.eq(other)

# Partial ordering trait (for types with undefined comparisons like NaN)
trait PartialOrd<T>: Eq<T>:
    fn partial_cmp(other: T) -> Option<Ordering>

    fn lt(other: T) -> bool:
        match self.partial_cmp(other):
            Option.Some(Ordering.Less): return true
            _: return false

    fn le(other: T) -> bool:
        match self.partial_cmp(other):
            Option.Some(Ordering.Less): return true
            Option.Some(Ordering.Equal): return true
            _: return false

    fn gt(other: T) -> bool:
        match self.partial_cmp(other):
            Option.Some(Ordering.Greater): return true
            _: return false

    fn ge(other: T) -> bool:
        match self.partial_cmp(other):
            Option.Some(Ordering.Greater): return true
            Option.Some(Ordering.Equal): return true
            _: return false

# Total ordering trait (all values are comparable)
trait Ord<T>: PartialOrd<T>:
    fn cmp(other: T) -> Ordering

    fn max(other: T) -> T:
        match self.cmp(other):
            Ordering.Less: return other
            _: return self

    fn min(other: T) -> T:
        match self.cmp(other):
            Ordering.Greater: return other
            _: return self

    fn clamp(min_val: T, max_val: T) -> T:
        if self.cmp(min_val).is_lt():
            return min_val
        if self.cmp(max_val).is_gt():
            return max_val
        return self

# Utility functions for common comparisons
fn min<T: Ord<T>>(a: T, b: T) -> T:
    return a.min(b)

fn max<T: Ord<T>>(a: T, b: T) -> T:
    return a.max(b)

fn clamp<T: Ord<T>>(value: T, min_val: T, max_val: T) -> T:
    return value.clamp(min_val, max_val)

# Reverse ordering wrapper
struct Reverse<T: Ord<T>>:
    inner: T

impl Reverse<T>: Ord<T>:
    fn eq(other: Reverse<T>) -> bool:
        return self.inner.eq(other.inner)

    fn partial_cmp(other: Reverse<T>) -> Option<Ordering>:
        return Option.some(self.cmp(other))

    fn cmp(other: Reverse<T>) -> Ordering:
        return self.inner.cmp(other.inner).reverse()

export Ordering, Eq, PartialOrd, Ord, Reverse
export min, max, clamp
