# Common Mixins - Reusable stateful compositions
#
# These mixins provide commonly needed fields and methods
# that can be composed into any class via `use MixinName`.
#
# Example:
#   class User:
#       use Timestamped
#       use Named
#       id: i64
#
# After composition, User has: created_at, updated_at, name, id fields
# plus age(), display_name() methods.

# Timestamped mixin - adds creation and modification tracking
mixin Timestamped:
    created_at: i64
    updated_at: i64

    fn age() -> i64:
        self.updated_at - self.created_at

    me touch(now: i64):
        self.updated_at = now

# Named mixin - adds a name field with display support
mixin Named:
    name: text

    fn display_name() -> text:
        self.name

# Identifiable mixin - adds unique ID support
mixin Identifiable:
    id: i64

    fn is_same(other) -> bool:
        self.id == other.id

# Auditable mixin - tracks who created/modified a record
mixin Auditable:
    created_by: text
    updated_by: text

    fn last_editor() -> text:
        self.updated_by

# Describable mixin - adds a description field
mixin Describable:
    description: text

    fn short_description() -> text:
        val desc = self.description
        if desc.length() > 50:
            return desc[0:47] + "..."
        desc

# Taggable mixin - adds tag support for categorization
mixin Taggable:
    tags: [text]

    fn has_tag(tag: text) -> bool:
        self.tags.contains(tag)

    fn tag_count() -> i64:
        self.tags.length()

# Sortable mixin - adds a sort_key for ordering
mixin Sortable:
    sort_key: i64

    fn comes_before(other) -> bool:
        self.sort_key < other.sort_key
