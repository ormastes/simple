struct McpOutput:
    items: Array<McpItem>

impl McpOutput:
    static fn new() -> McpOutput:
        return McpOutput { items: [] }

    fn add_item(item: McpItem):
        self.items.push(item)

    fn merge(other: McpOutput):
        for item in other.items:
            self.items.push(item)

struct McpItem:
    kind: ItemKind
    line: text
    children: Array<McpItem>
    metadata: McpMetadata

enum ItemKind:
    Function
    Struct
    Enum
    EnumVariant
    Trait
    Impl
    Module
    Import
    Field

impl ItemKind:
    # =========================================================================
    # Helper Methods
    # =========================================================================

    fn is_function() -> bool:
        """Check if item is Function.

        Returns:
            true for Function

        Example:
            ItemKind.Function.is_function()  # → true
        """
        match self:
            case Function: true
            case _: false

    fn is_struct() -> bool:
        """Check if item is Struct.

        Returns:
            true for Struct

        Example:
            ItemKind.Struct.is_struct()  # → true
        """
        match self:
            case Struct: true
            case _: false

    fn is_enum() -> bool:
        """Check if item is Enum.

        Returns:
            true for Enum

        Example:
            ItemKind.Enum.is_enum()  # → true
        """
        match self:
            case Enum: true
            case _: false

    fn is_enum_variant() -> bool:
        """Check if item is EnumVariant.

        Returns:
            true for EnumVariant

        Example:
            ItemKind.EnumVariant.is_enum_variant()  # → true
        """
        match self:
            case EnumVariant: true
            case _: false

    fn is_trait() -> bool:
        """Check if item is Trait.

        Returns:
            true for Trait

        Example:
            ItemKind.Trait.is_trait()  # → true
        """
        match self:
            case Trait: true
            case _: false

    fn is_impl() -> bool:
        """Check if item is Impl block.

        Returns:
            true for Impl

        Example:
            ItemKind.Impl.is_impl()  # → true
        """
        match self:
            case Impl: true
            case _: false

    fn is_module() -> bool:
        """Check if item is Module.

        Returns:
            true for Module

        Example:
            ItemKind.Module.is_module()  # → true
        """
        match self:
            case Module: true
            case _: false

    fn is_import() -> bool:
        """Check if item is Import.

        Returns:
            true for Import

        Example:
            ItemKind.Import.is_import()  # → true
        """
        match self:
            case Import: true
            case _: false

    fn is_field() -> bool:
        """Check if item is Field.

        Returns:
            true for Field

        Example:
            ItemKind.Field.is_field()  # → true
        """
        match self:
            case Field: true
            case _: false

    fn is_type_definition() -> bool:
        """Check if item is a type definition (Struct, Enum, or Trait).

        Returns:
            true for Struct, Enum, or Trait

        Example:
            ItemKind.Struct.is_type_definition()  # → true
            ItemKind.Function.is_type_definition()  # → false
        """
        match self:
            case Struct: true
            case Enum: true
            case Trait: true
            case _: false

    fn is_code() -> bool:
        """Check if item contains executable code.

        Returns:
            true for Function or Impl

        Example:
            ItemKind.Function.is_code()  # → true
            ItemKind.Struct.is_code()  # → false
        """
        match self:
            case Function: true
            case Impl: true
            case _: false

    fn is_container() -> bool:
        """Check if item can contain other items.

        Returns:
            true for Struct, Enum, Impl, Module

        Example:
            ItemKind.Module.is_container()  # → true
            ItemKind.Function.is_container()  # → false
        """
        match self:
            case Struct: true
            case Enum: true
            case Impl: true
            case Module: true
            case _: false

    fn is_nested() -> bool:
        """Check if item is typically nested inside another item.

        Returns:
            true for EnumVariant or Field

        Example:
            ItemKind.Field.is_nested()  # → true
            ItemKind.Struct.is_nested()  # → false
        """
        match self:
            case EnumVariant: true
            case Field: true
            case _: false

    fn is_declaration() -> bool:
        """Check if item is a declaration (not import).

        Returns:
            true for all except Import

        Example:
            ItemKind.Function.is_declaration()  # → true
            ItemKind.Import.is_declaration()  # → false
        """
        match self:
            case Import: false
            case _: true

    fn to_string() -> text:
        """Convert item kind to string.

        Returns:
            Item kind name

        Example:
            ItemKind.Function.to_string()  # → "function"
        """
        match self:
            case Function: "function"
            case Struct: "struct"
            case Enum: "enum"
            case EnumVariant: "enum_variant"
            case Trait: "trait"
            case Impl: "impl"
            case Module: "module"
            case Import: "import"
            case Field: "field"

    fn description() -> text:
        """Get item kind description.

        Returns:
            Human-readable description

        Example:
            ItemKind.Trait.description()
            # → "Trait definition"
        """
        match self:
            case Function: "Function definition"
            case Struct: "Struct type definition"
            case Enum: "Enum type definition"
            case EnumVariant: "Enum variant"
            case Trait: "Trait definition"
            case Impl: "Implementation block"
            case Module: "Module definition"
            case Import: "Import statement"
            case Field: "Struct or enum field"

    fn summary() -> text:
        """Get item kind summary.

        Returns:
            Human-readable summary

        Example:
            ItemKind.Struct.summary()
            # → "ItemKind: struct (Struct type definition, type definition, container)"
        """
        val name = self.to_string()
        val desc = self.description()
        var props = []

        if self.is_type_definition():
            props.push("type definition")
        elif self.is_code():
            props.push("code")
        elif self.is_import():
            props.push("import")

        if self.is_container():
            props.push("container")
        elif self.is_nested():
            props.push("nested")

        if props.len() > 0:
            val props_str = props.join(", ")
            "ItemKind: {name} ({desc}, {props_str})"
        else:
            "ItemKind: {name} ({desc})"

    fn marker_symbol() -> text:
        """Get marker symbol for this item kind.

        Returns:
            Marker string (F>, T>, etc.)

        Example:
            ItemKind.Function.marker_symbol()  # → "F>"
            ItemKind.Struct.marker_symbol()  # → "T>"
        """
        match self:
            case Function: "F>"
            case Struct: "T>"
            case Enum: "T>"
            case EnumVariant: "V•"
            case Trait: "T>"
            case Impl: "I>"
            case Module: "M>"
            case Import: "U>"
            case Field: "V•"

    fn to_string() -> text:
        """Convert item kind to string.

        Returns:
            Kind name

        Example:
            ItemKind.Function.to_string()  # → "function"
        """
        match self:
            case Function: "function"
            case Struct: "struct"
            case Enum: "enum"
            case EnumVariant: "enum_variant"
            case Trait: "trait"
            case Impl: "impl"
            case Module: "module"
            case Import: "import"
            case Field: "field"

    fn description() -> text:
        """Get item kind description.

        Returns:
            Human-readable description

        Example:
            ItemKind.Function.description()
            # → "Function definition"
        """
        match self:
            case Function: "Function definition"
            case Struct: "Structure definition"
            case Enum: "Enumeration definition"
            case EnumVariant: "Enum variant"
            case Trait: "Trait definition"
            case Impl: "Implementation block"
            case Module: "Module declaration"
            case Import: "Import statement"
            case Field: "Struct/enum field"

    fn summary() -> text:
        """Get summary of item kind.

        Returns:
            Human-readable summary

        Example:
            ItemKind.Function.summary()
            # → "ItemKind: function (code, F>)"
        """
        val name = self.to_string()
        val marker = self.marker_symbol()
        val category = if self.is_code():
                           "code"
                       else if self.is_type_definition():
                           "type definition"
                       else if self.is_container():
                           "container"
                       else if self.is_nested():
                           "nested"
                       else:
                           "declaration"
        return "ItemKind: {name} ({category}, {marker})"

