# Import Fixer - Correct Order
# Fixes: ./ then ../ then /

use app.io.mod.{shell, shell_output, print}
use std.string.{trim}

fn main():
    print "Fixing import paths..."

    # Find files that have path-style imports
    val file_list_result = shell_output("grep -rlE 'use .*(\/|\\.\\.|\\.\/)' src/ test/ 2>/dev/null || true")
    val file_list = trim(file_list_result)

    if file_list == "":
        print "No files need fixing"
        print "Done"
        return ()

    # Apply fixes using sed on matching files
    # Pass 1: Fix "use ./" -> "use ."
    # Pass 2: Fix "use ../" -> "use .."
    # Pass 3-4: Fix remaining "/" -> "." in use statements
    val fix_cmd = "grep -rlE 'use .*(\/|\\.\\.|\\.\/)' src/ test/ 2>/dev/null | while read file; do echo \"Fixing: $file\"; sed -i 's|use \\./|use .|g' \"$file\"; sed -i 's|use \\.\\.\/|use ..|g' \"$file\"; sed -i 's|\\(use [^ ]*\\)/\\([^ ]*\\)|\\1.\\2|g' \"$file\"; sed -i 's|\\(use [^ ]*\\)/\\([^ ]*\\)|\\1.\\2|g' \"$file\"; done"
    val result = shell(fix_cmd)
    print result.stdout

    print "Done"

main()
