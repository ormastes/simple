# Phase 2 Execution Script
# High Priority Files (1500-2000 lines)

use app.io.mod.{shell_output, file_exists, print}
use std.string.{trim, split}

fn analyze_file(utils_file: text, expected_lines: text) -> bool:
    val path = "src/std/{utils_file}.spl"
    if not file_exists(path):
        print "  File not found"
        return false

    val actual_raw = shell_output("wc -l < {path}")
    val actual_lines = trim(actual_raw)
    print "  Actual: {actual_lines} lines (expected: {expected_lines})"

    val actual_count = int(actual_lines)
    if actual_count < 100:
        print "  Already a facade"
        return true

    val fn_raw = shell_output("grep -c '^fn ' {path} 2>/dev/null || echo 0")
    val fn_count = trim(fn_raw)
    print "  Functions: {fn_count}"

    val cat_raw = shell_output("grep -c '^# ---' {path} 2>/dev/null || echo 0")
    val categories = trim(cat_raw)
    print "  Categories: {categories}"

    return true

fn main():
    print "======================================="
    print "Phase 2: High Priority Refactoring"
    print "Target: 10 files (1500-2000 lines each)"
    print "======================================="
    print ""

    val targets = [
        "red_black_tree_utils:1764",
        "rsa_utils:1759",
        "regex_engine_utils:1686",
        "optimization_utils:1664",
        "linear_algebra_utils:1648",
        "cert_utils:1621",
        "compression_utils:1606",
        "xml_utils:1592",
        "markdown_utils:1566",
        "statistical_utils:1554"
    ]

    var success = 0
    var failed = 0
    val total = 10

    for target in targets:
        val parts = split(target, ":")
        val utils_name = parts[0]
        val expected_lines = parts[1]

        print "[{utils_name}]"
        val ok = analyze_file(utils_name, expected_lines)
        if ok:
            success = success + 1
        if not ok:
            failed = failed + 1
        print ""

    print "======================================="
    print "Phase 2 Analysis Summary"
    print "======================================="
    print "Total targets: {total}"
    print "Analyzed: {success}"
    print "Failed: {failed}"
    print ""
    print "Analysis complete. Ready for refactoring."

main()
