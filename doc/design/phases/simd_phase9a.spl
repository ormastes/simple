"""
SIMD Complete - Phase 9A: Vector Types

Implements vector types for SIMD operations.

Status: Phase 9A In Progress
"""

type Symbol = text

# ============================================================================
# Vector Types
# ============================================================================

struct Vec2f:
    """2-element f32 vector (64-bit aligned)"""
    x: f32
    y: f32

impl Vec2f:
    static fn splat(value: f32) -> Vec2f:
        """Create vector with all elements set to value"""
        Vec2f(x: value, y: value)

    static fn from_array(arr: [f32]) -> Vec2f:
        """Create from array (must have 2+ elements)"""
        assert arr.len() >= 2, "Array must have at least 2 elements"
        Vec2f(x: arr[0], y: arr[1])

    static fn zero() -> Vec2f:
        """Zero vector"""
        Vec2f(x: 0.0, y: 0.0)

    fn to_array() -> [f32]:
        """Convert to array"""
        [self.x, self.y]

    fn get(index: i64) -> f32:
        """Get element by index"""
        match index:
            case 0: self.x
            case 1: self.y
            case _:
                assert false, "Index out of bounds: {index}"
                0.0  # Unreachable but needed for type checking

    fn set(index: i64, value: f32) -> Vec2f:
        """Set element by index (returns new vector)"""
        match index:
            case 0: Vec2f(x: value, y: self.y)
            case 1: Vec2f(x: self.x, y: value)
            case _:
                assert false, "Index out of bounds: {index}"
                self

    fn to_string() -> text:
        """String representation"""
        "Vec2f({self.x}, {self.y})"

struct Vec4f:
    """4-element f32 vector (128-bit SSE register)"""
    x: f32
    y: f32
    z: f32
    w: f32

impl Vec4f:
    static fn splat(value: f32) -> Vec4f:
        """Create vector with all elements set to value"""
        Vec4f(x: value, y: value, z: value, w: value)

    static fn from_array(arr: [f32]) -> Vec4f:
        """Create from array (must have 4+ elements)"""
        assert arr.len() >= 4, "Array must have at least 4 elements"
        Vec4f(x: arr[0], y: arr[1], z: arr[2], w: arr[3])

    static fn zero() -> Vec4f:
        """Zero vector"""
        Vec4f(x: 0.0, y: 0.0, z: 0.0, w: 0.0)

    fn to_array() -> [f32]:
        """Convert to array"""
        [self.x, self.y, self.z, self.w]

    fn get(index: i64) -> f32:
        """Get element by index"""
        match index:
            case 0: self.x
            case 1: self.y
            case 2: self.z
            case 3: self.w
            case _:
                assert false, "Index out of bounds: {index}"
                0.0

    fn set(index: i64, value: f32) -> Vec4f:
        """Set element by index (returns new vector)"""
        match index:
            case 0: Vec4f(x: value, y: self.y, z: self.z, w: self.w)
            case 1: Vec4f(x: self.x, y: value, z: self.z, w: self.w)
            case 2: Vec4f(x: self.x, y: self.y, z: value, w: self.w)
            case 3: Vec4f(x: self.x, y: self.y, z: self.z, w: value)
            case _:
                assert false, "Index out of bounds: {index}"
                self

    fn to_string() -> text:
        """String representation"""
        "Vec4f({self.x}, {self.y}, {self.z}, {self.w})"

struct Vec8f:
    """8-element f32 vector (256-bit AVX register)"""
    e0: f32
    e1: f32
    e2: f32
    e3: f32
    e4: f32
    e5: f32
    e6: f32
    e7: f32

impl Vec8f:
    static fn splat(value: f32) -> Vec8f:
        """Create vector with all elements set to value"""
        Vec8f(
            e0: value, e1: value, e2: value, e3: value,
            e4: value, e5: value, e6: value, e7: value
        )

    static fn from_array(arr: [f32]) -> Vec8f:
        """Create from array (must have 8+ elements)"""
        assert arr.len() >= 8, "Array must have at least 8 elements"
        Vec8f(
            e0: arr[0], e1: arr[1], e2: arr[2], e3: arr[3],
            e4: arr[4], e5: arr[5], e6: arr[6], e7: arr[7]
        )

    static fn zero() -> Vec8f:
        """Zero vector"""
        Vec8f(
            e0: 0.0, e1: 0.0, e2: 0.0, e3: 0.0,
            e4: 0.0, e5: 0.0, e6: 0.0, e7: 0.0
        )

    fn to_array() -> [f32]:
        """Convert to array"""
        [self.e0, self.e1, self.e2, self.e3, self.e4, self.e5, self.e6, self.e7]

    fn get(index: i64) -> f32:
        """Get element by index"""
        match index:
            case 0: self.e0
            case 1: self.e1
            case 2: self.e2
            case 3: self.e3
            case 4: self.e4
            case 5: self.e5
            case 6: self.e6
            case 7: self.e7
            case _:
                assert false, "Index out of bounds: {index}"
                0.0

    fn set(index: i64, value: f32) -> Vec8f:
        """Set element by index (returns new vector)"""
        match index:
            case 0: Vec8f(e0: value, e1: self.e1, e2: self.e2, e3: self.e3, e4: self.e4, e5: self.e5, e6: self.e6, e7: self.e7)
            case 1: Vec8f(e0: self.e0, e1: value, e2: self.e2, e3: self.e3, e4: self.e4, e5: self.e5, e6: self.e6, e7: self.e7)
            case 2: Vec8f(e0: self.e0, e1: self.e1, e2: value, e3: self.e3, e4: self.e4, e5: self.e5, e6: self.e6, e7: self.e7)
            case 3: Vec8f(e0: self.e0, e1: self.e1, e2: self.e2, e3: value, e4: self.e4, e5: self.e5, e6: self.e6, e7: self.e7)
            case 4: Vec8f(e0: self.e0, e1: self.e1, e2: self.e2, e3: self.e3, e4: value, e5: self.e5, e6: self.e6, e7: self.e7)
            case 5: Vec8f(e0: self.e0, e1: self.e1, e2: self.e2, e3: self.e3, e4: self.e4, e5: value, e6: self.e6, e7: self.e7)
            case 6: Vec8f(e0: self.e0, e1: self.e1, e2: self.e2, e3: self.e3, e4: self.e4, e5: self.e5, e6: value, e7: self.e7)
            case 7: Vec8f(e0: self.e0, e1: self.e1, e2: self.e2, e3: self.e3, e4: self.e4, e5: self.e5, e6: self.e6, e7: value)
            case _:
                assert false, "Index out of bounds: {index}"
                self

    fn to_string() -> text:
        """String representation"""
        "Vec8f({self.e0}, {self.e1}, {self.e2}, {self.e3}, {self.e4}, {self.e5}, {self.e6}, {self.e7})"

struct Vec2d:
    """2-element f64 vector (128-bit aligned)"""
    x: f64
    y: f64

impl Vec2d:
    static fn splat(value: f64) -> Vec2d:
        """Create vector with all elements set to value"""
        Vec2d(x: value, y: value)

    static fn from_array(arr: [f64]) -> Vec2d:
        """Create from array (must have 2+ elements)"""
        assert arr.len() >= 2, "Array must have at least 2 elements"
        Vec2d(x: arr[0], y: arr[1])

    static fn zero() -> Vec2d:
        """Zero vector"""
        Vec2d(x: 0.0, y: 0.0)

    fn to_array() -> [f64]:
        """Convert to array"""
        [self.x, self.y]

    fn get(index: i64) -> f64:
        """Get element by index"""
        match index:
            case 0: self.x
            case 1: self.y
            case _:
                assert false, "Index out of bounds: {index}"
                0.0

    fn set(index: i64, value: f64) -> Vec2d:
        """Set element by index (returns new vector)"""
        match index:
            case 0: Vec2d(x: value, y: self.y)
            case 1: Vec2d(x: self.x, y: value)
            case _:
                assert false, "Index out of bounds: {index}"
                self

    fn to_string() -> text:
        """String representation"""
        "Vec2d({self.x}, {self.y})"

struct Vec4d:
    """4-element f64 vector (256-bit AVX register)"""
    x: f64
    y: f64
    z: f64
    w: f64

impl Vec4d:
    static fn splat(value: f64) -> Vec4d:
        """Create vector with all elements set to value"""
        Vec4d(x: value, y: value, z: value, w: value)

    static fn from_array(arr: [f64]) -> Vec4d:
        """Create from array (must have 4+ elements)"""
        assert arr.len() >= 4, "Array must have at least 4 elements"
        Vec4d(x: arr[0], y: arr[1], z: arr[2], w: arr[3])

    static fn zero() -> Vec4d:
        """Zero vector"""
        Vec4d(x: 0.0, y: 0.0, z: 0.0, w: 0.0)

    fn to_array() -> [f64]:
        """Convert to array"""
        [self.x, self.y, self.z, self.w]

    fn get(index: i64) -> f64:
        """Get element by index"""
        match index:
            case 0: self.x
            case 1: self.y
            case 2: self.z
            case 3: self.w
            case _:
                assert false, "Index out of bounds: {index}"
                0.0

    fn set(index: i64, value: f64) -> Vec4d:
        """Set element by index (returns new vector)"""
        match index:
            case 0: Vec4d(x: value, y: self.y, z: self.z, w: self.w)
            case 1: Vec4d(x: self.x, y: value, z: self.z, w: self.w)
            case 2: Vec4d(x: self.x, y: self.y, z: value, w: self.w)
            case 3: Vec4d(x: self.x, y: self.y, z: self.z, w: value)
            case _:
                assert false, "Index out of bounds: {index}"
                self

    fn to_string() -> text:
        """String representation"""
        "Vec4d({self.x}, {self.y}, {self.z}, {self.w})"

# ============================================================================
# Tests
# ============================================================================

fn test_vec2f_create():
    """Test Vec2f creation"""
    val v = Vec2f(x: 1.0, y: 2.0)

    assert v.x == 1.0, "x is 1.0"
    assert v.y == 2.0, "y is 2.0"

    print "âœ… Vec2f creation"

fn test_vec2f_splat():
    """Test Vec2f splat constructor"""
    val v = Vec2f.splat(5.0)

    assert v.x == 5.0, "x is 5.0"
    assert v.y == 5.0, "y is 5.0"

    print "âœ… Vec2f splat"

fn test_vec2f_from_array():
    """Test Vec2f from_array"""
    val arr = [10.0, 20.0]
    val v = Vec2f.from_array(arr)

    assert v.x == 10.0, "x is 10.0"
    assert v.y == 20.0, "y is 20.0"

    print "âœ… Vec2f from_array"

fn test_vec2f_to_array():
    """Test Vec2f to_array"""
    val v = Vec2f(x: 3.0, y: 4.0)
    val arr = v.to_array()

    assert arr.len() == 2, "Array has 2 elements"
    assert arr[0] == 3.0, "First element is 3.0"
    assert arr[1] == 4.0, "Second element is 4.0"

    print "âœ… Vec2f to_array"

fn test_vec2f_get():
    """Test Vec2f element access"""
    val v = Vec2f(x: 7.0, y: 8.0)

    assert v.get(0) == 7.0, "Get x"
    assert v.get(1) == 8.0, "Get y"

    print "âœ… Vec2f get"

fn test_vec4f_create():
    """Test Vec4f creation"""
    val v = Vec4f(x: 1.0, y: 2.0, z: 3.0, w: 4.0)

    assert v.x == 1.0, "x is 1.0"
    assert v.y == 2.0, "y is 2.0"
    assert v.z == 3.0, "z is 3.0"
    assert v.w == 4.0, "w is 4.0"

    print "âœ… Vec4f creation"

fn test_vec4f_splat():
    """Test Vec4f splat constructor"""
    val v = Vec4f.splat(9.0)

    assert v.x == 9.0, "x is 9.0"
    assert v.y == 9.0, "y is 9.0"
    assert v.z == 9.0, "z is 9.0"
    assert v.w == 9.0, "w is 9.0"

    print "âœ… Vec4f splat"

fn test_vec4f_from_array():
    """Test Vec4f from_array"""
    val arr = [10.0, 20.0, 30.0, 40.0]
    val v = Vec4f.from_array(arr)

    assert v.x == 10.0, "x is 10.0"
    assert v.y == 20.0, "y is 20.0"
    assert v.z == 30.0, "z is 30.0"
    assert v.w == 40.0, "w is 40.0"

    print "âœ… Vec4f from_array"

fn test_vec4f_to_array():
    """Test Vec4f to_array"""
    val v = Vec4f(x: 1.0, y: 2.0, z: 3.0, w: 4.0)
    val arr = v.to_array()

    assert arr.len() == 4, "Array has 4 elements"
    assert arr[0] == 1.0, "First element"
    assert arr[1] == 2.0, "Second element"
    assert arr[2] == 3.0, "Third element"
    assert arr[3] == 4.0, "Fourth element"

    print "âœ… Vec4f to_array"

fn test_vec4f_get():
    """Test Vec4f element access"""
    val v = Vec4f(x: 5.0, y: 6.0, z: 7.0, w: 8.0)

    assert v.get(0) == 5.0, "Get x"
    assert v.get(1) == 6.0, "Get y"
    assert v.get(2) == 7.0, "Get z"
    assert v.get(3) == 8.0, "Get w"

    print "âœ… Vec4f get"

fn test_vec8f_create():
    """Test Vec8f creation"""
    val v = Vec8f(
        e0: 1.0, e1: 2.0, e2: 3.0, e3: 4.0,
        e4: 5.0, e5: 6.0, e6: 7.0, e7: 8.0
    )

    assert v.e0 == 1.0, "e0 is 1.0"
    assert v.e7 == 8.0, "e7 is 8.0"

    print "âœ… Vec8f creation"

fn test_vec8f_splat():
    """Test Vec8f splat constructor"""
    val v = Vec8f.splat(3.0)

    assert v.e0 == 3.0, "e0 is 3.0"
    assert v.e7 == 3.0, "e7 is 3.0"

    print "âœ… Vec8f splat"

fn test_vec8f_from_array():
    """Test Vec8f from_array"""
    val arr = [10.0, 20.0, 30.0, 40.0, 50.0, 60.0, 70.0, 80.0]
    val v = Vec8f.from_array(arr)

    assert v.e0 == 10.0, "e0 is 10.0"
    assert v.e7 == 80.0, "e7 is 80.0"

    print "âœ… Vec8f from_array"

fn test_vec8f_to_array():
    """Test Vec8f to_array"""
    val v = Vec8f(
        e0: 1.0, e1: 2.0, e2: 3.0, e3: 4.0,
        e4: 5.0, e5: 6.0, e6: 7.0, e7: 8.0
    )
    val arr = v.to_array()

    assert arr.len() == 8, "Array has 8 elements"
    assert arr[0] == 1.0, "First element"
    assert arr[7] == 8.0, "Last element"

    print "âœ… Vec8f to_array"

fn test_vec2d_create():
    """Test Vec2d creation"""
    val v = Vec2d(x: 1.5, y: 2.5)

    assert v.x == 1.5, "x is 1.5"
    assert v.y == 2.5, "y is 2.5"

    print "âœ… Vec2d creation"

fn test_vec4d_create():
    """Test Vec4d creation"""
    val v = Vec4d(x: 1.5, y: 2.5, z: 3.5, w: 4.5)

    assert v.x == 1.5, "x is 1.5"
    assert v.w == 4.5, "w is 4.5"

    print "âœ… Vec4d creation"

fn test_vec4f_zero():
    """Test Vec4f zero constructor"""
    val v = Vec4f.zero()

    assert v.x == 0.0, "x is 0.0"
    assert v.y == 0.0, "y is 0.0"
    assert v.z == 0.0, "z is 0.0"
    assert v.w == 0.0, "w is 0.0"

    print "âœ… Vec4f zero"

fn main():
    print ""
    print "SIMD Phase 9A Tests"
    print "==================="

    test_vec2f_create()
    test_vec2f_splat()
    test_vec2f_from_array()
    test_vec2f_to_array()
    test_vec2f_get()
    test_vec4f_create()
    test_vec4f_splat()
    test_vec4f_from_array()
    test_vec4f_to_array()
    test_vec4f_get()
    test_vec8f_create()
    test_vec8f_splat()
    test_vec8f_from_array()
    test_vec8f_to_array()
    test_vec2d_create()
    test_vec4d_create()
    test_vec4f_zero()

    print ""
    print "ğŸ‰ Phase 9A Complete!"
    print ""
    print "Implemented:"
    print "  âœ… Vec2f - 2-element f32 vector"
    print "  âœ… Vec4f - 4-element f32 vector (SSE)"
    print "  âœ… Vec8f - 8-element f32 vector (AVX)"
    print "  âœ… Vec2d - 2-element f64 vector"
    print "  âœ… Vec4d - 4-element f64 vector"
    print "  âœ… Constructors - create, splat, from_array, zero"
    print "  âœ… Conversions - to_array, get, set"
    print "  âœ… String representation"
    print ""
    print "Progress: 1/4 hours (25% of Phase 9)"
    print "Next: Phase 9B - SIMD Operations (1.5h)"
