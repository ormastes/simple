# Collection Matchers - include, be_empty
# Array, List, Dict, Set matchers

import matchers.{Matcher, MatchResult}

# Include matcher: expect [1,2,3] to include 2
export class IncludeMatcher[T]:
    expected: T
    
    fn new(expected: T) -> IncludeMatcher[T]:
        return IncludeMatcher { expected: expected }

impl[T, C] Matcher[C] for IncludeMatcher[T] where C: Collection[T]:
    fn match(self, actual: C) -> MatchResult:
        if actual.contains(self.expected):
            return MatchResult.success()
        else:
            return MatchResult.failure(
                "Expected ${actual} to include ${self.expected}"
            )

export fn include[T](expected: T) -> IncludeMatcher[T]:
    return IncludeMatcher.new(expected)

# Empty matcher: expect [] to be_empty
export class BeEmptyMatcher:
    fn new() -> BeEmptyMatcher:
        return BeEmptyMatcher {}

impl[C] Matcher[C] for BeEmptyMatcher where C: Collection[Any]:
    fn match(self, actual: C) -> MatchResult:
        if actual.is_empty():
            return MatchResult.success()
        else:
            return MatchResult.failure(
                "Expected collection to be empty but it has ${actual.len()} items"
            )

export fn be_empty() -> BeEmptyMatcher:
    return BeEmptyMatcher.new()
