# Test: Pattern Match Safety
# Tests exhaustiveness checking for tagged unions and enums

# Define a tagged union type
union Shape:
    Circle(radius: f64)
    Rectangle(width: f64, height: f64)
    Triangle(a: f64, b: f64, c: f64)

# Define a simple enum
enum Color:
    Red
    Green
    Blue

# Define Result-like union
union Result:
    Ok(value: i64)
    Err(message: str)

# Test 1: Exhaustive match (all variants covered)
fn test_exhaustive_shape(shape: Shape) -> f64:
    match shape:
        Shape.Circle(r) => 3.14159 * r * r
        Shape.Rectangle(w, h) => w * h
        Shape.Triangle(a, b, c) =>
            let s = (a + b + c) / 2.0
            return (s * (s - a) * (s - b) * (s - c)) ** 0.5

# Test 2: Exhaustive match with wildcard
fn test_with_wildcard(color: Color) -> str:
    match color:
        Color.Red => "red"
        _ => "not red"

# Test 3: Non-exhaustive match (missing variant) - should warn
fn test_non_exhaustive(color: Color) -> str:
    match color:
        Color.Red => "red"
        Color.Green => "green"
        # Missing Blue - runtime will fail if Blue is passed

# Test 4: Result pattern matching
fn test_result(result: Result) -> str:
    match result:
        Result.Ok(val) => "Success: " + str(val)
        Result.Err(msg) => "Error: " + msg

# Test 5: Unreachable arm (after wildcard)
fn test_unreachable(color: Color) -> str:
    match color:
        Color.Red => "red"
        _ => "other"
        Color.Blue => "blue"  # Unreachable!

# Test 6: Strong enum (no wildcards allowed)
#[strong]
enum StrictColor:
    Red
    Green
    Blue

fn test_strong_enum(c: StrictColor) -> str:
    match c:
        StrictColor.Red => "red"
        StrictColor.Green => "green"
        StrictColor.Blue => "blue"

# Test 7: Guards with exhaustive patterns
fn test_with_guard(n: i64) -> str:
    match n:
        x if x < 0 => "negative"
        x if x > 0 => "positive"
        _ => "zero"

# Main test runner
fn main():
    # Test exhaustive matches
    let circle = Shape.Circle(5.0)
    let area = test_exhaustive_shape(circle)
    print("Circle area: " + str(area))
    
    # Test with wildcard
    let color = Color.Red
    print("Color test: " + test_with_wildcard(color))
    
    # Test result
    let ok_result = Result.Ok(42)
    print("Result test: " + test_result(ok_result))
    
    # Test strong enum
    let strict = StrictColor.Blue
    print("Strict color: " + test_strong_enum(strict))
    
    # Test with guard
    print("Guard test: " + test_with_guard(-5))
    
    print("All tests passed!")
