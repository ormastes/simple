# Test to verify resource limit protection works
# This test consumes memory to trigger the 90% threshold

use std.spec.{describe, it, expect}

describe "Resource Limit Protection":
    it "should trigger shutdown when memory exceeds threshold":
        # Allocate large arrays to consume memory
        var arrays: [[i64]] = []

        # Allocate ~100MB of data (100 arrays of 125000 i64s each)
        # Each i64 = 8 bytes, so 125000 * 8 = 1MB per array
        var i = 0
        while i < 100:
            var arr: [i64] = []
            var j = 0
            while j < 125000:
                arr.push(j)
                j = j + 1
            arrays.push(arr)
            i = i + 1

        # Verify we allocated memory
        expect(arrays.len()).to_equal(100)

    it "normal test 1":
        expect(1 + 1).to_equal(2)

    it "normal test 2":
        expect(2 + 2).to_equal(4)

    it "normal test 3":
        expect(3 + 3).to_equal(6)
