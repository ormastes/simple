# Electron Global Shortcuts API
# Register global keyboard shortcuts

# External FFI declarations
extern fn electron_shortcuts_register(accelerator: String, callback_id: i64): bool
extern fn electron_shortcuts_unregister(accelerator: String): void
extern fn electron_shortcuts_is_registered(accelerator: String): bool
extern fn electron_shortcuts_unregister_all(): void

# Callback registry
let shortcut_callbacks: Dict<String, fn(): void> = {}
let next_callback_id: i64 = 0

# Register global shortcut
pub fn register(accelerator: String, handler: fn(): void): bool =
    """Register a global keyboard shortcut.

    Args:
        accelerator: Shortcut string (e.g., "Ctrl+X", "Cmd+Shift+F")
        handler: Function to call when shortcut pressed

    Returns:
        true if registration successful, false if already registered

    Accelerator format:
    - Modifiers: Ctrl, Cmd, Alt, Shift, Option, Super
    - Keys: A-Z, 0-9, F1-F24, Plus, Space, Tab, etc.
    - Combine with +

    Examples:
        shortcuts.register("Ctrl+Shift+X", fn():
            print("Shortcut pressed!")
        )

        shortcuts.register("Cmd+Alt+P", take_screenshot)

        # Media keys
        shortcuts.register("MediaPlayPause", toggle_playback)
    """
    # Store callback
    let callback_id = next_callback_id
    next_callback_id = next_callback_id + 1

    shortcut_callbacks[accelerator] = handler

    # Register with Electron
    electron_shortcuts_register(accelerator, callback_id)

# Unregister shortcut
pub fn unregister(accelerator: String):
    """Unregister a global shortcut.

    Example:
        shortcuts.unregister("Ctrl+X")
    """
    if shortcut_callbacks.has_key(accelerator):
        shortcut_callbacks.remove(accelerator)

    electron_shortcuts_unregister(accelerator)

# Check if shortcut is registered
pub fn is_registered(accelerator: String): bool =
    """Check if a shortcut is currently registered."""
    electron_shortcuts_is_registered(accelerator)

# Unregister all shortcuts
pub fn unregister_all():
    """Unregister all global shortcuts."""
    shortcut_callbacks.clear()
    electron_shortcuts_unregister_all()

# Trigger callback from FFI
pub fn _trigger_callback(accelerator: String):
    """Internal: Called by FFI when shortcut pressed."""
    if shortcut_callbacks.has_key(accelerator):
        handler = shortcut_callbacks[accelerator]
        handler()
