# Multi-Language Tooling Tests

import std.spec
use tooling.core.project.{Language, ProjectDetector, ProjectContext, LanguageConfig}
use tooling.testing.discovery.{TestDiscovery, TestSuite}
use tooling.testing.runner.{TestRunner, TestConfig, TestRunResult}

describe "ProjectDetector":
    context "when detecting languages":
        it "creates detector for root path":
            let detector = ProjectDetector.new(".")
            expect(detector.root).to_equal(".")

        it "detects language configurations":
            let detector = ProjectDetector.new(".")
            let configs = detector.detect_all_languages()
            # Should find at least Simple language in current project
            expect(configs.len()).to_be_greater_than_or_equal(0)

describe "TestDiscovery":
    context "when discovering tests":
        it "creates test discovery for root path":
            let discovery = TestDiscovery.new(".")
            expect(discovery.root).to_equal(".")

        it "can set verbose mode":
            let discovery = TestDiscovery.new(".")
            discovery.set_verbose(true)
            expect(discovery.verbose).to_be_true()

        it "discovers test suites by language":
            let discovery = TestDiscovery.new(".")
            let suites = discovery.discover_by_language(Language::Simple)
            # Should return list (may be empty if no tests found)
            expect(suites).to_be_instance_of(List[TestSuite])

describe "TestRunner":
    context "when running tests":
        it "creates test runner for root path":
            let runner = TestRunner.new(".")
            expect(runner.project.config.root).to_equal(".")

        it "can configure parallel execution":
            let runner = TestRunner.new(".")
            runner.set_parallel(true)
            expect(runner.config.parallel).to_be_true()

        it "can configure fail-fast mode":
            let runner = TestRunner.new(".")
            runner.set_fail_fast(true)
            expect(runner.config.fail_fast).to_be_true()

        it "can configure verbose output":
            let runner = TestRunner.new(".")
            runner.set_verbose(true)
            expect(runner.config.verbose).to_be_true()

        it "can configure coverage collection":
            let runner = TestRunner.new(".")
            runner.set_coverage(true)
            expect(runner.config.coverage).to_be_true()

describe "TestRunResult":
    context "when checking test results":
        it "creates empty result":
            let result = TestRunResult.new()
            expect(result.total_tests).to_equal(0)
            expect(result.passed).to_equal(0)
            expect(result.failed).to_equal(0)
            expect(result.skipped).to_equal(0)

        it "reports success when no failures":
            let result = TestRunResult.new()
            result.total_tests = 10
            result.passed = 10
            result.failed = 0
            expect(result.is_success()).to_be_true()

        it "reports failure when tests failed":
            let result = TestRunResult.new()
            result.total_tests = 10
            result.passed = 8
            result.failed = 2
            expect(result.is_success()).to_be_false()

        it "generates summary string":
            let result = TestRunResult.new()
            result.total_tests = 10
            result.passed = 10
            result.failed = 0
            let summary = result.summary()
            # Summary should contain test counts
            expect(summary).to_contain("10")

describe "LanguageConfig":
    context "when configuring languages":
        it "creates configuration for language":
            let config = LanguageConfig.new(Language::Simple, ".")
            expect(config.language).to_equal(Language::Simple)
            expect(config.root).to_equal(".")

        it "has default source directories":
            let config = LanguageConfig.new(Language::Rust, "./lib")
            expect(config.source_dirs).to_contain("src")

        it "has default exclude patterns":
            let config = LanguageConfig.new(Language::Python, ".")
            expect(config.exclude_patterns).to_contain("target")
            expect(config.exclude_patterns).to_contain("node_modules")

describe "ProjectContext":
    context "when working with project context":
        it "creates project context for root":
            let project = ProjectContext.new(".")
            expect(project.config.root).to_equal(".")

        it "has detected languages":
            let project = ProjectContext.new(".")
            # Should have some languages detected
            expect(project.languages).to_be_instance_of(List[LanguageConfig])

        it "can check if language is present":
            let project = ProjectContext.new(".")
            # May or may not have Simple, but method should work
            let has_simple = project.has_language(Language::Simple)
            expect(has_simple).to_be_instance_of(bool)

        it "returns build directory":
            let project = ProjectContext.new(".")
            let build_dir = project.get_build_dir()
            expect(build_dir).to_equal("target")

        it "returns test directory":
            let project = ProjectContext.new(".")
            let test_dir = project.get_test_dir()
            expect(test_dir).to_equal("tests")

describe "Multi-Language Tooling":
    context "Project Detection":
        skip "detects Simple projects":
            pass
        skip "detects multi-language projects":
            pass
        skip "validates project configuration":
            pass
    context "Incremental Compilation":
        skip "tracks file changes":
            pass
        skip "detects file modifications":
            pass
        skip "identifies files needing recompilation":
            pass
    context "Dependency Tracking":
        skip "builds dependency graph":
            pass
        skip "detects circular dependencies":
            pass
        skip "computes topological order":
            pass
    context "Error Aggregation":
        skip "collects errors from multiple languages":
            pass
        skip "normalizes error formats":
            pass
        skip "groups errors by file":
            pass
    context "Test Runner":
        skip "creates test configuration":
            pass
        skip "configures parallel execution":
            pass
        skip "creates test result":
            pass
        skip "generates test summary":
            pass
    context "Deployment Pipeline":
        skip "creates deployment pipeline":
            pass
        skip "adds pipeline stages":
            pass
        skip "executes pipeline stages":
            pass
    context "Compilation Modes":
        skip "supports debug mode":
            pass
        skip "supports release mode":
            pass
    context "Language Support":
        skip "recognizes all supported languages":
            pass
        skip "converts language to string":
            pass
    context "Compilation Results":
        skip "creates successful compilation result":
            pass
        skip "creates failed compilation result":
            pass
    context "Integration":
        skip "builds multi-language project":
            pass
        skip "runs multi-language tests":
            pass
        skip "deploys multi-language project":
            pass
