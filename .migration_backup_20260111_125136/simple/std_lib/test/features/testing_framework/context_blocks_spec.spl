# Context Blocks Feature Specification
# Feature #181: BDD context blocks for nested grouping
# Category: Testing Framework | Difficulty: 2 | Status: Complete

# =====================================================
# Feature Metadata
# =====================================================

class FeatureMetadata:
    id: Int
    name: String
    category: String
    difficulty: Int
    status: String
    impl_type: String
    spec_ref: String
    files: List<String>
    tests: List<String>
    description: String
    code_examples: List<String>
    dependencies: List<Int>
    required_by: List<Int>
    notes: String

# Feature Definition
let FEATURE = FeatureMetadata {
    id: 181,
    name: 'Context Blocks',
    category: 'Testing Framework',
    difficulty: 2,
    status: 'Complete',
    impl_type: 'Simple',
    spec_ref: 'doc/spec/testing/testing_bdd_framework.md',
    files: [
        'simple/std_lib/src/spec/dsl.spl'
    ],
    tests: [
        'simple/std_lib/test/system/spec/spec_framework_spec.spl'
    ],
    description: 'BDD context blocks for creating nested example groups. Provides conditional grouping with when/with semantics for test organization.',
    code_examples: [],
    dependencies: [180],
    required_by: [182],
    notes: 'Alias for nested describe. Supports context composition and reusable context definitions.'
}

# =====================================================
# BDD Specification Tests
# =====================================================

print('============================================================')
print('  CONTEXT BLOCKS FEATURE SPECIFICATION (#181)')
print('  Category: Testing Framework | Difficulty: 2 | Status: Complete')
print('============================================================')
print('')

let mut passed = 0
let mut failed = 0

# -----------------------------------------------------
# Nested Grouping
# -----------------------------------------------------

print('describe Nested grouping:')
print('  context creates nested groups:')
print('    it nests inside describe:')

struct ContextGroup:
    name: String
    parent_name: String
    depth: i64

fn create_context(name: String, parent: String, depth: i64) -> ContextGroup:
    return ContextGroup { name: name, parent_name: parent, depth: depth }

let ctx = create_context("when logged in", "User", 1)
if ctx.parent_name == "User" and ctx.depth == 1:
    print('      [PASS] nests inside describe')
    passed = passed + 1
else:
    print('      [FAIL] nests inside describe')
    failed = failed + 1

print('    it supports deep nesting:')

let deep_ctx = create_context("with valid data", "when logged in", 2)
if deep_ctx.depth == 2:
    print('      [PASS] deep nesting')
    passed = passed + 1
else:
    print('      [FAIL] deep nesting')
    failed = failed + 1

# -----------------------------------------------------
# When/With Semantics
# -----------------------------------------------------

print('')
print('describe When/With semantics:')
print('  context naming conventions:')
print('    it uses when for conditions:')

let when_ctx = create_context("when user is admin", "Permissions", 1)
if when_ctx.name == "when user is admin":
    print('      [PASS] when for conditions')
    passed = passed + 1
else:
    print('      [FAIL] when for conditions')
    failed = failed + 1

print('    it uses with for fixtures:')

let with_ctx = create_context("with database connection", "Repository", 1)
if with_ctx.name == "with database connection":
    print('      [PASS] with for fixtures')
    passed = passed + 1
else:
    print('      [FAIL] with for fixtures')
    failed = failed + 1

# -----------------------------------------------------
# Context Inheritance
# -----------------------------------------------------

print('')
print('describe Context inheritance:')
print('  context inherits parent scope:')
print('    it accesses parent values:')

let parent_val = 100
let child_val = parent_val + 50
if child_val == 150:
    print('      [PASS] accesses parent values')
    passed = passed + 1
else:
    print('      [FAIL] accesses parent values')
    failed = failed + 1

print('    it can override values:')

let base = 10
fn get_child_value() -> i64:
    let base = 20
    return base

if get_child_value() == 20:
    print('      [PASS] can override values')
    passed = passed + 1
else:
    print('      [FAIL] can override values')
    failed = failed + 1

# -----------------------------------------------------
# Context Composition
# -----------------------------------------------------

print('')
print('describe Context composition:')
print('  context composes multiple contexts:')
print('    it combines context definitions:')

struct ComposedContext:
    contexts: List<String>

let composed = ComposedContext { contexts: ["admin_user", "with_database"] }
if composed.contexts.len() == 2:
    print('      [PASS] combines contexts')
    passed = passed + 1
else:
    print('      [FAIL] combines contexts')
    failed = failed + 1

print('    it applies all fixtures:')

fn apply_fixtures(ctx_names: List<String>) -> i64:
    return ctx_names.len()

if apply_fixtures(["ctx1", "ctx2", "ctx3"]) == 3:
    print('      [PASS] applies all fixtures')
    passed = passed + 1
else:
    print('      [FAIL] applies all fixtures')
    failed = failed + 1

# =====================================================
# Documentation Output
# =====================================================

print('')
print('============================================================')
print('  GENERATED DOCUMENTATION')
print('============================================================')
print('')
print('# Context Blocks')
print('')
print("**Feature ID:** #181")
print("**Category:** Testing Framework")
print("**Difficulty:** Level 2/5")
print("**Status:** Complete")
print("**Implementation:** Simple")
print('')
print('## Description')
print('')
print(FEATURE.description)
print('')
print('## Usage Example')
print('')
print('```simple')
print('describe "User":')
print('    context "when logged in":')
print('        it "shows dashboard":')
print('            expect(user.dashboard).to be_visible')
print('')
print('    context "when admin":')
print('        it "shows admin panel":')
print('            expect(user.admin_panel).to be_visible')
print('```')
print('')
print('## Notes')
print('')
print(FEATURE.notes)

# Summary
print('')
print('============================================================')
print('  TEST SUMMARY')
print('============================================================')
let total = passed + failed
print("Passed: {passed}")
print("Failed: {failed}")
print("Total:  {total}")
if failed == 0:
    print('All tests PASSED!')
print('============================================================')
