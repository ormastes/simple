# Data Types for PyTorch
#
# Tensor data type enumeration.

export DType, dtype_code


# ============================================================================
# Data Type Enum
# ============================================================================

enum DType:
    Float32   # 32-bit floating point
    Float64   # 64-bit floating point
    Int32     # 32-bit integer
    Int64     # 64-bit integer

impl DType:
    # =========================================================================
    # Helper Methods
    # =========================================================================

    pub fn is_float(self) -> Bool:
        """Check if dtype is a floating-point type.

        Returns:
            true for Float32 or Float64

        Example:
            DType::Float32.is_float()  # → true
            DType::Int32.is_float()  # → false
        """
        match self:
            DType::Float32: true
            DType::Float64: true
            _: false

    pub fn is_int(self) -> Bool:
        """Check if dtype is an integer type.

        Returns:
            true for Int32 or Int64

        Example:
            DType::Int32.is_int()  # → true
            DType::Float32.is_int()  # → false
        """
        match self:
            DType::Int32: true
            DType::Int64: true
            _: false

    pub fn is_32bit(self) -> Bool:
        """Check if dtype is 32-bit precision.

        Returns:
            true for Float32 or Int32

        Example:
            DType::Float32.is_32bit()  # → true
            DType::Float64.is_32bit()  # → false
        """
        match self:
            DType::Float32: true
            DType::Int32: true
            _: false

    pub fn is_64bit(self) -> Bool:
        """Check if dtype is 64-bit precision.

        Returns:
            true for Float64 or Int64

        Example:
            DType::Float64.is_64bit()  # → true
            DType::Float32.is_64bit()  # → false
        """
        match self:
            DType::Float64: true
            DType::Int64: true
            _: false

    pub fn byte_size(self) -> Int:
        """Get size of dtype in bytes.

        Returns:
            4 for 32-bit types, 8 for 64-bit types

        Example:
            DType::Float32.byte_size()  # → 4
            DType::Float64.byte_size()  # → 8
        """
        if self.is_32bit():
            return 4
        else:
            return 8

    pub fn bit_size(self) -> Int:
        """Get size of dtype in bits.

        Returns:
            32 for 32-bit types, 64 for 64-bit types

        Example:
            DType::Int32.bit_size()  # → 32
            DType::Int64.bit_size()  # → 64
        """
        if self.is_32bit():
            return 32
        else:
            return 64

    pub fn is_signed(self) -> Bool:
        """Check if dtype supports negative values.

        Returns:
            true for all current dtypes (all are signed)

        Example:
            DType::Int32.is_signed()  # → true
        """
        return true

    pub fn name(self) -> String:
        """Get human-readable name of dtype.

        Returns:
            String name of the dtype

        Example:
            DType::Float32.name()  # → "Float32"
        """
        match self:
            DType::Float32: "Float32"
            DType::Float64: "Float64"
            DType::Int32: "Int32"
            DType::Int64: "Int64"

    pub fn summary(self) -> String:
        """Get summary of dtype with details.

        Returns:
            Human-readable summary

        Example:
            DType::Float32.summary()
            # → "DType: Float32 (32-bit floating-point, 4 bytes)"
        """
        let name = self.name()
        let bits = self.bit_size()
        let bytes = self.byte_size()
        let kind = if self.is_float(): "floating-point" else: "integer"
        return "DType: {name} ({bits}-bit {kind}, {bytes} bytes)"

    pub fn max_value(self) -> Float:
        """Get approximate maximum value for dtype.

        Returns:
            Maximum representable value (approximate for floats)

        Example:
            DType::Float32.max_value()  # → ~3.4e38
            DType::Int32.max_value()  # → 2147483647
        """
        match self:
            DType::Float32: 3.4028235e38
            DType::Float64: 1.7976931348623157e308
            DType::Int32: 2147483647.0
            DType::Int64: 9223372036854775807.0

    pub fn min_value(self) -> Float:
        """Get approximate minimum value for dtype.

        Returns:
            Minimum representable value (negative for signed types)

        Example:
            DType::Float32.min_value()  # → ~-3.4e38
            DType::Int32.min_value()  # → -2147483648
        """
        match self:
            DType::Float32: -3.4028235e38
            DType::Float64: -1.7976931348623157e308
            DType::Int32: -2147483648.0
            DType::Int64: -9223372036854775808.0

    pub fn can_represent(self, value: Float) -> Bool:
        """Check if a value can be represented by this dtype.

        Args:
            value: Value to check

        Returns:
            true if value is within range

        Example:
            DType::Int32.can_represent(1000.0)  # → true
            DType::Int32.can_represent(1e20)  # → false
        """
        return value >= self.min_value() and value <= self.max_value()

    pub fn is_wider_than(self, other: DType) -> Bool:
        """Check if this dtype has more precision than another.

        Args:
            other: DType to compare against

        Returns:
            true if this dtype has more bits

        Example:
            DType::Float64.is_wider_than(DType::Float32)  # → true
            DType::Int32.is_wider_than(DType::Int64)  # → false
        """
        return self.bit_size() > other.bit_size()

# DType helper functions
fn dtype_code(dtype: DType) -> i32:
    """Convert dtype to FFI dtype code.

    Args:
        dtype: DType enum instance

    Returns:
        Dtype code (0=Float32, 1=Float64, 2=Int32, 3=Int64)
    """
    match dtype:
        DType::Float32 -> 0
        DType::Float64 -> 1
        DType::Int32 -> 2
        DType::Int64 -> 3
