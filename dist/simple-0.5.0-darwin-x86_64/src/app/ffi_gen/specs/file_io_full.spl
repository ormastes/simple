# File I/O Full Module - FFI Spec
#
# Complete file I/O operations for the Simple runtime.
# Generates build/rust/ffi_gen/src/file_io.rs
#
# Usage: simple ffi-gen --gen-module src/app/ffi_gen/specs/file_io_full.spl

use app.ffi_gen.intern_codegen (InternFnSpec, InternParamSpec)

fn file_io_full_specs() -> [InternFnSpec]:
    var specs: [InternFnSpec] = []

    # =========================================================================
    # Basic File Operations
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_file_exists", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String")],
        return_type: "bool", runtime_fn: "rt_file_exists",
        doc: "Check if file exists"
    ))

    specs.push(InternFnSpec(
        name: "rt_file_read_text", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String")],
        return_type: "String", runtime_fn: "rt_file_read_text",
        doc: "Read entire file as text"
    ))

    specs.push(InternFnSpec(
        name: "rt_file_write_text", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String"),
                 InternParamSpec(name: "content", value_type: "String")],
        return_type: "bool", runtime_fn: "rt_file_write_text",
        doc: "Write text to file (overwrite)"
    ))

    specs.push(InternFnSpec(
        name: "rt_file_copy", category: "file_io",
        params: [InternParamSpec(name: "src", value_type: "String"),
                 InternParamSpec(name: "dst", value_type: "String")],
        return_type: "bool", runtime_fn: "rt_file_copy",
        doc: "Copy file from src to dst"
    ))

    specs.push(InternFnSpec(
        name: "rt_file_delete", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String")],
        return_type: "bool", runtime_fn: "rt_file_delete",
        doc: "Delete file"
    ))

    specs.push(InternFnSpec(
        name: "rt_file_remove", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String")],
        return_type: "bool", runtime_fn: "rt_file_remove",
        doc: "Remove file (alias for delete)"
    ))

    # =========================================================================
    # Extended File Operations
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_file_atomic_write", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String"),
                 InternParamSpec(name: "content", value_type: "String")],
        return_type: "bool", runtime_fn: "rt_file_atomic_write",
        doc: "Write to temp file then rename (atomic)"
    ))

    specs.push(InternFnSpec(
        name: "rt_file_append_text", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String"),
                 InternParamSpec(name: "content", value_type: "String")],
        return_type: "bool", runtime_fn: "rt_file_append_text",
        doc: "Append text to file"
    ))

    specs.push(InternFnSpec(
        name: "rt_file_modified_time", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String")],
        return_type: "i64", runtime_fn: "rt_file_modified_time",
        doc: "Get file modification time as unix microseconds"
    ))

    specs.push(InternFnSpec(
        name: "rt_file_hash_sha256", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String")],
        return_type: "String", runtime_fn: "rt_file_hash_sha256",
        doc: "Calculate SHA256 hash of file"
    ))

    specs.push(InternFnSpec(
        name: "rt_file_read_lines", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String")],
        return_type: "Value", runtime_fn: "rt_file_read_lines",
        doc: "Read file as array of lines"
    ))

    specs.push(InternFnSpec(
        name: "rt_file_size", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String")],
        return_type: "i64", runtime_fn: "rt_file_size",
        doc: "Get file size in bytes"
    ))

    # =========================================================================
    # File Locking
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_file_lock", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String"),
                 InternParamSpec(name: "timeout_secs", value_type: "i64")],
        return_type: "i64", runtime_fn: "rt_file_lock",
        doc: "Acquire file lock, returns handle (>0) or -1 on failure"
    ))

    specs.push(InternFnSpec(
        name: "rt_file_unlock", category: "file_io",
        params: [InternParamSpec(name: "handle", value_type: "i64")],
        return_type: "bool", runtime_fn: "rt_file_unlock",
        doc: "Release file lock by handle"
    ))

    # =========================================================================
    # Aliases
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_read_file", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String")],
        return_type: "String", runtime_fn: "rt_read_file",
        doc: "Read file (alias for rt_file_read_text)"
    ))

    specs.push(InternFnSpec(
        name: "rt_write_file", category: "file_io",
        params: [InternParamSpec(name: "path", value_type: "String"),
                 InternParamSpec(name: "content", value_type: "String")],
        return_type: "bool", runtime_fn: "rt_write_file",
        doc: "Write file (alias for rt_file_write_text)"
    ))

    specs
