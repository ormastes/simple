# Package Utilities - Shared helpers for package management
# Used by: install, update, lock commands

export generate_lockfile_content, parse_deps_from_sdn

# Generate lockfile content from dependency list
fn generate_lockfile_content(deps: [(text, text)]) -> text:
    var parts = [
        "# Generated by Simple Package Manager",
        "# Do not edit manually",
        "",
        "lockfile_version: 1",
        "generated: 2026-02-03T00:00:00Z",
        "",
        "packages |name, version, source, checksum, deps|"
    ]
    for (name, version) in deps:
        val ver = if version == "*": "0.0.0" else: version.trim_start("^").trim_start("~").trim_start(">=")
        parts.push("  {name}, {ver}, registry, sha256:0000000000000000000000000000000000000000000000000000000000000000, []")
    parts.join("\n") + "\n"

# Parse dependencies from SDN manifest content
fn parse_deps_from_sdn(content: text) -> [(text, text)]:
    val lines = content.split("\n")
    var deps = []
    var in_deps = false

    for line in lines:
        val trimmed = line.trim()
        if trimmed == "dependencies:" or trimmed == "dev_dependencies:":
            in_deps = true
        elif in_deps:
            if trimmed == "" or (not line.starts_with("  ") and not line.starts_with("\t")):
                in_deps = false
            elif trimmed.contains(":"):
                val parts = trimmed.split(":")
                if parts.len() >= 2:
                    val name = parts[0].trim()
                    val version = parts[1].trim()
                    if name != "" and not name.contains(" "):
                        deps.push((name, version))
    deps
