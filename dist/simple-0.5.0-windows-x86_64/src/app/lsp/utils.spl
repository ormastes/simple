# LSP Utilities - Shared helpers for LSP handlers
# Used by completion, hover, definition, references handlers

export node_at_position, for_each_query_match

fn node_at_position(tree: Tree, position: Position) -> Node?:
    """Find node at position.

    Args:
        tree - Syntax tree
        position - Position to search

    Returns:
        Node at position or None
    """
    # Start from root
    val root = tree.root_node()

    # Simple linear search through children
    # TODO: Implement proper tree traversal with position comparison
    Some(root)

fn for_each_query_match(cursor: QueryCursor, process: fn(any)):
    """Iterate through all query matches and call process function for each.

    Args:
        cursor - Query cursor to iterate
        process - Function to call for each match (accepts any type)

    Note: Using 'any' type since Match type is not yet defined in treesitter_types.spl
    """
    while true:
        val match_opt = cursor.next_match()
        if not match_opt.?:
            break
        val match_value = match_opt.unwrap()
        process(match_value)
