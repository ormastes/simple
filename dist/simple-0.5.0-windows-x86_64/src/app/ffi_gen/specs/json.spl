# JSON Module - Intern FFI Spec
#
# JSON parsing and serialization using serde_json.
# Generates interpreter_extern/json.rs boilerplate.
#
# Supports the extern functions declared in src/std/json.spl:
# - json_parse(text) -> Result<JsonValue, SimpleError>
# - json_serialize(JsonValue) -> text
# - json_pretty(JsonValue, indent) -> text
# - parse_int(text) -> i64?
#
# Usage: simple sffi-gen --gen-intern src/app/ffi_gen/specs/json.spl

use app.ffi_gen.intern_codegen (InternFnSpec, InternParamSpec)

fn json_specs() -> [InternFnSpec]:
    var specs: [InternFnSpec] = []

    # --- JSON parsing ---

    specs.push(InternFnSpec(
        name: "json_parse", category: "json",
        params: [InternParamSpec(name: "text", value_type: "String")],
        return_type: "Value", runtime_fn: "json_parse",
        doc: "Parse JSON text to JsonValue (RuntimeValue)"
    ))

    # --- JSON serialization ---

    specs.push(InternFnSpec(
        name: "json_serialize", category: "json",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "String", runtime_fn: "json_serialize",
        doc: "Serialize JsonValue to compact JSON text"
    ))

    specs.push(InternFnSpec(
        name: "json_pretty", category: "json",
        params: [InternParamSpec(name: "value", value_type: "Value"),
                 InternParamSpec(name: "indent", value_type: "i64")],
        return_type: "String", runtime_fn: "json_pretty",
        doc: "Serialize JsonValue to pretty-printed JSON"
    ))

    # --- Utilities ---

    specs.push(InternFnSpec(
        name: "parse_int", category: "json",
        params: [InternParamSpec(name: "text", value_type: "String")],
        return_type: "Value", runtime_fn: "parse_int",
        doc: "Parse integer from text, returns Option<i64>"
    ))

    specs

export json_specs
