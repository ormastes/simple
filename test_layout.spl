# Quick test for layout.spl

import tooling.compiler.layout.{TypeId, StructLayout}

fn test_type_sizes():
    print "Testing type sizes..."
    
    val i32_ty = TypeId.I32()
    val (size, align) = StructLayout.type_size_align(i32_ty)
    assert size == 4
    assert align == 4
    print "  I32: size={size}, align={align} ✓"
    
    val i64_ty = TypeId.I64()
    val (size2, align2) = StructLayout.type_size_align(i64_ty)
    assert size2 == 8
    assert align2 == 8
    print "  I64: size={size2}, align={align2} ✓"

fn test_padding():
    import tooling.compiler.layout.{StructLayout}
    print "Testing padding computation..."
    
    val pad1 = StructLayout.compute_padding(1, 4)
    assert pad1 == 3
    print "  Padding(1, 4) = {pad1} ✓"
    
    val pad2 = StructLayout.compute_padding(8, 4)
    assert pad2 == 0
    print "  Padding(8, 4) = {pad2} ✓"

fn test_simple_struct():
    import tooling.compiler.layout.{TypeId, StructLayout}
    print "Testing simple struct layout..."
    
    val fields = [
        ("x", TypeId.I32()),
        ("y", TypeId.I32())
    ]
    
    val layout = StructLayout.new(
        name: "Point2D",
        fields: fields,
        has_vtable: false,
        type_id: 1
    )
    
    print "  Struct: {layout.name}"
    print "  Size: {layout.size}, Alignment: {layout.alignment}"
    print "  Field count: {layout.fields.length()}"
    
    assert layout.size == 8
    assert layout.alignment == 4
    assert layout.fields.length() == 2
    
    print "  Layout computed correctly ✓"

fn main():
    test_type_sizes()
    test_padding()
    test_simple_struct()
    print ""
    print "All layout tests passed! ✓"
