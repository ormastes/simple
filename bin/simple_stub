#!/bin/sh
# Simple Settlement Stub - Written in Simple
#
# This wrapper script runs the Simple stub app using the Rust runtime.
# The actual stub implementation is in src/app/stub/main.spl

SCRIPT_DIR="$(cd "$(dirname "$0")/.." && pwd)"

# Find the runtime binary (prioritize bin/ first, then bin/bootstrap/)
if [ -n "$SIMPLE_RUNTIME_PATH" ] && [ -x "$SIMPLE_RUNTIME_PATH" ]; then
    RUNTIME="$SIMPLE_RUNTIME_PATH"
elif [ -x "$SCRIPT_DIR/bin/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/bin/simple_runtime"
elif [ -x "$SCRIPT_DIR/bin/bootstrap/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/bin/bootstrap/simple_runtime"
elif [ -x "$SCRIPT_DIR/rust/target/release/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/rust/target/release/simple_runtime"
elif [ -x "$SCRIPT_DIR/rust/target/debug/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/rust/target/debug/simple_runtime"
elif [ -x "$SCRIPT_DIR/rust/target/bootstrap/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/rust/target/bootstrap/simple_runtime"
else
    echo "error: simple_runtime not found." >&2
    echo "  Looked in:" >&2
    echo "    - bin/simple_runtime (development/release)" >&2
    echo "    - bin/bootstrap/simple_runtime (minimal bootstrap)" >&2
    echo "    - rust/target/{release,debug,bootstrap}/simple_runtime" >&2
    echo "  Run 'simple build --release' or 'simple build --bootstrap'." >&2
    exit 1
fi

# Run the Simple stub app
exec "$RUNTIME" "$SCRIPT_DIR/src/app/stub/main.spl" "$@"
