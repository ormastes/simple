#!/bin/sh
# Simple Language CLI
#
# Default CLI entry point â€” runs the Simple-language implementation.
# The core runtime is implemented in Rust (simple_runtime).
# The CLI and tools are implemented in Simple (src/app/).

SCRIPT_DIR="$(cd "$(dirname "$0")/../.." && pwd)"

# Find the runtime binary
if [ -n "$SIMPLE_RUNTIME_PATH" ] && [ -x "$SIMPLE_RUNTIME_PATH" ]; then
    RUNTIME="$SIMPLE_RUNTIME_PATH"
elif [ -n "$SIMPLE_OLD_PATH" ] && [ -x "$SIMPLE_OLD_PATH" ]; then
    RUNTIME="$SIMPLE_OLD_PATH"
elif [ -x "$SCRIPT_DIR/rust/target/release/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/rust/target/release/simple_runtime"
elif [ -x "$SCRIPT_DIR/rust/target/debug/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/rust/target/debug/simple_runtime"
elif [ -x "$SCRIPT_DIR/rust/target/release/simple_old" ]; then
    RUNTIME="$SCRIPT_DIR/rust/target/release/simple_old"
elif [ -x "$SCRIPT_DIR/rust/target/debug/simple_old" ]; then
    RUNTIME="$SCRIPT_DIR/rust/target/debug/simple_old"
else
    echo "error: simple_runtime not found. Run 'simple build' (or 'cd rust && cargo build' for first-time setup)." >&2
    exit 1
fi

# Run the Simple CLI implementation
exec "$RUNTIME" "$SCRIPT_DIR/src/app/cli/main.spl" "$@"
