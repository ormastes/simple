#!/bin/sh
# Coverage tool wrapper - runs Simple coverage app via runtime

SCRIPT_DIR="$(cd "$(dirname "$0")/.." && pwd)"

# Find the runtime binary (prioritize bin/ first, then bin/bootstrap/)
if [ -n "$SIMPLE_RUNTIME_PATH" ] && [ -x "$SIMPLE_RUNTIME_PATH" ]; then
    RUNTIME="$SIMPLE_RUNTIME_PATH"
elif [ -x "$SCRIPT_DIR/bin/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/bin/simple_runtime"
elif [ -x "$SCRIPT_DIR/bin/bootstrap/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/bin/bootstrap/simple_runtime"
elif [ -x "$SCRIPT_DIR/rust/target/release/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/rust/target/release/simple_runtime"
elif [ -x "$SCRIPT_DIR/rust/target/debug/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/rust/target/debug/simple_runtime"
elif [ -x "$SCRIPT_DIR/rust/target/bootstrap/simple_runtime" ]; then
    RUNTIME="$SCRIPT_DIR/rust/target/bootstrap/simple_runtime"
else
    echo "error: simple_runtime not found." >&2
    echo "  Run 'simple build --release' or 'simple build --bootstrap'." >&2
    exit 1
fi

exec "$RUNTIME" "$SCRIPT_DIR/src/app/coverage/main.spl" "$@"
