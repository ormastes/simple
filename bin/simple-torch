#!/usr/bin/env bash
# Simple PyTorch Wrapper Script
# Sets LD_LIBRARY_PATH to include PyTorch FFI library

# Get the directory where this script lives
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

# Path to FFI library
FFI_LIB_PATH="$PROJECT_ROOT/.build/rust/ffi_torch/target/release"

# Check if FFI library exists
if [ ! -f "$FFI_LIB_PATH/libsimple_torch_ffi.so" ]; then
    echo "ERROR: PyTorch FFI library not found at: $FFI_LIB_PATH/libsimple_torch_ffi.so"
    echo "Please build the FFI library first:"
    echo "  cd $PROJECT_ROOT/.build/rust/ffi_torch"
    echo "  cargo build --release"
    exit 1
fi

# Add FFI library path to LD_LIBRARY_PATH
export LD_LIBRARY_PATH="$FFI_LIB_PATH:${LD_LIBRARY_PATH}"

# Execute the Simple runtime with all arguments
exec "$PROJECT_ROOT/bin/release/simple" "$@"
