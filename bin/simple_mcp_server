#!/bin/bash
# Simple MCP Server Wrapper
# Suppresses stderr warnings for clean stdio transport.
# Uses main_lazy bootstrap for fast initialize and reliable tool responses.

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Use release binary (pre-built runtime)
RUNTIME="${SCRIPT_DIR}/release/simple"
MCP_MAIN="${SCRIPT_DIR}/../src/app/mcp/main_lazy.spl"
PROXY="${SCRIPT_DIR}/mcp_stdio_proxy.py"

# Point runtime at project stdlib to skip expensive path probing
export SIMPLE_LIB="${SCRIPT_DIR}/../src"
# Expose version for logging/parity with main CLI wrapper
export SIMPLE_VERSION=$(cat "${SCRIPT_DIR}/../VERSION" 2>/dev/null || echo "unknown")

# Suppress stderr (warnings) but keep stdout (JSON-RPC)
# Set RUST_LOG=error to minimize logging
RUST_LOG=error exec "$PROXY" "$RUNTIME" "$MCP_MAIN" 2>/dev/null
