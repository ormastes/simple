#!/bin/bash
# Native compiled MCP server for maximum performance
# Note: Requires native compilation to be set up first

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Use native compiled binary if it exists
NATIVE_BIN="${SCRIPT_DIR}/mcp_server_native"

if [ ! -f "$NATIVE_BIN" ]; then
    echo "Error: Native MCP server not compiled yet" >&2
    echo "Run: bin/simple compile src/app/mcp/main.spl -o bin/mcp_server_native" >&2
    exit 1
fi

# Point to project stdlib
export SIMPLE_LIB="${SCRIPT_DIR}/../src"
export SIMPLE_VERSION=$(cat "${SCRIPT_DIR}/../VERSION" 2>/dev/null || echo "unknown")

# Run native binary
RUST_LOG=error exec "$NATIVE_BIN" server 2>/dev/null
