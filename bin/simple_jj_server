#!/bin/bash
# Simple JJ (Jujutsu) MCP Server Wrapper
# Suppresses stderr warnings for clean stdio transport.

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Runtime selection:
#   1) SIMPLE_RUNTIME override
#   2) bootstrap runtime (often more stable for MCP)
#   3) release runtime fallback
RUNTIME="${SIMPLE_RUNTIME:-${SCRIPT_DIR}/bootstrap/cpp/simple}"
if [ ! -x "$RUNTIME" ]; then
  RUNTIME="${SCRIPT_DIR}/release/simple"
fi
MCP_MAIN="${SCRIPT_DIR}/../src/app/mcp_jj/main.spl"
PROXY="${SCRIPT_DIR}/mcp_stdio_proxy.py"

# Point runtime at project stdlib to skip expensive path probing
export SIMPLE_LIB="${SCRIPT_DIR}/../src"

# Suppress stderr (warnings) but keep stdout (JSON-RPC)
# Set RUST_LOG=error to minimize logging
RUST_LOG=error exec "$PROXY" "$RUNTIME" "$MCP_MAIN" 2>/dev/null
