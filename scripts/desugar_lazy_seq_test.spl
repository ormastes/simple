# Desugar lazy_seq_spec.spl test file

use std.spec

extern fn rt_file_read_text(path: text) -> text
extern fn rt_file_write_text(path: text, content: text) -> bool

use app.desugar.rewriter (rewrite_static_calls)

describe "Desugar LazySeq Test":
    it "desugars lazy_seq_spec.spl":
        val input_path = "test/app/interpreter/lazy/lazy_seq_spec.spl"
        val output_path = "test/app/interpreter/lazy/lazy_seq_spec_fixed.spl"

        print ""
        print "Reading {input_path}..."
        val source_opt = rt_file_read_text(input_path)
        val source = source_opt ?? ""

        check(source != "")

        # Test files don't have impl blocks, just rewrite calls
        print "Rewriting static calls..."
        val result = rewrite_static_calls(source)

        print "Writing to {output_path}..."
        val ok = rt_file_write_text(output_path, result)
        check(ok)

        if ok:
            print "âœ“ Success! Desugared test file written"
            print ""
            print "To apply the fix:"
            print "  cp {output_path} {input_path}"
