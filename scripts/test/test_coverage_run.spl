# Test Coverage Execution
# Actually run coverage on a small subset to verify functionality

use app.build.coverage (
    Coverage,
    CoverageLevel,
    CoverageFormat,
    CoverageConfig,
    print_coverage_result
)

fn main():
    print "Testing Coverage Execution"
    print "=========================="
    print ""

    # Test: Run coverage on a single package (smaller scope)
    print "Running coverage on simple-runtime package (text output)..."
    print "(This may take 1-2 minutes)"
    print ""

    val config = CoverageConfig(
        level: CoverageLevel.All,
        format: CoverageFormat.Text,
        output_dir: "build/coverage",
        threshold: 0.0,
        fail_on_threshold: false,
        include_doctests: false,
        workspace: false,
        package: "simple-runtime"
    )

    val result = Coverage.run(config)

    print "\nCoverage Result:"
    print "================"
    print_coverage_result(result)

    if result.success:
        print "\n✓ Coverage execution successful!"
        return 0
    else:
        print "\n✗ Coverage execution failed"
        print "\nThis is expected if:"
        print "  - cargo-llvm-cov is not installed"
        print "  - Tests are failing"
        print "  - Build issues exist"
        return 1
