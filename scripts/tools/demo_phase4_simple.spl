"""
# Phase 4 DSL Demo - Simplified Version

This demonstrates the Phase 4 DSL system with manually created data
to work around interpreter nested method limitations.

**Usage:** simple scripts/demo_phase4_simple.spl
"""

use compiler.irdsl.parser.{IrInstruction, IrParam}
use compiler.irdsl.validator.{validate_instructions}
use compiler.irdsl.codegen.{generate_backend_code}

fn main():
    print "=" * 60
    print "Phase 4 DSL Demo - Instruction Code Generation"
    print "=" * 60
    print ""

    # Manually create instruction definitions (bypassing parser for demo)
    val instructions = create_sample_instructions()

    print "Sample Instructions Created: {instructions.len()}"
    print ""

    # Show validation
    print "=== Validation Report ==="
    print ""
    val validation = validate_instructions(instructions)
    print validation
    print ""

    # Generate code for each backend
    print "=== Generated Cranelift Backend Code ==="
    print ""
    val cranelift_code = generate_backend_code(instructions, "cranelift")
    print cranelift_code
    print ""

    print "=== Generated LLVM Backend Code ==="
    print ""
    val llvm_code = generate_backend_code(instructions, "llvm")
    print llvm_code
    print ""

    print "=== Generated Interpreter Backend Code ==="
    print ""
    val interp_code = generate_backend_code(instructions, "interpreter")
    print interp_code
    print ""

    print "=" * 60
    print "âœ… Phase 4 DSL Demo Complete!"
    print "=" * 60

# Create sample instruction definitions manually
fn create_sample_instructions() -> [IrInstruction]:
    var instructions: [IrInstruction] = []

    # ConstInt - supported by all backends
    val const_int = IrInstruction(
        name: "ConstInt",
        params: [],
        backends: ["cranelift", "llvm", "interpreter"],
        description: "Create integer constant",
        rust_pattern: "MirInst::ConstInt { dest, value }",
        error_msg: "",
        category: "constants"
    )
    instructions.push(const_int)

    # Add - supported by all backends
    val add = IrInstruction(
        name: "Add",
        params: [],
        backends: ["cranelift", "llvm", "interpreter"],
        description: "Integer addition",
        rust_pattern: "MirInst::Add { dest, left, right }",
        error_msg: "",
        category: "arithmetic"
    )
    instructions.push(add)

    # VecSum - SIMD, only on cranelift and interpreter
    val vec_sum = IrInstruction(
        name: "VecSum",
        params: [],
        backends: ["cranelift", "interpreter"],
        description: "Sum vector elements",
        rust_pattern: "MirInst::VecSum { dest, vec }",
        error_msg: "SIMD not supported in this backend",
        category: "simd"
    )
    instructions.push(vec_sum)

    # GpuBarrier - GPU only, vulkan backend
    val gpu_barrier = IrInstruction(
        name: "GpuBarrier",
        params: [],
        backends: ["vulkan"],
        description: "GPU work-group barrier",
        rust_pattern: "MirInst::GpuBarrier",
        error_msg: "GPU instructions only supported in Vulkan backend",
        category: "gpu"
    )
    instructions.push(gpu_barrier)

    instructions
