# Core Matchers - eq, be, be_nil
# Basic equality and identity matchers

import matchers.{Matcher, MatchResult}

# Equality matcher: expect x to eq 5
class EqMatcher<T>:
    expected: T
    
    fn new(expected: T) -> EqMatcher<T>:
        return EqMatcher { expected: expected }

impl<T> Matcher<T> for EqMatcher<T>:
    fn match(self, actual: T) -> MatchResult:
        if actual == self.expected:
            return MatchResult.success()
        else:
            return MatchResult.failure(
                "Expected ${actual} to equal ${self.expected}"
            )

fn eq<T>(expected: T) -> EqMatcher<T>:
    return EqMatcher.new(expected)

# Identity matcher: expect x to be y (same object)
class BeMatcher<T>:
    expected: T
    
    fn new(expected: T) -> BeMatcher<T>:
        return BeMatcher { expected: expected }

impl<T> Matcher<T> for BeMatcher<T>:
    fn match(self, actual: T) -> MatchResult:
        if actual is self.expected:
            return MatchResult.success()
        else:
            return MatchResult.failure(
                "Expected ${actual} to be ${self.expected}"
            )

fn be<T>(expected: T) -> BeMatcher<T>:
    return BeMatcher.new(expected)

# Nil matcher: expect x to be_nil
class BeNilMatcher:
    fn new() -> BeNilMatcher:
        return BeNilMatcher {}

impl Matcher<Option<Any>> for BeNilMatcher:
    fn match(self, actual: Option<Any>) -> MatchResult:
        match actual:
            case None:
                return MatchResult.success()
            case Some(v):
                return MatchResult.failure(
                    "Expected None but got Some(${v})"
                )

fn be_nil() -> BeNilMatcher:
    return BeNilMatcher.new()
