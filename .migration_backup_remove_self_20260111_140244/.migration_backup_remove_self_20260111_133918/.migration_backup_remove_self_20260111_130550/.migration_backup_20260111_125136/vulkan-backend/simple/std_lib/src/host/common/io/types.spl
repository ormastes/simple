# Common I/O Types
# Shared across all host variants (async_nogc_mut, async_gc_immut, etc.)

use units.file.*
use units.size.*
use units.time.*
use core.traits.*

# Timestamp (nanoseconds since Unix epoch)
pub unit Timestamp: u64 as ts

# File metadata - common structure for file information
pub struct FileMetadata:
    size: ByteCount
    modified: Option<Timestamp>
    created: Option<Timestamp>
    accessed: Option<Timestamp>
    file_type: FileType
    permissions: FileMode
    readonly: bool

impl FileMetadata:
    pub fn size(self) -> ByteCount:
        self.size

    pub fn modified(self) -> Option<Timestamp>:
        self.modified

    pub fn created(self) -> Option<Timestamp>:
        self.created

    pub fn accessed(self) -> Option<Timestamp>:
        self.accessed

    pub fn file_type(self) -> FileType:
        self.file_type

    pub fn permissions(self) -> FileMode:
        self.permissions

    pub fn is_readonly(self) -> bool:
        self.readonly

    pub fn is_file(self) -> bool:
        match self.file_type:
            case File: true
            case _: false

    pub fn is_dir(self) -> bool:
        match self.file_type:
            case Directory: true
            case _: false

    pub fn is_symlink(self) -> bool:
        match self.file_type:
            case Symlink: true
            case _: false

# File type enumeration
pub enum FileType:
    File
    Directory
    Symlink
    Other

impl Display for FileType:
    fn fmt(self) -> str:
        match self:
            case File: "file"
            case Directory: "directory"
            case Symlink: "symlink"
            case Other: "other"

# Directory entry - represents a single entry in a directory listing
pub struct DirEntry:
    path: FilePath
    name: FileName
    file_type: FileType

impl DirEntry:
    pub fn path(self) -> FilePath:
        self.path

    pub fn name(self) -> FileName:
        self.name

    pub fn file_type(self) -> FileType:
        self.file_type

# Open modes for file operations
pub enum OpenMode:
    Read
    Write
    Append
    ReadWrite
    Create
    CreateNew
    Truncate

impl Display for OpenMode:
    fn fmt(self) -> str:
        match self:
            case Read: "read"
            case Write: "write"
            case Append: "append"
            case ReadWrite: "read-write"
            case Create: "create"
            case CreateNew: "create-new"
            case Truncate: "truncate"

# Seek position for file operations
pub enum SeekFrom:
    Start(u64)
    End(i64)
    Current(i64)

impl SeekFrom:
    pub fn start(pos: u64) -> SeekFrom:
        SeekFrom::Start(pos)

    pub fn end(pos: i64) -> SeekFrom:
        SeekFrom::End(pos)

    pub fn current(pos: i64) -> SeekFrom:
        SeekFrom::Current(pos)

# Text type (UTF-8 validated string)
pub unit Text: str as text
