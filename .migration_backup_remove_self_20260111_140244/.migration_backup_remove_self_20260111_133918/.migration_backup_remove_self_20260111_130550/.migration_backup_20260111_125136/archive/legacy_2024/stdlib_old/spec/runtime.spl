# Runtime configuration and state management
# Manages global test settings and execution context

# Global configuration
let default_tags: List<Symbol> = []
let default_timeout_ms: Int = 5000
let current_example_state: Dict<String, Any> = {}

# Set default tag for all examples in scope
export fn tag_default(tag: Symbol) -> Void:
    default_tags.push(tag)

# Set default timeout in milliseconds
export fn timeout_default(ms: Int) -> Void:
    default_timeout_ms = ms

# Get/set per-example state (for let memoization)
export fn get_example_state(key: String) -> Option<Any>:
    return current_example_state.get(key)

export fn set_example_state(key: String, value: Any) -> Void:
    current_example_state[key] = value

export fn clear_example_state() -> Void:
    current_example_state.clear()

# Execution context
export class ExecutionContext:
    timeout_ms: Int
    tags: List<Symbol>
    
    fn new() -> ExecutionContext:
        return ExecutionContext {
            timeout_ms: default_timeout_ms,
            tags: default_tags.clone()
        }
    
    fn with_timeout(self, ms: Int) -> ExecutionContext:
        self.timeout_ms = ms
        return self
    
    fn with_tag(self, tag: Symbol) -> ExecutionContext:
        self.tags.push(tag)
        return self
