# Unit tests for Python grammar

import spec.{describe, it, expect}
import parser.treesitter.grammar_python as python_grammar
import parser.treesitter.grammar_test as gt

describe("PythonGrammar"):
    it("creates Python grammar"):
        val grammar = python_grammar.PythonGrammar.new()

        expect(grammar.grammar.name).to_equal("python")
        expect(grammar.grammar.entry_point).to_equal("module")

describe("Python parsing"):
    it("parses function definition"):
        val suite = gt.GrammarTestBuilder.new()
            .test("function", "python", "def hello():\n    pass\n", "module")
            .build()

        val result = suite.run()

        expect(result.all_passed()).to_be(true)

    it("parses class definition"):
        val suite = gt.GrammarTestBuilder.new()
            .test("class", "python", "class Point:\n    pass\n", "module")
            .build()

        val result = suite.run()

        expect(result.all_passed()).to_be(true)

    it("parses if statement"):
        val suite = gt.GrammarTestBuilder.new()
            .test("if", "python", "if x > 0:\n    print(x)\n", "module")
            .build()

        val result = suite.run()

        expect(result.all_passed()).to_be(true)

    it("parses for loop"):
        val suite = gt.GrammarTestBuilder.new()
            .test("for", "python", "for i in range(10):\n    print(i)\n", "module")
            .build()

        val result = suite.run()

        expect(result.all_passed()).to_be(true)

    it("parses list comprehension"):
        val suite = gt.GrammarTestBuilder.new()
            .test("list_comp", "python", "[for x in range(10): x]\n", "module")
            .build()

        val result = suite.run()

        expect(result.all_passed()).to_be(true)

    it("parses import"):
        val suite = gt.GrammarTestBuilder.new()
            .test("import", "python", "import os\n", "module")
            .build()

        val result = suite.run()

        expect(result.all_passed()).to_be(true)

    it("parses decorators"):
        val suite = gt.GrammarTestBuilder.new()
            .test("decorator", "python", "@property\ndef name(self):\n    return self._name\n", "module")
            .build()

        val result = suite.run()

        expect(result.all_passed()).to_be(true)

    it("parses lambda"):
        val suite = gt.GrammarTestBuilder.new()
            .test("lambda", "python", "lambda x: x + 1\n", "module")
            .build()

        val result = suite.run()

        expect(result.all_passed()).to_be(true)
