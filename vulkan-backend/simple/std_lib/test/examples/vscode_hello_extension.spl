# Hello VSCode Extension
# Simple demonstration of VSCode extension API in Simple language

import vscode.commands
import vscode.languages
import vscode.window

# Extension entry points

fn activate(context: ExtensionContext):
    """Called when extension is activated."""
    print("Hello Extension activated!")

    window.show_information_message("Hello from Simple!")

    # Register hello command
    val cmd = commands.register_command(
        "simple.hello",
        show_hello
    )
    context.push(cmd)

    # Register completion provider for Simple language
    val completion_provider = languages.register_completion_provider(
        "simple",
        provide_completions
    )
    context.push(completion_provider)

    # Register hover provider
    val hover_provider = languages.register_hover_provider(
        "simple",
        provide_hover
    )
    context.push(hover_provider)

fn deactivate():
    """Called when extension is deactivated."""
    print("Hello Extension deactivated")

# Command handlers

fn show_hello(args: List<String>):
    """Show hello message."""
    window.show_information_message("Hello from Simple Language Extension!")
    print("Hello command executed")

# Language feature providers

fn provide_completions(document: TextDocument, position: Position): List<CompletionItem> =
    """Provide basic keyword completions."""
    val items: List<CompletionItem> = []

    # Simple keywords
    val keywords = ["fn", "val", "if", "else", "for", "while", "return", "import", "class"]

    for keyword in keywords:
        val item = CompletionItem.new(keyword, CompletionItemKind_Keyword)
        item.detail = "Simple keyword"
        item.documentation = "Keyword: {keyword}"
        items.append(item)

    items

fn provide_hover(document: TextDocument, position: Position): Option<Hover> =
    """Provide hover information for keywords."""
    val range = document.get_word_range_at_position(position)
    if range == none:
        return none

    # Get word at cursor
    val word = document.get_text_in_range(range!)

    # Provide documentation for common keywords
    if word == "fn":
        return some(Hover.new("**fn** - Function definition keyword"))
    elif word == "val":
        return some(Hover.new("**val** - Variable binding keyword"))
    elif word == "if":
        return some(Hover.new("**if** - Conditional expression"))
    elif word == "class":
        return some(Hover.new("**class** - Class definition keyword"))

    none
