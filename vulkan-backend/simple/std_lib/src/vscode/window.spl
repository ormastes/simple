# VSCode Window API
# Interact with VSCode window and UI elements

# External FFI declarations
extern fn vscode_window_show_message(message: String, message_type: i32): void
extern fn vscode_window_show_error(message: String): void
extern fn vscode_window_show_warning(message: String): void
extern fn vscode_window_show_info(message: String): void
extern fn vscode_window_create_status_bar_item(alignment: i32, priority: i32): i64
extern fn vscode_window_status_bar_set_text(item_id: i64, text: String): void
extern fn vscode_window_status_bar_show(item_id: i64): void
extern fn vscode_window_status_bar_hide(item_id: i64): void
extern fn vscode_window_get_active_editor_uri(): String

# Message types
pub val MessageType_Info: i32 = 0
pub val MessageType_Warning: i32 = 1
pub val MessageType_Error: i32 = 2

# Status bar alignment
pub val StatusBarAlignment_Left: i32 = 1
pub val StatusBarAlignment_Right: i32 = 2

# Show informational message
pub fn show_information_message(message: String):
    """Show informational message in notification area.

    Example:
        window.show_information_message("Operation completed successfully")
    """
    vscode_window_show_info(message)

# Show warning message
pub fn show_warning_message(message: String):
    """Show warning message.

    Example:
        window.show_warning_message("File not found")
    """
    vscode_window_show_warning(message)

# Show error message
pub fn show_error_message(message: String):
    """Show error message.

    Example:
        window.show_error_message("Compilation failed")
    """
    vscode_window_show_error(message)

# Generic show message
pub fn show_message(message: String, message_type: i32):
    """Show message with specific type."""
    vscode_window_show_message(message, message_type)

# Status bar item
pub class StatusBarItem:
    pub id: i64
    pub text: String
    pub tooltip: String
    pub alignment: i32
    pub priority: i32
    pub visible: bool

    pub fn new(alignment: i32, priority: i32): StatusBarItem =
        """Create status bar item.

        Args:
            alignment: StatusBarAlignment_Left or StatusBarAlignment_Right
            priority: Higher priority appears more to the left/right

        Example:
            item = StatusBarItem.new(StatusBarAlignment_Right, 100)
            item.set_text("âœ“ Ready")
            item.show()
        """
        val id = vscode_window_create_status_bar_item(alignment, priority)

        StatusBarItem {
            id: id,
            text: "",
            tooltip: "",
            alignment: alignment,
            priority: priority,
            visible: false
        }

    pub fn set_text(self, text: String):
        """Set status bar item text."""
        self.text = text
        vscode_window_status_bar_set_text(self.id, text)

    pub fn set_tooltip(self, tooltip: String):
        """Set status bar item tooltip (shown on hover)."""
        self.tooltip = tooltip
        # FFI call

    pub fn show(self):
        """Show status bar item."""
        self.visible = true
        vscode_window_status_bar_show(self.id)

    pub fn hide(self):
        """Hide status bar item."""
        self.visible = false
        vscode_window_status_bar_hide(self.id)

    pub fn dispose(self):
        """Dispose status bar item."""
        # FFI call
        pass

# Create status bar item
pub fn create_status_bar_item(alignment: i32, priority: i32): StatusBarItem =
    """Create a status bar item.

    Example:
        status = window.create_status_bar_item(StatusBarAlignment_Left, 10)
        status.set_text("$(sync~spin) Processing...")
        status.show()
    """
    StatusBarItem.new(alignment, priority)

# Text editor
pub class TextEditor:
    pub document: TextDocument
    pub selection: Range

    pub fn new(): TextEditor =
        TextEditor {
            document: TextDocument.new(),
            selection: Range.new(Position.new(0, 0), Position.new(0, 0))
        }

# Get active text editor
pub fn get_active_text_editor(): Option<TextEditor> =
    """Get currently active text editor.

    Returns:
        TextEditor if there's an active editor, none otherwise
    """
    val uri = vscode_window_get_active_editor_uri()
    if uri == "":
        return none

    # TODO: Create TextEditor from URI
    some(TextEditor.new())

# Import Position, Range, TextDocument from languages module
# (These should be in a shared types module)
use vscode.languages.Position
use vscode.languages.Range
use vscode.languages.TextDocument
