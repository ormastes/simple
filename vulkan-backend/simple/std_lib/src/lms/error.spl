# Error types for Language Model Server (MCP)

# JSON-RPC error code constants
const ERROR_PARSE_ERROR = -32700
const ERROR_INVALID_REQUEST = -32600
const ERROR_METHOD_NOT_FOUND = -32601
const ERROR_INVALID_PARAMS = -32602
const ERROR_INTERNAL_ERROR = -32603
const ERROR_SERVER_NOT_INITIALIZED = -32002
const ERROR_FILE_NOT_FOUND = -32001
const ERROR_PERMISSION_DENIED = -32003
const ERROR_WORKSPACE_ERROR = -32004

# LMS-specific error types
pub enum LmsError:
    TransportError(String)           # I/O failures
    ProtocolError(String)            # Invalid JSON-RPC
    InvalidRequest(String)           # Bad request format
    MethodNotFound(String)           # Unknown method
    InvalidParams(String)            # Bad parameters
    InternalError(String)            # Server error
    NotInitialized                   # Server not initialized
    AlreadyInitialized               # Double initialization
    FileNotFound(String)             # File doesn't exist
    PermissionDenied(String)         # Access denied
    WorkspaceError(String)           # Workspace-related errors

# Convert LMS error to JSON-RPC error code
pub fn to_json_rpc_code(error: LmsError) -> Int:
    match error:
        LmsError.TransportError(_) ->
            ERROR_PARSE_ERROR
        LmsError.ProtocolError(_) ->
            ERROR_INVALID_REQUEST
        LmsError.InvalidRequest(_) ->
            ERROR_INVALID_REQUEST
        LmsError.MethodNotFound(_) ->
            ERROR_METHOD_NOT_FOUND
        LmsError.InvalidParams(_) ->
            ERROR_INVALID_PARAMS
        LmsError.InternalError(_) ->
            ERROR_INTERNAL_ERROR
        LmsError.NotInitialized ->
            ERROR_SERVER_NOT_INITIALIZED
        LmsError.AlreadyInitialized ->
            ERROR_INVALID_REQUEST
        LmsError.FileNotFound(_) ->
            ERROR_FILE_NOT_FOUND
        LmsError.PermissionDenied(_) ->
            ERROR_PERMISSION_DENIED
        LmsError.WorkspaceError(_) ->
            ERROR_WORKSPACE_ERROR

# Get error message from LMS error
pub fn to_message(error: LmsError) -> String:
    match error:
        LmsError.TransportError(msg) ->
            msg
        LmsError.ProtocolError(msg) ->
            msg
        LmsError.InvalidRequest(msg) ->
            msg
        LmsError.MethodNotFound(method) ->
            f"Method not found: {method}"
        LmsError.InvalidParams(msg) ->
            msg
        LmsError.InternalError(msg) ->
            msg
        LmsError.NotInitialized ->
            "Server not initialized"
        LmsError.AlreadyInitialized ->
            "Server already initialized"
        LmsError.FileNotFound(path) ->
            f"File not found: {path}"
        LmsError.PermissionDenied(path) ->
            f"Permission denied: {path}"
        LmsError.WorkspaceError(msg) ->
            msg

# Helper to create an error response dict
pub fn error_response(id: Int, error: LmsError) -> Dict:
    val code = to_json_rpc_code(error)
    val message = to_message(error)
    val error_obj = {"code": code, "message": message}
    return {"jsonrpc": "2.0", "id": id, "error": error_obj}

# Helper to create a success response dict
pub fn success_response(id: Int, data: Dict) -> Dict:
    return {"jsonrpc": "2.0", "id": id, "result": data}
