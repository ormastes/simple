# Test for system_api module

use system_api (
    SYS_OPEN, SYS_CLOSE, SYS_WRITE, SYS_READ, SYS_EXIT,
    SYS_CLOCK, SYS_TIME, SYS_WRITE_HANDLE,
    FMT_INT32, FMT_INT64, FMT_FLOAT64, FMT_BOOL,
    MODE_READ, MODE_WRITE,
    HANDLE_TEST_START, HANDLE_TEST_PASS, HANDLE_TEST_FAIL, HANDLE_TEST_END,
    semi_print, semi_print1, semi_print2,
    semi_open, semi_close, semi_read, semi_write,
    semi_exit, semi_clock, semi_time,
    semi_host_call, test_start, test_pass, test_fail, test_end
)

fn main():
    print "=== Semihosting System API Test (32-bit values) ==="

    # Test operation code values
    print ""
    print "Testing operation codes:"
    print "  SYS_OPEN = {SYS_OPEN} (expected: 1)"
    print "  SYS_CLOSE = {SYS_CLOSE} (expected: 2)"
    print "  SYS_WRITE = {SYS_WRITE} (expected: 5)"
    print "  SYS_READ = {SYS_READ} (expected: 6)"
    print "  SYS_EXIT = {SYS_EXIT} (expected: 24)"
    print "  SYS_CLOCK = {SYS_CLOCK} (expected: 16)"
    print "  SYS_WRITE_HANDLE = {SYS_WRITE_HANDLE} (expected: 256)"

    # Test format type values
    print ""
    print "Testing format types:"
    print "  FMT_INT32 = {FMT_INT32} (expected: 3)"
    print "  FMT_INT64 = {FMT_INT64} (expected: 4)"
    print "  FMT_FLOAT64 = {FMT_FLOAT64} (expected: 10)"
    print "  FMT_BOOL = {FMT_BOOL} (expected: 11)"

    # Test mode values
    print ""
    print "Testing file modes:"
    print "  MODE_READ = {MODE_READ} (expected: 0)"
    print "  MODE_WRITE = {MODE_WRITE} (expected: 4)"

    # Test handle values
    print ""
    print "Testing test handles:"
    print "  HANDLE_TEST_START = {HANDLE_TEST_START}"
    print "  HANDLE_TEST_PASS = {HANDLE_TEST_PASS}"
    print "  HANDLE_TEST_FAIL = {HANDLE_TEST_FAIL}"
    print "  HANDLE_TEST_END = {HANDLE_TEST_END}"

    # Test semi_host_call function
    print ""
    print "Testing semi_host_call:"
    val result = semi_host_call(SYS_CLOCK, 0, 0)
    print "  Result: {result}"

    # Test semi_print functions
    print ""
    print "Testing semi_print functions:"
    semi_print(42)
    semi_print1(42, 100)
    semi_print2(42, 100, 200)

    # Test test protocol
    print ""
    print "Testing test protocol:"
    test_start()
    test_pass(1)
    test_fail(2, 3)
    test_end(5, 1)

    print ""
    print "=== All tests passed! ==="
