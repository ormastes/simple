# HIR Entity - CoreSymbolTable and CoreSymbolEntry types
#
# Extracted from src/core/hir_types.spl
# Seed-compatible symbol table definitions.

# ===== Symbol Kind Tags =====

val SYM_KIND_VAR = 1
val SYM_KIND_VAL = 2
val SYM_KIND_FUNCTION = 3
val SYM_KIND_STRUCT = 4
val SYM_KIND_EXTERN_FN = 5
val SYM_KIND_PARAM = 6
val SYM_KIND_MODULE = 7
val SYM_KIND_ENUM = 8
val SYM_KIND_METHOD = 9
val SYM_KIND_FIELD = 10

# ===== CoreSymbolEntry — single symbol table entry =====

struct CoreSymbolEntry:
    name: text
    kind: i64
    type_idx: i64
    scope_depth: i64
    decl_id: i64
    is_mutable: i64

fn make_core_symbol(name: text, kind: i64) -> CoreSymbolEntry:
    CoreSymbolEntry(name: name, kind: kind, type_idx: -1, scope_depth: 0, decl_id: -1, is_mutable: 0)

# ===== CoreSymbolTable — typed lookup table (no Dict<>) =====

struct CoreSymbolTable:
    names: [text]
    kinds: [i64]
    type_indices: [i64]
    scope_depths: [i64]
    decl_ids: [i64]
    mutabilities: [i64]

fn make_core_symbol_table() -> CoreSymbolTable:
    CoreSymbolTable(names: [], kinds: [], type_indices: [], scope_depths: [], decl_ids: [], mutabilities: [])

fn symtab_add(table: CoreSymbolTable, name: text, kind: i64, type_idx: i64, depth: i64, decl_id: i64, is_mut: i64) -> i64:
    val idx = table.names.len()
    table.names.push(name)
    table.kinds.push(kind)
    table.type_indices.push(type_idx)
    table.scope_depths.push(depth)
    table.decl_ids.push(decl_id)
    table.mutabilities.push(is_mut)
    idx

fn symtab_find(table: CoreSymbolTable, name: text) -> i64:
    # Search from end (latest scope first) for shadowing
    val names: [text] = table.names
    val count = names.len()
    if count == 0:
        return -1
    for i in range(0, count):
        val rev_idx = count - 1 - i
        val entry_name: text = names[rev_idx]
        if entry_name == name:
            return rev_idx
    -1

fn symtab_count(table: CoreSymbolTable) -> i64:
    val names: [text] = table.names
    names.len()

fn sym_kind_name(kind: i64) -> text:
    if kind == SYM_KIND_VAR: return "var"
    if kind == SYM_KIND_VAL: return "val"
    if kind == SYM_KIND_FUNCTION: return "fn"
    if kind == SYM_KIND_STRUCT: return "struct"
    if kind == SYM_KIND_EXTERN_FN: return "extern fn"
    if kind == SYM_KIND_PARAM: return "param"
    if kind == SYM_KIND_MODULE: return "module"
    if kind == SYM_KIND_ENUM: return "enum"
    if kind == SYM_KIND_METHOD: return "method"
    if kind == SYM_KIND_FIELD: return "field"
    "unknown"

export SYM_KIND_VAR, SYM_KIND_VAL, SYM_KIND_FUNCTION, SYM_KIND_STRUCT
export SYM_KIND_EXTERN_FN, SYM_KIND_PARAM, SYM_KIND_MODULE, SYM_KIND_ENUM
export SYM_KIND_METHOD, SYM_KIND_FIELD
export CoreSymbolEntry, make_core_symbol
export CoreSymbolTable, make_core_symbol_table
export symtab_add, symtab_find, symtab_count
export sym_kind_name
