# Source Location Tracking
#
# Tracks source code positions for error reporting.

# Source location span (start, end, line, column)
struct Span:
    start: i64    # Start byte offset
    end: i64      # End byte offset
    line: i64     # Line number (1-indexed)
    column: i64   # Column number (1-indexed)

impl Span:
    # Create a new span
    static fn new(start: i64, end: i64, line: i64, column: i64) -> Span:
        Span(start: start, end: end, line: line, column: column)

    # Create a zero-length span at the given position
    static fn at(pos: i64, line: i64, column: i64) -> Span:
        Span(start: pos, end: pos, line: line, column: column)

    # Create a span at line 1, column 1 (default)
    static fn default() -> Span:
        Span(start: 0, end: 0, line: 1, column: 1)

    # Combine two spans into one covering both
    fn to(other: Span) -> Span:
        val min_start = if self.start < other.start: self.start else: other.start
        val max_end = if self.end > other.end: self.end else: other.end
        val min_line = if self.line < other.line: self.line else: other.line

        Span(
            start: min_start,
            end: max_end,
            line: min_line,
            column: self.column
        )

    # Get the length of this span
    fn len() -> i64:
        self.end - self.start

    # Check if this span is empty (zero-length)
    fn is_empty() -> bool:
        self.start == self.end

    # Format span as "line:column"
    fn to_string() -> text:
        "{self.line}:{self.column}"

    # Format span as "line:column-end_column"
    fn to_range_string() -> text:
        if self.is_empty():
            "{self.line}:{self.column}"
        else:
            val end_col = self.column + (self.end - self.start)
            "{self.line}:{self.column}-{end_col}"

# Public exports

# Auto-generated desugared static method wrappers
fn Span__at(pos: i64, line: i64, column: i64) -> Span:
        Span(start: pos, end: pos, line: line, column: column)

    # Create a span at line 1, column 1 (default)

fn Span__default() -> Span:
        Span(start: 0, end: 0, line: 1, column: 1)

    # Combine two spans into one covering both

export Span
