# Desugaring Module
#
# Provides AST transformation passes that desugar high-level language features
# into simpler forms.
#
# Transformations:
# - async/await → state machines
# - spawn → actor runtime calls
# - actor definitions → classes with message passing
# - frame analysis → compile-time frame sizing and verification
# - spawn analysis → compile-time spawn boundedness (Pass B)

# Export all desugaring modules
export suspension_analysis
export state_enum
export poll_generator
export frame_analysis
export frame_verify
export spawn_analysis

# Re-export commonly used types
use compiler.desugar.suspension_analysis.{
    VariableDecl,
    SuspensionPoint,
    SuspensionAnalysis,
    analyze_suspensions
}
use compiler.desugar.state_enum.{
    StateEnum,
    StateVariant,
    generate_state_enum
}
use compiler.desugar.poll_generator.{
    PollFunction,
    generate_poll_function
}
use compiler.desugar.frame_analysis.{
    FrameAnalysis,
    VariantLayout,
    VariableSizeInfo,
    ConflictEntry,
    analyze_frame,
    analyze_frame_with_large_capture_check,
    format_frame_analysis
}
use compiler.desugar.frame_verify.{
    FrameLimits,
    FrameDiagnostic,
    FrameVerifyResult,
    verify_frame,
    verify_task_frame,
    verify_frames_batch,
    format_verify_result
}

export VariableDecl
export SuspensionPoint
export SuspensionAnalysis
export analyze_suspensions
export StateEnum
export StateVariant
export generate_state_enum
export PollFunction
export generate_poll_function
export FrameAnalysis
export VariantLayout
export VariableSizeInfo
export ConflictEntry
export analyze_frame
export analyze_frame_with_large_capture_check
export format_frame_analysis
export FrameLimits
export FrameDiagnostic
export FrameVerifyResult
export verify_frame
export verify_task_frame
export verify_frames_batch
export format_verify_result

# Spawn analysis (Pass B)
use compiler.desugar.spawn_analysis.{
    SpawnSite,
    TaskInfo,
    TaskGroupInfo,
    SpawnAnalysis,
    SpawnDiagnostic,
    SpawnVerifyResult,
    analyze_spawns,
    analyze_spawns_with_groups,
    verify_spawn_bounds,
    format_spawn_analysis,
    format_spawn_verify_result
}

export SpawnSite
export TaskInfo
export TaskGroupInfo
export SpawnAnalysis
export SpawnDiagnostic
export SpawnVerifyResult
export analyze_spawns
export analyze_spawns_with_groups
export verify_spawn_bounds
export format_spawn_analysis
export format_spawn_verify_result

# Reservation analysis (Pass C)
export reservation_analysis

use compiler.desugar.reservation_analysis.{
    ResourceLeaf,
    TaskReservation,
    ReservationDemand,
    ReservationDiagnostic,
    ReservationVerifyResult,
    get_task_reserve,
    compute_demand,
    verify_reservations,
    build_task_reservations_from_analysis,
    format_demand,
    format_reservation_result
}

export ResourceLeaf
export TaskReservation
export ReservationDemand
export ReservationDiagnostic
export ReservationVerifyResult
export get_task_reserve
export compute_demand
export verify_reservations
export build_task_reservations_from_analysis
export format_demand
export format_reservation_result
