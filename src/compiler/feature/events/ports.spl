# Compilation Event Bus Ports
#
# Extension point: observe compilation pipeline events.
# Adapters implementing this port can hook into any pipeline stage
# without modifying the compiler driver.
#
# Adapters: LanguageServerAdapter, ProfilerAdapter, DocCoverageAdapter, LintAdapter
# Design: doc/research/compiler_mdsoc_design.md Section 7

struct CompilationEventPort:
    """Observer port for compilation pipeline events.

    Attach adapters to receive notifications at each pipeline stage.
    Used by: IDE language server, profiler, doc coverage, lint tools.
    """
    name: text
    on_lex_complete_fn: fn(i64)
    on_parse_complete_fn: fn(i64)
    on_desugar_complete_fn: fn(i64)
    on_type_check_complete_fn: fn(i64, i64)
    on_hir_complete_fn: fn(i64)
    on_mir_complete_fn: fn(i64)
    on_backend_complete_fn: fn(bool)

fn _noop_event_i64(count: i64): ()
fn _noop_event_two(a: i64, b: i64): ()
fn _noop_event_bool(ok: bool): ()

fn create_noop_event_port() -> CompilationEventPort:
    """Create a no-op event port that ignores all events."""
    CompilationEventPort(
        name: "noop-events",
        on_lex_complete_fn: _noop_event_i64,
        on_parse_complete_fn: _noop_event_i64,
        on_desugar_complete_fn: _noop_event_i64,
        on_type_check_complete_fn: _noop_event_two,
        on_hir_complete_fn: _noop_event_i64,
        on_mir_complete_fn: _noop_event_i64,
        on_backend_complete_fn: _noop_event_bool
    )

export CompilationEventPort, create_noop_event_port
