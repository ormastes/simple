# Native Backend - Layout Reordering Utility
#
# Shared helper that reorders encoded functions according to a layout plan.
# Used by both ELF and Mach-O emission modules.

use compiler.backend.native.mach_inst.{EncodedFunction}
use compiler.backend.native.layout_solver.{LayoutPlan}

fn reorder_by_layout(
    encoded_funcs: [EncodedFunction],
    layout_plan: LayoutPlan
) -> [EncodedFunction]:
    """Reorder encoded functions according to layout plan."""
    var ordered: [EncodedFunction] = []

    # Process each phase group in order
    for group in layout_plan.groups:
        for func_info in group.functions:
            # Find matching encoded function
            for enc_func in encoded_funcs:
                if enc_func.name == func_info.name:
                    ordered.push(enc_func)
                    break

    # Add any functions not in the plan (shouldn't happen)
    for enc_func in encoded_funcs:
        var found = false
        for ordered_func in ordered:
            if ordered_func.name == enc_func.name:
                found = true
                break
        if not found:
            ordered.push(enc_func)

    ordered

export reorder_by_layout
