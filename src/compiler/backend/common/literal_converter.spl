# Literal Converter - Shared Literal Conversion for All Backends
#
# Provides shared logic for converting HIR literals to backend values.
# Ensures all backends produce identical values for the same literals.

use compiler.backend_types.*
use compiler.mir_data.*

# ============================================================================
# Literal Converter - Manual Desugaring
# ============================================================================

# Manual desugaring of static methods for bootstrap runtime compatibility
fn LiteralConverter__convert_int(value: i64, ty: MirType?) -> Value:
    """Convert integer literal to value."""
    Value.Int(value)

fn LiteralConverter__convert_float(value: f64, ty: MirType?) -> Value:
    """Convert float literal to value."""
    Value.Float(value)

fn LiteralConverter__convert_string(value: text) -> Value:
    """Convert string literal to value."""
    Value.String(value)

fn LiteralConverter__convert_bool(value: bool) -> Value:
    """Convert boolean literal to value."""
    Value.Bool(value)

fn LiteralConverter__convert_nil() -> Value:
    """Convert nil literal to value."""
    Value.Nil

fn LiteralConverter__convert_array(elements: [Value]) -> Value:
    """Convert array literal to value."""
    Value.Array(elements)

fn LiteralConverter__convert_tuple(elements: [Value]) -> Value:
    """Convert tuple literal to value."""
    Value.Tuple(elements)

fn LiteralConverter__convert_dict(pairs: [(Value, Value)]) -> Value:
    """
    Convert dict literal to value.
    Note: If duplicate keys exist, last value wins.
    """
    var dict: Dict<Value, Value> = {}
    for key, value in pairs:
        dict[key] = value
    Value.Dict(dict)

# ============================================================================
# Literal Converter
# ============================================================================

class LiteralConverter:
    """
    Converts HIR literals to backend values.
    Shared across all backends to ensure consistency.

    All methods are static - this is a utility class.
    """

    static fn convert_int(value: i64, ty: MirType?) -> Value:
        """Convert integer literal to value."""
        Value.Int(value)

    static fn convert_float(value: f64, ty: MirType?) -> Value:
        """Convert float literal to value."""
        Value.Float(value)

    static fn convert_string(value: text) -> Value:
        """Convert string literal to value."""
        Value.String(value)

    static fn convert_bool(value: bool) -> Value:
        """Convert boolean literal to value."""
        Value.Bool(value)

    static fn convert_nil() -> Value:
        """Convert nil literal to value."""
        Value.Nil

    static fn convert_array(elements: [Value]) -> Value:
        """Convert array literal to value."""
        Value.Array(elements)

    static fn convert_tuple(elements: [Value]) -> Value:
        """Convert tuple literal to value."""
        Value.Tuple(elements)

    static fn convert_dict(pairs: [(Value, Value)]) -> Value:
        """
        Convert dict literal to value.
        Note: If duplicate keys exist, last value wins.
        """
        var dict: Dict<Value, Value> = {}
        for key, value in pairs:
            dict[key] = value
        Value.Dict(dict)

# ============================================================================
# Export
# ============================================================================

export LiteralConverter

# Export desugared static methods
export LiteralConverter__convert_int
export LiteralConverter__convert_float
export LiteralConverter__convert_string
export LiteralConverter__convert_bool
export LiteralConverter__convert_nil
export LiteralConverter__convert_array
export LiteralConverter__convert_tuple
export LiteralConverter__convert_dict
