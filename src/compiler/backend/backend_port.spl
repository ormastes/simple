# Backend Port - Typed Contract for Compiler Backend
#
# Defines BackendPort: a struct-with-fn-fields that makes the compiler's
# backend dependency visible, typed, and statically checkable.
#
# Instead of di.resolve("Backend") -> Any, CompileContext holds a typed
# BackendPort field. Open CompileContext to see ALL services it needs.
#
# Design: doc/research/di_composition_root_design.md Option A

use compiler.hir.hir.*
use compiler.backend.backend_types.*

# ============================================================================
# BackendPort
# ============================================================================

struct BackendPort:
    """Typed contract: what the compiler needs from a backend.

    Replace di.resolve("Backend") -> Any with a typed field on CompileContext.
    Each fn-field corresponds to one operation the compiler invokes on the backend.
    Wired in CompileContext__create() based on CompileMode.
    """
    name: text
    run_fn: fn(HirModule) -> Result<BackendResult, BackendError>
    supports_jit_fn: fn() -> bool
    target_triple_fn: fn() -> text

# ============================================================================
# Exports
# ============================================================================

export BackendPort
