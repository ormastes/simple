use compiler.test_common.*
use compiler.hir_lowering.*
use compiler.mir_lowering.*
use compiler.mir_data.*

val source = "fn main():\n    0\n"
var parser = Parser.new(source)
val ast_module = parser.parse()
var hir_lowering = HirLowering.new()
val hir_module = hir_lowering.lower_module(ast_module)
var mir_ctx = MirLowering.new(hir_lowering.symbols)
val mir_module = mir_ctx.lower_module(hir_module)

for key in mir_module.functions.keys():
    val fn_ = mir_module.functions[key]
    print "MIR fn: {fn_.name}, sig: {fn_.signature}"
    print "  Locals: {fn_.locals.len()}"
    for i in 0..fn_.locals.len():
        print "    Local {i}: {fn_.locals[i]}"
    for blk in fn_.blocks:
        print "  Block {blk.id.id}: {blk.instructions.len()} insts"
        for inst in blk.instructions:
            print "    {inst.kind}"
        print "    term: {blk.terminator}"
