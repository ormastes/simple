# Construct Capsule: class_struct
#
# Groups all compiler files that handle class and struct declarations.
# Tier: decl (depends on expr, variable)
# Dimension: construct (vertical second axis)
# Participation: shared_bind

use compiler.mdsoc.types.*

export class_struct_capsule_def

fn class_struct_capsule_def() -> ConstructCapsule:
    """Define the class_struct construct capsule.

    Class and struct handling shares most infrastructure with func and enum.
    Primary ownership of type layout and field access code.
    """
    var cap = ConstructCapsule.new("class_struct", ConstructKind.ClassStruct, ConstructTier.Decl)

    cap.exclusive_files = []

    # Shared files
    val sb_parser_decls = SharedBinding.new("10.frontend/core/parser_decls.spl", "func", 10)
    val sb_ast = SharedBinding.new("10.frontend/core/ast.spl", "func", 10)
    val sb_hir = SharedBinding.new("20.hir/hir_definitions.spl", "func", 20)
    val sb_c_type_mapper = SharedBinding.new("70.backend/backend/c_type_mapper.spl", "class_struct", 70)
    val sb_mir_lower = SharedBinding.new("50.mir/mir_lowering_expr.spl", "func", 50)
    val sb_mir_data = SharedBinding.new("50.mir/mir_data.spl", "async", 50)
    val sb_interpreter = SharedBinding.new("70.backend/backend/interpreter.spl", "func", 70)

    cap.shared_bindings = [sb_parser_decls, sb_ast, sb_hir, sb_c_type_mapper, sb_mir_lower, sb_mir_data, sb_interpreter]

    # Depends on expr (field expressions), variable (field declarations)
    cap.depends_on = ["expr", "variable"]

    cap
