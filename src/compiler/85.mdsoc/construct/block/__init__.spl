# Construct Capsule: block
#
# Groups all compiler files that handle the 'block' language construct.
# Tier: advanced (depends on expr, control)
# Dimension: construct (vertical second axis)
# Participation: shared_bind

use compiler.mdsoc.types.*

export block_capsule_def

fn block_capsule_def() -> ConstructCapsule:
    """Define the block construct capsule.

    Block handling is well-isolated in the 15.blocks layer:
    - 15.blocks/**:  exclusive ownership (22+ files)
    - Shared with expr and control for block expression lowering
    """
    var cap = ConstructCapsule.new("block", ConstructKind.Block, ConstructTier.Advanced)

    # Exclusive files — the entire blocks layer is block-specific
    cap.exclusive_files = [
        "15.blocks/blocks/mod.spl",
        "15.blocks/blocks/modes.spl",
        "15.blocks/blocks/unified_registry.spl",
        "15.blocks/blocks/builtin_blocks_data.spl",
        "15.blocks/blocks/builtin_blocks_math.spl",
        "15.blocks/blocks/builtin_blocks_shell.spl"
    ]

    # Shared files — block expressions appear in AST and MIR
    val sb_ast = SharedBinding.new("10.frontend/core/ast.spl", "func", 10)
    val sb_hir = SharedBinding.new("20.hir/hir_definitions.spl", "func", 20)
    val sb_mir = SharedBinding.new("50.mir/mir_instructions.spl", "expr", 50)
    val sb_parser_expr = SharedBinding.new("10.frontend/core/parser_expr.spl", "expr", 10)

    cap.shared_bindings = [sb_ast, sb_hir, sb_mir, sb_parser_expr]

    # Depends on expr and control (blocks contain expressions and control flow)
    cap.depends_on = ["expr", "control"]

    cap
