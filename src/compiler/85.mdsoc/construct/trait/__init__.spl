# Construct Capsule: trait
#
# Groups all compiler files that handle the 'trait' language construct.
# Tier: advanced (depends on func, class_struct, expr)
# Dimension: construct (vertical second axis)
# Participation: shared_bind (files may belong to multiple constructs)

use compiler.mdsoc.types.*

export trait_capsule_def

fn trait_capsule_def() -> ConstructCapsule:
    """Define the trait construct capsule.

    Trait handling spans multiple layers:
    - 25.traits/: exclusive ownership (trait definitions, solver, coherence)
    - 30.types/associated_types.spl: shared with other type-system constructs
    - 10.frontend/core/parser_decls.spl: shared with func, class_struct, enum, etc.
    - 10.frontend/core/ast.spl: shared with all construct capsules
    """
    var cap = ConstructCapsule.new("trait", ConstructKind.Trait, ConstructTier.Advanced)

    # Exclusive files — owned only by this capsule
    cap.exclusive_files = [
        "25.traits/traits.spl",
        "25.traits/traits_types.spl",
        "25.traits/solver.spl",
        "25.traits/coherence.spl",
        "25.traits/validation.spl",
        "25.traits/trait_impl.spl",
        "25.traits/trait_def.spl"
    ]

    # Shared files — also tagged to other construct capsules
    val sb_parser_decls = SharedBinding.new("10.frontend/core/parser_decls.spl", "func", 10)
    val sb_ast = SharedBinding.new("10.frontend/core/ast.spl", "func", 10)
    val sb_assoc = SharedBinding.new("30.types/associated_types.spl", "trait", 30)
    val sb_hir = SharedBinding.new("20.hir/hir_definitions.spl", "func", 20)
    val sb_mir = SharedBinding.new("50.mir/mir_instructions.spl", "expr", 50)

    cap.shared_bindings = [sb_parser_decls, sb_ast, sb_assoc, sb_hir, sb_mir]

    # Depends on lower-tier constructs
    cap.depends_on = ["func", "class_struct", "expr"]

    cap
