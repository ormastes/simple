# Parser Factory - Interpreter-compatible factory functions
#
# The interpreter cannot call static methods (like Parser.new()) from external
# modules. These standalone functions provide the same functionality using
# direct struct construction within this module.

use lexer.*
use parser_types.*
use parser.*
use compiler.frontend.block_types.{LexerMode}

fn create_parser(src: text) -> Parser:
    """Create a Parser from source text.
    Use this instead of Parser.new() when running in interpreter mode."""
    var p = Parser(
        source: src,
        lexer: lexer_create_internal(src, nil),
        current: Token(kind: TokenKind.Eof, span: Span(start: 0, end: 0, line: 1, col: 0), text: ""),
        previous: Token(kind: TokenKind.Eof, span: Span(start: 0, end: 0, line: 1, col: 0), text: ""),
        errors: [],
        outline: nil,
        resolved_blocks: nil
    )
    p_advance(p)
    p

export create_parser
