# Syscall-only FFI functions (no external libs)
# Generated as #![no_std] Rust file with direct POSIX syscalls
#
# This spec defines 16 FFI functions that can be implemented using
# only libc syscalls, without requiring external Rust crates.
#
# Categories:
# - File I/O (9 functions): file operations via open/read/write/stat
# - Environment (3 functions): cwd/env/home via getcwd/getenv/getpwuid
# - Process (2 functions): pid/run via getpid/fork/exec
# - System Info (2 functions): cpu_count/hostname via sysconf/gethostname

import compiler.ffi_gen.types

fn syscalls_core_spec() -> [InternFnSpec]:
    [
        # ============================================
        # File I/O - Direct Syscalls (9 functions)
        # ============================================

        InternFnSpec(
            name: "rt_file_exists",
            category: "syscalls",
            params: [{name: "path", type: "text"}],
            return_type: "bool",
            runtime_fn: "syscall_file_exists",
            doc: "Check if file exists using stat() syscall"
        ),

        InternFnSpec(
            name: "rt_file_read_text",
            category: "syscalls",
            params: [{name: "path", type: "text"}],
            return_type: "text",
            runtime_fn: "syscall_file_read_text",
            doc: "Read file contents using open()+read()+close() syscalls"
        ),

        InternFnSpec(
            name: "rt_file_write_text",
            category: "syscalls",
            params: [
                {name: "path", type: "text"},
                {name: "content", type: "text"}
            ],
            return_type: "bool",
            runtime_fn: "syscall_file_write_text",
            doc: "Write file contents using open(O_CREAT|O_WRONLY)+write()+close()"
        ),

        InternFnSpec(
            name: "rt_file_delete",
            category: "syscalls",
            params: [{name: "path", type: "text"}],
            return_type: "bool",
            runtime_fn: "syscall_file_delete",
            doc: "Delete file using unlink() syscall"
        ),

        InternFnSpec(
            name: "rt_file_size",
            category: "syscalls",
            params: [{name: "path", type: "text"}],
            return_type: "i64",
            runtime_fn: "syscall_file_size",
            doc: "Get file size using stat() syscall, returns -1 on error"
        ),

        InternFnSpec(
            name: "rt_dir_create",
            category: "syscalls",
            params: [
                {name: "path", type: "text"},
                {name: "recursive", type: "bool"}
            ],
            return_type: "bool",
            runtime_fn: "syscall_dir_create",
            doc: "Create directory using mkdir() syscall"
        ),

        InternFnSpec(
            name: "rt_dir_list",
            category: "syscalls",
            params: [{name: "path", type: "text"}],
            return_type: "[text]",
            runtime_fn: "syscall_dir_list",
            doc: "List directory contents using opendir()+readdir()+closedir()"
        ),

        InternFnSpec(
            name: "rt_file_lock",
            category: "syscalls",
            params: [{name: "path", type: "text"}],
            return_type: "i64",
            runtime_fn: "syscall_file_lock",
            doc: "Acquire file lock using fcntl(F_SETLK), returns fd or -1"
        ),

        InternFnSpec(
            name: "rt_file_unlock",
            category: "syscalls",
            params: [{name: "fd", type: "i64"}],
            return_type: "bool",
            runtime_fn: "syscall_file_unlock",
            doc: "Release file lock using fcntl(F_UNLCK) and close fd"
        ),

        # ============================================
        # Environment - Direct Syscalls (3 functions)
        # ============================================

        InternFnSpec(
            name: "rt_env_cwd",
            category: "syscalls",
            params: [],
            return_type: "text",
            runtime_fn: "syscall_env_cwd",
            doc: "Get current working directory using getcwd() syscall"
        ),

        InternFnSpec(
            name: "rt_env_get",
            category: "syscalls",
            params: [{name: "key", type: "text"}],
            return_type: "text",
            runtime_fn: "syscall_env_get",
            doc: "Get environment variable using getenv(), returns empty string if not set"
        ),

        InternFnSpec(
            name: "rt_env_home",
            category: "syscalls",
            params: [],
            return_type: "text",
            runtime_fn: "syscall_env_home",
            doc: "Get home directory using getenv(HOME) or getpwuid()->pw_dir"
        ),

        # ============================================
        # Process - Direct Syscalls (2 functions)
        # ============================================

        InternFnSpec(
            name: "rt_getpid",
            category: "syscalls",
            params: [],
            return_type: "i64",
            runtime_fn: "syscall_getpid",
            doc: "Get process ID using getpid() syscall"
        ),

        InternFnSpec(
            name: "rt_process_run",
            category: "syscalls",
            params: [
                {name: "cmd", type: "text"},
                {name: "args", type: "[text]"}
            ],
            return_type: "i32",
            runtime_fn: "syscall_process_run",
            doc: "Run process using fork()+execvp()+waitpid(), returns exit code"
        ),

        # ============================================
        # System Info - Direct Syscalls (2 functions)
        # ============================================

        InternFnSpec(
            name: "rt_system_cpu_count",
            category: "syscalls",
            params: [],
            return_type: "i64",
            runtime_fn: "syscall_system_cpu_count",
            doc: "Get CPU count using sysconf(_SC_NPROCESSORS_ONLN)"
        ),

        InternFnSpec(
            name: "rt_hostname",
            category: "syscalls",
            params: [],
            return_type: "text",
            runtime_fn: "syscall_hostname",
            doc: "Get hostname using gethostname() syscall"
        ),
    ]
