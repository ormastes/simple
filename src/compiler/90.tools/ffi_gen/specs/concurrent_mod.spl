# Concurrent Module - Full Specification
#
# Complete specification for generating concurrent.rs with:
# - Parallel iteration
# - Thread pools
# - Atomic operations
#
# Usage: simple ffi-gen --gen-module specs/concurrent_mod.spl

use app.ffi_gen.types*
use app.ffi_gen.module_gen (ModuleBuilder)

# ============================================================================
# Module Specification
# ============================================================================

fn concurrent_module() -> ModuleSpec:
    var builder = ModuleBuilder__start("concurrent")
        .doc("Concurrency FFI\n\nParallel iteration, thread pools, and synchronization.")

    # Imports
    builder = builder
        .add_import("std::os::raw::c_char")

    # Concurrent functions (stubs for future implementation)
    builder = builder
        .add_fn(fn_rt_parallel_map())
        .add_fn(fn_rt_thread_count())

    builder.build()

# ============================================================================
# Concurrent Functions
# ============================================================================

fn fn_rt_parallel_map() -> FFIFnSpec:
    var spec = FFIFnSpec__extern_c("rt_parallel_map",
        [FFIParamSpec__simple("_array_ptr", "i64"),
         FFIParamSpec__simple("_fn_ptr", "i64")],
        "i64",
        "// TODO: Implement parallel map with rayon\n" +
        "0"
    )
    spec.doc = "Parallel map operation (stub)"
    spec

fn fn_rt_thread_count() -> FFIFnSpec:
    var spec = FFIFnSpec__extern_c("rt_thread_count",
        [],
        "i64",
        "rayon::current_num_threads() as i64"
    )
    spec.doc = "Get number of threads in thread pool"
    spec
export concurrent_module
