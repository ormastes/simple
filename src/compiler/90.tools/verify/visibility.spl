#!/usr/bin/env simple
# Quick test script for TUI visibility
# Migrated from scripts/verify/test_visibility.sh

use app.io
use app.utils.colors (success, error, warning, info)
use std.log.{log, LOG_INFO}

export main, test_visibility

fn main():
    test_visibility()

fn test_visibility():
    """Test TUI visibility by building and providing test instructions"""

    log(LOG_INFO, "verify", "Building TUI mode...")
    val (stdout, stderr, code) = process_run("cargo",
        ["build", "-p", "simple-driver", "--features", "tui", "--quiet"])

    if code != 0:
        print error("Build failed!")
        print "Errors: {stderr}"
        exit(1)

    print success("✅ Build successful")
    print ""
    print "Manual Test Instructions:"
    print "========================="
    print ""
    print "Run: ./target/debug/simple --tui"
    print ""
    print "Then type exactly:"
    print "  if x > 0:"
    print "  <Press Enter>"
    print "  <Press Tab>"
    print "  if y > 0:"
    print "  <Press Enter>"
    print "  <Press Tab Tab>"
    print "  <Press Backspace>"
    print "  <Press Ctrl+D to exit>"
    print ""
    print "Expected to see:"
    print "  >>> if x > 0:              ← Line visible after Enter ✓"
    print "  ... ····if y > 0:          ← Dots show 4-space indent ✓"
    print "  ... ········               ← Dots show 8-space indent ✓"
    print "  ... ····                   ← After backspace (4 spaces left) ✓"
    print ""
    print info("Starting TUI REPL in 3 seconds...")

    # Sleep for 3 seconds
    val (_, _, _) = process_run("sleep", ["3"])

    # Launch TUI
    val (_, _, _) = process_run("./target/debug/simple", ["--tui"])
