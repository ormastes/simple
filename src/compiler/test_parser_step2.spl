use compiler.parser.*
use compiler.parser_types.*
use compiler.lexer.*
use compiler.blocks.*
use compiler.treesitter.*

print "=== Step-by-step Parser Test ==="
val src = "fn main() -> i64:\n    0\n"

# Step 1: Create TreeSitter outline
print "Step 1: TreeSitter..."
var ts = TreeSitter.new(src)
val outline = ts.parse_outline()
print "  Functions: {outline.functions.len()}"
print "  Exports: {outline.exports.len()}"

# Step 2: Manually parse_full
print "Step 2: Iterating outline..."
print "  Imports count: {outline.imports.len()}"

# Test iteration on imports
var imp_idx = 0
while imp_idx < outline.imports.len():
    print "  import #{imp_idx}"
    imp_idx = imp_idx + 1
print "  Imports iterated OK"

# Test iteration on exports
var exp_idx = 0
while exp_idx < outline.exports.len():
    print "  export #{exp_idx}"
    exp_idx = exp_idx + 1
print "  Exports iterated OK"

# Now try parser.parse_full
print "Step 3: Creating parser..."
var parser = Parser.new(src)
print "  Parser source: '{parser.source}'"
parser.outline = Some(outline)
print "  Outline set"
val module = parser.parse_full()
print "  Module: {module.name}"
print "=== SUCCESS ==="
