# Parser Factory - Interpreter-compatible factory functions
#
# The interpreter cannot call static methods (like Parser.new()) from external
# modules. These standalone functions provide the same functionality using
# direct struct construction within this module.

use lexer.{*, lexer_create_base}
use parser_types.*
use parser.*
use blocks.modes.{LexerMode}

fn create_parser(src: text) -> Parser:
    """Create a Parser from source text.
    Use this instead of Parser.new() when running in interpreter mode."""
    var p = Parser(
        source: src,
        lexer: lexer_create_base(src, nil),
            block_brace_depth: 0,
            unified_registry: nil
        ),
        current: Token(kind: TokenKind.Eof, span: Span(start: 0, end: 0, line: 1, col: 0), text: ""),
        previous: Token(kind: TokenKind.Eof, span: Span(start: 0, end: 0, line: 1, col: 0), text: ""),
        errors: [],
        outline: nil,
        resolved_blocks: nil
    )
    p.advance()
    p

export create_parser
