# FreeBSD Wrapper
#
# Simple (.spl) replacement for bin/freebsd/simple-wrapper.sh
# Uses Linux compatibility layer (Linuxulator) to run the full compiler

use app.io.mod.{shell, shell_bool, get_args, exit}

fn main():
    # Ensure Linux compat is loaded
    shell_bool("kldstat -q -m linux64 2>/dev/null || kldload linux64 2>/dev/null")

    # Build command with all args forwarded
    val args = get_args()
    var cmd = "/usr/local/simple/bin/simple-engine"
    var idx = 1
    for arg in args:
        if idx > 0:
            cmd = cmd + " " + arg
        idx = idx + 1

    # Run the Linux binary
    val result = shell(cmd)
    exit(result.exit_code)

main()
