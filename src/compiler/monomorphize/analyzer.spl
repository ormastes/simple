# Call Site Analyzer
#
# Finds calls to generic functions in a module and collects the
# concrete type arguments needed for monomorphization.
# Handles both explicit generic calls (identity<Int>(42))
# and inferred generic calls (identity(42)).
#
# Port of rust/compiler/src/monomorphize/analyzer.rs (80+ lines)

export CallSite, CallSiteAnalyzer

use monomorphize.engine.ConcreteType

# ============================================================================
# Types
# ============================================================================

struct CallSite:
    function_name: text
    type_args: [ConcreteType]

# ============================================================================
# Call Site Analyzer
# ============================================================================

class CallSiteAnalyzer:
    """Analyzes AST to find calls to generic functions."""
    generic_functions: [text]
    call_sites: [CallSite]
    type_context: {text: ConcreteType}


# ============================================================================
# CallSiteAnalyzer Methods (was: impl CallSiteAnalyzer:)
# ============================================================================

fn callsiteanalyzer_create(generic_function_names: [text]) -> CallSiteAnalyzer:
        CallSiteAnalyzer(generic_functions: generic_function_names,
                         call_sites: [], type_context: {})

