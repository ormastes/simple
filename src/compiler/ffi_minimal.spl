# Minimal FFI Declarations for Simple Runtime
# # This module declares the essential FFI functions from build/rust/ffi_gen
# These functions are implemented in Rust and linked via C ABI.
# # NOTE: This module provides low-level FFI bindings. For normal Simple code,
# use the standard library types (Int, String, List, etc.) which will
# eventually use these FFI functions under the hood.

# ==============================================================================
# Value Type
# ==============================================================================

# Value type tags
enum ValueType:
    Nil
    Bool
    Int
    Float
    String
    Array
    Dict
    Object
    Function

# ==============================================================================
# RuntimeValue - Opaque pointer type
# ==============================================================================

# Opaque pointer to RuntimeValue (managed by Rust FFI)
# In Simple, we represent C pointers as i64 for now
type RuntimeValuePtr = i64

# ==============================================================================
# Garbage Collector
# ==============================================================================

extern fn rt_gc_init()
extern fn rt_gc_malloc(size: i64) -> i64
extern fn rt_gc_collect()

# ==============================================================================
# Constructors
# ==============================================================================

extern fn rt_value_nil() -> RuntimeValuePtr
extern fn rt_value_bool(value: bool) -> RuntimeValuePtr
extern fn rt_value_int(value: i64) -> RuntimeValuePtr
extern fn rt_value_float(value: f64) -> RuntimeValuePtr
extern fn rt_value_string(ptr: i64, len: i64) -> RuntimeValuePtr
extern fn rt_value_array_new() -> RuntimeValuePtr
extern fn rt_value_dict_new() -> RuntimeValuePtr

# ==============================================================================
# Type Checking
# ==============================================================================

extern fn rt_value_type(value: RuntimeValuePtr) -> ValueType
extern fn rt_value_is_nil(value: RuntimeValuePtr) -> bool
extern fn rt_value_is_bool(value: RuntimeValuePtr) -> bool
extern fn rt_value_is_int(value: RuntimeValuePtr) -> bool
extern fn rt_value_is_float(value: RuntimeValuePtr) -> bool
extern fn rt_value_is_string(value: RuntimeValuePtr) -> bool
extern fn rt_value_is_array(value: RuntimeValuePtr) -> bool
extern fn rt_value_is_dict(value: RuntimeValuePtr) -> bool

# ==============================================================================
# Conversions
# ==============================================================================

extern fn rt_value_as_bool(value: RuntimeValuePtr) -> bool
extern fn rt_value_as_int(value: RuntimeValuePtr) -> i64
extern fn rt_value_as_float(value: RuntimeValuePtr) -> f64
extern fn rt_value_as_string(value: RuntimeValuePtr, out_len: i64) -> i64

# ==============================================================================
# Arithmetic Operations
# ==============================================================================

extern fn rt_value_add(left: RuntimeValuePtr, right: RuntimeValuePtr) -> RuntimeValuePtr
extern fn rt_value_sub(left: RuntimeValuePtr, right: RuntimeValuePtr) -> RuntimeValuePtr
extern fn rt_value_mul(left: RuntimeValuePtr, right: RuntimeValuePtr) -> RuntimeValuePtr
extern fn rt_value_div(left: RuntimeValuePtr, right: RuntimeValuePtr) -> RuntimeValuePtr

# ==============================================================================
# Comparison
# ==============================================================================

extern fn rt_value_eq(left: RuntimeValuePtr, right: RuntimeValuePtr) -> bool
extern fn rt_value_lt(left: RuntimeValuePtr, right: RuntimeValuePtr) -> bool

# ==============================================================================
# Printing
# ==============================================================================

extern fn rt_value_print(value: RuntimeValuePtr)
extern fn rt_value_println(value: RuntimeValuePtr)

# ==============================================================================
# Memory Management
# ==============================================================================

extern fn rt_value_free(value: RuntimeValuePtr)
extern fn rt_value_clone(value: RuntimeValuePtr) -> RuntimeValuePtr

# ==============================================================================
# File I/O
# ==============================================================================

extern fn rt_file_exists(path_ptr: i64, path_len: i64) -> bool
extern fn rt_file_read_text(path_ptr: i64, path_len: i64) -> i64
extern fn rt_file_write_text(path_ptr: i64, path_len: i64, content_ptr: i64, content_len: i64) -> bool
extern fn rt_file_delete(path_ptr: i64, path_len: i64) -> bool
extern fn rt_string_free(ptr: i64)

# ==============================================================================
# Environment Variables
# ==============================================================================

extern fn rt_env_get(name_ptr: i64, name_len: i64) -> i64
extern fn rt_env_set(name_ptr: i64, name_len: i64, value_ptr: i64, value_len: i64) -> bool

# ==============================================================================
# Wrapper Functions (Two-Tier Pattern)
# ==============================================================================

# GC wrappers
fn gc_init():
    # Stub: GC not available in bootstrap
    pass_do_nothing

fn gc_malloc(size: i64) -> i64:
    # Stub: GC not available in bootstrap
    0

fn gc_collect():
    rt_gc_collect()

# Constructor wrappers
fn value_nil() -> RuntimeValuePtr:
    rt_value_nil()

fn value_bool(value: bool) -> RuntimeValuePtr:
    rt_value_bool(value)

fn value_int(value: i64) -> RuntimeValuePtr:
    rt_value_int(value)

fn value_float(value: f64) -> RuntimeValuePtr:
    rt_value_float(value)

fn value_string(ptr: i64, len: i64) -> RuntimeValuePtr:
    rt_value_string(ptr, len)

fn value_array_new() -> RuntimeValuePtr:
    rt_value_array_new()

fn value_dict_new() -> RuntimeValuePtr:
    rt_value_dict_new()

# Type checking wrappers
fn value_type(value: RuntimeValuePtr) -> ValueType:
    rt_value_type(value)

fn value_is_nil(value: RuntimeValuePtr) -> bool:
    rt_value_is_nil(value)

fn value_is_bool(value: RuntimeValuePtr) -> bool:
    rt_value_is_bool(value)

fn value_is_int(value: RuntimeValuePtr) -> bool:
    rt_value_is_int(value)

fn value_is_float(value: RuntimeValuePtr) -> bool:
    rt_value_is_float(value)

fn value_is_string(value: RuntimeValuePtr) -> bool:
    rt_value_is_string(value)

fn value_is_array(value: RuntimeValuePtr) -> bool:
    rt_value_is_array(value)

fn value_is_dict(value: RuntimeValuePtr) -> bool:
    rt_value_is_dict(value)

# Conversion wrappers
fn value_as_bool(value: RuntimeValuePtr) -> bool:
    rt_value_as_bool(value)

fn value_as_int(value: RuntimeValuePtr) -> i64:
    rt_value_as_int(value)

fn value_as_float(value: RuntimeValuePtr) -> f64:
    rt_value_as_float(value)

fn value_as_string(value: RuntimeValuePtr, out_len: i64) -> i64:
    rt_value_as_string(value, out_len)

# Arithmetic wrappers
fn value_add(left: RuntimeValuePtr, right: RuntimeValuePtr) -> RuntimeValuePtr:
    rt_value_add(left, right)

fn value_sub(left: RuntimeValuePtr, right: RuntimeValuePtr) -> RuntimeValuePtr:
    rt_value_sub(left, right)

fn value_mul(left: RuntimeValuePtr, right: RuntimeValuePtr) -> RuntimeValuePtr:
    rt_value_mul(left, right)

fn value_div(left: RuntimeValuePtr, right: RuntimeValuePtr) -> RuntimeValuePtr:
    rt_value_div(left, right)

# Comparison wrappers
fn value_eq(left: RuntimeValuePtr, right: RuntimeValuePtr) -> bool:
    rt_value_eq(left, right)

fn value_lt(left: RuntimeValuePtr, right: RuntimeValuePtr) -> bool:
    rt_value_lt(left, right)

# Printing wrappers
fn value_print(value: RuntimeValuePtr):
    rt_value_print(value)

fn value_println(value: RuntimeValuePtr):
    rt_value_println(value)

# Memory management wrappers
fn value_free(value: RuntimeValuePtr):
    rt_value_free(value)

fn value_clone(value: RuntimeValuePtr) -> RuntimeValuePtr:
    rt_value_clone(value)

# File I/O wrappers
fn file_exists_ptr(path_ptr: i64, path_len: i64) -> bool:
    rt_file_exists(path_ptr, path_len)

fn file_read_text_ptr(path_ptr: i64, path_len: i64) -> i64:
    rt_file_read_text(path_ptr, path_len)

fn file_write_text_ptr(path_ptr: i64, path_len: i64, content_ptr: i64, content_len: i64) -> bool:
    rt_file_write_text(path_ptr, path_len, content_ptr, content_len)

fn file_delete_ptr(path_ptr: i64, path_len: i64) -> bool:
    rt_file_delete(path_ptr, path_len)

fn string_free(ptr: i64):
    rt_string_free(ptr)

# Environment wrappers
fn env_get_ptr(name_ptr: i64, name_len: i64) -> i64:
    rt_env_get(name_ptr, name_len)

fn env_set_ptr(name_ptr: i64, name_len: i64, value_ptr: i64, value_len: i64) -> bool:
    rt_env_set(name_ptr, name_len, value_ptr, value_len)

# ==============================================================================
# Exports
# ==============================================================================

export ValueType
export RuntimeValuePtr

# GC exports
export gc_init, gc_malloc, gc_collect

# Constructor exports
export value_nil, value_bool, value_int, value_float, value_string
export value_array_new, value_dict_new

# Type checking exports
export value_type, value_is_nil, value_is_bool, value_is_int, value_is_float
export value_is_string, value_is_array, value_is_dict

# Conversion exports
export value_as_bool, value_as_int, value_as_float, value_as_string

# Arithmetic exports
export value_add, value_sub, value_mul, value_div

# Comparison exports
export value_eq, value_lt

# Printing exports
export value_print, value_println

# Memory management exports
export value_free, value_clone

# File I/O exports
export file_exists_ptr, file_read_text_ptr, file_write_text_ptr, file_delete_ptr
export string_free

# Environment exports
export env_get_ptr, env_set_ptr
