# File Module Storage Adapter (Production)
#
# Implements ModuleStoragePort using actual disk file reads.
# Used in production compilation.
#
# Design: doc/report/compiler_mdsoc_impl_plan.md Phase 5b

use compiler.feature.module_loading.app.ports.{ModuleStoragePort}

extern fn rt_file_read_text(path: text) -> text

fn _file_read_source(path: text) -> text:
    rt_file_read_text(path) ?? ""

fn create_file_module_storage() -> ModuleStoragePort:
    """Create a file system backed module storage adapter.

    Reads source files from disk using the runtime file I/O.
    Returns empty string for missing or unreadable files.
    """
    ModuleStoragePort(
        name: "file-module-storage",
        read_source_fn: _file_read_source
    )

export create_file_module_storage
