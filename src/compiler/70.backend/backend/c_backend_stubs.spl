# C Backend - Stub Trait Methods
#
# Unimplemented trait methods for GPU, VHDL, SIMD, and async/actor
# features. These are stubs that emit comments or zero-assign for
# features that require specialized backends.
#
# Split from c_backend.spl - these are all `impl MirTextCodegen for MirToC`.

use compiler.mir.mir_data.*
use compiler.backend.c_type_mapper.{CTypeMapper, CTypeMapper__create, CTypeMapper__create_for_target}
use compiler.backend.c_ir_builder.{CIRBuilder, CIRBuilder__create, escape_c_string}
use compiler.backend.common.mir_text_codegen.MirTextCodegen
use compiler.core.backend_types.{CodegenTarget, CompileOptions, CompiledModule}

# ============================================================================
# Async / Actor Stubs
# ============================================================================

impl MirTextCodegen for MirToC:

    me translate_create_promise(dest: LocalId, body: LocalId, result_type: MirType):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "(void*)0")
        self.builder.emit_comment("CreatePromise (async stub)")

    me translate_await(dest: LocalId, promise: MirOperand):
        val dest_name = self.get_local(dest.id)
        val promise_val = self.translate_operand(promise)
        self.builder.emit_assign(dest_name, "0")
        self.builder.emit_comment("Await (async stub)")

    me translate_yield(value: MirOperand?):
        self.builder.emit_comment("Yield (async stub)")

    me translate_spawn(dest: LocalId, handler: MirOperand, args: [MirOperand]):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "(void*)0")
        self.builder.emit_comment("Spawn (async stub)")

    me translate_send(target: MirOperand, message: MirOperand):
        self.builder.emit_comment("Send (actor stub)")

    me translate_receive(dest: LocalId, timeout: MirOperand?):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")
        self.builder.emit_comment("Receive (actor stub)")

# ============================================================================
# GPU Stubs
# ============================================================================

    me translate_gpu_kernel_def(name: text):
        self.builder.emit_comment(r"GpuKernelDef: " + name + r" (requires GPU backend)")

    me translate_gpu_launch(args: [text]):
        self.builder.emit_comment("GpuLaunch (requires GPU backend)")

    me translate_gpu_global_id(dest: LocalId, dim: i64):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")

    me translate_gpu_local_id(dest: LocalId, dim: i64):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")

    me translate_gpu_block_id(dest: LocalId, dim: i64):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")

    me translate_gpu_block_dim(dest: LocalId, dim: i64):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")

    me translate_gpu_grid_dim(dest: LocalId, dim: i64):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")

    me translate_gpu_barrier(scope: GpuBarrierScope):
        self.builder.emit_comment("GpuBarrier (requires GPU backend)")

    me translate_gpu_mem_fence(scope: GpuMemoryScope):
        self.builder.emit_comment("GpuMemFence (requires GPU backend)")

    me translate_gpu_shared_alloc(dest: LocalId, type_: MirType, size: i64):
        val slot_name = self.ensure_stack_slot(dest.id, size)
        self.emit_pointer_assign(dest.id, slot_name)

    me translate_gpu_atomic_op(dest: LocalId, op: GpuAtomicOpKind, ptr: MirOperand, value: MirOperand):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")
        self.builder.emit_comment("GpuAtomicOp (requires GPU backend)")

# ============================================================================
# VHDL Stubs
# ============================================================================

    me translate_vhdl_process(kind: VhdlProcessKind, body_block: BlockId):
        self.builder.emit_comment("VhdlProcess (requires VHDL backend)")

    me translate_vhdl_signal_assign(target: MirOperand, value: MirOperand, delay_ns: i64?):
        self.builder.emit_comment("VhdlSignalAssign (requires VHDL backend)")

    me translate_vhdl_var_assign(target: MirOperand, value: MirOperand):
        self.builder.emit_comment("VhdlVarAssign (requires VHDL backend)")

    me translate_vhdl_port_map(entity: text, instance: text, connections: [(text, MirOperand)]):
        self.builder.emit_comment(r"VhdlPortMap: " + entity + r"/" + instance + r" (requires VHDL backend)")

    me translate_vhdl_resize(dest: LocalId, operand: MirOperand, new_width: i64, signed: bool):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")

    me translate_vhdl_slice(dest: LocalId, signal: MirOperand, hi: i64, lo: i64):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")

    me translate_vhdl_concat(dest: LocalId, parts: [MirOperand]):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")

# ============================================================================
# SIMD Stubs
# ============================================================================

    me translate_simd_binop(dest: LocalId, a: MirOperand, b: MirOperand, op_name: text):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")
        self.builder.emit_comment(r"SIMD " + op_name + r" (scalar fallback stub)")

    me translate_simd_fma(dest: LocalId, a: MirOperand, b: MirOperand, c: MirOperand, op_name: text):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")
        self.builder.emit_comment(r"SIMD " + op_name + r" (stub)")

    me translate_simd_horizontal(dest: LocalId, a: MirOperand, op_name: text):
        val dest_name = self.get_local(dest.id)
        self.builder.emit_assign(dest_name, "0")
        self.builder.emit_comment(r"SIMD " + op_name + r" (stub)")
