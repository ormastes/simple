# WASM Codegen Adapter
#
# Wraps WebAssembly code generation to implement the Codegen trait.
# Currently produces stub WAT output.

use compiler.mir.mir_data.{MirModule}
use compiler.core.backend_types.{BackendKind, CodegenTarget, CompileOptions, CompileError}
use compiler.backend.codegen_types.{Codegen, CodegenOutput, CodegenOutputKind}

# ============================================================================
# WASM Codegen Adapter
# ============================================================================

class WasmCodegenAdapter:
    """Adapts WebAssembly generation to the Codegen trait interface."""
    options: CompileOptions

impl Codegen for WasmCodegenAdapter:
    fn backend_kind() -> BackendKind: BackendKind.Wasm
    fn backend_name() -> text: "wasm"

    fn supports_target(target: CodegenTarget) -> bool:
        match target:
            case Wasm32: true
            case _: false

    fn output_kind() -> CodegenOutputKind: CodegenOutputKind.TextSource

    fn compile_module(module: MirModule) -> Result<CodegenOutput, CompileError>:
        # TODO: integrate MirToWat when available
        Ok(CodegenOutput.text(module.name, "(module)"))

# ============================================================================
# Exports
# ============================================================================

export WasmCodegenAdapter
