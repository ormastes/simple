# C Codegen Adapter
#
# Wraps MirToC translator to implement the Codegen trait.
# Delegates to existing C++20 code generation.

use compiler.mir_data.{MirModule}
use compiler.core.backend_types.{BackendKind, CodegenTarget, CompileOptions, CompileError}
use compiler.backend.codegen_types.{Codegen, CodegenOutput, CodegenOutputKind}
use compiler.backend.c_backend.{MirToC, MirToC__create}

# ============================================================================
# C Codegen Adapter
# ============================================================================

class CCodegenAdapter:
    """Adapts MirToC translator to the Codegen trait interface."""
    options: CompileOptions

impl Codegen for CCodegenAdapter:
    fn backend_kind() -> BackendKind: BackendKind.CCodegen
    fn backend_name() -> text: "c"
    fn supports_target(target: CodegenTarget) -> bool: true
    fn output_kind() -> CodegenOutputKind: CodegenOutputKind.TextSource

    fn compile_module(module: MirModule) -> Result<CodegenOutput, CompileError>:
        var translator = MirToC__create(module.name)
        val c_source = translator.translate_module(module)
        val h_source = translator.build_header()
        Ok(CodegenOutput.text_with_header(module.name, c_source, h_source))

# ============================================================================
# Exports
# ============================================================================

export CCodegenAdapter
