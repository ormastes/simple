# ISel Common Structs and Utilities
#
# Shared data structures and helper functions used by all native ISel backends
# (x86_64, AArch64, RISC-V 64, RISC-V 32).

use compiler.backend.native.mach_inst.{MachReg, virtual_reg, Operand, op_reg, MachInst, MachBlock, MachFunction}
use compiler.backend.common.isel_context.{ISelContext}

# ============================================================================
# Shared Result Structs
# ============================================================================

struct LoweredOperand:
    insts: [MachInst]
    result: Operand
    ctx: ISelContext

struct ISelFuncResult:
    func: MachFunction
    ctx: ISelContext

struct ISelBlockResult:
    block: MachBlock
    ctx: ISelContext

struct ISelInstResult:
    insts: [MachInst]
    ctx: ISelContext

# ============================================================================
# Local to Virtual Register Mapping
# ============================================================================

fn local_to_vreg(local_id: i64) -> MachReg:
    virtual_reg(local_id)

fn local_vreg_op(local_id: i64) -> Operand:
    op_reg(virtual_reg(local_id))

# ============================================================================
# Exports
# ============================================================================

export LoweredOperand, ISelFuncResult, ISelBlockResult, ISelInstResult
export local_to_vreg, local_vreg_op
