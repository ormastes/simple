# GpuCodegen Trait - GPU Kernel Compilation Interface
#
# Implemented by CUDA and Vulkan backends.
# Provides GPU-specific compilation capabilities including
# kernel compilation, barrier synchronization, and atomic operations.

use compiler.mir_data.{MirBody, MirInst, MirOperand, LocalId}
use compiler.core.backend_types.{CompileError}

# ============================================================================
# GPU Barrier Scope
# ============================================================================

enum GpuBarrierScope:
    """Scope of a GPU synchronization barrier."""
    Workgroup   # Thread block / workgroup level
    Device      # Device-wide barrier
    Subgroup    # Warp / subgroup level

# ============================================================================
# GPU Atomic Operation Kind
# ============================================================================

enum GpuAtomicOpKind:
    """Kind of atomic operation on GPU."""
    Add
    Sub
    Min
    Max
    And
    Or
    Xor
    Exchange
    CompareExchange

# ============================================================================
# GpuCodegen Trait
# ============================================================================

trait GpuCodegen:
    """Interface for GPU code generation backends."""
    fn compile_kernel(func_name: text, body: MirBody) -> Result<text, CompileError>
    fn compile_device_function(func_name: text, body: MirBody) -> Result<text, CompileError>
    fn compile_gpu_instruction(inst: MirInst) -> text
    fn compile_barrier(scope: GpuBarrierScope) -> text
    fn compile_atomic(op: GpuAtomicOpKind, dest: LocalId, ptr: MirOperand, value: MirOperand) -> text
    fn gpu_memory_model() -> text
    fn is_kernel_function(body: MirBody) -> bool

# ============================================================================
# Exports
# ============================================================================

export GpuCodegen, GpuBarrierScope, GpuAtomicOpKind
