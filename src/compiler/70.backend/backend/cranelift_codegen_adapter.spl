# Cranelift Codegen Adapter
#
# Implements the Codegen trait for the Cranelift backend.
# Cranelift requires compiled mode (FFI calls); in interpreter mode,
# this adapter returns an error suggesting --backend=llvm.

use compiler.mir.mir_data.{MirModule}
use compiler.core.backend_types.{BackendKind, CodegenTarget, CompileOptions, CompileError, compileerror_backend_error}
use compiler.backend.codegen_types.{Codegen, CodegenOutput, CodegenOutputKind}

# ============================================================================
# Cranelift Codegen Adapter
# ============================================================================

class CraneliftCodegenAdapter:
    """Adapts Cranelift backend to the Codegen trait interface."""
    options: CompileOptions

impl Codegen for CraneliftCodegenAdapter:
    fn backend_kind() -> BackendKind: BackendKind.Cranelift
    fn backend_name() -> text: "cranelift"

    fn supports_target(target: CodegenTarget) -> bool:
        match target:
            case X86_64 | AArch64 | Riscv64: true
            case Host: true
            case _: false

    fn output_kind() -> CodegenOutputKind: CodegenOutputKind.ObjectCode

    fn compile_module(module: MirModule) -> Result<CodegenOutput, CompileError>:
        Err(compileerror_backend_error(BackendKind.Cranelift,
            "Cranelift backend is stubbed; use --backend=llvm. If you intended Cranelift, install llc and select llvm until implementation lands."))

# ============================================================================
# Exports
# ============================================================================

export CraneliftCodegenAdapter
