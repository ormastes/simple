# CRT Discovery - stubbed for bootstrap
# Original backed up to /tmp/crt_discovery.spl.bak

struct CrtFiles:
    crt1: text
    crti: text
    crtn: text
    crtbegin: text
    crtend: text
    dynamic_linker: text
    lib_dirs: [text]
    found: bool

fn find_crt_files(pie: bool, verbose: bool) -> CrtFiles:
    CrtFiles(
        crt1: "/usr/lib/x86_64-linux-gnu/crt1.o",
        crti: "/usr/lib/x86_64-linux-gnu/crti.o",
        crtn: "/usr/lib/x86_64-linux-gnu/crtn.o",
        crtbegin: "",
        crtend: "",
        dynamic_linker: "/lib64/ld-linux-x86-64.so.2",
        lib_dirs: ["/usr/lib/x86_64-linux-gnu"],
        found: true
    )

fn find_dynamic_linker() -> text:
    "/lib64/ld-linux-x86-64.so.2"

fn find_gcc_lib_dirs() -> [text]:
    ["/usr/lib/gcc/x86_64-linux-gnu/13"]

fn path_dirname(path: text) -> text:
    val last_slash = path.last_index_of("/")
    if last_slash >= 0:
        path.substring(0, last_slash)
    else:
        ""

fn cc_print_file(name: text) -> text:
    name

export find_crt_files, find_dynamic_linker, find_gcc_lib_dirs, path_dirname, cc_print_file
export CrtFiles
