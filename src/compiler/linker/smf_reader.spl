# Compatibility SMF reader types for loader tests/imports.

enum Platform:
    Linux
    MacOS
    Windows

enum Arch:
    X86_64
    Aarch64

enum CompressionType:
    None_
    Lz4

class SmfFlags:
    executable: bool
    reloadable: bool
    debug_info: bool
    pic: bool
    has_stub: bool

class SmfHeader:
    version: (i64, i64)
    platform: Platform
    arch: Arch
    flags: SmfFlags
    section_count: i64
    symbol_count: i64
    entry_point: i64
    has_templates: bool
    has_note_sdn: bool
    compression: CompressionType

class SmfReaderImpl:
    ffi: any
    file_path: text
    header: SmfHeader
    symbols: Dict
    string_table: [text]
    sections: [text]
    note_sdn_cache: any

fn SmfReaderImpl__open(path: text) -> Result<SmfReaderImpl, text>:
    val hdr = SmfHeader(
        version: (1, 1),
        platform: Platform.Linux,
        arch: Arch.X86_64,
        flags: SmfFlags(executable: false, reloadable: false, debug_info: false, pic: false, has_stub: false),
        section_count: 0,
        symbol_count: 0,
        entry_point: 0,
        has_templates: false,
        has_note_sdn: false,
        compression: CompressionType.None_
    )
    Ok(SmfReaderImpl(ffi: nil, file_path: path, header: hdr, symbols: {}, string_table: [], sections: [], note_sdn_cache: nil))

fn reader_result_is_err(r: Result<SmfReaderImpl, text>) -> bool:
    r.is_err()

val reader_result_value = SmfReaderImpl(
    ffi: nil,
    file_path: "",
    header: SmfHeader(
        version: (1, 1),
        platform: Platform.Linux,
        arch: Arch.X86_64,
        flags: SmfFlags(executable: false, reloadable: false, debug_info: false, pic: false, has_stub: false),
        section_count: 0,
        symbol_count: 0,
        entry_point: 0,
        has_templates: false,
        has_note_sdn: false,
        compression: CompressionType.None_
    ),
    symbols: {},
    string_table: [],
    sections: [],
    note_sdn_cache: nil
)

export Platform, Arch, CompressionType
export SmfFlags, SmfHeader, SmfReaderImpl
export SmfReaderImpl__open
export reader_result_is_err, reader_result_value
