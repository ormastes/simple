# Feature Definitions
# All debug capabilities expressed as FeatureId values.
# Each backend registers handlers for features at a numeric rank.

# Debug capability identifier
enum FeatureId:
    # Execution control
    Halt
    Resume
    SingleStep
    StepOver
    Reset

    # Memory
    ReadMemory
    WriteMemory

    # Registers
    ReadRegister
    WriteRegister
    ReadAllRegisters

    # Breakpoints
    SetBreakpoint
    ClearBreakpoint
    SetWatchpoint

    # Inspection
    ReadLocals
    ReadGlobals
    ReadArguments
    EvaluateExpression
    ReadStackTrace

    # Trace32-unique features
    FlashProgram
    TraceCapture
    CoverageCollect
    ProfileSample
    SystemReset

    fn to_string() -> text:
        match self:
            Halt: "Halt"
            Resume: "Resume"
            SingleStep: "SingleStep"
            StepOver: "StepOver"
            Reset: "Reset"
            ReadMemory: "ReadMemory"
            WriteMemory: "WriteMemory"
            ReadRegister: "ReadRegister"
            WriteRegister: "WriteRegister"
            ReadAllRegisters: "ReadAllRegisters"
            SetBreakpoint: "SetBreakpoint"
            ClearBreakpoint: "ClearBreakpoint"
            SetWatchpoint: "SetWatchpoint"
            ReadLocals: "ReadLocals"
            ReadGlobals: "ReadGlobals"
            ReadArguments: "ReadArguments"
            EvaluateExpression: "EvaluateExpression"
            ReadStackTrace: "ReadStackTrace"
            FlashProgram: "FlashProgram"
            TraceCapture: "TraceCapture"
            CoverageCollect: "CoverageCollect"
            ProfileSample: "ProfileSample"
            SystemReset: "SystemReset"

    fn eq(other: FeatureId) -> bool:
        self.to_string() == other.to_string()

# Rank constants for feature handler priority
# Lower rank = preferred handler
class FeatureRank:
    # Rank 0: Native support (zero overhead, direct protocol command)
    static fn NATIVE() -> i32:
        0

    # Rank 1: Bridge translation (minor overhead, translated command)
    static fn BRIDGE() -> i32:
        1

    # Rank 2: Secondary native (alternative protocol, higher overhead)
    static fn SECONDARY() -> i32:
        2

    # Rank 3: External tool (OpenOCD, etc.)
    static fn EXTERNAL() -> i32:
        3

    # Rank 4: Emulated (synthesized from lower-level operations)
    static fn EMULATED() -> i32:
        4

# Feature rank table: default rankings per backend
#
# | Feature            | GDB | T32-GDB | T32-Native | Emulated |
# |--------------------|-----|---------|------------|----------|
# | Halt               |  0  |    1    |     2      |    -     |
# | Resume             |  0  |    1    |     2      |    -     |
# | SingleStep         |  0  |    1    |     2      |    -     |
# | ReadMemory         |  0  |    1    |     2      |    -     |
# | WriteMemory        |  0  |    1    |     2      |    -     |
# | ReadRegister       |  0  |    1    |     2      |    -     |
# | ReadLocals         |  0  |    1    |     -      |    4     |
# | ReadArguments      |  0  |    1    |     -      |    4     |
# | ReadStackTrace     |  0  |    1    |     2      |    4     |
# | EvaluateExpression |  0  |    1    |     2      |    -     |
# | SetBreakpoint      |  0  |    1    |     2      |    -     |
# | FlashProgram       |  -  |    -    |     0      |    3     |
# | TraceCapture       |  -  |    -    |     0      |    -     |
# | CoverageCollect    |  -  |    -    |     0      |    -     |
# | ProfileSample      |  -  |    -    |     0      |    3     |
