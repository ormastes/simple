# Remote Debug - Core Types
# Shared enums, config, and error types for remote debugging.

# Target architecture
enum Architecture:
    Arm32
    Arm64
    RiscV32
    RiscV64
    X86
    X86_64

    fn to_string() -> text:
        match self:
            Arm32: "arm32"
            Arm64: "arm64"
            RiscV32: "riscv32"
            RiscV64: "riscv64"
            X86: "x86"
            X86_64: "x86_64"

# Byte order
enum Endianness:
    Little
    Big

    fn to_string() -> text:
        match self:
            Little: "little"
            Big: "big"

# Reason the target halted
enum HaltReason:
    Breakpoint(addr: i64)
    Watchpoint(addr: i64)
    SingleStep
    Halt
    Exception(code: i32)

    fn to_string() -> text:
        match self:
            Breakpoint(addr): "breakpoint at 0x{addr}"
            Watchpoint(addr): "watchpoint at 0x{addr}"
            SingleStep: "single step"
            Halt: "halt"
            Exception(code): "exception {code}"

# Debug operation errors
enum DebugError:
    ConnectionFailed(msg: text)
    Timeout
    TargetNotHalted
    InvalidAddress(addr: i64)
    InvalidRegister(index: i32)
    BreakpointFull
    ProtocolError(msg: text)
    NotSupported(msg: text)

    fn to_string() -> text:
        match self:
            ConnectionFailed(msg): "connection failed: {msg}"
            Timeout: "timeout"
            TargetNotHalted: "target not halted"
            InvalidAddress(addr): "invalid address: 0x{addr}"
            InvalidRegister(index): "invalid register: {index}"
            BreakpointFull: "breakpoint slots full"
            ProtocolError(msg): "protocol error: {msg}"
            NotSupported(msg): "not supported: {msg}"

# Configuration for a debug connection
class DebugConfig:
    host: text
    port: i32
    target: Architecture
    program: text
    options: Dict<text, text>

    static fn default_gdb(program: text) -> DebugConfig:
        DebugConfig(
            host: "localhost",
            port: 1234,
            target: Architecture.RiscV32,
            program: program,
            options: {}
        )

    static fn for_trace32(host: text, port: i32) -> DebugConfig:
        DebugConfig(
            host: host,
            port: port,
            target: Architecture.RiscV32,
            program: "",
            options: {}
        )
