# @no_alloc
# Layout metadata for structs and fields
# Provides StructLayoutInfo queried by the C codegen and tooling
# @tag:api
# @tag:internal

export StructLayoutInfo, layout_info_new
export layout_info_has_repr, layout_info_field_is_volatile
export layout_info_repr_attrs, layout_info_volatile_fields

# Layout metadata for a struct declaration
# First (and only) struct in this file â€” direct construction works
struct StructLayoutInfo:
    struct_name: text
    repr_attrs: [text]
    volatile_fields: [text]

fn layout_info_new(struct_name: text, repr_attrs: [text], volatile_fields: [text]) -> StructLayoutInfo:
    StructLayoutInfo(
        struct_name: struct_name,
        repr_attrs: repr_attrs,
        volatile_fields: volatile_fields
    )

fn layout_info_has_repr(info: StructLayoutInfo, repr: text) -> bool:
    for r in info.repr_attrs:
        if r == repr:
            return true
    false

fn layout_info_field_is_volatile(info: StructLayoutInfo, field_name: text) -> bool:
    for f in info.volatile_fields:
        if f == field_name:
            return true
    false

fn layout_info_repr_attrs(info: StructLayoutInfo) -> [text]:
    info.repr_attrs

fn layout_info_volatile_fields(info: StructLayoutInfo) -> [text]:
    info.volatile_fields
