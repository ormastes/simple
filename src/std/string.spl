# String Extension Methods
#
# Provides string utility functions not available as built-in methods.
# Pure Simple implementation - no external dependencies.
#
# Functions:
# - char_code: Get ASCII code of a single character
# - text_hash: FNV-1a hash for strings
# - text_trim_start_matches: Remove prefix pattern repeatedly
# - text_trim_end_matches: Remove suffix pattern repeatedly
# - text_contains_char: Check if string contains a character
# - text_index_of_char: Find index of character in string

# ============================================================================
# ASCII Character Code Lookup
# ============================================================================

fn char_code(c: text) -> i64:
    """Get ASCII code of a single character. Returns 0 for unknown characters.
    Note: Runtime's .to_int() returns 0 for single chars, so we use a lookup table."""
    if c == " ": return 32
    if c == "!": return 33
    if c == "#": return 35
    if c == "$": return 36
    if c == "%": return 37
    if c == "&": return 38
    if c == "'": return 39
    if c == "(": return 40
    if c == ")": return 41
    if c == "*": return 42
    if c == "+": return 43
    if c == ",": return 44
    if c == "-": return 45
    if c == ".": return 46
    if c == "/": return 47
    if c == "0": return 48
    if c == "1": return 49
    if c == "2": return 50
    if c == "3": return 51
    if c == "4": return 52
    if c == "5": return 53
    if c == "6": return 54
    if c == "7": return 55
    if c == "8": return 56
    if c == "9": return 57
    if c == ":": return 58
    if c == ";": return 59
    if c == "<": return 60
    if c == "=": return 61
    if c == ">": return 62
    if c == "?": return 63
    if c == "@": return 64
    if c == "A": return 65
    if c == "B": return 66
    if c == "C": return 67
    if c == "D": return 68
    if c == "E": return 69
    if c == "F": return 70
    if c == "G": return 71
    if c == "H": return 72
    if c == "I": return 73
    if c == "J": return 74
    if c == "K": return 75
    if c == "L": return 76
    if c == "M": return 77
    if c == "N": return 78
    if c == "O": return 79
    if c == "P": return 80
    if c == "Q": return 81
    if c == "R": return 82
    if c == "S": return 83
    if c == "T": return 84
    if c == "U": return 85
    if c == "V": return 86
    if c == "W": return 87
    if c == "X": return 88
    if c == "Y": return 89
    if c == "Z": return 90
    if c == "[": return 91
    if c == "]": return 93
    if c == "^": return 94
    if c == "_": return 95
    if c == "a": return 97
    if c == "b": return 98
    if c == "c": return 99
    if c == "d": return 100
    if c == "e": return 101
    if c == "f": return 102
    if c == "g": return 103
    if c == "h": return 104
    if c == "i": return 105
    if c == "j": return 106
    if c == "k": return 107
    if c == "l": return 108
    if c == "m": return 109
    if c == "n": return 110
    if c == "o": return 111
    if c == "p": return 112
    if c == "q": return 113
    if c == "r": return 114
    if c == "s": return 115
    if c == "t": return 116
    if c == "u": return 117
    if c == "v": return 118
    if c == "w": return 119
    if c == "x": return 120
    if c == "y": return 121
    if c == "z": return 122
    if c == "{": return 123
    if c == "|": return 124
    if c == "}": return 125
    if c == "~": return 126
    if c == "\n": return 10
    if c == "\t": return 9
    if c == "\r": return 13
    0

# ============================================================================
# String Hashing
# ============================================================================

fn text_hash(s: text) -> i64:
    """FNV-1a hash of a string. Returns a deterministic i64 hash value."""
    var hash = 2166136261
    var i = 0
    while i < s.len():
        val code = char_code(s[i])
        hash = (hash xor code) * 16777619
        i = i + 1
    hash

# ============================================================================
# Trim Matching Patterns
# ============================================================================

fn text_trim_start_matches(s: text, pattern: text) -> text:
    """Remove all occurrences of pattern from the start of the string."""
    if pattern.len() == 0:
        return s
    var result = s
    while result.starts_with(pattern):
        result = result[pattern.len():]
    result

fn text_trim_end_matches(s: text, pattern: text) -> text:
    """Remove all occurrences of pattern from the end of the string."""
    if pattern.len() == 0:
        return s
    var result = s
    while result.ends_with(pattern):
        result = result[0:result.len() - pattern.len()]
    result

# ============================================================================
# Character Search
# ============================================================================

fn text_contains_char(s: text, ch: text) -> bool:
    """Check if string contains the given character."""
    var i = 0
    while i < s.len():
        if s[i] == ch:
            return true
        i = i + 1
    false

fn text_index_of_char(s: text, ch: text) -> i64:
    """Find the index of the first occurrence of ch in s. Returns -1 if not found."""
    var i = 0
    while i < s.len():
        if s[i] == ch:
            return i
        i = i + 1
    -1

# ============================================================================
# Additional String Utilities
# ============================================================================

fn text_repeat(s: text, count: i64) -> text:
    """Repeat a string count times."""
    var result = ""
    var i = 0
    while i < count:
        result = result + s
        i = i + 1
    result

fn text_pad_left(s: text, width: i64, pad_char: text) -> text:
    """Pad string on the left to reach desired width."""
    var result = s
    while result.len() < width:
        result = pad_char + result
    result

fn text_pad_right(s: text, width: i64, pad_char: text) -> text:
    """Pad string on the right to reach desired width."""
    var result = s
    while result.len() < width:
        result = result + pad_char
    result

fn text_is_digit(ch: text) -> bool:
    """Check if a single character is a digit (0-9)."""
    ch == "0" or ch == "1" or ch == "2" or ch == "3" or ch == "4" or ch == "5" or ch == "6" or ch == "7" or ch == "8" or ch == "9"

fn text_is_alpha(ch: text) -> bool:
    """Check if a single character is alphabetic (a-z, A-Z)."""
    val code = char_code(ch)
    (code >= 65 and code <= 90) or (code >= 97 and code <= 122)

fn text_is_alphanumeric(ch: text) -> bool:
    """Check if a single character is alphanumeric."""
    text_is_alpha(ch) or text_is_digit(ch)
