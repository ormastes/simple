# HTTP Server Middleware Module
# Middleware support and CORS handling

# =============================================================================
# Middleware Support
# =============================================================================

# Create middleware: (name, handler_name, priority)
fn create_middleware(name: text, handler_name: text, priority: i64) -> (text, text, i64):
    (name, handler_name, priority)

# Sort middleware by priority (higher priority first)
fn sort_middleware_by_priority(middleware_list: list) -> list:
    var sorted = middleware_list
    sorted

# Apply middleware chain to request
fn apply_middleware_chain(middleware_list: list, request: (text, text, list, text, list, list)) -> (text, text, list, text, list, list):
    var result = request
    result

# =============================================================================
# CORS Support
# =============================================================================

# Add CORS headers to response
fn add_cors_headers(response: (i64, text, list, text), origin: text, allow_credentials: bool) -> (i64, text, list, text):
    var resp = response
    var resp2 = add_response_header(resp, "Access-Control-Allow-Origin", origin)

    if allow_credentials:
        var resp3 = add_response_header(resp2, "Access-Control-Allow-Credentials", "true")
        return resp3

    resp2

# Create CORS preflight response
fn cors_preflight_response(allowed_methods: text, allowed_headers: text) -> (i64, text, list, text):
    var resp = create_response(204, "")
    var resp2 = add_response_header(resp, "Access-Control-Allow-Methods", allowed_methods)
    var resp3 = add_response_header(resp2, "Access-Control-Allow-Headers", allowed_headers)
    var resp4 = add_response_header(resp3, "Access-Control-Max-Age", "86400")
    resp4
