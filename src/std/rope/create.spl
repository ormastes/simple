# Rope Creation Module
# Functions for creating rope nodes and structures

fn rope_create_empty() -> any:
    # Create an empty rope
    ("leaf", 0, nil, nil, "")

fn rope_create_from_string(s: text) -> any:
    # Create a rope from a string
    if s.length() == 0:
        return rope_create_empty()

    if s.length() <= ROPE_MAX_LEAF_SIZE:
        return ("leaf", s.length(), nil, nil, s)

    # Split large strings into multiple leaf nodes
    var result = rope_create_empty()
    var pos = 0
    var len = s.length()

    while pos < len:
        var chunk_size = ROPE_IDEAL_LEAF_SIZE
        if pos + chunk_size > len:
            chunk_size = len - pos

        var chunk = s.substring(pos, pos + chunk_size)
        var leaf = ("leaf", chunk.length(), nil, nil, chunk)
        result = rope_concat(result, leaf)
        pos = pos + chunk_size

    result

fn rope_create_leaf(s: text) -> any:
    # Create a leaf node with string data
    ("leaf", s.length(), nil, nil, s)

fn rope_create_concat(left: any, right: any) -> any:
    # Create a concat node from two child nodes
    var left_weight = rope_length(left)
    ("concat", left_weight, left, right, nil)

fn rope_clone(node: any) -> any:
    # Clone a rope (deep copy)
    if node == nil:
        return nil

    if rope_is_leaf(node):
        var value = node.4
        return rope_create_leaf(value)

    var left = node.2
    var right = node.3
    var cloned_left = rope_clone(left)
    var cloned_right = rope_clone(right)

    rope_create_concat(cloned_left, cloned_right)
