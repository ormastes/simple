# Shell Environment Module
#
# Simple facade module for environment variable operations.
# Provides FFI access to environment variables and working directory.
#
# Used by: test/unit/std/env_spec.spl
#
# Functions:
#   get(key) -> text           Get environment variable
#   set(key, value) -> bool    Set environment variable
#   cwd() -> text              Get current working directory

# FFI declarations for runtime functions
extern fn rt_env_get(key: text) -> text
extern fn rt_env_set(key: text, value_str: text) -> bool
extern fn rt_process_run(cmd: text, args: [text]) -> (text, text, i64)

# Get environment variable value
# Returns empty string if not set
fn get(key: text) -> text:
    val result = rt_env_get(key)
    if result == nil:
        ""
    else:
        result

# Set environment variable
# Returns true on success, false on failure
fn set(key: text, value: text) -> bool:
    rt_env_set(key, value)

# Get current working directory
# Uses shell command 'pwd' to get the path
fn cwd() -> text:
    val (out, err, code) = rt_process_run("/bin/sh", ["-c", "pwd"])
    if code == 0:
        out.trim()
    else:
        "."

export get, set, cwd
