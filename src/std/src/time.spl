# Time Module - Unified time and sleep functions
# Provides high-level time measurement and sleep functionality

use app.io.{time_now_unix_micros, thread_sleep_ms}

# ============================================================================
# Time Measurement
# ============================================================================

#[allow(primitive_api)]
pub fn now_micros() -> i64:
    """Get current time in microseconds since Unix epoch.

    Returns:
        Microseconds since 1970-01-01 00:00:00 UTC

    Example:
        val start = time.now_micros()
        # ... do work ...
        val elapsed = time.now_micros() - start
    """
    time_now_unix_micros()

#[allow(primitive_api)]
pub fn now_nanos() -> i64:
    """Get current time in nanoseconds (approximate).

    Note: This is an approximation based on microsecond precision.
    True nanosecond precision is not available.

    Returns:
        Approximate nanoseconds since Unix epoch

    Example:
        val start = time.now_nanos()
        # ... do work ...
        val elapsed = time.now_nanos() - start
    """
    time_now_unix_micros() * 1000

#[allow(primitive_api)]
pub fn now_ms() -> i64:
    """Get current time in milliseconds since Unix epoch.

    Returns:
        Milliseconds since 1970-01-01 00:00:00 UTC

    Example:
        val timestamp = time.now_ms()
    """
    time_now_unix_micros() / 1000

#[allow(primitive_api)]
pub fn now() -> f64:
    """Get current time in seconds since Unix epoch.

    Returns:
        Seconds (with fractional microsecond precision)

    Example:
        val start = time.now()
        # ... do work ...
        val elapsed = time.now() - start
    """
    time_now_unix_micros() as f64 / 1_000_000.0

# ============================================================================
# Sleep
# ============================================================================

#[allow(primitive_api)]
pub fn sleep(seconds: f64):
    """Sleep for specified duration.

    Args:
        seconds: Duration to sleep (supports fractional seconds)

    Example:
        time.sleep(1.5)   # Sleep for 1.5 seconds
        time.sleep(0.1)   # Sleep for 100 milliseconds
    """
    val millis = (seconds * 1000.0) as i64
    thread_sleep_ms(millis)

#[allow(primitive_api)]
pub fn sleep_ms(milliseconds: i64):
    """Sleep for specified milliseconds.

    Args:
        milliseconds: Duration to sleep in milliseconds

    Example:
        time.sleep_ms(500)  # Sleep for 500ms
    """
    thread_sleep_ms(milliseconds)

#[allow(primitive_api)]
pub fn sleep_micros(microseconds: i64):
    """Sleep for specified microseconds (approximate).

    Note: Actual precision depends on OS scheduler.
    Very short sleeps may be longer than requested.

    Args:
        microseconds: Duration to sleep in microseconds

    Example:
        time.sleep_micros(1000)  # Sleep for ~1ms
    """
    val millis = microseconds / 1000
    if millis > 0:
        thread_sleep_ms(millis)
    else:
        # Sleep at least 1ms for very short durations
        thread_sleep_ms(1)

# ============================================================================
# Export
# ============================================================================

export now_micros
export now_nanos
export now_ms
export now
export sleep
export sleep_ms
export sleep_micros
