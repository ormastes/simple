# CSV Data Types and Configuration

# ============================================================================
# Core Data Types
# ============================================================================

class CsvConfig:
    delimiter: text
    quote_char: text
    escape_char: text
    line_ending: text
    trim_whitespace: bool
    skip_empty_lines: bool

class CsvTable:
    headers: list
    rows: list
    config: CsvConfig

class CsvParseResult:
    success: bool
    table: CsvTable
    error: text
    line_number: i64

# ============================================================================
# Configuration Builders
# ============================================================================

fn default_csv_config() -> CsvConfig:
    CsvConfig(
        delimiter: ",",
        quote_char: "\"",
        escape_char: "\"",
        line_ending: "\n",
        trim_whitespace: false,
        skip_empty_lines: false
    )

fn config_with_delimiter(config: CsvConfig, delimiter: text) -> CsvConfig:
    CsvConfig(
        delimiter: delimiter,
        quote_char: config.quote_char,
        escape_char: config.escape_char,
        line_ending: config.line_ending,
        trim_whitespace: config.trim_whitespace,
        skip_empty_lines: config.skip_empty_lines
    )

fn config_with_line_ending(config: CsvConfig, line_ending: text) -> CsvConfig:
    CsvConfig(
        delimiter: config.delimiter,
        quote_char: config.quote_char,
        escape_char: config.escape_char,
        line_ending: line_ending,
        trim_whitespace: config.trim_whitespace,
        skip_empty_lines: config.skip_empty_lines
    )

fn config_with_quote_char(config: CsvConfig, quote_char: text) -> CsvConfig:
    CsvConfig(
        delimiter: config.delimiter,
        quote_char: quote_char,
        escape_char: config.escape_char,
        line_ending: config.line_ending,
        trim_whitespace: config.trim_whitespace,
        skip_empty_lines: config.skip_empty_lines
    )

fn config_with_trim(config: CsvConfig, should_trim: bool) -> CsvConfig:
    CsvConfig(
        delimiter: config.delimiter,
        quote_char: config.quote_char,
        escape_char: config.escape_char,
        line_ending: config.line_ending,
        trim_whitespace: should_trim,
        skip_empty_lines: config.skip_empty_lines
    )

fn config_with_skip_empty(config: CsvConfig, skip_empty: bool) -> CsvConfig:
    CsvConfig(
        delimiter: config.delimiter,
        quote_char: config.quote_char,
        escape_char: config.escape_char,
        line_ending: config.line_ending,
        trim_whitespace: config.trim_whitespace,
        skip_empty_lines: skip_empty
    )

fn create_tsv_config() -> CsvConfig:
    val base = default_csv_config()
    config_with_delimiter(base, "\t")

fn create_crlf_config() -> CsvConfig:
    val base = default_csv_config()
    config_with_line_ending(base, "\r\n")

fn create_custom_config(delimiter: text, quote: text, escape: text) -> CsvConfig:
    CsvConfig(
        delimiter: delimiter,
        quote_char: quote,
        escape_char: escape,
        line_ending: "\n",
        trim_whitespace: false,
        skip_empty_lines: false
    )

fn create_config_with_trim(delimiter: text, should_trim: bool) -> CsvConfig:
    val base = default_csv_config()
    CsvConfig(
        delimiter: delimiter,
        quote_char: base.quote_char,
        escape_char: base.escape_char,
        line_ending: base.line_ending,
        trim_whitespace: should_trim,
        skip_empty_lines: base.skip_empty_lines
    )

fn create_config_skip_empty(delimiter: text, skip_empty: bool) -> CsvConfig:
    val base = default_csv_config()
    CsvConfig(
        delimiter: delimiter,
        quote_char: base.quote_char,
        escape_char: base.escape_char,
        line_ending: base.line_ending,
        trim_whitespace: base.trim_whitespace,
        skip_empty_lines: skip_empty
    )

# ============================================================================
# Table Information
# ============================================================================

fn table_is_empty(table: CsvTable) -> bool:
    val row_count = table.rows.length()
    row_count == 0

fn table_has_headers(table: CsvTable) -> bool:
    val header_count = table.headers.length()
    header_count > 0

fn get_table_dimensions(table: CsvTable) -> list:
    val row_count = get_row_count(table)
    val col_count = get_column_count(table)
    var dims = []
    dims = dims.append(row_count)
    dims = dims.append(col_count)
    dims

fn get_header_names(table: CsvTable) -> list:
    table.headers

fn get_row_count(table: CsvTable) -> i64:
    table.rows.length()

fn get_column_count(table: CsvTable) -> i64:
    val row_count = table.rows.length()
    if row_count == 0:
        return 0
    val first_row = table.rows.at(0)
    first_row.length()
