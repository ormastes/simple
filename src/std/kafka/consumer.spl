# Apache Kafka Consumer Module
# Consumer API structures and functions

import kafka.types

# ============================================================================
# Consumer API - Fetch
# ============================================================================

# Fetch request body: (replica_id, max_wait_ms, min_bytes, max_bytes, isolation_level, topic_data)
# topic_data: [(topic_name, partition_data)]
# partition_data: [(partition_id, fetch_offset, log_start_offset, max_bytes)]
fn create_fetch_request_body(replica_id: i64, max_wait_ms: i64, min_bytes: i64, max_bytes: i64, isolation_level: i64, topic_data: list) -> list:
    [replica_id, max_wait_ms, min_bytes, max_bytes, isolation_level, topic_data]

fn get_fetch_request_replica_id(body: list) -> i64:
    body[0]

fn get_fetch_request_max_wait_ms(body: list) -> i64:
    body[1]

fn get_fetch_request_min_bytes(body: list) -> i64:
    body[2]

fn get_fetch_request_max_bytes(body: list) -> i64:
    body[3]

fn get_fetch_request_isolation_level(body: list) -> i64:
    body[4]

fn get_fetch_request_topic_data(body: list) -> list:
    body[5]

# Fetch partition request: (partition_id, fetch_offset, log_start_offset, max_bytes)
fn create_fetch_partition_request(partition_id: i64, fetch_offset: i64, log_start_offset: i64, max_bytes: i64) -> list:
    [partition_id, fetch_offset, log_start_offset, max_bytes]

fn get_fetch_partition_request_id(request: list) -> i64:
    request[0]

fn get_fetch_partition_request_offset(request: list) -> i64:
    request[1]

fn get_fetch_partition_request_log_start_offset(request: list) -> i64:
    request[2]

fn get_fetch_partition_request_max_bytes(request: list) -> i64:
    request[3]

# Fetch response body: (throttle_time_ms, error_code, session_id, topic_data)
# topic_data: [(topic_name, partition_data)]
# partition_data: [(partition_id, error_code, high_watermark, last_stable_offset, log_start_offset, record_batch)]
fn create_fetch_response_body(throttle_time_ms: i64, error_code: i64, session_id: i64, topic_data: list) -> list:
    [throttle_time_ms, error_code, session_id, topic_data]

fn get_fetch_response_throttle_time(body: list) -> i64:
    body[0]

fn get_fetch_response_error_code(body: list) -> i64:
    body[1]

fn get_fetch_response_session_id(body: list) -> i64:
    body[2]

fn get_fetch_response_topic_data(body: list) -> list:
    body[3]

# Fetch partition response: (partition_id, error_code, high_watermark, last_stable_offset, log_start_offset, record_batch)
fn create_fetch_partition_response(partition_id: i64, error_code: i64, high_watermark: i64, last_stable_offset: i64, log_start_offset: i64, record_batch: list) -> list:
    [partition_id, error_code, high_watermark, last_stable_offset, log_start_offset, record_batch]

fn get_fetch_partition_response_id(response: list) -> i64:
    response[0]

fn get_fetch_partition_response_error(response: list) -> i64:
    response[1]

fn get_fetch_partition_response_high_watermark(response: list) -> i64:
    response[2]

fn get_fetch_partition_response_last_stable_offset(response: list) -> i64:
    response[3]

fn get_fetch_partition_response_log_start_offset(response: list) -> i64:
    response[4]

fn get_fetch_partition_response_record_batch(response: list) -> list:
    response[5]

# ============================================================================
# Consumer API - Offset Management
# ============================================================================

# Offset commit request body: (group_id, generation_id, member_id, retention_time_ms, topic_data)
# topic_data: [(topic_name, partition_data)]
# partition_data: [(partition_id, offset, metadata)]
fn create_offset_commit_request_body(group_id: text, generation_id: i64, member_id: text, retention_time_ms: i64, topic_data: list) -> list:
    [group_id, generation_id, member_id, retention_time_ms, topic_data]

fn get_offset_commit_request_group_id(body: list) -> text:
    body[0]

fn get_offset_commit_request_generation_id(body: list) -> i64:
    body[1]

fn get_offset_commit_request_member_id(body: list) -> text:
    body[2]

fn get_offset_commit_request_retention_time(body: list) -> i64:
    body[3]

fn get_offset_commit_request_topic_data(body: list) -> list:
    body[4]

# Offset commit partition request: (partition_id, offset, metadata)
fn create_offset_commit_partition_request(partition_id: i64, offset: i64, metadata: text) -> list:
    [partition_id, offset, metadata]

fn get_offset_commit_partition_request_id(request: list) -> i64:
    request[0]

fn get_offset_commit_partition_request_offset(request: list) -> i64:
    request[1]

fn get_offset_commit_partition_request_metadata(request: list) -> text:
    request[2]

# Offset commit response body: (throttle_time_ms, topic_data)
# topic_data: [(topic_name, partition_data)]
# partition_data: [(partition_id, error_code)]
fn create_offset_commit_response_body(throttle_time_ms: i64, topic_data: list) -> list:
    [throttle_time_ms, topic_data]

fn get_offset_commit_response_throttle_time(body: list) -> i64:
    body[0]

fn get_offset_commit_response_topic_data(body: list) -> list:
    body[1]

# Offset fetch request body: (group_id, topic_data)
# topic_data: [(topic_name, partition_ids)]
fn create_offset_fetch_request_body(group_id: text, topic_data: list) -> list:
    [group_id, topic_data]

fn get_offset_fetch_request_group_id(body: list) -> text:
    body[0]

fn get_offset_fetch_request_topic_data(body: list) -> list:
    body[1]

# Offset fetch response body: (throttle_time_ms, topic_data, error_code)
# topic_data: [(topic_name, partition_data)]
# partition_data: [(partition_id, offset, metadata, error_code)]
fn create_offset_fetch_response_body(throttle_time_ms: i64, topic_data: list, error_code: i64) -> list:
    [throttle_time_ms, topic_data, error_code]

fn get_offset_fetch_response_throttle_time(body: list) -> i64:
    body[0]

fn get_offset_fetch_response_topic_data(body: list) -> list:
    body[1]

fn get_offset_fetch_response_error_code(body: list) -> i64:
    body[2]

# Offset fetch partition response: (partition_id, offset, metadata, error_code)
fn create_offset_fetch_partition_response(partition_id: i64, offset: i64, metadata: text, error_code: i64) -> list:
    [partition_id, offset, metadata, error_code]

fn get_offset_fetch_partition_response_id(response: list) -> i64:
    response[0]

fn get_offset_fetch_partition_response_offset(response: list) -> i64:
    response[1]

fn get_offset_fetch_partition_response_metadata(response: list) -> text:
    response[2]

fn get_offset_fetch_partition_response_error(response: list) -> i64:
    response[3]
