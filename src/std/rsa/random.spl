# RSA Random Number Generation
#
# PRNG for cryptographic operations

import src.std.array as array
import src.std.math as math
import src.std.rsa.types as types

# Simple PRNG state (linear congruential generator)
var prng_seed = 12345

# Set random seed
fn random_seed(seed: i64):
    prng_seed = seed
    pass

# Generate random i64 (using LCG)
fn random_i64() -> i64:
    prng_seed = (prng_seed * 1103515245 + 12345) % 2147483648
    return prng_seed

# Generate random BigInt with specified number of bits
fn random_bigint(bits: i64) -> list:
    if bits <= 0:
        return types.bigint_zero()

    var result = types.bigint_zero()
    var remaining = bits

    while remaining > 0:
        val chunk_bits = math.min(remaining, 30)
        val max_val = math.pow(2, chunk_bits)
        val rand_val = random_i64() % max_val

        val chunk = types.bigint_from_i64(rand_val)
        val shifted = types.bigint_shift_left(chunk, bits - remaining)
        result = types.bigint_add(result, shifted)

        remaining = remaining - chunk_bits

    return result

# Generate random BigInt in range [min, max)
fn random_bigint_range(min: list, max: list) -> list:
    val diff = types.bigint_sub(max, min)
    val bit_len = types.bigint_bit_length(diff)

    var attempts = 0
    while attempts < 100:
        val rand = random_bigint(bit_len)
        val cmp = types.bigint_compare(rand, diff)
        if cmp < 0:
            return types.bigint_add(min, rand)
        attempts = attempts + 1

    return min
