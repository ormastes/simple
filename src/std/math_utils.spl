# Math Utilities Module
#
# Wrapper around std.math with additional utility functions.
# Provides clean function names for mathematical operations on integers.
#
# Categories:
# - Basic operations: abs, min, max, clamp, sign
# - Power and roots: pow, gcd, lcm, factorial, binomial
# - Predicates: is_even, is_odd, is_divisible_by, in_range
# - Statistics: sum, product, average, median
#
# All functions are pure Simple - no external dependencies required.

use std.math.{
    math_abs_i64, math_min_i64, math_max_i64, math_clamp_i64,
    math_sign_i64, math_pow_i64, math_gcd, math_lcm, math_factorial
}

# ============================================================================
# Exports
# ============================================================================

export abs_i64, min_i64, max_i64, clamp_i64, sign_i64
export pow_i64, gcd, lcm, factorial, binomial
export is_even, is_odd, is_divisible_by, in_range_i64
export sum_i64, product_i64, average_i64, median_i64

# ============================================================================
# Basic Operations (Wrappers)
# ============================================================================

fn abs_i64(x: i64) -> i64:
    """Absolute value of an integer.

    Example:
        abs_i64(-5)  # 5
    """
    math_abs_i64(x)

fn min_i64(a: i64, b: i64) -> i64:
    """Minimum of two integers.

    Example:
        min_i64(a=5, b=10)  # 5
    """
    math_min_i64(a, b)

fn max_i64(a: i64, b: i64) -> i64:
    """Maximum of two integers.

    Example:
        max_i64(a=5, b=10)  # 10
    """
    math_max_i64(a, b)

fn clamp_i64(x: i64, min_val: i64, max_val: i64) -> i64:
    """Clamp x to the range [min_val, max_val].

    Example:
        clamp_i64(x=15, min_val=0, max_val=10)  # 10
    """
    math_clamp_i64(x, min_val, max_val)

fn sign_i64(x: i64) -> i64:
    """Sign function: returns -1, 0, or 1.

    Example:
        sign_i64(5)   # 1
        sign_i64(-5)  # -1
        sign_i64(0)   # 0
    """
    math_sign_i64(x)

# ============================================================================
# Power and Combinatorics
# ============================================================================

fn pow_i64(base: i64, exp: i64) -> i64:
    """Integer exponentiation. Returns base^exp.

    Example:
        pow_i64(base=2, exp=3)  # 8
    """
    math_pow_i64(base, exp)

fn gcd(a: i64, b: i64) -> i64:
    """Greatest common divisor (Euclidean algorithm).

    Example:
        gcd(a=12, b=8)  # 4
    """
    math_gcd(a, b)

fn lcm(a: i64, b: i64) -> i64:
    """Least common multiple.

    Example:
        lcm(a=4, b=6)  # 12
    """
    math_lcm(a, b)

fn factorial(n: i64) -> i64:
    """Factorial of n. Returns 1 for n <= 0.

    Example:
        factorial(5)  # 120
    """
    math_factorial(n)

fn binomial(n: i64, k: i64) -> i64:
    """Binomial coefficient C(n, k) = n! / (k! * (n-k)!).

    Example:
        binomial(n=5, k=2)  # 10
    """
    if k > n:
        return 0
    if k == 0 or k == n:
        return 1
    factorial(n) / (factorial(k) * factorial(n - k))

# ============================================================================
# Integer Predicates
# ============================================================================

fn is_even(x: i64) -> bool:
    """Check if integer is even.

    Example:
        is_even(4)  # true
        is_even(3)  # false
    """
    x % 2 == 0

fn is_odd(x: i64) -> bool:
    """Check if integer is odd.

    Example:
        is_odd(3)  # true
        is_odd(4)  # false
    """
    x % 2 != 0

fn is_divisible_by(x: i64, d: i64) -> bool:
    """Check if x is divisible by d.

    Example:
        is_divisible_by(x=10, d=2)  # true
        is_divisible_by(x=7, d=3)   # false
    """
    if d == 0:
        return false
    x % d == 0

fn in_range_i64(x: i64, min_val: i64, max_val: i64) -> bool:
    """Check if x is in the range [min_val, max_val].

    Example:
        in_range_i64(x=5, min_val=0, max_val=10)  # true
    """
    x >= min_val and x <= max_val

# ============================================================================
# Statistical Functions
# ============================================================================

fn sum_i64(list: [i64]) -> i64:
    """Sum of all integers in a list.

    Example:
        sum_i64([1, 2, 3, 4, 5])  # 15
    """
    var total = 0
    for x in list:
        total = total + x
    total

fn product_i64(list: [i64]) -> i64:
    """Product of all integers in a list. Returns 1 for empty list.

    Example:
        product_i64([2, 3, 4])  # 24
    """
    if list.len() == 0:
        return 1
    var result = 1
    for x in list:
        result = result * x
    result

fn average_i64(list: [i64]) -> i64?:
    """Average of integers in a list. Returns nil for empty list.

    Example:
        average_i64([1, 2, 3, 4, 5])  # Some(3)
        average_i64([])               # nil
    """
    if list.len() == 0:
        return nil
    sum_i64(list) / list.len()

fn median_i64(list: [i64]) -> i64?:
    """Median of integers in a list. Returns nil for empty list.
    Uses bubble sort for simplicity.

    Example:
        median_i64([1, 2, 3, 4, 5])  # Some(3)
        median_i64([1, 2, 3, 4])     # Some(2)
        median_i64([])               # nil
    """
    if list.len() == 0:
        return nil

    # Bubble sort
    var sorted = list
    val n = sorted.len()
    for i in 0..n:
        for j in 0..(n - i - 1):
            if sorted[j] > sorted[j + 1]:
                val temp = sorted[j]
                sorted[j] = sorted[j + 1]
                sorted[j + 1] = temp

    # Calculate median
    val mid = n / 2
    if n % 2 == 0:
        (sorted[mid - 1] + sorted[mid]) / 2
    else:
        sorted[mid]
