# Regular Expression Engine - Validator
#
# Regex pattern validation functions.

from .matcher import regex_compile

# ============================================================================
# VALIDATION
# ============================================================================

fn validate_regex(pattern: text) -> any:
    """Validate regex pattern syntax. Returns (valid, error_msg)."""
    val compile_result = regex_compile(pattern)
    val success = compile_result.0
    if success:
        return (true, "")
    val error = compile_result.2
    (false, error)

fn check_balanced_parens(pattern: text) -> bool:
    """Check if parentheses are balanced in pattern."""
    var depth = 0
    var i = 0
    var escaped = false
    while i < pattern.len():
        val ch = pattern[i:i + 1]
        if escaped:
            escaped = false
        else:
            if ch == "\\":
                escaped = true
            else:
                if ch == "(":
                    depth = depth + 1
                if ch == ")":
                    depth = depth - 1
                    if depth < 0:
                        return false
        i = i + 1
    depth == 0

fn check_valid_quantifier(pattern: text) -> bool:
    """Check if quantifiers are valid (not at start, not doubled)."""
    if pattern.len() == 0:
        return true
    val first = pattern[0:1]
    if first == "*" or first == "+" or first == "?":
        return false
    var i = 1
    var prev_was_quant = false
    while i < pattern.len():
        val ch = pattern[i:i + 1]
        val is_quant = ch == "*" or ch == "+" or ch == "?"
        if is_quant and prev_was_quant:
            return false
        prev_was_quant = is_quant
        i = i + 1
    true

export validate_regex, check_balanced_parens, check_valid_quantifier
