# Coverage Module Basic Tests
use std.spec.*
use std.coverage.*

describe "Coverage Basic Tests":
    it "enables and disables coverage tag":
        disable_coverage_tag()
        expect is_coverage_tag_enabled() == false
        enable_coverage_tag()
        expect is_coverage_tag_enabled() == true
        disable_coverage_tag()
        expect is_coverage_tag_enabled() == false
    
    it "blocks check_coverage without tag":
        disable_coverage_tag()
        val result = check_coverage("line", "**/*.spl", minimum: 0.0)
        val error = get_coverage_error()
        expect error.contains("CoverageNotEnabledException")
        clear_coverage_error()
    
    it "allows check_coverage with tag":
        enable_coverage_tag()
        val result = check_coverage("line", "**/*.spl", minimum: 0.0)
        val error = get_coverage_error()
        # Should NOT have access error (may have data error)
        expect not error.contains("CoverageNotEnabledException")
        disable_coverage_tag()
        clear_coverage_error()
    
    it "supports coverage types":
        enable_coverage_tag()
        
        # Line coverage
        val line = check_coverage("line", "**/*.spl", minimum: 0.0)
        expect line.coverage_type == "line"
        clear_coverage_error()
        
        # Branch coverage
        val branch = check_coverage("branch", "**/*.spl", minimum: 0.0)
        expect branch.coverage_type == "branch"
        clear_coverage_error()
        
        disable_coverage_tag()

describe "Coverage Summary":
    it "prints test summary":
        print ""
        print "Coverage Module Tests Passed!"
