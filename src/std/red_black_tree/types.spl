# Red-Black Tree Types and Basic Operations
#
# Core type definitions and accessor functions for Red-Black tree nodes and trees.

# Color constants
val RED = 0
val BLACK = 1

# ============================================================================
# NODE CREATION AND ACCESS
# ============================================================================

# Create a new Red-Black tree node
# Returns: (value, color, left, right, parent)
fn create_node(value, color, left, right, parent):
    (value, color, left, right, parent)

# Get node value
fn node_value(node):
    node.0

# Get node color
fn node_color(node):
    node.1

# Get left child
fn node_left(node):
    node.2

# Get right child
fn node_right(node):
    node.3

# Get parent node
fn node_parent(node):
    node.4

# Set node value (returns new node)
fn set_node_value(node, value):
    (value, node.1, node.2, node.3, node.4)

# Set node color (returns new node)
fn set_node_color(node, color):
    (node.0, color, node.2, node.3, node.4)

# Set left child (returns new node)
fn set_node_left(node, left):
    (node.0, node.1, left, node.3, node.4)

# Set right child (returns new node)
fn set_node_right(node, right):
    (node.0, node.1, node.2, right, node.4)

# Set parent (returns new node)
fn set_node_parent(node, parent):
    (node.0, node.1, node.2, node.3, parent)

# ============================================================================
# TREE CREATION AND BASIC PROPERTIES
# ============================================================================

# Create NIL sentinel node (black, special marker)
fn nil_node():
    create_node(-1, BLACK, nil, nil, nil)

# Create an empty Red-Black tree
# Returns: (root, size, nil_sentinel)
fn create_rbtree():
    val nil_sentinel = nil_node()
    (nil_sentinel, 0, nil_sentinel)

# Get tree root
fn tree_root(tree):
    tree.0

# Get tree size
fn tree_size(tree):
    tree.1

# Get tree NIL sentinel
fn tree_nil(tree):
    tree.2

# Set tree root (returns new tree)
fn set_tree_root(tree, root):
    (root, tree.1, tree.2)

# Set tree size (returns new tree)
fn set_tree_size(tree, size):
    (tree.0, size, tree.2)

# Increment tree size (returns new tree)
fn increment_tree_size(tree):
    set_tree_size(tree, tree.1 + 1)

# Decrement tree size (returns new tree)
fn decrement_tree_size(tree):
    set_tree_size(tree, tree.1 - 1)

# Check if tree is empty
fn rb_is_empty(tree):
    val root = tree_root(tree)
    val nil_sentinel = tree_nil(tree)
    is_nil_node(root, nil_sentinel)

# Check if node is NIL sentinel
fn is_nil_node(node, nil_sentinel):
    if node == nil:
        true
    else:
        val is_sentinel = node == nil_sentinel
        if is_sentinel:
            true
        else:
            val node_val = node_value(node)
            node_val == -1

# ============================================================================
# COLOR OPERATIONS
# ============================================================================

# Check if node is red
fn is_red(node, nil_sentinel):
    if is_nil_node(node, nil_sentinel):
        false
    else:
        val color = node_color(node)
        color == RED

# Check if node is black
fn is_black(node, nil_sentinel):
    if is_nil_node(node, nil_sentinel):
        true
    else:
        val color = node_color(node)
        color == BLACK

# Get node color (NIL nodes are black)
fn get_color(node, nil_sentinel):
    if is_nil_node(node, nil_sentinel):
        BLACK
    else:
        node_color(node)

# Set node color
fn set_color(node, color):
    set_node_color(node, color)
