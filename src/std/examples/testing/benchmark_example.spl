# Benchmarking Example
# Demonstrates how to use the benchmarking library

import std.testing.benchmark as bench
import map

# Example function to benchmark
fn fibonacci(n: i32) -> i32:
    if n <= 1:
        return n
    fibonacci(n - 1) + fibonacci(n - 2)

# Example: Basic benchmark
fn example_basic():
    print "=== Basic Benchmark ==="
    print ""

    val stats = bench.benchmark_default("fibonacci(20)", \:
        fibonacci(20)
    )

    print stats.summary()

# Example: Comparison benchmark
fn example_comparison():
    print "=== Comparison Benchmark ==="
    print ""

    # Simulate different implementations
    fn quicksort_impl():
        var arr = [5, 2, 8, 1, 9, 3, 7, 4, 6]
        arr.sort()

    fn bubblesort_impl():
        var arr = [5, 2, 8, 1, 9, 3, 7, 4, 6]
        # Simulate slower algorithm
        for _ in 0..10:
            arr.sort()

    # Create map of benchmarks
    val benchmarks = Map.new()
    benchmarks.insert("quicksort", quicksort_impl)
    benchmarks.insert("bubblesort", bubblesort_impl)

    val results = bench.compare_default(benchmarks)

    for (name, stats) in results.entries():
        print "{name}:"
        print stats.summary()
        print ""

# Example: Custom configuration
fn example_custom_config():
    print "=== Custom Configuration ==="
    print ""

    val config = bench.BenchmarkConfig(
        warmup_iterations: 5,
        measurement_iterations: 200,
        measurement_time_secs: 3.0,
        sample_size: 15,
        outlier_threshold: 2.5,
        confidence_level: 0.99
    )

    val stats = bench.benchmark("fibonacci(15)", \: fibonacci(15), config)
    print stats.summary()

# Example: Quick benchmark for development
fn example_quick():
    print "=== Quick Benchmark (for development) ==="
    print ""

    val config = bench.BenchmarkConfig.quick()

    val stats = bench.benchmark("fibonacci(10)", \: fibonacci(10), config)
    print stats.summary()

# Main entry point
fn main():
    example_basic()
    print "\n" + "=".repeat(60) + "\n"

    example_comparison()
    print "\n" + "=".repeat(60) + "\n"

    example_custom_config()
    print "\n" + "=".repeat(60) + "\n"

    example_quick()
