# Base64 Variants Module
#
# Custom alphabet support and variant encoding/decoding utilities

use base64::utilities::{text_length, text_char_at}
use base64::encode::{encode_base64_with_alphabet}
use base64::decode::{decode_base64_with_alphabet}

# ============================================================================
# CUSTOM ALPHABET UTILITIES
# ============================================================================

# Create custom alphabet from characters
fn create_alphabet(chars: text) -> text:
    var len = text_length(chars)
    if len != 64:
        # Invalid alphabet length
        return ""
    # Validate all characters are unique
    var i = 0
    while i < len:
        var c1 = text_char_at(chars, i)
        var j = i + 1
        while j < len:
            var c2 = text_char_at(chars, j)
            if c1 == c2:
                # Duplicate character
                return ""
            j = j + 1
        i = i + 1
    chars

# Encode with custom alphabet
fn encode_with_alphabet(data: text, alphabet: text) -> text:
    var alphabet_len = text_length(alphabet)
    if alphabet_len != 64:
        return ""
    encode_base64_with_alphabet(data, alphabet, true)

# Decode with custom alphabet
fn decode_with_alphabet(encoded: text, alphabet: text) -> text:
    var alphabet_len = text_length(alphabet)
    if alphabet_len != 64:
        return ""
    decode_base64_with_alphabet(encoded, alphabet)
