# Template Engine Types Module
# Data structures for template system

# ============================================================================
# DATA STRUCTURES (Tuple-based, no generics)
# ============================================================================

# Token: (type, value, position)
fn make_token(ttype: text, value: text, pos: i64) -> [text]:
    [ttype, value, "{pos}"]

fn token_type(token: [text]) -> text:
    token[0]

fn token_value(token: [text]) -> text:
    token[1]

fn token_pos(token: [text]) -> i64:
    parse_i64_safe(token[2])

# AST Node: (node_type, data1, data2, data3)
fn make_node(ntype: text, d1: text, d2: text, d3: text) -> [text]:
    [ntype, d1, d2, d3]

fn node_type(node: [text]) -> text:
    node[0]

fn node_data1(node: [text]) -> text:
    node[1]

fn node_data2(node: [text]) -> text:
    node[2]

fn node_data3(node: [text]) -> text:
    node[3]

# Context: list of (key, value) pairs
fn make_context() -> [[text]]:
    []

fn ctx_set(ctx: [[text]], key: text, val: text) -> [[text]]:
    var result = ctx
    result.push([key, val])
    result

fn ctx_get(ctx: [[text]], key: text) -> text?:
    var i = ctx.len() - 1
    while i >= 0:
        val entry = ctx[i]
        if entry[0] == key:
            return entry[1]
        i = i - 1
    nil

fn ctx_has(ctx: [[text]], key: text) -> bool:
    var i = 0
    while i < ctx.len():
        if ctx[i][0] == key:
            return true
        i = i + 1
    false

fn ctx_clone(ctx: [[text]]) -> [[text]]:
    var result: [[text]] = []
    for entry in ctx:
        result.push([entry[0], entry[1]])
    result

# Partials registry: list of (name, compiled_template) pairs
fn make_registry() -> [[text]]:
    []

fn reg_add(registry: [[text]], name: text, template: text) -> [[text]]:
    var result = registry
    result.push([name, template])
    result

fn reg_get(registry: [[text]], name: text) -> text?:
    for entry in registry:
        if entry[0] == name:
            return entry[1]
    nil

# ============================================================================
# EXPORTS
# ============================================================================

export make_token, token_type, token_value, token_pos
export make_node, node_type, node_data1, node_data2, node_data3
export make_context, ctx_set, ctx_get, ctx_has, ctx_clone
export make_registry, reg_add, reg_get
