# Template Engine Utilities Module - Facade
# Comprehensive text templating system for Simple language
#
# This is a facade that re-exports all template functionality
# from the refactored template/ subdirectory modules

import template.types
import template.parse
import template.render
import template.filters
import template.context
import template.utilities

# ============================================================================
# PUBLIC API
# ============================================================================

fn template_create_context() -> [[text]]:
    make_context()

fn template_set(ctx: [[text]], key: text, value: text) -> [[text]]:
    ctx_set(ctx, key, value)

fn template_get(ctx: [[text]], key: text) -> text?:
    ctx_get(ctx, key)

fn template_has(ctx: [[text]], key: text) -> bool:
    ctx_has(ctx, key)

fn template_clone_context(ctx: [[text]]) -> [[text]]:
    ctx_clone(ctx)

fn template_compile(template: text) -> [[text]]:
    compile_template(template)

fn template_render(compiled: [[text]], ctx: [[text]]) -> text:
    val registry = make_registry()
    render_nodes(compiled, ctx, registry)

fn template_render_with_partials(compiled: [[text]], ctx: [[text]], registry: [[text]]) -> text:
    render_nodes(compiled, ctx, registry)

fn template_render_string(template: text, ctx: [[text]]) -> text:
    val registry = make_registry()
    render_template(template, ctx, registry)

fn template_create_registry() -> [[text]]:
    make_registry()

fn template_register_partial(registry: [[text]], name: text, template: text) -> [[text]]:
    reg_add(registry, name, template)

fn template_get_partial(registry: [[text]], name: text) -> text?:
    reg_get(registry, name)

fn template_register_helper(registry: [[text]], name: text, fn_name: text) -> [[text]]:
    # Helper registration would need function reference support
    # For now, just return registry as-is
    registry

fn template_escape_html(s: text) -> text:
    html_escape(s)

fn template_unescape_html(s: text) -> text:
    html_unescape(s)

fn template_escape_url(s: text) -> text:
    url_encode(s)

fn template_escape_js(s: text) -> text:
    js_escape(s)

fn template_escape_css(s: text) -> text:
    css_escape(s)

fn template_strip_html(s: text) -> text:
    filter_strip_html(s)

fn template_slug(s: text) -> text:
    filter_slug(s)

fn template_word_count(s: text) -> text:
    filter_word_count(s)

fn template_format_bytes(bytes: i64) -> text:
    filter_format_bytes(bytes)

fn template_ordinal(n: i64) -> text:
    filter_ordinal(n)

fn template_indent(s: text, spaces: i64) -> text:
    filter_indent(s, spaces)

fn template_dedent(s: text) -> text:
    filter_dedent(s)

# ============================================================================
# EXPORTS
# ============================================================================

# Core API
export template_create_context, template_set, template_get, template_has, template_clone_context
export template_compile, template_render, template_render_with_partials, template_render_string
export template_create_registry, template_register_partial, template_get_partial, template_register_helper

# Escaping functions
export template_escape_html, template_unescape_html, template_escape_url
export template_escape_js, template_escape_css
export html_escape, html_unescape, url_encode, url_decode, js_escape, css_escape

# Filter functions
export template_strip_html, template_slug, template_word_count
export template_format_bytes, template_ordinal, template_indent, template_dedent

# String utilities
export str_trim, str_trim_left, str_trim_right
export str_to_upper, str_to_lower, str_capitalize, str_reverse
export str_truncate, str_repeat, str_split, str_replace_all
export str_contains, str_starts_with, str_ends_with, str_index_of
export str_pad_left, str_pad_right, str_center
export int_to_str, str_to_int, int_to_hex_str, hex_str_to_int

# Character utilities
export is_whitespace_char, is_alpha_char, is_digit_char, is_alnum_char
export char_at_safe, substr_safe

# Filter operations
export filter_strip_html, filter_slug, filter_word_count, filter_line_count, filter_char_count
export filter_first_line, filter_last_line, filter_indent, filter_dedent
export filter_quote, filter_unquote, filter_abs
export filter_format_bytes, filter_ordinal, filter_percentage
export filter_join_list, filter_first_item, filter_last_item, filter_list_length
export filter_sort_list, filter_reverse_list, filter_unique_list

# Helpers
export apply_helper, is_truthy, resolve_var
