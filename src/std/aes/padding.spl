# AES Padding Module
#
# This module implements PKCS#7 padding for block alignment

# =============================================================================
# PADDING (PKCS#7)
# =============================================================================

# Add PKCS#7 padding to data
fn pkcs7_pad(data: list, block_size: i64) -> list:
    val data_len = data.length()
    val remainder = data_len % block_size
    val padding_len = block_size - remainder

    val padded = []
    var i = 0
    while i < data_len:
        padded.append(data[i])
        i = i + 1

    # Add padding bytes (each byte = padding length)
    var j = 0
    while j < padding_len:
        padded.append(padding_len)
        j = j + 1

    padded

# Remove PKCS#7 padding from data
fn pkcs7_unpad(data: list) -> list:
    val data_len = data.length()

    if data_len == 0:
        return data

    # Last byte indicates padding length
    val padding_len = data[data_len - 1]

    # Validate padding
    if padding_len > data_len:
        return data

    if padding_len == 0:
        return data

    # Extract unpadded data
    val unpadded = []
    val unpadded_len = data_len - padding_len
    var i = 0
    while i < unpadded_len:
        unpadded.append(data[i])
        i = i + 1

    unpadded
