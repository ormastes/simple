# Report TraitNL#NL# Base class for all reports in the Simple language.NL# Provides unified interface for compiler, runtime, and tool reports.NLNLimport .levelNLimport .locationNLuse ansi.{ansi_reset, ansi_bold, ansi_bold_blue, ansi_bold_cyan, ansi_bold_green}NLuse std.string.{NL}NLNLexport Report, ReportKind, Suggestion, FixConfidenceNLNL# =============================================================================NL# ReportKind: Category of reportNL# =============================================================================NLNLenum ReportKind:NL    # Compiler reportsNL    ParseError          # Syntax/parsing errorsNL    TypeError           # Type checking errorsNL    NameError           # Undefined names, scope errorsNL    LintWarning         # Lint rule violationsNL    DeprecationWarning  # Deprecated feature usageNLNL    # Runtime reportsNL    RuntimeError        # Runtime failuresNL    Panic               # Unrecoverable runtime errorsNL    MemoryError         # Memory/GC related issuesNL    DebugLog            # Debug informationNLNL    # Tool reportsNL    BuildError          # Build system errorsNL    TestFailure         # Test assertion failuresNL    FixSuggestion       # EasyFix suggestionsNLNLimpl ReportKind:NL    fn name() -> text:NL        match self:NL            case ReportKind.ParseError: "parse error"NL            case ReportKind.TypeError: "type error"NL            case ReportKind.NameError: "name error"NL            case ReportKind.LintWarning: "lint"NL            case ReportKind.DeprecationWarning: "deprecation"NL            case ReportKind.RuntimeError: "runtime error"NL            case ReportKind.Panic: "panic"NL            case ReportKind.MemoryError: "memory error"NL            case ReportKind.DebugLog: "debug"NL            case ReportKind.BuildError: "build error"NL            case ReportKind.TestFailure: "test failure"NL            case ReportKind.FixSuggestion: "fix"NLNL    fn is_compiler() -> bool:NL        match self:NL            case ReportKind.ParseError: trueNL            case ReportKind.TypeError: trueNL            case ReportKind.NameError: trueNL            case ReportKind.LintWarning: trueNL            case ReportKind.DeprecationWarning: trueNL            case _: falseNLNL    fn is_runtime() -> bool:NL        match self:NL            case ReportKind.RuntimeError: trueNL            case ReportKind.Panic: trueNL            case ReportKind.MemoryError: trueNL            case ReportKind.DebugLog: trueNL            case _: falseNLNL    fn is_tool() -> bool:NL        match self:NL            case ReportKind.BuildError: trueNL            case ReportKind.TestFailure: trueNL            case ReportKind.FixSuggestion: trueNL            case _: falseNLNL# =============================================================================NL# FixConfidence: Confidence level for auto-fixesNL# =============================================================================NLNLenum FixConfidence:NL    MachineApplicable   # Safe to auto-apply without reviewNL    MaybeIncorrect      # Probably correct, review recommendedNL    HasPlaceholders     # Contains <#placeholder#>, needs editingNL    Unspecified         # Unknown confidence levelNLNLimpl FixConfidence:NL    fn name() -> text:NL        match self:NL            case FixConfidence.MachineApplicable: "safe"NL            case FixConfidence.MaybeIncorrect: "likely"NL            case FixConfidence.HasPlaceholders: "placeholder"NL            case FixConfidence.Unspecified: "unknown"NLNL    fn is_safe_to_auto_apply() -> bool:NL        match self:NL            case FixConfidence.MachineApplicable: trueNL            case _: falseNLNL    fn is_likely_correct() -> bool:NL        match self:NL            case FixConfidence.MachineApplicable: trueNL            case FixConfidence.MaybeIncorrect: trueNL            case _: falseNLNL# =============================================================================NL# Suggestion: Machine-applicable fix suggestionNL# =============================================================================NLNLstruct Suggestion:NL    message: text           # Description of the fixNL    location: SourceLocationNL    new_text: text          # Replacement textNL    confidence: FixConfidenceNLNLimpl Suggestion:NL    # Create a simple replacement suggestionNL    static fn replace(location: SourceLocation, new_text: text, message: text) -> Suggestion:NL        Suggestion(NL            message: message,NL            location: location,NL            new_text: new_text,NL            confidence: FixConfidence.MachineApplicableNL        )NLNL    # Create a suggestion with specified confidenceNL    static fn with_confidence(location: SourceLocation, new_text: text, message: text, confidence: FixConfidence) -> Suggestion:NL        Suggestion(NL            message: message,NL            location: location,NL            new_text: new_text,NL            confidence: confidenceNL        )NLNL    # Create an insertion suggestion (insert at location)NL    static fn insert(location: SourceLocation, new_text: text, message: text) -> Suggestion:NL        Suggestion(NL            message: message,NL            location: SourceLocation.from_span(NL                location.file,NL                Span.at(location.span.start),NL                location.line,NL                location.column,NL                0,NL                0NL            ),NL            new_text: new_text,NL            confidence: FixConfidence.MachineApplicableNL        )NLNL    # Create a deletion suggestionNL    static fn delete(location: SourceLocation, message: text) -> Suggestion:NL        Suggestion(NL            message: message,NL            location: location,NL            new_text: "",NL            confidence: FixConfidence.MachineApplicableNL        )NLNL    fn format() -> text:NL        "{self.location.format_short()}: {self.message} [{self.confidence.name()}]"NLNL# =============================================================================NL# Report: Base class for all reportsNL# =============================================================================NLNLclass Report:NL    # Core fieldsNL    level: ReportLevelNL    kind: ReportKindNL    code: text?             # Error code (e.g., "E0001", "L:print_in_test_spec")NL    message: textNLNL    # LocationNL    location: SourceLocation?NLNL    # Additional contextNL    labels: [Label]         # Multiple labeled spansNL    notes: [text]           # Additional context notesNL    help: [text]            # Help messages/suggestionsNL    suggestions: [Suggestion]  # Machine-applicable fixesNLNL    # MetadataNL    source_name: text?      # Source identifier (e.g., "rustc", "lint", "runtime")NLNLimpl Report:NL    # ==========================================================================NL    # Factory methods for creating reportsNL    # ==========================================================================NLNL    # Create a basic error reportNL    static fn error(message: text) -> Report:NL        Report(NL            level: ReportLevel.Error,NL            kind: ReportKind.RuntimeError,NL            code: nil,NL            message: message,NL            location: nil,NL            labels: [],NL            notes: [],NL            help: [],NL            suggestions: [],NL            source_name: nilNL        )NLNL    # Create a basic warning reportNL    static fn warning(message: text) -> Report:NL        Report(NL            level: ReportLevel.Warning,NL            kind: ReportKind.LintWarning,NL            code: nil,NL            message: message,NL            location: nil,NL            labels: [],NL            notes: [],NL            help: [],NL            suggestions: [],NL            source_name: nilNL        )NLNL    # Create an info reportNL    static fn info(message: text) -> Report:NL        Report(NL            level: ReportLevel.Info,NL            kind: ReportKind.DebugLog,NL            code: nil,NL            message: message,NL            location: nil,NL            labels: [],NL            notes: [],NL            help: [],NL            suggestions: [],NL            source_name: nilNL        )NLNL    # Create a debug reportNL    static fn debug(message: text) -> Report:NL        Report(NL            level: ReportLevel.Debug,NL            kind: ReportKind.DebugLog,NL            code: nil,NL            message: message,NL            location: nil,NL            labels: [],NL            notes: [],NL            help: [],NL            suggestions: [],NL            source_name: nilNL        )NLNL    # Create a fatal error reportNL    static fn fatal(message: text) -> Report:NL        Report(NL            level: ReportLevel.Fatal,NL            kind: ReportKind.Panic,NL            code: nil,NL            message: message,NL            location: nil,NL            labels: [],NL            notes: [],NL            help: [],NL            suggestions: [],NL            source_name: nilNL        )NLNL    # ==========================================================================NL    # Builder methods (fluent API)NL    # ==========================================================================NLNL    fn with_code(code: text) -> Report:NL        Report(NL            level: self.level,NL            kind: self.kind,NL            code: Some(code),NL            message: self.message,NL            location: self.location,NL            labels: self.labels,NL            notes: self.notes,NL            help: self.help,NL            suggestions: self.suggestions,NL            source_name: self.source_nameNL        )NLNL    fn with_kind(kind: ReportKind) -> Report:NL        Report(NL            level: self.level,NL            kind: kind,NL            code: self.code,NL            message: self.message,NL            location: self.location,NL            labels: self.labels,NL            notes: self.notes,NL            help: self.help,NL            suggestions: self.suggestions,NL            source_name: self.source_nameNL        )NLNL    fn with_location(location: SourceLocation) -> Report:NL        Report(NL            level: self.level,NL            kind: self.kind,NL            code: self.code,NL            message: self.message,NL            location: Some(location),NL            labels: self.labels,NL            notes: self.notes,NL            help: self.help,NL            suggestions: self.suggestions,NL            source_name: self.source_nameNL        )NLNL    fn at(file: text, line: i64, column: i64) -> Report:NL        self.with_location(SourceLocation.at(file, line, column))NLNL    fn with_label(label: Label) -> Report:NL        Report(NL            level: self.level,NL            kind: self.kind,NL            code: self.code,NL            message: self.message,NL            location: self.location,NL            labels: self.labels + [label],NL            notes: self.notes,NL            help: self.help,NL            suggestions: self.suggestions,NL            source_name: self.source_nameNL        )NLNL    fn with_primary_label(location: SourceLocation, message: text) -> Report:NL        self.with_label(Label.primary(location, message))NLNL    fn with_secondary_label(location: SourceLocation, message: text) -> Report:NL        self.with_label(Label.secondary(location, message))NLNL    fn with_note(note: text) -> Report:NL        Report(NL            level: self.level,NL            kind: self.kind,NL            code: self.code,NL            message: self.message,NL            location: self.location,NL            labels: self.labels,NL            notes: self.notes + [note],NL            help: self.help,NL            suggestions: self.suggestions,NL            source_name: self.source_nameNL        )NLNL    fn with_help(help_msg: text) -> Report:NL        Report(NL            level: self.level,NL            kind: self.kind,NL            code: self.code,NL            message: self.message,NL            location: self.location,NL            labels: self.labels,NL            notes: self.notes,NL            help: self.help + [help_msg],NL            suggestions: self.suggestions,NL            source_name: self.source_nameNL        )NLNL    fn with_suggestion(suggestion: Suggestion) -> Report:NL        Report(NL            level: self.level,NL            kind: self.kind,NL            code: self.code,NL            message: self.message,NL            location: self.location,NL            labels: self.labels,NL            notes: self.notes,NL            help: self.help,NL            suggestions: self.suggestions + [suggestion],NL            source_name: self.source_nameNL        )NLNL    fn with_source(source: text) -> Report:NL        Report(NL            level: self.level,NL            kind: self.kind,NL            code: self.code,NL            message: self.message,NL            location: self.location,NL            labels: self.labels,NL            notes: self.notes,NL            help: self.help,NL            suggestions: self.suggestions,NL            source_name: Some(source)NL        )NLNL    # ==========================================================================NL    # AccessorsNL    # ==========================================================================NLNL    fn is_error() -> bool:NL        self.level.is_error()NLNL    fn is_warning() -> bool:NL        self.level == ReportLevel.WarningNLNL    fn has_suggestions() -> bool:NL        not self.suggestions.is_empty()NLNL    fn has_location() -> bool:NL        self.location.?NLNL    fn get_file() -> text?:NL        if self.location.?:NL            Some(self.location.unwrap().file)NL        else:NL            nilNLNL    fn get_line() -> i64:NL        if self.location.?:NL            self.location.unwrap().lineNL        else:NL            0NLNL    # ==========================================================================NL    # FormattingNL    # ==========================================================================NLNL    fn format(source: text, use_color: bool) -> text:NL        val reset = if use_color: ansi_reset() else: ""NL        val bold = if use_color: ansi_bold() else: ""NL        val blue = if use_color: ansi_bold_blue() else: ""NL        val level_color = if use_color: self.level.color() else: ""NLNL        # Header: level[code]: messageNL        val code_str = if self.code.?: "[{self.code.unwrap()}]" else: ""NL        var output = "{level_color}{self.level.name()}{code_str}{reset}: {bold}{self.message}{reset}\n"NLNL        # Source name if presentNL        if self.source_name.?:NL            output = output + "  [{self.source_name.unwrap()}]\n"NLNL        # Primary locationNL        if self.location.?:NL            val loc = self.location.unwrap()NL            output = output + "  {blue}-->{reset} {loc.format_short()}\n"NL            output = output + loc.show_context(source, use_color) + "\n"NLNL        # LabelsNL        for label in self.labels:NL            val label_color = if label.primary: level_color else: blueNL            output = output + label.format(source, use_color, label_color)NLNL        # NotesNL        for note in self.notes:NL            val note_color = if use_color: ansi_bold_cyan() else: ""NL            output = output + "  {note_color}= note:{reset} {note}\n"NLNL        # HelpNL        for h in self.help:NL            val help_color = if use_color: ansi_bold_green() else: ""NL            output = output + "  {help_color}= help:{reset} {h}\n"NLNL        # SuggestionsNL        for suggestion in self.suggestions:NL            val sugg_color = if use_color: ansi_bold_green() else: ""NL            output = output + "  {sugg_color}= suggestion:{reset} {suggestion.message}"NL            output = output + " [{suggestion.confidence.name()}]\n"NLNL        outputNLNL    fn format_plain(source: text) -> text:NL        self.format(source, false)NLNL    fn format_short() -> text:NL        val code_str = if self.code.?: "[{self.code.unwrap()}] " else: ""NL        val loc_str = if self.location.?:NL            "{self.location.unwrap().format_short()}: "NL        else:NL            ""NL        "{loc_str}{self.level.name()}: {code_str}{self.message}"NL