# Platform-Aware Text I/O
#
# File I/O with automatic newline translation based on platform configs.

use app.io.mod.{file_read_text, file_write}
use std.platform.config.{PlatformConfig, host_config}
use std.platform.convert.{send_text, recv_text}

export text_file_write, text_file_write_local
export text_file_read, text_file_read_local

# Write text to file, converting newlines for the target platform
fn text_file_write(path: text, content: text, remote: PlatformConfig):
    val host = host_config()
    val translated = send_text(host, remote, content)
    file_write(path, translated)

# Write text to file using host platform newlines (most common)
fn text_file_write_local(path: text, content: text):
    text_file_write(path, content, host_config())

# Read text file, normalizing newlines from source platform
fn text_file_read(path: text, source: PlatformConfig) -> text:
    val host = host_config()
    val raw = file_read_text(path)
    recv_text(host, source, raw)

# Read text file assuming host platform (most common)
fn text_file_read_local(path: text) -> text:
    text_file_read(path, host_config())
