# bcrypt_utils.spl - Comprehensive bcrypt password hashing utilities - Facade
#
# Pure Simple implementation of the bcrypt password hashing algorithm.
# bcrypt is a password hashing function based on the Blowfish cipher, designed
# to be intentionally slow to resist brute-force attacks.
#
# Hash Format: $2a$[cost]$[22-char salt][31-char hash]
# Example: $2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy
#
# Security: Cost factor makes rainbow tables impractical. Use cost 10-12.

import "std/bcrypt/hash" as hash
import "std/bcrypt/verify" as verify
import "std/bcrypt/salt" as salt
import "std/bcrypt/key_derivation" as key_derivation
import "std/bcrypt/utilities" as utilities

# ============================================================================
# Main Hashing Functions
# ============================================================================

fn bcrypt_hash(password: text, cost: i64) -> text:
    hash.bcrypt_hash(password, cost)

fn bcrypt_hash_with_salt(password: text, salt_bytes: list[i64], cost: i64) -> text:
    hash.bcrypt_hash_with_salt(password, salt_bytes, cost)

fn bcrypt_hash_default(password: text) -> text:
    hash.bcrypt_hash_default(password)

fn bcrypt_hash_secure(password: text) -> text:
    hash.bcrypt_hash_secure(password)

# ============================================================================
# Verification Functions
# ============================================================================

fn bcrypt_verify(password: text, hash_str: text) -> bool:
    verify.bcrypt_verify(password, hash_str)

fn bcrypt_check(password: text, hash_str: text) -> bool:
    verify.bcrypt_check(password, hash_str)

fn compare_hashes(hash1: text, hash2: text) -> bool:
    verify.compare_hashes(hash1, hash2)

fn bcrypt_verify_and_check_cost(password: text, hash_str: text, target_cost: i64) -> bool:
    verify.bcrypt_verify_and_check_cost(password, hash_str, target_cost)

fn rehash_if_needed(password: text, hash_str: text, target_cost: i64) -> text:
    verify.rehash_if_needed(password, hash_str, target_cost)

# ============================================================================
# Salt Generation Functions
# ============================================================================

fn generate_salt() -> list[i64]:
    salt.generate_salt()

fn generate_salt_with_cost(cost: i64) -> list[i64]:
    salt.generate_salt_with_cost(cost)

fn encode_salt(salt_bytes: list[i64], cost: i64) -> text:
    salt.encode_salt(salt_bytes, cost)

fn extract_salt(hash_str: text) -> list[i64]:
    salt.extract_salt(hash_str)

# ============================================================================
# Cost Factor Utilities
# ============================================================================

fn get_cost_from_hash(hash_str: text) -> i64:
    utilities.get_cost_from_hash(hash_str)

fn is_cost_secure(cost: i64) -> bool:
    utilities.is_cost_secure(cost)

fn recommended_cost() -> i64:
    utilities.recommended_cost()

fn is_valid_cost(cost: i64) -> bool:
    utilities.is_valid_cost(cost)

fn get_min_cost() -> i64:
    utilities.get_min_cost()

fn get_max_cost() -> i64:
    utilities.get_max_cost()

fn get_default_cost() -> i64:
    utilities.get_default_cost()

# ============================================================================
# Hash Parsing Functions
# ============================================================================

fn parse_hash(hash_str: text) -> list[text]:
    utilities.parse_hash(hash_str)

fn hash_to_components(hash_str: text) -> list[text]:
    utilities.hash_to_components(hash_str)

fn is_bcrypt_hash(text_val: text) -> bool:
    utilities.is_bcrypt_hash(text_val)

fn get_version_from_hash(hash_str: text) -> text:
    utilities.get_version_from_hash(hash_str)

# ============================================================================
# Advanced Utilities
# ============================================================================

fn estimate_hash_time(cost: i64) -> i64:
    utilities.estimate_hash_time(cost)

fn bcrypt_encode_base64(bytes: list[i64]) -> text:
    utilities.bcrypt_encode_base64(bytes)

fn bcrypt_decode_base64(encoded: text) -> list[i64]:
    utilities.bcrypt_decode_base64(encoded)

fn get_base64_alphabet() -> text:
    utilities.get_base64_alphabet()

fn encode_cost(cost: i64) -> text:
    utilities.encode_cost(cost)

fn decode_cost(cost_str: text) -> i64:
    utilities.decode_cost(cost_str)

# ============================================================================
# Testing/Debugging Utilities
# ============================================================================

fn test_bcrypt_known_vector() -> bool:
    utilities.test_bcrypt_known_vector()

fn debug_hash(hash_str: text) -> list[text]:
    utilities.debug_hash(hash_str)

fn test_blowfish_encrypt(left: i64, right: i64) -> list[i64]:
    key_derivation.test_blowfish_encrypt(left, right)

fn get_blowfish_state() -> list[list[i64]]:
    key_derivation.get_blowfish_state()

fn hex_to_bytes(hex: text) -> list[i64]:
    utilities.hex_to_bytes(hex)
