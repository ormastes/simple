# String Utilities Module
#
# Comprehensive string manipulation utilities for Simple language.
# Pure Simple implementation - no external dependencies required.
#
# Categories:
# - Basic operations: repeat, reverse, join
# - Character operations: contains_char, count_char, index_of_char
# - Whitespace: is_whitespace, trim variants
# - Case operations: case-insensitive comparison
# - Search: starts_with_char, ends_with_char
#
# All functions are pure and work without FFI.

# ============================================================================
# Exports
# ============================================================================

export repeat_str, reverse_str, is_whitespace
export contains_char, count_char, index_of_char
export starts_with_char, ends_with_char
export join_strs, compare_case_insensitive
export split_on_char, last_index_of_char
export char_at, is_empty, is_blank
export lines, words, capitalize_first

# ============================================================================
# Basic String Operations
# ============================================================================

fn repeat_str(s: text, n: i64) -> text:
    """Repeat a string n times.

    Example:
        repeat_str("abc", 3)  # "abcabcabc"
        repeat_str("x", 0)    # ""
    """
    if n <= 0:
        return ""
    var result = ""
    for _ in 0..n:
        result = result + s
    result

fn reverse_str(s: text) -> text:
    """Reverse a string.

    Example:
        reverse_str("hello")  # "olleh"
    """
    var result = ""
    var i = s.len() - 1
    while i >= 0:
        result = result + s[i:i + 1]
        i = i - 1
    result

fn join_strs(list: [text], sep: text) -> text:
    """Join a list of strings with a separator.

    Example:
        join_strs(["a", "b", "c"], ", ")  # "a, b, c"
        join_strs([], "-")  # ""
    """
    if list.len() == 0:
        return ""
    var result = list[0]
    for i in 1..list.len():
        result = result + sep + list[i]
    result

# ============================================================================
# Character Operations
# ============================================================================

fn contains_char(s: text, c: text) -> bool:
    """Check if string contains a character.

    Example:
        contains_char("hello", "e")  # true
        contains_char("hello", "x")  # false
    """
    if c.len() != 1:
        return false
    for i in 0..s.len():
        if s[i:i + 1] == c:
            return true
    false

fn count_char(s: text, c: text) -> i64:
    """Count occurrences of a character in a string.

    Example:
        count_char("hello", "l")  # 2
        count_char("test", "x")   # 0
    """
    if c.len() != 1:
        return 0
    var count = 0
    for i in 0..s.len():
        if s[i:i + 1] == c:
            count = count + 1
    count

fn index_of_char(s: text, c: text) -> i64?:
    """Find first index of a character in a string.
    Returns nil if not found.

    Example:
        index_of_char("hello", "l")  # Some(2)
        index_of_char("test", "x")   # nil
    """
    if c.len() != 1:
        return nil
    for i in 0..s.len():
        if s[i:i + 1] == c:
            return i
    nil

fn last_index_of_char(s: text, c: text) -> i64?:
    """Find last index of a character in a string.
    Returns nil if not found.

    Example:
        last_index_of_char("hello", "l")  # Some(3)
        last_index_of_char("test", "x")   # nil
    """
    if c.len() != 1:
        return nil
    var i = s.len() - 1
    while i >= 0:
        if s[i:i + 1] == c:
            return i
        i = i - 1
    nil

fn starts_with_char(s: text, c: text) -> bool:
    """Check if string starts with a character.

    Example:
        starts_with_char("hello", "h")  # true
        starts_with_char("hello", "e")  # false
    """
    if s.len() == 0:
        return false
    if c.len() != 1:
        return false
    s[0:1] == c

fn ends_with_char(s: text, c: text) -> bool:
    """Check if string ends with a character.

    Example:
        ends_with_char("hello", "o")  # true
        ends_with_char("hello", "h")  # false
    """
    if s.len() == 0:
        return false
    if c.len() != 1:
        return false
    s[s.len() - 1:s.len()] == c

fn char_at(s: text, index: i64) -> text:
    """Get character at index. Returns empty string if out of bounds.

    Example:
        char_at("hello", 1)  # "e"
        char_at("hello", 10) # ""
    """
    if index < 0 or index >= s.len():
        return ""
    s[index:index + 1]

# ============================================================================
# Whitespace Operations
# ============================================================================

fn is_whitespace(s: text) -> bool:
    """Check if string contains only whitespace characters.

    Example:
        is_whitespace("   ")     # true
        is_whitespace(" a ")     # false
        is_whitespace("")        # true
    """
    if s.len() == 0:
        return true
    for i in 0..s.len():
        val c = s[i:i + 1]
        if c != " " and c != "\t" and c != "\n" and c != "\r":
            return false
    true

fn is_empty(s: text) -> bool:
    """Check if string is empty.

    Example:
        is_empty("")   # true
        is_empty("a")  # false
    """
    s.len() == 0

fn is_blank(s: text) -> bool:
    """Check if string is empty or contains only whitespace.

    Example:
        is_blank("")      # true
        is_blank("  ")    # true
        is_blank(" a ")   # false
    """
    is_whitespace(s)

# ============================================================================
# Case Operations
# ============================================================================

fn compare_case_insensitive(a: text, b: text) -> bool:
    """Compare two strings ignoring case.

    Example:
        compare_case_insensitive("Hello", "hello")  # true
        compare_case_insensitive("Test", "other")   # false
    """
    to_lowercase_str(a) == to_lowercase_str(b)

fn to_lowercase_str(s: text) -> text:
    """Convert string to lowercase (ASCII only).

    Example:
        to_lowercase_str("Hello")  # "hello"
    """
    var result = ""
    for i in 0..s.len():
        val c = s[i:i + 1]
        val code = char_code_simple(c)
        if code >= 65 and code <= 90:
            result = result + char_from_code(code + 32)
        else:
            result = result + c
    result

fn to_uppercase_str(s: text) -> text:
    """Convert string to uppercase (ASCII only).

    Example:
        to_uppercase_str("hello")  # "HELLO"
    """
    var result = ""
    for i in 0..s.len():
        val c = s[i:i + 1]
        val code = char_code_simple(c)
        if code >= 97 and code <= 122:
            result = result + char_from_code(code - 32)
        else:
            result = result + c
    result

fn capitalize_first(s: text) -> text:
    """Capitalize first letter of string.

    Example:
        capitalize_first("hello")  # "Hello"
    """
    if s.len() == 0:
        return s
    val first = s[0:1]
    val rest = s[1:]
    to_uppercase_str(first) + rest

# ============================================================================
# Split Operations
# ============================================================================

fn split_on_char(s: text, c: text) -> [text]:
    """Split string on a character.

    Example:
        split_on_char("a,b,c", ",")  # ["a", "b", "c"]
    """
    if c.len() != 1:
        return [s]
    var result: [text] = []
    var current = ""
    for i in 0..s.len():
        val ch = s[i:i + 1]
        if ch == c:
            result = result.push(current)
            current = ""
        else:
            current = current + ch
    result.push(current)

fn lines(s: text) -> [text]:
    """Split string into lines.

    Example:
        lines("a\nb\nc")  # ["a", "b", "c"]
    """
    split_on_char(s, "\n")

fn words(s: text) -> [text]:
    """Split string into words (on spaces).

    Example:
        words("hello world")  # ["hello", "world"]
    """
    var result: [text] = []
    var current = ""
    for i in 0..s.len():
        val c = s[i:i + 1]
        if c == " " or c == "\t" or c == "\n" or c == "\r":
            if current.len() > 0:
                result = result.push(current)
                current = ""
        else:
            current = current + c
    if current.len() > 0:
        result = result.push(current)
    result

# ============================================================================
# Helper Functions
# ============================================================================

fn char_code_simple(c: text) -> i64:
    """Get ASCII code of a character (simplified version)."""
    # Use existing char_code from std.string if available
    # Fallback to basic A-Z, a-z, 0-9
    if c == "A": return 65
    if c == "B": return 66
    if c == "C": return 67
    if c == "D": return 68
    if c == "E": return 69
    if c == "F": return 70
    if c == "G": return 71
    if c == "H": return 72
    if c == "I": return 73
    if c == "J": return 74
    if c == "K": return 75
    if c == "L": return 76
    if c == "M": return 77
    if c == "N": return 78
    if c == "O": return 79
    if c == "P": return 80
    if c == "Q": return 81
    if c == "R": return 82
    if c == "S": return 83
    if c == "T": return 84
    if c == "U": return 85
    if c == "V": return 86
    if c == "W": return 87
    if c == "X": return 88
    if c == "Y": return 89
    if c == "Z": return 90
    if c == "a": return 97
    if c == "b": return 98
    if c == "c": return 99
    if c == "d": return 100
    if c == "e": return 101
    if c == "f": return 102
    if c == "g": return 103
    if c == "h": return 104
    if c == "i": return 105
    if c == "j": return 106
    if c == "k": return 107
    if c == "l": return 108
    if c == "m": return 109
    if c == "n": return 110
    if c == "o": return 111
    if c == "p": return 112
    if c == "q": return 113
    if c == "r": return 114
    if c == "s": return 115
    if c == "t": return 116
    if c == "u": return 117
    if c == "v": return 118
    if c == "w": return 119
    if c == "x": return 120
    if c == "y": return 121
    if c == "z": return 122
    if c == "0": return 48
    if c == "1": return 49
    if c == "2": return 50
    if c == "3": return 51
    if c == "4": return 52
    if c == "5": return 53
    if c == "6": return 54
    if c == "7": return 55
    if c == "8": return 56
    if c == "9": return 57
    if c == " ": return 32
    if c == "\n": return 10
    if c == "\t": return 9
    if c == "\r": return 13
    0

fn char_from_code(code: i64) -> text:
    """Convert ASCII code to character (simplified version)."""
    if code == 65: return "A"
    if code == 66: return "B"
    if code == 67: return "C"
    if code == 68: return "D"
    if code == 69: return "E"
    if code == 70: return "F"
    if code == 71: return "G"
    if code == 72: return "H"
    if code == 73: return "I"
    if code == 74: return "J"
    if code == 75: return "K"
    if code == 76: return "L"
    if code == 77: return "M"
    if code == 78: return "N"
    if code == 79: return "O"
    if code == 80: return "P"
    if code == 81: return "Q"
    if code == 82: return "R"
    if code == 83: return "S"
    if code == 84: return "T"
    if code == 85: return "U"
    if code == 86: return "V"
    if code == 87: return "W"
    if code == 88: return "X"
    if code == 89: return "Y"
    if code == 90: return "Z"
    if code == 97: return "a"
    if code == 98: return "b"
    if code == 99: return "c"
    if code == 100: return "d"
    if code == 101: return "e"
    if code == 102: return "f"
    if code == 103: return "g"
    if code == 104: return "h"
    if code == 105: return "i"
    if code == 106: return "j"
    if code == 107: return "k"
    if code == 108: return "l"
    if code == 109: return "m"
    if code == 110: return "n"
    if code == 111: return "o"
    if code == 112: return "p"
    if code == 113: return "q"
    if code == 114: return "r"
    if code == 115: return "s"
    if code == 116: return "t"
    if code == 117: return "u"
    if code == 118: return "v"
    if code == 119: return "w"
    if code == 120: return "x"
    if code == 121: return "y"
    if code == 122: return "z"
    if code == 48: return "0"
    if code == 49: return "1"
    if code == 50: return "2"
    if code == 51: return "3"
    if code == 52: return "4"
    if code == 53: return "5"
    if code == 54: return "6"
    if code == 55: return "7"
    if code == 56: return "8"
    if code == 57: return "9"
    if code == 32: return " "
    if code == 10: return "\n"
    if code == 9: return "\t"
    if code == 13: return "\r"
    ""
