# Iterator Creation
#
# Functions for creating iterators from various sources.

export iter_from_array, iter_from_range, iter_from_function, iter_empty
export iter_cycle, iter_repeat

fn iter_from_array(items):
    """Create an iterator from an array.

    Example:
        val it = iter_from_array([1, 2, 3])
        iter_collect(it)  # [1, 2, 3]
    """
    {
        "type": "iterator",
        "data": items,
        "index": 0,
        "generator": nil,
        "state": nil,
        "done": items.len() == 0
    }

fn iter_from_range(start, end, step):
    """Create an iterator over a numeric range with custom step.

    Example:
        val it = iter_from_range(0, 10, 2)
        iter_collect(it)  # [0, 2, 4, 6, 8]
    """
    if step == 0:
        return iter_empty()

    {
        "type": "iterator",
        "data": [],
        "index": 0,
        "generator": "range",
        "state": {"current": start, "end": end, "step": step},
        "done": false
    }

fn iter_from_function(initial, fn):
    """Create an iterator from a generator function.

    The function takes current state and returns (next_state, continue).
    If continue is false, iteration stops.

    Example:
        val it = iter_from_function(1, \x: (x * 2, x < 100))
        iter_collect(it)  # [1, 2, 4, 8, 16, 32, 64]
    """
    {
        "type": "iterator",
        "data": [],
        "index": 0,
        "generator": "function",
        "state": {"fn": fn, "current": initial},
        "done": false
    }

fn iter_empty():
    """Create an empty iterator.

    Example:
        val it = iter_empty()
        iter_collect(it)  # []
    """
    {
        "type": "iterator",
        "data": [],
        "index": 0,
        "generator": nil,
        "state": nil,
        "done": true
    }

fn iter_cycle(items):
    """Create an infinite iterator that cycles through items.

    CAUTION: Infinite iterator. Use with iter_take.

    Example:
        val it = iter_cycle([1, 2, 3])
        iter_collect(iter_take(it, 7))  # [1, 2, 3, 1, 2, 3, 1]
    """
    if items.len() == 0:
        return iter_empty()

    {
        "type": "iterator",
        "data": [],
        "index": 0,
        "generator": "cycle",
        "state": {"items": items, "position": 0},
        "done": false
    }

fn iter_repeat(value):
    """Create an infinite iterator repeating the same value.

    CAUTION: Infinite iterator. Use with iter_take.

    Example:
        val it = iter_repeat(42)
        iter_collect(iter_take(it, 3))  # [42, 42, 42]
    """
    {
        "type": "iterator",
        "data": [],
        "index": 0,
        "generator": "repeat",
        "state": {"value": value},
        "done": false
    }
