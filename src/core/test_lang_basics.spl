# Core Simple — Language Basics Tests
#
# Derived from feature specs (arithmetic, numeric literals, strings, control flow)
# but rewritten to avoid SSpec and unsupported Core Simple syntax.
#
# Run:
#   bin/release/simple src/core/test_lang_basics.spl

# Simple check functions — only print on failure
fn check_eq_int(label: text, actual: i64, expected: i64):
    if actual != expected:
        print "FAIL: {label} - expected {expected}, got {actual}"

fn check_eq_bool(label: text, actual: bool, expected: bool):
    if actual != expected:
        val a = if actual: "true" else: "false"
        val e = if expected: "true" else: "false"
        print "FAIL: {label} - expected {e}, got {a}"

fn check_eq_str(label: text, actual: text, expected: text):
    if actual != expected:
        print "FAIL: {label} - expected '{expected}', got '{actual}'"

fn check_eq_float(label: text, actual: f64, expected: f64):
    if actual != expected:
        print "FAIL: {label} - expected {expected}, got {actual}"

fn check_true(label: text, condition: bool):
    if not condition:
        print "FAIL: {label}"

print "--- Arithmetic ---"
check_eq_int("2 + 3", 2 + 3, 5)
check_eq_int("10 - 3", 10 - 3, 7)
check_eq_int("4 * 5", 4 * 5, 20)
check_eq_int("15 / 3", 15 / 3, 5)
check_eq_int("7 / 2", 7 / 2, 3)
check_eq_int("17 % 5", 17 % 5, 2)
check_eq_int("(-5) + 3", (-5) + 3, -2)
check_eq_int("(-4) * -5", (-4) * -5, 20)
check_eq_int("20 / -4", 20 / -4, -5)
check_eq_int("(-20) / -4", (-20) / -4, 5)

print "--- Arithmetic Precedence ---"
check_eq_int("2 + 3 * 4", 2 + 3 * 4, 14)
check_eq_int("10 - 3 * 2", 10 - 3 * 2, 4)
check_eq_int("(2 + 3) * 4", (2 + 3) * 4, 20)
check_eq_int("20 - 5 - 3", 20 - 5 - 3, 12)
check_eq_int("20 / 4 / 2", 20 / 4 / 2, 2)

print "--- Floating Point ---"
check_eq_float("2.5 + 3.5", 2.5 + 3.5, 6.0)
check_eq_float("10.5 - 3.2", 10.5 - 3.2, 7.3)
check_eq_float("2.5 * 4.0", 2.5 * 4.0, 10.0)
check_eq_float("10.0 / 2.0", 10.0 / 2.0, 5.0)
check_eq_float("5 + 2.5", 5 + 2.5, 7.5)

print "--- Numeric Literals ---"
check_eq_int("hex 0xFF", 0xFF, 255)
check_eq_int("hex 0xAb", 0xAb, 171)
check_eq_int("bin 0b1010", 0b1010, 10)
check_eq_int("oct 0o10", 0o10, 8)
check_eq_int("sep 1_000_000", 1_000_000, 1000000)
check_eq_int("hex sep 0xFF_FF", 0xFF_FF, 65535)
check_eq_int("bin sep 0b1010_1010", 0b1010_1010, 170)

print "--- Comparison ---"
check_eq_bool("5 > 3", 5 > 3, true)
check_eq_bool("2 < 10", 2 < 10, true)
check_eq_bool("5 == 5", 5 == 5, true)
check_eq_bool("3 != 4", 3 != 4, true)
check_eq_bool("3 <= 3", 3 <= 3, true)
check_eq_bool("4 >= 3", 4 >= 3, true)

print "--- Strings ---"
val s = "Hello" + " " + "World"
check_eq_str("concat", s, "Hello World")
val name = "Alice"
val age = 30
val msg = "Name: {name}, Age: {age}"
check_eq_str("interpolation", msg, "Name: Alice, Age: 30")

print "--- Arrays ---"
val arr = [10, 20, 30, 40, 50]
check_eq_int("index 0", arr[0], 10)
check_eq_int("index 2", arr[2], 30)
check_eq_int("index expr", arr[2 + 1], 40)

print "--- Control Flow ---"
var sum = 0
for i in [1, 2, 3, 4, 5]:
    sum = sum + i
check_eq_int("for sum", sum, 15)

var count = 0
var total = 0
while count < 4:
    total = total + count
    count = count + 1
check_eq_int("while sum", total, 6)

var flag = false
if 2 + 3 == 5:
    flag = true
check_eq_bool("if true branch", flag, true)

print ""
print "=== Core Simple Language Basics Test ==="
print "If no FAIL lines above, all tests passed."
