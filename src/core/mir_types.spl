# Core Simple — MIR Type Definitions
#
# Struct-based MIR types for the shared core library.
# Used by mir.spl struct pools and by compiler MIR extensions.
#
# Compiled by seed (Core Simple subset).

# ===== CoreMirInst — single MIR instruction =====
# Fields mirror the inst_* parallel arrays in mir.spl.

struct CoreMirInst:
    kind: i64
    dest: i64
    src1: i64
    src2: i64
    src3: i64
    i_val: i64
    s_val: text
    f_val: text
    args: [i64]

fn make_core_mir_inst(kind: i64) -> CoreMirInst:
    CoreMirInst(kind: kind, dest: -1, src1: -1, src2: -1, src3: -1, i_val: 0, s_val: "", f_val: "", args: [])

# ===== CoreTerminator — basic block terminator =====

struct CoreTerminator:
    kind: i64
    cond: i64
    target1: i64
    target2: i64
    value: i64
    targets: [i64]
    values: [i64]

fn make_core_terminator(kind: i64) -> CoreTerminator:
    CoreTerminator(kind: kind, cond: -1, target1: -1, target2: -1, value: -1, targets: [], values: [])

# ===== CoreBasicBlock — instruction list + terminator =====

struct CoreBasicBlock:
    label: text
    instructions: [i64]
    terminator: i64

fn make_core_basic_block(label: text) -> CoreBasicBlock:
    CoreBasicBlock(label: label, instructions: [], terminator: -1)

# ===== CoreMirVar — SSA-like variable =====

struct CoreMirVar:
    name: text
    type_tag: i64

fn make_core_mir_var(name: text, type_tag: i64) -> CoreMirVar:
    CoreMirVar(name: name, type_tag: type_tag)

# ===== CoreMirFunction — function with basic blocks =====

struct CoreMirFunction:
    name: text
    param_names: [text]
    param_types: [i64]
    ret_type: i64
    bbs: [i64]
    vars: [i64]
    is_extern: i64

fn make_core_mir_function(name: text, param_names: [text], param_types: [i64], ret_type: i64, is_ext: i64) -> CoreMirFunction:
    CoreMirFunction(name: name, param_names: param_names, param_types: param_types, ret_type: ret_type, bbs: [], vars: [], is_extern: is_ext)

# ===== CoreMirModule — collection of functions and struct defs =====

struct CoreMirStructDef:
    name: text
    field_names: [text]
    field_types: [i64]

fn make_core_mir_struct_def(name: text, fields: [text], types: [i64]) -> CoreMirStructDef:
    CoreMirStructDef(name: name, field_names: fields, field_types: types)

export CoreMirInst, make_core_mir_inst
export CoreTerminator, make_core_terminator
export CoreBasicBlock, make_core_basic_block
export CoreMirVar, make_core_mir_var
export CoreMirFunction, make_core_mir_function
export CoreMirStructDef, make_core_mir_struct_def
