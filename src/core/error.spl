# Core Simple — Error Reporting with Easyfix Suggestions
#
# When the Core parser encounters unsupported Full Simple syntax,
# this module provides helpful error messages with actionable
# rewrite suggestions, not cryptic parse failures.
#
# Design: Pure functions, no module state. Each function prints
# a structured error with an easyfix suggestion.
#
# Error format:
#   error[E:core_unsupported]: line N:M: description
#   easyfix: suggested rewrite
#
# Integrates with the existing easyfix infrastructure pattern.

use core.types.{int_to_str}

# ===== Error Severity =====
val ERROR_HINT = 0
val ERROR_WARNING = 1
val ERROR_ERROR = 2

# ===== Core Error Formatting =====

fn core_error(line: i64, col: i64, message: text):
    print "error[E:core]: line " + int_to_str(line) + ":" + int_to_str(col) + ": " + message

fn core_error_unsupported(line: i64, col: i64, feature: text, suggestion: text):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": `" + feature + "` is not supported in Core Simple"
    print "  easyfix: " + suggestion

# ===== Unsupported Syntax — Easyfix Suggestions =====

fn error_impl_block(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": `impl` blocks not supported in Core Simple"
    print "  easyfix: rewrite as free function:"
    print "    impl Type:           ->  fn Type_method(self_arg: Type):"
    print "      fn method():       ->      ..."
    print "  run: simple fix --core-compat file.spl"

fn error_class_decl(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": `class` not supported in Core Simple"
    print "  easyfix: use `struct` instead:"
    print "    class Point:         ->  struct Point:"
    print "      x: i64             ->      x: i64"
    print "      fn method():       ->  fn Point_method(self_arg: Point):"
    print "  run: simple fix --core-compat file.spl"

fn error_me_method(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": `me` (mutable method) not supported in Core Simple"
    print "  easyfix: rewrite as free function with mutable parameter:"
    print "    me move(dx: i64):    ->  fn Type_move(self_arg: Type, dx: i64) -> Type:"
    print "  run: simple fix --core-compat file.spl"

fn error_static_method(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": `static fn` not supported in Core Simple"
    print "  easyfix: rewrite as free function:"
    print "    static fn new():     ->  fn Type_new() -> Type:"
    print "  run: simple fix --core-compat file.spl"

fn error_generics(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": generics (`<T>`) not supported in Core Simple"
    print "  easyfix: monomorphize — use concrete types:"
    print "    fn map<T,U>(f):      ->  fn map_i64_text(f: fn(i64) -> text):"
    print "    Container<T>         ->  Container_i64"
    print "  run: simple fix --core-compat file.spl"

fn error_lambda(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": lambda expressions not supported in Core Simple"
    print "  easyfix: define as named function:"
    print "    \\x: x * 2            ->  fn double(x: i64) -> i64: x * 2"
    print "  run: simple fix --core-compat file.spl"

fn error_closure(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": closures (capturing variables) not supported in Core Simple"
    print "  easyfix: pass captured variables as explicit parameters:"
    print "    fn(): captured + 1   ->  fn add_one(captured: i64) -> i64: captured + 1"
    print "  run: simple fix --core-compat file.spl"

fn error_optional_chain(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": optional chaining (`?.`) not supported in Core Simple"
    print "  easyfix: use explicit nil check:"
    print "    x?.field             ->  if x != nil: x.field else: nil"
    print "  run: simple fix --core-compat file.spl"

fn error_existence_check(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": existence check (`.?`) not supported in Core Simple"
    print "  easyfix: use explicit nil check:"
    print "    x.?                  ->  x != nil"
    print "  run: simple fix --core-compat file.spl"

fn error_pipe_operator(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": pipe operator (`|>`) not supported in Core Simple"
    print "  easyfix: rewrite as nested call:"
    print "    x |> f |> g          ->  g(f(x))"
    print "  run: simple fix --core-compat file.spl"

fn error_decorator(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": decorators (`@`) not supported in Core Simple"
    print "  easyfix: call explicitly:"
    print "    @cached              ->  fn raw_fn(): ..."
    print "    fn my_fn():          ->  val my_fn = cached(raw_fn)"
    print "  run: simple fix --core-compat file.spl"

fn error_math_block(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": math blocks not supported in Core Simple"
    print "  easyfix: use `**` for power instead of `^` in math blocks"
    print "  run: simple fix --core-compat file.spl"

fn error_trait_decl(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": `trait` not supported in Core Simple"
    print "  easyfix: use free functions with struct parameters:"
    print "    trait Printable:     ->  fn to_string(item: MyType) -> text:"
    print "      fn to_string():   ->      ..."
    print "  run: simple fix --core-compat file.spl"

fn error_async_await(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": `async`/`await` not supported in Core Simple"
    print "  easyfix: use synchronous code or callback pattern"

fn error_actor(line: i64, col: i64):
    print "error[E:core_unsupported]: line " + int_to_str(line) + ":" + int_to_str(col) + ": `actor` not supported in Core Simple"
    print "  easyfix: use struct + free functions pattern"

# ===== Parse Error Helpers =====

fn error_expected_token(line: i64, col: i64, expected: text, got: text):
    print "error[E:core_parse]: line " + int_to_str(line) + ":" + int_to_str(col) + ": expected " + expected + ", found " + got

fn error_unexpected_token(line: i64, col: i64, token_text: text):
    print "error[E:core_parse]: line " + int_to_str(line) + ":" + int_to_str(col) + ": unexpected token `" + token_text + "`"

fn error_unexpected_indent(line: i64, col: i64):
    print "error[E:core_parse]: line " + int_to_str(line) + ":" + int_to_str(col) + ": unexpected indentation"

fn error_unterminated_string(line: i64, col: i64):
    print "error[E:core_parse]: line " + int_to_str(line) + ":" + int_to_str(col) + ": unterminated string literal"

fn error_invalid_number(line: i64, col: i64, token_text: text):
    print "error[E:core_parse]: line " + int_to_str(line) + ":" + int_to_str(col) + ": invalid number literal `" + token_text + "`"

# ===== Semantic Error Helpers =====

fn error_undefined_name(line: i64, col: i64, name: text):
    print "error[E:core_name]: line " + int_to_str(line) + ":" + int_to_str(col) + ": undefined name `" + name + "`"

fn error_duplicate_name(line: i64, col: i64, name: text):
    print "error[E:core_name]: line " + int_to_str(line) + ":" + int_to_str(col) + ": duplicate definition `" + name + "`"

fn error_type_mismatch(line: i64, col: i64, expected: text, got: text):
    print "error[E:core_type]: line " + int_to_str(line) + ":" + int_to_str(col) + ": type mismatch: expected " + expected + ", got " + got

fn error_wrong_arg_count(line: i64, col: i64, name: text, expected: i64, got: i64):
    print "error[E:core_args]: line " + int_to_str(line) + ":" + int_to_str(col) + ": `" + name + "` expects " + int_to_str(expected) + " arguments, got " + int_to_str(got)

export ERROR_HINT, ERROR_WARNING, ERROR_ERROR
export core_error, core_error_unsupported
export error_impl_block, error_class_decl, error_me_method, error_static_method
export error_generics, error_lambda, error_closure
export error_optional_chain, error_existence_check, error_pipe_operator
export error_decorator, error_math_block, error_trait_decl
export error_async_await, error_actor
export error_expected_token, error_unexpected_token, error_unexpected_indent
export error_unterminated_string, error_invalid_number
export error_undefined_name, error_duplicate_name, error_type_mismatch
export error_wrong_arg_count
