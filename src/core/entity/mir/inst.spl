# MIR Entity - CoreMirInst and MIR_* opcode constants
#
# Extracted from src/core/mir_types.spl and src/core/mir.spl
# Seed-compatible MIR instruction definitions.

# ===== MIR Instruction Kind Constants =====

# Constants
val MIR_CONST_INT = 1
val MIR_CONST_FLOAT = 2
val MIR_CONST_BOOL = 3
val MIR_CONST_STRING = 4
val MIR_CONST_NIL = 5
val MIR_COPY = 6
val MIR_MOVE = 7

# Arithmetic
val MIR_ADD = 10
val MIR_SUB = 11
val MIR_MUL = 12
val MIR_DIV = 13
val MIR_MOD = 14
val MIR_NEG = 15
val MIR_POW = 16

# Comparison
val MIR_EQ = 20
val MIR_NE = 21
val MIR_LT = 22
val MIR_LE = 23
val MIR_GT = 24
val MIR_GE = 25

# Logical
val MIR_AND = 30
val MIR_OR = 31
val MIR_NOT = 32

# Bitwise
val MIR_BIT_AND = 35
val MIR_BIT_OR = 36
val MIR_BIT_XOR = 37
val MIR_BIT_NOT = 38

# Memory
val MIR_ALLOC = 40
val MIR_LOAD = 41
val MIR_STORE = 42
val MIR_GET_ELEMENT_PTR = 43

# Aggregate / struct
val MIR_AGGREGATE = 50
val MIR_GET_FIELD = 51
val MIR_SET_FIELD = 52

# Array operations
val MIR_ARRAY_NEW = 55
val MIR_ARRAY_PUSH = 56
val MIR_ARRAY_GET = 57
val MIR_ARRAY_SET = 58
val MIR_ARRAY_LEN = 59

# Dict operations
val MIR_DICT_NEW = 60
val MIR_DICT_SET = 61
val MIR_DICT_GET = 62
val MIR_DICT_CONTAINS = 63
val MIR_DICT_KEYS = 64
val MIR_DICT_LEN = 65

# String operations
val MIR_STR_CONCAT = 70
val MIR_STR_LEN = 71
val MIR_STR_SLICE = 72
val MIR_STR_INDEX = 73
val MIR_STR_FORMAT = 74

# Calls
val MIR_CALL = 80
val MIR_CALL_EXTERN = 81
val MIR_CALL_INDIRECT = 82

# Misc
val MIR_CAST = 85
val MIR_NOP = 90
val MIR_PRINT = 91
val MIR_PRINTLN = 92

# ===== Terminator Kind Constants =====

val TERM_GOTO = 1
val TERM_RETURN = 2
val TERM_RETURN_VOID = 3
val TERM_IF = 4
val TERM_SWITCH = 5
val TERM_UNREACHABLE = 6

# ===== CoreMirInst — single MIR instruction =====
# Fields mirror the inst_* parallel arrays in mir.spl.

struct CoreMirInst:
    kind: i64
    dest: i64
    src1: i64
    src2: i64
    src3: i64
    i_val: i64
    s_val: text
    f_val: text
    args: [i64]

fn make_core_mir_inst(kind: i64) -> CoreMirInst:
    CoreMirInst(kind: kind, dest: -1, src1: -1, src2: -1, src3: -1, i_val: 0, s_val: "", f_val: "", args: [])

# ===== CoreTerminator — basic block terminator =====

struct CoreTerminator:
    kind: i64
    cond: i64
    target1: i64
    target2: i64
    value: i64
    targets: [i64]
    values: [i64]

fn make_core_terminator(kind: i64) -> CoreTerminator:
    CoreTerminator(kind: kind, cond: -1, target1: -1, target2: -1, value: -1, targets: [], values: [])

export MIR_CONST_INT, MIR_CONST_FLOAT, MIR_CONST_BOOL, MIR_CONST_STRING, MIR_CONST_NIL
export MIR_COPY, MIR_MOVE
export MIR_ADD, MIR_SUB, MIR_MUL, MIR_DIV, MIR_MOD, MIR_NEG, MIR_POW
export MIR_EQ, MIR_NE, MIR_LT, MIR_LE, MIR_GT, MIR_GE
export MIR_AND, MIR_OR, MIR_NOT
export MIR_BIT_AND, MIR_BIT_OR, MIR_BIT_XOR, MIR_BIT_NOT
export MIR_ALLOC, MIR_LOAD, MIR_STORE, MIR_GET_ELEMENT_PTR
export MIR_AGGREGATE, MIR_GET_FIELD, MIR_SET_FIELD
export MIR_ARRAY_NEW, MIR_ARRAY_PUSH, MIR_ARRAY_GET, MIR_ARRAY_SET, MIR_ARRAY_LEN
export MIR_DICT_NEW, MIR_DICT_SET, MIR_DICT_GET, MIR_DICT_CONTAINS, MIR_DICT_KEYS, MIR_DICT_LEN
export MIR_STR_CONCAT, MIR_STR_LEN, MIR_STR_SLICE, MIR_STR_INDEX, MIR_STR_FORMAT
export MIR_CALL, MIR_CALL_EXTERN, MIR_CALL_INDIRECT
export MIR_CAST, MIR_NOP, MIR_PRINT, MIR_PRINTLN
export TERM_GOTO, TERM_RETURN, TERM_RETURN_VOID, TERM_IF, TERM_SWITCH, TERM_UNREACHABLE
export CoreMirInst, make_core_mir_inst
export CoreTerminator, make_core_terminator
