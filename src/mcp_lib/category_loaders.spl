# MCP Category Loaders
#
# Loads handler categories on-demand
# Each function imports its category's handler modules

use mcp_lib.lazy_registry.{register_cached_handler, mark_category_loaded}

# Category: fileio (diagnostic read tools)
fn load_fileio_category():
    # Import fileio handlers
    use app.mcp.diag_read_tools.{handle_simple_read, handle_simple_check, handle_simple_symbols, handle_simple_status}

    # Register in cache
    register_cached_handler("simple_read", handle_simple_read)
    register_cached_handler("read_code", handle_simple_read)  # Alias
    register_cached_handler("simple_check", handle_simple_check)
    register_cached_handler("file_info", handle_simple_check)  # Alias
    register_cached_handler("simple_symbols", handle_simple_symbols)
    register_cached_handler("simple_status", handle_simple_status)

    # Mark category as loaded
    mark_category_loaded("fileio")

# Category: edit (diagnostic edit tools)
fn load_edit_category():
    use app.mcp.diag_edit_tools.{handle_simple_edit, handle_simple_multi_edit, handle_simple_run}

    register_cached_handler("simple_edit", handle_simple_edit)
    register_cached_handler("simple_multi_edit", handle_simple_multi_edit)
    register_cached_handler("simple_run", handle_simple_run)

    mark_category_loaded("edit")

# Category: vcs (version control tools)
fn load_vcs_category():
    use app.mcp.diag_vcs_tools.{handle_simple_diff, handle_simple_log, handle_simple_squash, handle_simple_new}

    register_cached_handler("simple_diff", handle_simple_diff)
    register_cached_handler("simple_log", handle_simple_log)
    register_cached_handler("simple_squash", handle_simple_squash)
    register_cached_handler("simple_new", handle_simple_new)

    mark_category_loaded("vcs")

# Category: debug (debug session tools)
fn load_debug_category():
    use app.mcp.debug_tools.{
        handle_debug_create_session,
        handle_debug_list_sessions,
        handle_debug_close_session,
        handle_debug_set_breakpoint,
        handle_debug_remove_breakpoint,
        handle_debug_continue,
        handle_debug_step,
        handle_debug_get_variables,
        handle_debug_stack_trace,
        handle_debug_evaluate
    }

    register_cached_handler("debug_create_session", handle_debug_create_session)
    register_cached_handler("debug_list_sessions", handle_debug_list_sessions)
    register_cached_handler("debug_close_session", handle_debug_close_session)
    register_cached_handler("debug_set_breakpoint", handle_debug_set_breakpoint)
    register_cached_handler("debug_remove_breakpoint", handle_debug_remove_breakpoint)
    register_cached_handler("debug_continue", handle_debug_continue)
    register_cached_handler("debug_step", handle_debug_step)
    register_cached_handler("debug_get_variables", handle_debug_get_variables)
    register_cached_handler("debug_stack_trace", handle_debug_stack_trace)
    register_cached_handler("debug_evaluate", handle_debug_evaluate)

    mark_category_loaded("debug")

# Category: debug_log (debug logging tools)
fn load_debug_log_category():
    use app.mcp.debug_log_tools.{
        handle_debug_log_enable,
        handle_debug_log_disable,
        handle_debug_log_clear,
        handle_debug_log_query,
        handle_debug_log_tree,
        handle_debug_log_status
    }

    register_cached_handler("debug_log_enable", handle_debug_log_enable)
    register_cached_handler("debug_log_disable", handle_debug_log_disable)
    register_cached_handler("debug_log_clear", handle_debug_log_clear)
    register_cached_handler("debug_log_query", handle_debug_log_query)
    register_cached_handler("debug_log_tree", handle_debug_log_tree)
    register_cached_handler("debug_log_status", handle_debug_log_status)

    mark_category_loaded("debug_log")

# Load a category by name
fn load_category(category: text):
    if category == "fileio":
        load_fileio_category()
    elif category == "edit":
        load_edit_category()
    elif category == "vcs":
        load_vcs_category()
    elif category == "debug":
        load_debug_category()
    elif category == "debug_log":
        load_debug_log_category()
    else:
        ()  # Unknown category

# Export loaders
export load_fileio_category, load_edit_category, load_vcs_category
export load_debug_category, load_debug_log_category
export load_category
