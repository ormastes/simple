# Macro Validation
#
# Ordering constraints, shadowing detection, and validation rules
# for one-pass LL(1) macro compilation.
#
# Port of rust/compiler/src/macro_validation.rs (464 lines)

export BlockPosition, BlockContext, MacroValidator, ValidationResult

# ============================================================================
# Block Position
# ============================================================================

enum BlockPosition:
    Head        # Before any non-macro statements
    Middle      # After some non-macro statements
    Tail        # After all non-macro statements

# ============================================================================
# Block Context
# ============================================================================

class BlockContext:
    """Context about current block during macro expansion."""
    has_non_macro_statements: bool
    current_position: BlockPosition


# ============================================================================
# BlockContext Methods (was: impl BlockContext:)
# ============================================================================

fn blockcontext_create() -> BlockContext:
        BlockContext(
                     current_position: BlockPosition.Head)


# ============================================================================
# Validation Result
# ============================================================================

struct ValidationResult:
    is_valid: bool
    errors: [text]
    warnings: [text]


# ============================================================================
# ValidationResult Methods (was: impl ValidationResult:)
# ============================================================================

fn validationresult_ok() -> ValidationResult:
        ValidationResult(is_valid: true, errors: [], warnings: [])


fn validationresult_error(msg: text) -> ValidationResult:
        ValidationResult(is_valid: false, errors: [msg], warnings: [])


# ============================================================================
# Macro Validator
# ============================================================================

class MacroValidator:
    """Validates macro definitions for one-pass compilation."""
    known_macros: [text]
    max_expansion_depth: i64


# ============================================================================
# MacroValidator Methods (was: impl MacroValidator:)
# ============================================================================

fn macrovalidator_create() -> MacroValidator:
        MacroValidator(known_macros: [], max_expansion_depth: 64)

