# Context Management and Environment Operations
#
# Manages the type inference context:
# - Context initialization (new, with_builtins, with_dim_check_mode)
# - Builtin function registration
# - Environment operations (lookup, bind_mono, bind_poly)
# - Error recording
#
# The context holds the type environment, substitution, trait solver,
# and dimension solver state throughout type inference.

use compiler.hir.*
use compiler.lexer.*
use compiler.dim_constraints.*
use compiler.traits.*
use type_infer_types.*


# ============================================================================
# HmInferContext Methods (was: impl HmInferContext:)
# ============================================================================

fn hminfercontext_new() -> HmInferContext:
        """Create a new inference context at level 0.

        Default dimension check mode is Assert (debug assertions).
        """
        HmInferContext(
            env: empty_type_env(),
            level: 0,
            next_var: 0,
            subst: substitution_new(),
            errors: [],
            dim_solver: dimsolver_new(),
            runtime_checks: dimcheckgenerator_new(DimCheckMode.Assert),
            dim_check_mode: DimCheckMode.Assert,
            trait_solver: traitsolver_create(),
            function_bounds: {}
        )


fn hminfercontext_with_dim_check_mode(mode: DimCheckMode) -> HmInferContext:
        """Create a new inference context with specified dimension check mode."""
        HmInferContext(
            env: empty_type_env(),
            level: 0,
            next_var: 0,
            subst: substitution_new(),
            errors: [],
            dim_solver: dimsolver_new(),
            runtime_checks: dimcheckgenerator_new(mode),
            dim_check_mode: mode,
            trait_solver: traitsolver_create(),
            function_bounds: {}
        )


fn hminfercontext_with_builtins() -> HmInferContext:
        """Create a context with pre-defined builtins."""
        var ctx = hminfercontext_new()
        ctx_add_builtins(ctx)
        ctx

