# Effects Cache
#
# Caches effect analysis results for functions and operations.
# Avoids re-analyzing unchanged functions during incremental compilation.
#
# Port of rust/compiler/src/effects_cache.rs (120+ lines)

export EffectCacheConfig, EffectCacheStats, FunctionEffectInfo, EffectCache

# ============================================================================
# Types
# ============================================================================

struct EffectCacheConfig:
    max_entries: i64
    validate_on_lookup: bool


# ============================================================================
# EffectCacheConfig Methods (was: impl EffectCacheConfig:)
# ============================================================================

fn effectcacheconfig_default_config() -> EffectCacheConfig:
        EffectCacheConfig(max_entries: 5000, validate_on_lookup: true)


struct EffectCacheStats:
    hits: i64
    misses: i64
    entries: i64


# ============================================================================
# EffectCacheStats Methods (was: impl EffectCacheStats:)
# ============================================================================

fn effectcachestats_empty() -> EffectCacheStats:
        EffectCacheStats(hits: 0, misses: 0, entries: 0)


struct FunctionEffectInfo:
    """Effect analysis results for a single function."""
    name: text
    declared_effects: [text]
    derived_effects: [text]
    called_operations: [text]
    called_functions: [text]
    violations: [text]


# ============================================================================
# FunctionEffectInfo Methods (was: impl FunctionEffectInfo:)
# ============================================================================

fn functioneffectinfo_empty(name: text) -> FunctionEffectInfo:
        FunctionEffectInfo(name: name, declared_effects: [], derived_effects: [],
                           called_operations: [], called_functions: [], violations: [])


# ============================================================================
# Effect Cache
# ============================================================================

class EffectCache:
    """Caches function effect analysis results."""
    config: EffectCacheConfig
    function_cache: {text: FunctionEffectInfo}
    operation_effects: {text: [text]}    # operation -> required effects
    stats: EffectCacheStats


# ============================================================================
# EffectCache Methods (was: impl EffectCache:)
# ============================================================================

fn effectcache_create(config: EffectCacheConfig) -> EffectCache:
        EffectCache(config: config, function_cache: {},
                    operation_effects: {}, stats: effectcachestats_empty())

