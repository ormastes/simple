# Symbol Analysis
#
# Symbol dependency graph, reachability analysis, and dead symbol detection.
# Used by linker to eliminate unused code.
#
# Port of rust/compiler/src/linker/analysis/analyzer.rs

export SymbolVisibility, RefKind, AnalyzedSymbol
export SymbolGraph, SymbolAnalyzer, AnalysisStats

# ============================================================================
# Types
# ============================================================================

enum SymbolVisibility:
    Local
    Export
    Import


# ============================================================================
# SymbolVisibility Methods (was: impl SymbolVisibility:)
# ============================================================================

enum RefKind:
    Call
    Data
    Type

# ============================================================================
# Analyzed Symbol
# ============================================================================

struct AnalyzedSymbol:
    name: text
    visibility: SymbolVisibility
    size: i64
    section: text
    references: [text]          # Symbols this one references
    ref_kinds: {text: RefKind}
    is_reachable: bool


# ============================================================================
# AnalyzedSymbol Methods (was: impl AnalyzedSymbol:)
# ============================================================================

fn analyzedsymbol_create(name: text, visibility: SymbolVisibility) -> AnalyzedSymbol:
        AnalyzedSymbol(name: name, visibility: visibility, size: 0,
                       section: "", references: [], ref_kinds: {},
                       is_reachable: false)


# ============================================================================
# Symbol Graph
# ============================================================================

class SymbolGraph:
    """Dependency graph for symbols with reachability analysis."""
    symbols: {text: AnalyzedSymbol}
    reverse_refs: {text: [text]}    # symbol -> who references it
    entry_points: [text]


# ============================================================================
# SymbolGraph Methods (was: impl SymbolGraph:)
# ============================================================================

fn symbolgraph_empty() -> SymbolGraph:
        SymbolGraph(symbols: {}, reverse_refs: {}, entry_points: [])


# ============================================================================
# Analysis Stats
# ============================================================================

struct AnalysisStats:
    total_symbols: i64
    reachable_symbols: i64
    dead_symbols: i64
    dead_size: i64
    total_size: i64


# ============================================================================
# AnalysisStats Methods (was: impl AnalysisStats:)
# ============================================================================

# ============================================================================
# Symbol Analyzer (facade)
# ============================================================================

class SymbolAnalyzer:
    """High-level symbol analysis facade."""
    graph: SymbolGraph


# ============================================================================
# SymbolAnalyzer Methods (was: impl SymbolAnalyzer:)
# ============================================================================

fn symbolanalyzer_create() -> SymbolAnalyzer:
        SymbolAnalyzer(graph: symbolgraph_empty())


fn symbolanalyzer_analyze(self: SymbolAnalyzer) -> SymbolGraph:
        self.graph_analyze_reachability(graph)
        self.graph

