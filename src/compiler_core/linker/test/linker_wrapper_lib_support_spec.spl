# Linker Wrapper Library Support Test Specification

use std.sspec.*
use compiler.linker.linker_wrapper_lib_support.{extract_basename, scan_libraries, extract_undefined_symbols}

# ============================================================================
# Basename Extraction Tests
# ============================================================================

# describe: extract_basename
    fn test_extracts_filename_without_directory_1():
        val result = extract_basename("/usr/lib/simple/libstd.lsm")
        expect(result).to_equal("libstd")

    fn test_extracts_filename_with_no_directory_2():
        val result = extract_basename("libmath.lsm")
        expect(result).to_equal("libmath")

    fn test_handles_nested_directories_3():
        val result = extract_basename("/a/b/c/d/mylib.lsm")
        expect(result).to_equal("mylib")

    fn test_returns_empty_for_just_extension_4():
        val result = extract_basename(".lsm")
        expect(result).to_equal("")

# ============================================================================
# Library Scanning Tests
# ============================================================================

# describe: scan_libraries
    fn test_returns_empty_list_for_non_existent_paths_5():
        val paths = ["/nonexistent/path"]
        val result = scan_libraries(paths, false)

        expect(result_is_ok(result)).to_equal(true)
        val libraries = result_value
        expect(libraries_len(libraries)).to_equal(0)

    fn test_returns_empty_list_for_empty_paths_6():
        val paths: [text] = []
        val result = scan_libraries(paths, false)

        expect(result_is_ok(result)).to_equal(true)
        val libraries = result_value
        expect(libraries_len(libraries)).to_equal(0)

# ============================================================================
# Undefined Symbol Extraction Tests
# ============================================================================

# describe: extract_undefined_symbols
    fn test_returns_empty_list_for_empty_object_files_7():
        val obj_files: [text] = []
        val result = extract_undefined_symbols(obj_files, false)

        expect(result_is_ok(result)).to_equal(true)
        val symbols = result_value
        expect(symbols_len(symbols)).to_equal(0)

    fn test_returns_empty_list_for_non_existent_files_8():
        val obj_files = ["/nonexistent/file.o"]
        val result = extract_undefined_symbols(obj_files, false)

        expect(result_is_ok(result)).to_equal(true)
        val symbols = result_value
        expect(symbols_len(symbols)).to_equal(0)

# ============================================================================
# Integration Tests
# ============================================================================

# describe: Linker Library Support Integration
    fn test_can_extract_basename_from_multiple_paths_9():
        val paths = [
            "/usr/lib/libstd.lsm",
            "/opt/simple/libmath.lsm",
            "libtest.lsm"
        ]

        var count = 0
        for path in paths:
            val name = extract_basename(path)
            if name_len(name) > 0:
                count = count + 1

        expect(count).to_equal(3)

    fn test_handles_verbose_mode_without_errors_10():
        val paths = ["/nonexistent"]
        val result = scan_libraries(paths, true)

        expect(result_is_ok(result)).to_equal(true)
