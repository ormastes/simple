# Object File Resolver Test Specification

use std.sspec.*
use compiler.linker.object_resolver.{generate_object_candidates, default_object_search_paths}

# ============================================================================
# Object Candidate Generation Tests
# ============================================================================

# describe: generate_object_candidates
    fn test_generates_full_path_variant_1():
        val candidates = generate_object_candidates("std/io/mod")

        var has_full_path = false
        for c in candidates:
            if c == "std/io/mod.o":
                has_full_path = true
                break

        expect(has_full_path).to_equal(true)

    fn test_generates_underscore_variant_2():
        val candidates = generate_object_candidates("std/io/mod")

        var has_underscore = false
        for c in candidates:
            if c == "std_io_mod.o":
                has_underscore = true
                break

        expect(has_underscore).to_equal(true)

    fn test_generates_last_component_variant_3():
        val candidates = generate_object_candidates("std/io/mod")

        var has_last = false
        for c in candidates:
            if c == "mod.o":
                has_last = true
                break

        expect(has_last).to_equal(true)

    fn test_generates_src_prefix_variant_4():
        val candidates = generate_object_candidates("std/io/mod")

        var has_src = false
        for c in candidates:
            if c == "src/std/io/mod.o":
                has_src = true
                break

        expect(has_src).to_equal(true)

    fn test_generates_at_least_4_candidates_5():
        val candidates = generate_object_candidates("std/io/mod")
        expect(candidates_len(candidates) >= 4).to_equal(true)

# ============================================================================
# Default Search Paths Tests
# ============================================================================

# describe: default_object_search_paths
    fn test_returns_non_empty_list_6():
        val paths = default_object_search_paths()
        expect(paths_len(paths) > 0).to_equal(true)

    fn test_includes_build_obj_7():
        val paths = default_object_search_paths()

        var has_build_obj = false
        for p in paths:
            if p == "build/obj":
                has_build_obj = true
                break

        expect(has_build_obj).to_equal(true)

    fn test_includes_current_directory_8():
        val paths = default_object_search_paths()

        var has_dot = false
        for p in paths:
            if p == ".":
                has_dot = true
                break

        expect(has_dot).to_equal(true)

# ============================================================================
# Integration Tests
# ============================================================================

# describe: Object File Resolution
    fn test_generates_unique_candidates_9():
        val candidates1 = generate_object_candidates("std/io")
        val candidates2 = generate_object_candidates("std/collections")

        # First candidate should be different
        expect(candidates1[0] != candidates2[0]).to_equal(true)

    fn test_handles_single_component_names_10():
        val candidates = generate_object_candidates("math")
        expect(candidates_len(candidates) > 0).to_equal(true)

    fn test_handles_deep_paths_11():
        val candidates = generate_object_candidates("a/b/c/d/e")
        expect(candidates_len(candidates) >= 4).to_equal(true)
