# SMF Enums Specification
#
# Unit tests for SMF enum types:
# - Platform: OS/target platform identifiers
# - Arch: CPU architecture identifiers
# - CompressionType: Compression algorithm identifiers
# - SmfAppType: Application type hints

use ..smf_enums.*
use testing.{describe, it, expect}

describe "Platform enum":
    it "converts from u8 to Platform correctly":
        expect(platform_from_u8(0) == Platform.Any)
        expect(platform_from_u8(1) == Platform.Linux)
        expect(platform_from_u8(2) == Platform.Windows)
        expect(platform_from_u8(3) == Platform.MacOS)
        expect(platform_from_u8(4) == Platform.FreeBSD)
        expect(platform_from_u8(5) == Platform.None_)

    it "defaults to Any for unknown u8 values":
        expect(platform_from_u8(99) == Platform.Any)
        expect(platform_from_u8(255) == Platform.Any)

    it "converts Platform to u8 correctly":
        expect(Platform.any_to_u8() == 0)
        expect(Platform.linux_to_u8() == 1)
        expect(Platform.windows_to_u8() == 2)
        expect(Platform.macos_to_u8() == 3)
        expect(Platform.freebsd_to_u8() == 4)
        expect(Platform.none__to_u8() == 5)

    it "round-trips u8 conversion correctly":
        for i in 0..6:
            val platform = platform_from_u8(i)
            expect(platform_to_u8(platform) == i)

    it "returns correct platform names":
        expect(Platform.Any.name() == "any")
        expect(Platform.Linux.name() == "linux")
        expect(Platform.Windows.name() == "windows")
        expect(Platform.MacOS.name() == "macos")
        expect(Platform.FreeBSD.name() == "freebsd")
        expect(Platform.None_.name() == "none")

describe "Arch enum":
    it "converts from u8 to Arch correctly":
        expect(arch_from_u8(0) == Arch.X86_64)
        expect(arch_from_u8(1) == Arch.Aarch64)
        expect(arch_from_u8(2) == Arch.X86)
        expect(arch_from_u8(3) == Arch.Arm)
        expect(arch_from_u8(4) == Arch.Riscv64)
        expect(arch_from_u8(5) == Arch.Riscv32)
        expect(arch_from_u8(6) == Arch.Wasm32)
        expect(arch_from_u8(7) == Arch.Wasm64)

    it "defaults to X86_64 for unknown u8 values":
        expect(arch_from_u8(99) == Arch.X86_64)
        expect(arch_from_u8(255) == Arch.X86_64)

    it "converts Arch to u8 correctly":
        expect(Arch.x86_64_to_u8() == 0)
        expect(Arch.aarch64_to_u8() == 1)
        expect(Arch.x86_to_u8() == 2)
        expect(Arch.arm_to_u8() == 3)
        expect(Arch.riscv64_to_u8() == 4)
        expect(Arch.riscv32_to_u8() == 5)
        expect(Arch.wasm32_to_u8() == 6)
        expect(Arch.wasm64_to_u8() == 7)

    it "round-trips u8 conversion correctly":
        for i in 0..8:
            val arch = arch_from_u8(i)
            expect(arch_to_u8(arch) == i)

    it "returns correct architecture names":
        expect(Arch.X86_64.name() == "x86_64")
        expect(Arch.Aarch64.name() == "aarch64")
        expect(Arch.X86.name() == "x86")
        expect(Arch.Arm.name() == "arm")
        expect(Arch.Riscv64.name() == "riscv64")
        expect(Arch.Riscv32.name() == "riscv32")
        expect(Arch.Wasm32.name() == "wasm32")
        expect(Arch.Wasm64.name() == "wasm64")

    it "correctly identifies 32-bit architectures":
        expect(Arch.x86_is_32bit())
        expect(Arch.arm_is_32bit())
        expect(Arch.riscv32_is_32bit())
        expect(Arch.wasm32_is_32bit())

        expect(not Arch.x86_64_is_32bit())
        expect(not Arch.aarch64_is_32bit())
        expect(not Arch.riscv64_is_32bit())
        expect(not Arch.wasm64_is_32bit())

    it "correctly identifies 64-bit architectures":
        expect(Arch.x86_64_is_64bit())
        expect(Arch.aarch64_is_64bit())
        expect(Arch.riscv64_is_64bit())
        expect(Arch.wasm64_is_64bit())

        expect(not Arch.x86_is_64bit())
        expect(not Arch.arm_is_64bit())
        expect(not Arch.riscv32_is_64bit())
        expect(not Arch.wasm32_is_64bit())

describe "CompressionType enum":
    it "converts from u8 to CompressionType correctly":
        expect(compressiontype_from_u8(0) == CompressionType.None_)
        expect(compressiontype_from_u8(1) == CompressionType.Zstd)
        expect(compressiontype_from_u8(2) == CompressionType.Lz4)

    it "defaults to None_ for unknown u8 values":
        expect(compressiontype_from_u8(99) == CompressionType.None_)
        expect(compressiontype_from_u8(255) == CompressionType.None_)

    it "converts CompressionType to u8 correctly":
        expect(CompressionType.none__to_u8() == 0)
        expect(CompressionType.zstd_to_u8() == 1)
        expect(CompressionType.lz4_to_u8() == 2)

    it "round-trips u8 conversion correctly":
        for i in 0..3:
            val compression = compressiontype_from_u8(i)
            expect(compression_to_u8(compression) == i)

    it "returns correct compression names":
        expect(CompressionType.None_.name() == "none")
        expect(CompressionType.Zstd.name() == "zstd")
        expect(CompressionType.Lz4.name() == "lz4")

describe "SmfAppType enum":
    it "converts from u8 to SmfAppType correctly":
        expect(smfapptype_from_u8(0) == SmfAppType.Cli)
        expect(smfapptype_from_u8(1) == SmfAppType.Tui)
        expect(smfapptype_from_u8(2) == SmfAppType.Gui)
        expect(smfapptype_from_u8(3) == SmfAppType.Service)
        expect(smfapptype_from_u8(4) == SmfAppType.Repl)

    it "defaults to Cli for unknown u8 values":
        expect(smfapptype_from_u8(99) == SmfAppType.Cli)
        expect(smfapptype_from_u8(255) == SmfAppType.Cli)

    it "converts SmfAppType to u8 correctly":
        expect(SmfAppType.cli_to_u8() == 0)
        expect(SmfAppType.tui_to_u8() == 1)
        expect(SmfAppType.gui_to_u8() == 2)
        expect(SmfAppType.service_to_u8() == 3)
        expect(SmfAppType.repl_to_u8() == 4)

    it "round-trips u8 conversion correctly":
        for i in 0..5:
            val app_type = smfapptype_from_u8(i)
            expect(app_type_to_u8(app_type) == i)

    it "returns correct app type names":
        expect(SmfAppType.Cli.name() == "cli")
        expect(SmfAppType.Tui.name() == "tui")
        expect(SmfAppType.Gui.name() == "gui")
        expect(SmfAppType.Service.name() == "service")
        expect(SmfAppType.Repl.name() == "repl")
