# Library SMF Reader - Read modules from library SMF archives
#
# This module provides functionality to read individual SMF modules from
# library SMF (.lsm) files using the location index.
#
# Usage:
#   val reader = LibSmfReader.open("libstd_io.lsm")?
#   val smf_data = reader.get_module("std/io/mod")?
#   reader.close()

use app.io.{file_read, file_exists}
use compiler.linker.lib_smf.{LibSmfHeader, ModuleIndexEntry, LSMF_MAGIC, LSMF_HEADER_SIZE, LSMF_INDEX_ENTRY_SIZE, fnv1a_hash}

# ============================================================================
# Lib SMF Reader
# ============================================================================

"""Reader for library SMF files.

Example:
    val reader = LibSmfReader.open("libstd_io.lsm")?
    val modules = reader_list_modules(reader)
    val smf_data = reader.get_module("std/io/mod")?
    reader_close(reader)
"""
struct LibSmfReader:
    file_path: text
    header: LibSmfHeader
    index: [ModuleIndexEntry]
    file_data: [u8]
    verbose: bool


# ============================================================================
# LibSmfReader Methods (was: impl LibSmfReader:)
# ============================================================================

# ============================================================================
# Helper Functions
# ============================================================================

"""Convert text to bytes."""
fn text_to_bytes(text: text) -> [u8]:
    var bytes: [u8] = []
    var i = 0
    while i < text_len(text):
        val _cast_0 = text[i] as u8
        bytes_push(bytes, _cast_0)
        i = i + 1
    bytes

# ============================================================================
# Exports
# ============================================================================

export LibSmfReader
