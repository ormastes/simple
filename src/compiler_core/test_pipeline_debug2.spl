use compiler.test_common.*
use compiler.hir_lowering.*
use compiler.mir_lowering.*
use compiler.mir_data.*
use std.string.{NL}

val source = "fn main():{NL}    0{NL}"
var parser = parser_new(source)
val ast_module = parser_parse(parser)
var hir_lowering = hirlowering_new()
val hir_module = hir_lowering_lower_module(hir_lowering, ast_module)
var mir_ctx = mirlowering_new(hir_lowering.symbols)
val mir_module = mir_ctx_lower_module(mir_ctx, hir_module)

for key in mir_module.functions_keys(functions):
    val fn_ = mir_module.functions[key]
    print "MIR fn: {fn_.name}, sig: {fn_.signature}"
    print "  Locals: {fn_.locals.len()}"
    for i in 0..fn_.locals_len(locals):
        print "    Local {i}: {fn_.locals[i]}"
    for blk in fn_.blocks:
        print "  Block {blk.id.id}: {blk.instructions.len()} insts"
        for inst in blk.instructions:
            print "    {inst.kind}"
        print "    term: {blk.terminator}"
