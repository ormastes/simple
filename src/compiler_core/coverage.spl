# Coverage
#
# Coverage instrumentation for line, branch, and function tracking.
# Records which source lines and functions were executed during tests.
#
# Port of rust/compiler/src/coverage.rs (129 lines)

export SourceLoc, FunctionCoverage, ModuleCoverage, CoverageStats
export CoverageCollector, CoverageReport

# ============================================================================
# Types
# ============================================================================

struct SourceLoc:
    file: text
    line: i64
    column: i64

struct FunctionCoverage:
    name: text
    lines_hit: i64
    lines_total: i64
    branches_hit: i64
    branches_total: i64

struct ModuleCoverage:
    name: text
    functions: [FunctionCoverage]

struct CoverageStats:
    lines_hit: i64
    lines_total: i64
    branches_hit: i64
    branches_total: i64
    functions_hit: i64
    functions_total: i64


# ============================================================================
# CoverageStats Methods (was: impl CoverageStats:)
# ============================================================================

fn coveragestats_empty() -> CoverageStats:
        CoverageStats(lines_hit: 0, lines_total: 0,
                       branches_hit: 0, branches_total: 0,
                       functions_hit: 0, functions_total: 0)


struct CoverageReport:
    modules: [ModuleCoverage]
    stats: CoverageStats

# ============================================================================
# Coverage Collector
# ============================================================================

class CoverageCollector:
    """Records coverage data during execution."""
    line_hits: {text: [i64]}      # file -> hit line numbers
    function_calls: {text: i64}   # function_name -> call count


# ============================================================================
# CoverageCollector Methods (was: impl CoverageCollector:)
# ============================================================================

fn coveragecollector_create() -> CoverageCollector:
        CoverageCollector(line_hits: {}, function_calls: {})

