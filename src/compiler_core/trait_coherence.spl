# Trait Coherence Checking
#
# Verifies trait implementation coherence: orphan rules, overlapping impls,
# blanket impl conflicts, and associated type consistency.
#
# Port of rust/compiler/src/trait_coherence.rs (451 lines)

export CoherenceError, ImplInfo, CoherenceChecker

# ============================================================================
# Coherence Errors
# ============================================================================

enum CoherenceError:
    OrphanImpl(trait_name: text, target_type: text, suggestion: text?)
    OverlappingImpl(trait_name: text, type1: text, type2: text)
    ConflictingAssociatedType(trait_name: text, target_type: text, type_name: text)
    BlanketImplConflict(trait_name: text, general: text, specific: text)


# ============================================================================
# CoherenceError Methods (was: impl CoherenceError:)
# ============================================================================

# ============================================================================
# Impl Registry Entry
# ============================================================================

struct ImplInfo:
    target_type: text
    # # DESUGARED: trait_name: text
    has_trait_name: bool
    trait_name: text
    generic_params: [text]
    is_blanket: bool
    is_default: bool
    associated_types: {text: text}

# ============================================================================
# Coherence Checker
# ============================================================================

class CoherenceChecker:
    """Checks trait implementation coherence rules."""
    local_traits: [text]
    local_types: [text]
    impls: {text: [ImplInfo]}       # trait_name -> list of impls


# ============================================================================
# CoherenceChecker Methods (was: impl CoherenceChecker:)
# ============================================================================

fn coherencechecker_create() -> CoherenceChecker:
        CoherenceChecker(local_traits: [], local_types: [], impls: {})

