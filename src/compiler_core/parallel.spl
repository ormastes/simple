# Parallel Compilation
#
# Dependency-aware parallel build orchestration.
# Groups source files by dependency level and compiles each level
# in parallel using rayon FFI.
#
# Port of parallel compilation logic from driver

export ParallelConfig, CompileUnit, CompileResult, ParallelScheduler

# ============================================================================
# Types
# ============================================================================

struct ParallelConfig:
    max_threads: i64
    batch_size: i64


# ============================================================================
# ParallelConfig Methods (was: impl ParallelConfig:)
# ============================================================================

fn parallelconfig_default_config() -> ParallelConfig:
        extern fn rt_cpu_count() -> i64
        ParallelConfig(max_threads: rt_cpu_count(), batch_size: 16)


fn parallelconfig_single_threaded() -> ParallelConfig:
        ParallelConfig(max_threads: 1, batch_size: 1)


enum CompileResult:
    Success(text)        # path
    Failed(text, text)   # path, error

struct CompileUnit:
    path: text
    dependencies: [text]
    priority: i64         # Lower = compile first

# ============================================================================
# Parallel Scheduler
# ============================================================================

class ParallelScheduler:
    """Schedules compilation units respecting dependency order."""
    config: ParallelConfig
    units: [CompileUnit]
    completed: [text]
    failed: [text]


# ============================================================================
# ParallelScheduler Methods (was: impl ParallelScheduler:)
# ============================================================================

fn parallelscheduler_create(config: ParallelConfig) -> ParallelScheduler:
        ParallelScheduler(config: config, units: [], completed: [], failed: [])

