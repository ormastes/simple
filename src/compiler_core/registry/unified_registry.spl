# Unified Registry - Blocks and Literals
#
# Central registry for both block definitions and literal definitions.
# Ensures that each prefix can only be registered as either a block OR a literal.

use std.src.config.{LiteralDefinition, LiteralsConfig}
use compiler.blocks.definition.{BlockDefinition}
use compiler.blocks.registry.{BlockRegistry}

# ============================================================================
# Prefix Kind Enum
# ============================================================================

enum PrefixKind:
    """Type of prefix: block or literal."""
    Block(BlockDefinition)
    Literal(LiteralDefinition)

# ============================================================================
# Unified Registry
# ============================================================================

struct UnifiedRegistry:
    """Registry for both blocks and literals.

    Each prefix can only be registered as ONE thing (block OR literal).
    This prevents ambiguity when parsing prefix{...} syntax.

    Example:
    ```simple
    val registry = unifiedregistry_new()

    # Register set literal
    registry.register_literal("s", set_lit_def)

    # Check prefix type
    if registry.is_literal_prefix("s"):
        # Parse as set literal
    ```
    """
    prefixes: Dict<text, PrefixKind>  # prefix -> kind mapping


# ============================================================================
# UnifiedRegistry Methods (was: impl UnifiedRegistry:)
# ============================================================================

fn unifiedregistry_new() -> UnifiedRegistry:
        """Create an empty registry."""
        UnifiedRegistry(prefixes: {})


# ============================================================================
# Exports
# ============================================================================

export PrefixKind, UnifiedRegistry
