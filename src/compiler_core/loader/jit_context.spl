# JIT Compilation Context (FFI-based)
#
# Simplified JIT context that uses compiler FFI instead of deep integration.
# Templates come from SMF TemplateCode sections and are passed to compiler via FFI.

use .compiler_ffi.*

# ============================================================================
# JitCompilationContext
# ============================================================================

struct JitCompilationContext:
    """JIT context that holds templates and uses compiler FFI."""
    compiler_ctx: CompilerContext  # FFI handle
    smf_templates: Dict<text, TemplateBytes>  # Templates from SMF
    recorded: [InstantiationRecord]  # Recorded instantiations

struct InstantiationRecord:
    """Record of a JIT instantiation."""
    template_name: text
    type_args: [TypeInfo]
    mangled_name: text
    success: bool
    # # DESUGARED: error: text
    has_error: bool
    error: text


# ============================================================================
# JitCompilationContext Methods (was: impl JitCompilationContext:)
# ============================================================================

fn jitcompilationcontext_from_smf(tmpls: Dict<text, TemplateBytes>) -> JitCompilationContext:
        """Create JIT context from SMF templates.

        Args:
            tmpls: Map of template name to template bytes

        Returns:
            New JIT context with FFI compiler handle
        """
        JitCompilationContext(
            compiler_ctx: compilercontext_create(),
            smf_templates: tmpls,
            recorded: []
        )


# ============================================================================
# Exports
# ============================================================================

export JitCompilationContext
export InstantiationRecord
