# HIR Entity - CoreHirType and HIR_TYPE_* constants
#
# Extracted from src/core/hir_types.spl
# Seed-compatible HIR type definitions.

# ===== HIR Type Kind Tags =====

val HIR_TYPE_VOID = 0
val HIR_TYPE_BOOL = 1
val HIR_TYPE_I64 = 2
val HIR_TYPE_F64 = 3
val HIR_TYPE_TEXT = 4
val HIR_TYPE_ARRAY = 5
val HIR_TYPE_DICT = 6
val HIR_TYPE_STRUCT = 7
val HIR_TYPE_ENUM = 8
val HIR_TYPE_FN = 9
val HIR_TYPE_OPTION = 10
val HIR_TYPE_ANY = 11
val HIR_TYPE_NIL = 12
val HIR_TYPE_TUPLE = 13
val HIR_TYPE_RESULT = 14

# ===== CoreHirType â€” tagged struct for type representations =====
# Uses integer tag instead of enum payloads for seed compatibility.
# - tag: HIR_TYPE_* constant
# - name: type name (struct/enum name, or empty for primitives)
# - child: index into type pool for element type (-1 = none)
#          Used by: ARRAY (element type), OPTION (inner type), FN (return type)
# - params: parameter type indices
#           Used by: FN (param types), TUPLE (element types), DICT (key+value types)

struct CoreHirType:
    tag: i64
    name: text
    child: i64
    params: [i64]

fn make_core_hir_type(tag: i64) -> CoreHirType:
    CoreHirType(tag: tag, name: "", child: -1, params: [])

fn hir_type_void() -> CoreHirType:
    make_core_hir_type(HIR_TYPE_VOID)

fn hir_type_bool() -> CoreHirType:
    make_core_hir_type(HIR_TYPE_BOOL)

fn hir_type_i64() -> CoreHirType:
    make_core_hir_type(HIR_TYPE_I64)

fn hir_type_f64() -> CoreHirType:
    make_core_hir_type(HIR_TYPE_F64)

fn hir_type_text() -> CoreHirType:
    make_core_hir_type(HIR_TYPE_TEXT)

fn hir_type_array(elem_type_idx: i64) -> CoreHirType:
    var t = make_core_hir_type(HIR_TYPE_ARRAY)
    t.child = elem_type_idx
    t

fn hir_type_option(inner_type_idx: i64) -> CoreHirType:
    var t = make_core_hir_type(HIR_TYPE_OPTION)
    t.child = inner_type_idx
    t

fn hir_type_fn(param_type_indices: [i64], ret_type_idx: i64) -> CoreHirType:
    var t = make_core_hir_type(HIR_TYPE_FN)
    t.params = param_type_indices
    t.child = ret_type_idx
    t

fn hir_type_struct(name: text) -> CoreHirType:
    var t = make_core_hir_type(HIR_TYPE_STRUCT)
    t.name = name
    t

fn hir_type_enum(name: text) -> CoreHirType:
    var t = make_core_hir_type(HIR_TYPE_ENUM)
    t.name = name
    t

fn hir_type_kind_name(tag: i64) -> text:
    if tag == HIR_TYPE_VOID: return "void"
    if tag == HIR_TYPE_BOOL: return "bool"
    if tag == HIR_TYPE_I64: return "i64"
    if tag == HIR_TYPE_F64: return "f64"
    if tag == HIR_TYPE_TEXT: return "text"
    if tag == HIR_TYPE_ARRAY: return "array"
    if tag == HIR_TYPE_DICT: return "dict"
    if tag == HIR_TYPE_STRUCT: return "struct"
    if tag == HIR_TYPE_ENUM: return "enum"
    if tag == HIR_TYPE_FN: return "fn"
    if tag == HIR_TYPE_OPTION: return "option"
    if tag == HIR_TYPE_ANY: return "any"
    if tag == HIR_TYPE_NIL: return "nil"
    if tag == HIR_TYPE_TUPLE: return "tuple"
    if tag == HIR_TYPE_RESULT: return "result"
    "unknown"

export HIR_TYPE_VOID, HIR_TYPE_BOOL, HIR_TYPE_I64, HIR_TYPE_F64, HIR_TYPE_TEXT
export HIR_TYPE_ARRAY, HIR_TYPE_DICT, HIR_TYPE_STRUCT, HIR_TYPE_ENUM
export HIR_TYPE_FN, HIR_TYPE_OPTION, HIR_TYPE_ANY, HIR_TYPE_NIL
export HIR_TYPE_TUPLE, HIR_TYPE_RESULT
export CoreHirType, make_core_hir_type
export hir_type_void, hir_type_bool, hir_type_i64, hir_type_f64, hir_type_text
export hir_type_array, hir_type_option, hir_type_fn, hir_type_struct, hir_type_enum
export hir_type_kind_name
