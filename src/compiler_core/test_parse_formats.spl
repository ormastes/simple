use compiler.test_common.*
use std.text.{NL}

fn try_parse(label: text, src: text):
    print "--- {label} ---"
    var parser = parser_new(src)
    val ast = parser_parse(parser)
    if parser.errors_len(errors) > 0:
        print "  Errors: {parser.errors.len()}"
        for e in parser.errors:
            print "    {e}"
    for name in ast.functions_keys(functions):
        val fn_ = ast.functions[name]
        print "  fn {fn_.name}: body.stmts={fn_.body.stmts.len()}"
        for stmt in fn_.body.stmts:
            print "    stmt: {stmt.kind}"

try_parse("Simple", "fn main() -> i64:{NL}    0{NL}")
try_parse("No return type", "fn main():{NL}    0{NL}")
try_parse("Return stmt", "fn main() -> i64:{NL}    return 0{NL}")
try_parse("Pass only", "fn main():{NL}    pass{NL}")
