use compiler.parser.*
use compiler.parser_types.*
use compiler.lexer.*
use compiler.blocks.*
use compiler.treesitter.*

fn try_parse(label: text, src: text):
    print "--- {label} ---"
    var parser = parser_new(src)
    val ast = parser_parse(parser)
    if parser.errors_len(errors) > 0:
        print "  Errors: {parser.errors.len()}"
        for e in parser.errors:
            print "    {e}"
    for name in ast.functions_keys(functions):
        val fn_ = ast.functions[name]
        print "  fn {fn_.name}: body.stmts={fn_.body.stmts.len()}"
        for stmt in fn_.body.stmts:
            print "    stmt: {stmt.kind}"

try_parse("Simple", "fn main() -> i64:\n    0\n")
try_parse("No return type", "fn main():\n    0\n")
try_parse("Return stmt", "fn main() -> i64:\n    return 0\n")
try_parse("Pass only", "fn main():\n    pass\n")
