# Binding Specializer
#
# Interface binding specialization for static polymorphism.
# When `bind Logger = ConsoleLogger` is declared, trait method calls
# on Logger-typed values are rewritten to ConsoleLogger method calls.
#
# Port of rust/compiler/src/monomorphize/binding_specializer.rs (80+ lines)

export InterfaceBinding, BindingSpecializer

# ============================================================================
# Types
# ============================================================================

struct InterfaceBinding:
    interface_name: text
    impl_type_name: text

# ============================================================================
# Binding Specializer
# ============================================================================

class BindingSpecializer:
    """Rewrites method calls based on interface bindings for static dispatch."""
    bindings: {text: text}    # interface_name -> impl_type_name


# ============================================================================
# BindingSpecializer Methods (was: impl BindingSpecializer:)
# ============================================================================

fn bindingspecializer_create() -> BindingSpecializer:
        BindingSpecializer(bindings: {})


fn bindingspecializer_from_bindings(bindings: [InterfaceBinding]) -> BindingSpecializer:
        var map: {text: text} = {}
        for b in bindings:
            map[b.interface_name] = b.impl_type_name
        BindingSpecializer(bindings: map)

