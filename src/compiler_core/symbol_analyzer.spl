# Symbol Analyzer
#
# Analyzes symbol usage in AST for context pack generation and
# LLM-friendly IR export. Extracts used functions, types, and
# required imports with transitive dependency tracking.
#
# Port of rust/compiler/src/symbol_analyzer.rs (374 lines)

export SymbolUsageAnalyzer, SymbolUsageResult

# ============================================================================
# Types
# ============================================================================

struct SymbolUsageResult:
    """Tracks which symbols are used by a target."""
    used_functions: [text]
    used_types: [text]
    required_imports: [text]


# ============================================================================
# SymbolUsageResult Methods (was: impl SymbolUsageResult:)
# ============================================================================

fn symbolusageresult_empty() -> SymbolUsageResult:
        SymbolUsageResult(used_functions: [], used_types: [], required_imports: [])


# ============================================================================
# Node/Expression Representations (for analysis input)
# ============================================================================

enum NodeKind:
    Function
    Class
    Struct
    Enum
    Import
    Expression

struct AnalysisNode:
    kind: NodeKind
    name: text
    is_public: bool
    param_types: [text]
    # # DESUGARED: return_type: text
    has_return_type: bool
    return_type: text
    body_calls: [text]          # Function/constructor calls in body
    body_type_refs: [text]      # Type references in body
    field_types: [text]         # For struct/class: field type names
    method_names: [text]        # For class: method names
    # # DESUGARED: import_path: text
    has_import_path: bool
    import_path: text

# ============================================================================
# Symbol Usage Analyzer
# ============================================================================

class SymbolUsageAnalyzer:
    """Analyzes AST nodes to extract symbol dependencies."""
    minimal: bool       # Only direct references, no transitive deps


# ============================================================================
# SymbolUsageAnalyzer Methods (was: impl SymbolUsageAnalyzer:)
# ============================================================================

fn symbolusageanalyzer_create() -> SymbolUsageAnalyzer:
        SymbolUsageAnalyzer(minimal: false)


fn symbolusageanalyzer_minimal_mode() -> SymbolUsageAnalyzer:
        SymbolUsageAnalyzer(minimal: true)

