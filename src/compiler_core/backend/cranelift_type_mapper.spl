# Cranelift Type Mapper - Cranelift-Specific Type Mapping Implementation
#
# Maps MIR types to Cranelift IR type strings.
# Implements TypeMapper trait for Cranelift backend.

use compiler.mir_data.*
use compiler.backend.common.type_mapper.*

# ============================================================================
# Cranelift Type Mapper
# ============================================================================

class CraneliftTypeMapper:
    """
    Maps MIR types to Cranelift IR type representations.

    Cranelift uses value types:
    - Integers: I64, I32, I16, I8
    - Floats: F64, F32
    - References: R64 (64-bit reference)

    Note: Cranelift only supports 64-bit targets.
    For 32-bit, use LLVM backend instead.

    Example mappings:
        I64 → "I64"
        F64 → "F64"
        Ptr(_) → "R64"  (reference type)
        Bool → "I8"  (i8 with 0/1 values)
    """

    target_bits: i64  # 32 or 64 for pointer size (Cranelift supports 64-bit only)

    static fn create() -> CraneliftTypeMapper:
        """Create Cranelift type mapper (default 64-bit)."""
        CraneliftTypeMapper(target_bits: 64)

    static fn create_for_target(target: CodegenTarget) -> CraneliftTypeMapper:
        """
        Create mapper for specific target.
        Note: Cranelift only supports 64-bit targets. 32-bit will error.
        """
        if target_is_32bit(target):
            error("Cranelift does not support 32-bit targets. Use LLVM backend instead.")
        CraneliftTypeMapper(target_bits: 64)

# REMOVED: impl TypeMapper for CraneliftTypeMapper:
# (Trait implementations not supported in Core Simple)
    # fn map_primitive(ty: PrimitiveType) -> text:
        # """
        # Map primitive types to Cranelift IR types.

        # Cranelift primitives (uppercase):
        # - Integers: I64, I32, I16, I8
        # - Floats: F64, F32
        # - Boolean: I8 (represented as 0/1 in i8)
        # - Unit: (special handling, no direct type)
        # """
        # match ty:
            # case I64: "I64"
            # case I32: "I32"
            # case I16: "I16"
            # case I8: "I8"
            # case F64: "F64"
            # case F32: "F32"
            # case Bool: "I8"  # Boolean as i8 (0 or 1)
            # case Unit: "I64"  # Unit represented as dummy i64 (0)

    # fn map_pointer(pointee: text, mutability: Mutability) -> text:
        # """
        # Map pointer types to Cranelift IR.

        # Cranelift uses R64 (reference type) for all pointers.
        # This is always 64-bit since Cranelift only supports 64-bit targets.

        # Mutability is tracked at value level, not type level.
        # """
        # "R64"  # All pointers are R64 in Cranelift

    # fn backend_name() -> text:
        # "Cranelift"


# ============================================================================
# CraneliftTypeMapper Methods (was: impl CraneliftTypeMapper:)
# ============================================================================

# ============================================================================
# Export
# ============================================================================

# Export desugared static method names
fn CraneliftTypeMapper__create() -> CraneliftTypeMapper:
    cranelifttypemapper_create()

fn CraneliftTypeMapper__create_for_target(target: CodegenTarget) -> CraneliftTypeMapper:
    cranelifttypemapper_create_for_target(target)

export CraneliftTypeMapper
export CraneliftTypeMapper__create, CraneliftTypeMapper__create_for_target
