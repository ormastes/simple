# Builtin Type Registry
#
# FFI wrapper providing access to Rust's builtin type registry.
# The registry maps builtin function/type names to their type signatures.
# Heavy lifting stays in Rust; Simple calls through for lookups.
#
# Port of rust/type/src/checker_builtins.rs (registry portion)

from inference.types import {Type, TypeVarId}

# ============================================================================
# FFI (to Rust type registry when available)
# ============================================================================

extern fn rt_type_registry_lookup(name: text) -> text
extern fn rt_type_registry_has(name: text) -> bool

# Wrapper functions (two-tier pattern)
fn type_registry_lookup(name: text) -> text:
    rt_type_registry_lookup(name)

fn type_registry_has(name: text) -> bool:
    rt_type_registry_has(name)

# ============================================================================
# Builtin Category
# ============================================================================

enum BuiltinCategory:
    """Category of builtin function/type."""
    IO            # print, println, input, eprint, eprintln
    Math          # abs, sqrt, pow, min, max, sin, cos, etc.
    Collections   # len, range, collect, enumerate
    Concurrency   # spawn, send, recv, join, Channel, ThreadPool
    TypeConvert   # str, int, float, type
    Generator     # generator, next, yield
    Testing       # describe, context, it, test, expect
    Constructor   # Some, nil, Ok, Err

# ============================================================================
# Builtin Entry
# ============================================================================

struct BuiltinEntry:
    """A registered builtin with its category and type signature."""
    name: text
    category: BuiltinCategory
    param_count: i64
    description: text

# ============================================================================
# Builtin Registry
# ============================================================================

class BuiltinRegistry:
    """Registry of all builtin functions and types.

    This is the Simple-side registry. For complex type resolution,
    delegates to Rust via FFI.
    """
    entries: Dict<text, BuiltinEntry>


# ============================================================================
# BuiltinRegistry Methods (was: impl BuiltinRegistry:)
# ============================================================================

fn builtinregistry_default() -> BuiltinRegistry:
        var reg = BuiltinRegistry(entries: {})
        reg_register_defaults(reg)
        reg


export BuiltinCategory, BuiltinEntry, BuiltinRegistry
