# API Surface Analysis
#
# Generates a manifest of all public types, functions, and signatures.
# Prevents accidental API changes and makes diffs reviewable.
#
# Port of rust/compiler/src/api_surface.rs (481 lines)

export FunctionSignature, ParamSignature, FieldSignature
export StructSignature, ClassSignature, EnumSignature, TraitSignature
export ApiSurface

# ============================================================================
# Signature Types
# ============================================================================

struct ParamSignature:
    name: text
    # # DESUGARED: type_name: text
    has_type_name: bool
    type_name: text

struct FieldSignature:
    name: text
    # # DESUGARED: type_name: text
    has_type_name: bool
    type_name: text
    is_public: bool

struct FunctionSignature:
    name: text
    params: [ParamSignature]
    # # DESUGARED: return_type: text
    has_return_type: bool
    return_type: text
    is_async: bool
    is_generator: bool

struct StructSignature:
    name: text
    fields: [FieldSignature]

struct ClassSignature:
    name: text
    fields: [FieldSignature]
    methods: [text]

struct EnumSignature:
    name: text
    variants: [text]

struct TraitSignature:
    name: text
    methods: [text]

# ============================================================================
# API Surface
# ============================================================================

class ApiSurface:
    """Public API surface of a module."""
    module: text
    functions: {text: FunctionSignature}
    structs: {text: StructSignature}
    classes: {text: ClassSignature}
    enums: {text: EnumSignature}
    traits: {text: TraitSignature}


# ============================================================================
# ApiSurface Methods (was: impl ApiSurface:)
# ============================================================================

fn apisurface_create(module: text) -> ApiSurface:
        ApiSurface(module: module, functions: {}, structs: {},
                   classes: {}, enums: {}, traits: {})


# ============================================================================
# API Change
# ============================================================================

enum ApiChangeKind:
    Added
    Removed
    Modified

struct ApiChange:
    kind: ApiChangeKind
    symbol: text
    category: text      # "function", "struct", "class", "enum", "trait"
    # # DESUGARED: detail: text
    has_detail: bool
    detail: text


# ============================================================================
# ApiChange Methods (was: impl ApiChange:)
# ============================================================================
