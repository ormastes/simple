# Builtin Math Block Definitions
#
# Math-mode block types:
# - Math blocks (m{...}): Mathematical notation
# - Loss blocks (loss{...}): Automatic differentiation
# - Nograd blocks (nograd{...}): Gradient-free zones

use blocks.{BlockDefinition, BlockValue, BlockRegistry}
use blocks.modes.{PreLexInfo, BlockSkipPolicy, BlockOutlineInfo, BlockToken, BlockTokenKind, TextSpan}
use blocks.context.{BlockContext, BlockError}
use compiler.hir.HirType
use value.ConstValue

struct MathBlockDef(BlockDefinition):
    r"""Math block: enables math-like syntax.

    Features:
    - ^ as power operator (x^2)
    - ' as transpose operator (A')
    - Implicit multiplication (2x, (a)(b))
    - Broadcast operators (.+ .- .* ./ .^)
    - Matrix multiplication (@)

    Example:
        val result = m{ x^2 + 2*x*y + y^2 }
        val norm = m{ sqrt(x'x) }
    """


# ============================================================================
# MathBlockDef Methods (was: impl MathBlockDef:)
# ============================================================================

# ============================================================================
# Loss Block (loss{})
# ============================================================================

struct LossBlockDef(BlockDefinition):
    r"""Loss block: math mode with automatic backward pass.

    Inherits all math block features plus:
    - Automatic gradient tracking
    - Calls .backward() on the result

    Example:
        loss{
            pred = model(x)
            cross_entropy(pred, y)
        }
    """


# ============================================================================
# LossBlockDef Methods (was: impl LossBlockDef:)
# ============================================================================

# ============================================================================
# Nograd Block (nograd{})
# ============================================================================

struct NogradBlockDef(BlockDefinition):
    r"""Nograd block: math mode with gradient tracking disabled.

    Inherits all math block features plus:
    - Disables gradient tracking
    - Used for inference/evaluation

    Example:
        nograd{
            val pred = model(x)
            accuracy(pred, y)
        }
    """


# ============================================================================
# NogradBlockDef Methods (was: impl NogradBlockDef:)
# ============================================================================

export MathBlockDef, LossBlockDef, NogradBlockDef
