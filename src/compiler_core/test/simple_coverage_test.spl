# Simple Branch Coverage Tests
#
# Comprehensive tests to maximize branch coverage in the Simple interpreter
# and core language features.

use std.spec.*

# describe: Boolean operations
    fn test_tests_true_1():
        val x = true
        expect x == true

    fn test_tests_false_2():
        val x = false
        expect x == false

    fn test_tests_and_operator___both_true_3():
        expect (true and true) == true

    fn test_tests_and_operator___one_false_4():
        expect (true and false) == false

    fn test_tests_or_operator___one_true_5():
        expect (true or false) == true

    fn test_tests_or_operator___both_false_6():
        expect (false or false) == false

    fn test_tests_not_operator_7():
        expect not false == true
        expect not true == false

    fn test_tests_complex_boolean_expression_8():
        expect (true and (false or true)) == true
        expect ((true or false) and (true and true)) == true

# describe: Integer operations
    fn test_tests_addition_9():
        expect 1 + 2 == 3

    fn test_tests_subtraction_10():
        expect 5 - 3 == 2

    fn test_tests_multiplication_11():
        expect 4 * 3 == 12

    fn test_tests_division_12():
        expect 10 / 2 == 5

    fn test_tests_modulo_13():
        expect 10 % 3 == 1

    fn test_tests_negative_numbers_14():
        expect (-5 + 3) == -2

    fn test_tests_comparison___equal_15():
        expect 5 == 5

    fn test_tests_comparison___not_equal_16():
        expect 5 != 3

    fn test_tests_comparison___less_than_17():
        expect 3 < 5

    fn test_tests_comparison___greater_than_18():
        expect 5 > 3

    fn test_tests_comparison___less_than_or_equal_19():
        expect 5 <= 5
        expect 3 <= 5

    fn test_tests_comparison___greater_than_or_equal_20():
        expect 5 >= 5
        expect 5 >= 3

    fn test_tests_integer_overflow_handling_21():
        val big = 1000000
        expect big * 2 == 2000000

# describe: String operations
    fn test_tests_string_equality_22():
        expect "hello" == "hello"

    fn test_tests_string_inequality_23():
        expect "hello" != "world"

    fn test_tests_string_concatenation_24():
        val s = "hello" + " world"
        expect s == "hello world"

    fn test_tests_string_length_25():
        expect "hello".len() == 5

    fn test_tests_empty_string_26():
        val s = ""
        expect s_len(s) == 0
        expect s_is_empty(s) == true

    fn test_tests_string_interpolation_27():
        val name = "Alice"
        val greeting = "Hello, {name}!"
        expect greeting == "Hello, Alice!"

    fn test_tests_string_with_numbers_28():
        val num = 42
        val msg = "The answer is {num}"
        expect msg == "The answer is 42"

    fn test_tests_string_with_newline_escape_29():
        val text = "line1\nline2"
        expect text.contains("line1") == true
        expect text.contains("line2") == true

# describe: Option type operations
    fn test_tests_Some_construction_30():
        val opt = 42
        expect opt_is_some(opt) == true
        expect opt_is_none(opt) == false

    fn test_tests_None_construction_31():
        val opt: Option<i32> = nil
        expect opt_is_some(opt) == false
        expect opt_is_none(opt) == true

    fn test_tests_unwrap_on_Some_32():
        val opt = 42
        expect opt_value == 42

    fn test_tests_unwrap_or_on_Some_33():
        val opt = 42
        expect opt_unwrap_or(opt, 99) == 42

    fn test_tests_unwrap_or_on_None_34():
        val opt: Option<i32> = nil
        expect opt_unwrap_or(opt, 99) == 99

    fn test_tests_map_on_Some_35():
        val opt = 5
        val doubled = opt_map(opt, \x: x * 2)
        expect doubled_value == 10

    fn test_tests_map_on_None_36():
        val opt: Option<i32> = nil
        val doubled = opt_map(opt, \x: x * 2)
        expect doubled_is_none(doubled) == true

# describe: Result type operations
    fn test_tests_Ok_construction_37():
        val res: Result<i32, text> = Ok(42)
        expect res_is_ok(res) == true
        expect res_is_err(res) == false

    fn test_tests_Err_construction_38():
        val res: Result<i32, text> = Err("error")
        expect res_is_ok(res) == false
        expect res_is_err(res) == true

    fn test_tests_unwrap_or_on_Ok_39():
        val res: Result<i32, text> = Ok(42)
        expect res_unwrap_or(res, 99) == 42

    fn test_tests_unwrap_or_on_Err_40():
        val res: Result<i32, text> = Err("error")
        expect res_unwrap_or(res, 99) == 99

# describe: List operations
    fn test_tests_empty_list_literal_41():
        val lst: [i32] = []
        expect lst_len(lst) == 0
        expect lst_is_empty(lst) == true

    fn test_tests_list_literal_with_elements_42():
        val lst = [1, 2, 3]
        expect lst_len(lst) == 3
        expect lst_is_empty(lst) == false

    fn test_tests_list_indexing_43():
        val lst = [10, 20, 30]
        expect lst[0] == 10
        expect lst[1] == 20
        expect lst[2] == 30

    fn test_tests_list_contains_44():
        val lst = [10, 20]
        expect lst_contains(lst, bitwise_and_imm(10)) == true
        expect lst_contains(lst, bitwise_and_imm(99)) == false

    fn test_tests_list_map_45():
        val lst = [1, 2, 3]
        val doubled = lst_map(lst, \x: x * 2)
        expect doubled[0] == 2
        expect doubled[1] == 4
        expect doubled[2] == 6

    fn test_tests_list_filter_46():
        val lst = [1, 2, 3, 4]
        val evens = lst_filter(lst, \x: x % 2 == 0)
        expect evens_len(evens) == 2
        expect evens[0] == 2
        expect evens[1] == 4

# describe: Control flow
    fn test_tests_if_else_with_true_condition_47():
        val x = 5
        val result = if x > 0:
            "positive"
        else:
            "negative"
        expect result == "positive"

    fn test_tests_if_else_with_false_condition_48():
        val x = -5
        val result = if x > 0:
            "positive"
        else:
            "negative"
        expect result == "negative"

    fn test_tests_nested_if_else_49():
        val x = 5
        val result = if x > 10:
            "big"
        elif x > 0:
            "small"
        else:
            "negative"
        expect result == "small"

    fn test_tests_match_with_literal_50():
        val x = 2
        val result = match x:
            1 => "one"
            2 => "two"
            _ => "other"
        expect result == "two"

    fn test_tests_match_with_default_51():
        val x = 99
        val result = match x:
            1 => "one"
            2 => "two"
            _ => "other"
        expect result == "other"

# describe: Pattern matching
    fn test_tests_match_on_Option_Some_52():
        val opt = 42
        # val result = match # DESUGARED: opt: Some(x => x * 2)
            opt: x => x * 2
            nil => 0
        expect result == 84

    fn test_tests_match_on_Option_None_53():
        val opt: Option<i32> = nil
        # val result = match # DESUGARED: opt: Some(x => x * 2)
            opt: x => x * 2
            nil => 0
        expect result == 0

    fn test_tests_match_on_Result_Ok_54():
        val res: Result<i32, text> = Ok(42)
        val result = match res:
            Ok(x) => x
            Err(_) => 0
        expect result == 42

    fn test_tests_match_on_Result_Err_55():
        val res: Result<i32, text> = Err("error")
        val result = match res:
            Ok(x) => x
            Err(_) => 0
        expect result == 0

# describe: Loops
    fn test_tests_for_loop_over_range_56():
        var sum = 0
        for i in 0..5:
            sum = sum + i
        expect sum == 10  # 0+1+2+3+4

    fn test_tests_for_loop_over_list_57():
        val lst = [10, 20, 30]
        var sum = 0
        for x in lst:
            sum = sum + x
        expect sum == 60

    fn test_tests_while_loop_58():
        var count = 0
        var sum = 0
        while count < 5:
            sum = sum + count
            count = count + 1
        expect sum == 10

# describe: Functions and lambdas
    fn test_tests_simple_function_call_59():
        fn add(a: i32, b: i32) -> i32:
            a + b
        expect add(3, 4) == 7

    fn test_tests_lambda_expression_60():
        val double = \x: x * 2
        expect double(5) == 10

    fn test_tests_lambda_with_multiple_arguments_61():
        val add = \a, b: a + b
        expect add(3, 4) == 7

    fn test_tests_higher_order_function_62():
        fn apply(f: fn(i32) -> i32, x: i32) -> i32:
            f(x)
        val double = \x: x * 2
        expect apply(double, 5) == 10

# describe: Ranges
    fn test_tests_exclusive_range_63():
        val r = 0..5
        var count = 0
        for _unused in r:
            count = count + 1
        expect count == 5

    fn test_tests_inclusive_range_64():
        val r = 0..=5
        var count = 0
        for _unused in r:
            count = count + 1
        expect count == 6

# describe: Array literals
    fn test_tests_array_literal_creation_65():
        val arr = [1, 2, 3, 4, 5]
        expect arr_len(arr) == 5

    fn test_tests_array_indexing_66():
        val arr = [10, 20, 30]
        expect arr[0] == 10
        expect arr[1] == 20
        expect arr[2] == 30

    fn test_tests_array_negative_indexing_67():
        val arr = [10, 20, 30]
        expect arr[-1] == 30
        expect arr[-2] == 20

# describe: Type conversions
    fn test_tests_int_to_string_conversion_68():
        val num = 42
        val s = num_to_string(num)
        expect s == "42"

    fn test_tests_negative_int_to_string_69():
        val num = -42
        val s = num_to_string(num)
        expect s == "-42"

# describe: Edge cases
    fn test_tests_empty_string_operations_70():
        val s = ""
        expect s_len(s) == 0
        expect s + "hello" == "hello"

    fn test_tests_zero_in_arithmetic_71():
        expect 0 + 5 == 5
        expect 5 * 0 == 0

    fn test_tests_empty_list_operations_72():
        val lst: [i32] = []
        expect lst_len(lst) == 0
        expect lst_is_empty(lst) == true

    fn test_tests_boolean_short_circuit_evaluation___and_73():
        var called = false
        fn side_effect() -> bool:
            called = true
            true
        val result = false and side_effect()
        expect result == false
        # Note: can't easily test if side_effect was called due to short-circuit

    fn test_tests_boolean_short_circuit_evaluation___or_74():
        var called = false
        fn side_effect() -> bool:
            called = true
            false
        val result = true or side_effect()
        expect result == true
