"""
# CompilerCore - Production Self-Hosting Compiler

**Category:** compiler
**Status:** Production Ready
**Tag:** @tag:compiler @tag:internal

## Purpose

Production-grade self-hosting compiler infrastructure for the Simple language.
Provides complete compilation pipeline from source code to native executables,
including lexing, parsing, type inference, optimization, and code generation
for multiple backends (interpreter, C, LLVM, native x86_64/ARM).

This is the full-featured compiler used by the `simple` CLI, supporting all
language features including generics, async/await, trait system, visibility
checking, dimension constraints, and FFI integration.

## Quick Start

```simple
# Example 1: Compile Simple source to executable
use compiler.driver.{CompilerDriver, CompileMode, CompileOptions}

val driver = CompilerDriver()
val opts = CompileOptions(
    mode: CompileMode.Native,
    output_path: "output.exe",
    optimize: true
)
val result = driver.compile_file("main.spl", opts)
if result.success:
    print "Compilation successful"
```

```simple
# Example 2: Type-check only (no code generation)
use compiler.driver.{CompilerDriver, CompileMode}

val driver = CompilerDriver()
val opts = CompileOptions(mode: CompileMode.Check)
val result = driver.compile_file("source.spl", opts)
if result.errors.len() > 0:
    print "Type errors found"
```

```simple
# Example 3: Parse and analyze AST
use compiler.lexer.{lex}
use compiler.parser.{parse}
use compiler.hir.{lower_to_hir}

val source = "fn add(x: i64, y: i64) -> i64: x + y"
val tokens = lex(source)
val ast = parse(tokens)
val hir = lower_to_hir(ast)
print "HIR generated: {hir.functions.len()} functions"
```

## Available Components

### Core Pipeline Modules
- **lexer** - Tokenization and lexical analysis
- **treesitter** - Tree-sitter based parsing fallback
- **parser** - Recursive descent parser (AST generation)
- **hir** - High-level intermediate representation
- **mir** - Mid-level intermediate representation
- **codegen** - Code generation orchestration

### Compilation Infrastructure
- **driver** - Main compiler driver (CompilerDriver, CompileResult)
- **backend** - Backend abstraction (interpreter, C, LLVM, native)
- **compilation_context** - Shared compilation state
- **pipeline_fn** - Functional pipeline composition

### Type System & Analysis
- **type_infer** - Hindley-Milner type inference engine
- **resolve** - Name resolution and scope analysis
- **dim_constraints** - Dimension constraint checking (tensor/array shapes)
- **inference** - Shared inference utilities

### Advanced Features
- **blocks** - Block expression handling
- **init** - Compiler initialization (CompilerContext, init_compiler)
- **mod** - Module system support
- **config** - Compiler configuration
- **di** - Dependency injection framework
- **aop** - Aspect-oriented programming support

## Usage Notes

- **High-level API:** Use `compiler.driver` for standard compilation workflows
- **Direct pipeline access:** Import lexer/parser/hir/mir for custom tooling
- **Type checking only:** Set `CompileMode.Check` to skip code generation
- **Runtime compatibility:** For runtime-safe versions, use `src/core/` modules
- **Backend selection:** Supports interpreter, C codegen, LLVM, native x86_64/ARM
- **Full language support:** Generics, traits, async/await, visibility, FFI

## Module Organization

### Public API (exported via driver/init)
- `CompileResult` - Compilation result with errors/warnings
- `CompilerDriver` - Main compiler orchestration class
- `CompileMode` - Compilation mode enum (Check, Interpret, Native, etc.)
- `CompileOptions` - Compilation options struct
- `CompilerContext` - Global compiler context
- `init_compiler()` - Initialize compiler system
- `get_context()` - Get current compiler context

### Internal Implementation
All other modules are internal implementation details. Direct use is discouraged
except for compiler development, custom tooling, or advanced language tooling.

## See Also

- **Runtime-compatible core:** `src/core/` - Minimal core for runtime use
- **CLI integration:** `src/app/cli/` - Command-line interface
- **Test suite:** `test/system/compiler/` - Comprehensive compiler tests

@tag:compiler
@tag:internal
"""

arch {
    tier = "seed"
}

# Simple Self-Hosting Compiler Module
#
# This file declares the `compiler` module namespace.
# All files in this directory can be imported as `compiler.module_name`.

mod compiler

# ============================================================================
# Core Pipeline Modules
# ============================================================================
# These modules form the main compilation pipeline from source to executable.
# Order: lexer → parser → HIR → MIR → codegen → backend

mod lexer           # @tag:compiler - Tokenization and lexical analysis
mod treesitter      # @tag:compiler - Tree-sitter based parsing (fallback/tooling)
mod parser          # @tag:compiler - Recursive descent parser (AST generation)
mod hir             # @tag:compiler - High-level intermediate representation
mod mir             # @tag:compiler - Mid-level intermediate representation
mod codegen         # @tag:compiler - Code generation orchestration
mod driver          # @tag:compiler - Main compiler driver and public API
mod backend         # @tag:compiler - Backend abstraction (interpreter/C/LLVM/native)

# ============================================================================
# Type System & Analysis Modules
# ============================================================================
# Name resolution, type inference, and semantic analysis

mod resolve         # @tag:compiler - Name resolution and scope analysis
mod type_infer      # @tag:compiler - Hindley-Milner type inference engine
mod dim_constraints # @tag:compiler - Dimension constraint checking (tensors/arrays)
mod inference       # @tag:compiler - Shared inference utilities (used by loader/linker)

# ============================================================================
# Language Feature Modules
# ============================================================================
# Advanced language features and special syntax

mod blocks          # @tag:compiler - Block expression handling
mod init            # @tag:compiler - Compiler initialization and context setup
mod mod             # @tag:compiler - Module system support and imports

# ============================================================================
# Compilation Infrastructure
# ============================================================================
# Shared compilation state, dependency injection, and pipeline composition

mod compilation_context  # @tag:internal - Shared compilation state and caching
mod instantiation        # @tag:internal - Generic instantiation tracking
mod pipeline_fn          # @tag:internal - Functional pipeline composition

# ============================================================================
# Internal Support Modules
# ============================================================================
# Configuration, dependency injection, and aspect-oriented programming

mod config          # @tag:internal - Compiler configuration and settings
mod di              # @tag:internal - Dependency injection framework
mod aop             # @tag:internal - Aspect-oriented programming support

# ============================================================================
# Common Module Imports
# ============================================================================
# All compiler modules automatically import the standard library

common use crate.std.*

# ============================================================================
# Public API Exports
# ============================================================================
# Main entry points for using the compiler from external code.
# Most users should only import these high-level types and functions.
# For low-level compiler development, import specific modules directly.
#
# @tag:compiler - Public API for compilation workflows

use driver.{CompileResult, CompilerDriver, CompileMode, CompileOptions}
use init.{CompilerContext, init_compiler, get_context}
