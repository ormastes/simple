# Type Coercion
#
# Unified type coercion rules for Simple language.
# These rules define how values are converted between types.
# Both interpreter evaluation and codegen must follow these rules.
#
# Port of rust/compiler/src/semantics/type_coercion.rs (209 lines)

export CoercionResult, TypeCoercion

use semantics.truthiness (TruthinessRules)

# ============================================================================
# Result Type
# ============================================================================

enum CoercionResult<T>:
    Ok(T)                                        # Coercion succeeded
    Incompatible(from: text, to: text)          # Coercion not possible
    PrecisionLoss(from: text, to: text)         # Coercion would lose precision

impl CoercionResult<T>:
    static fn ok(value: T) -> CoercionResult<T>:
        coercionresult_Ok(value)

    static fn incompatible(from: text, to: text) -> CoercionResult<T>:
        coercionresult_Incompatible(from: from, to: to)

    fn is_ok() -> bool:
        match self:
            case Ok(_): true
            case _: false

    fn unwrap() -> T:
        match self:
            case Ok(v): v
            case _: panic("called unwrap on non-Ok CoercionResult")

# ============================================================================
# Type Coercion Rules
# ============================================================================

struct TypeCoercion


# ============================================================================
# TypeCoercion Methods (was: impl TypeCoercion:)
# ============================================================================
