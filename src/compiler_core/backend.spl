# Backend - Compiler Backend Implementations (FACADE)
#
# COMPILED-ONLY: This module and its sub-modules use generics, traits,
# and Result<> types. They require the compiled pipeline to load.
# For runtime (interpreter mode), use core.interpreter instead.
#
# This is a facade module that re-exports all backend implementations.
# The actual implementation is split into focused modules:
#
# - backend/env.spl: Environment and scoping utilities (shared)
# - backend/interpreter.spl: Tree-walking interpreter backend (LEGACY)
# - backend/jit_interpreter.spl: JIT hybrid interpreter (DEFAULT)
# - backend/compiler.spl: Native code generation (Cranelift JIT/AOT)
# - backend/sdn.spl: SDN export backend (data-only, blocks execution)

use compiler.hir.*
use compiler.mir.*
use compiler.lexer.Span
use backend_types.*

# Stub implementations (actual backends defined in backend/jit_interpreter.spl and backend/interpreter.spl)
fn jitinterpreterconfig_always_jit() -> i64:
    # Stub: Struct return not fully supported in seed_cpp
    0

fn jitinterpreterbackend_default() -> JitInterpreterBackend:
    # Stub: Return dummy JIT interpreter backend
    JitInterpreterBackend(
        config: JitInterpreterConfig(mode: JitMode.HybridJit, backend: "auto", jit_threshold: 10, verbose: false),
        call_counts: {},
        jit_compiled: {}
    )

fn jitinterpreterbackend_new(config: JitInterpreterConfig) -> JitInterpreterBackend:
    # Stub: Return JIT interpreter with given config
    JitInterpreterBackend(
        config: config,
        call_counts: {},
        jit_compiled: {}
    )

fn interpreterbackendimpl_new() -> InterpreterBackendImpl:
    # Stub: Return tree-walk interpreter
    InterpreterBackendImpl(
        config: InterpreterConfig(mode: InterpreterMode.Classic, enable_debug_hooks: true, enable_gc: true, use_ffi_arithmetic: true)
    )

# Re-export environment types and utilities
use backend.env.{EvalContext, Environment, empty_env_scope, HirVisitor}

# Re-export backend implementations (compiled-only â€” generics required)
use backend.interpreter.InterpreterBackendImpl
use backend.jit_interpreter.{JitInterpreterBackend, JitInterpreterConfig, JitMode}
# use backend.compiler.CompilerBackendImpl     # Native compilation backend
# use backend.sdn.SdnBackendImpl               # SDN export backend

# ============================================================================
# Backend Factory
# ============================================================================

fn create_backend(kind: BackendKind) -> i64:
    # Stub: Backend type and struct return not fully supported in seed_cpp
    0

fn create_interpreter_backend() -> i64:
    # Stub: Backend struct return not supported in seed_cpp
    0

fn create_jit_backend(config: JitInterpreterConfig) -> i64:
    # Stub: Backend struct return not supported in seed_cpp
    0

fn get_backend() -> Backend:
    # Default: JIT interpreter
    create_backend(BackendKind.Interpreter)

# ============================================================================
# Exports
# ============================================================================

export Backend, BackendKind, BackendResult, BackendError, BackendErrorKind
export CompiledUnit, CompiledSymbol, CompiledSymbolKind, Relocation, RelocKind
export SdnValue, SdnValueKind
export Value, EnumPayloadValue, FunctionValue, ClosureValue, ObjectValue
export EvalContext, Environment
export HirVisitor
export create_backend, create_interpreter_backend, create_jit_backend, get_backend
export InterpreterBackendImpl, JitInterpreterBackend, JitInterpreterConfig, JitMode
