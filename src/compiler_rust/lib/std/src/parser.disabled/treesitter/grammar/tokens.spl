# Token Kinds and Grammar Helper Functions
#
# Token types and helper functions for grammar construction.

use simple_grammar.{GrammarRule as Rule}

export TokenKind
export token, ref, seq, choice, optional, repeat, repeat1, field, prec_left, prec_right

# ============================================================================
# Helper Functions for Grammar Construction
# ============================================================================

fn token(kind: TokenKind) -> Rule:
    Rule.Token(kind)

fn ref(name: text) -> Rule:
    Rule.Ref(name)

fn seq(rules: List<Rule>) -> Rule:
    Rule.Seq(rules)

fn choice(rules: List<Rule>) -> Rule:
    Rule.Choice(rules)

fn optional(rule: Rule) -> Rule:
    Rule.Optional(rule)

fn repeat(rule: Rule) -> Rule:
    Rule.Repeat(rule)

fn repeat1(rule: Rule) -> Rule:
    Rule.Repeat1(rule)

fn field(name: text, rule: Rule) -> Rule:
    Rule.Field(name, rule)

fn prec_left(precedence: i32, rule: Rule) -> Rule:
    Rule.PrecLeft(precedence, rule)

fn prec_right(precedence: i32, rule: Rule) -> Rule:
    Rule.PrecRight(precedence, rule)

# ============================================================================
# Token Kinds
# ============================================================================

enum TokenKind:
    # Keywords - Core
    Fn, Me,
    Let, Mut,  # Legacy: use Val/Var instead
    Val, Var,  # Scala-style variables
    Return, If, Elif, Else, Match, Case,
    For, In, While, Loop, Break, Continue,
    Class, Struct, Enum, Trait, Impl,
    Import, As, From,
    True, False, Nil,
    And, Or, Not,
    Then,  # For if-expressions

    # Keywords - Module System
    Mod, Use, Export, Common, Auto, Crate,

    # Keywords - Memory & Type System
    Union, Mixin, Extends,
    Move, Const, Static, Type, Unit, Extern,
    Iso, Ref, Dyn, Repr,
    Self_, Super, New,
    Pub, Priv,
    Context, With, Ghost,

    # Keywords - Concurrency
    Actor, Spawn, Go, Yield, Async, Await, Sync,

    # Keywords - Suspension (async-by-default)
    IfSuspend, WhileSuspend, ForSuspend,
    AndSuspend, OrSuspend,

    # Keywords - GPU/SIMD
    Macro, Bang, Vec, Shared, Gpu, Bounds,

    # Keywords - AOP & Unified Predicates
    On, Bind, Forbid, Allow, Mock,

    # Keywords - Contracts & Verification
    Out, OutErr, Where,
    Requires, Ensures, Invariant, Old, Result, Decreases,
    Forall, Exists,
    Assert, Assume, Admit, Calc,

    # Keywords - BDD/Testing (Gherkin DSL)
    Feature, Scenario, Outline, Examples,
    Given, When, AndThen,
    To, NotTo,  # Infix assertions

    # Keywords - Special
    HandlePool, Grid, Tensor, Slice, Flat, Default,

    # Operators - Arithmetic
    Plus, Minus, Star, Slash, Percent, DoubleStar, DoubleSlash,

    # Operators - Comparison
    Eq, DoubleEq, NotEq,
    Lt, Gt, LtEq, GtEq,

    # Operators - Assignment
    Assign,
    PlusAssign, MinusAssign, StarAssign, SlashAssign,
    TildeAssign, TildePlusAssign, TildeMinusAssign, TildeStarAssign, TildeSlashAssign,

    # Operators - Bitwise
    Pipe, Ampersand, Caret, Tilde,
    LtLt, GtGt,  # ShiftLeft, ShiftRight
    DoublePipe, DoubleAmp,

    # Operators - Special
    Dot, Comma, Colon, DoubleColon, Semicolon,
    Arrow, FatArrow, ChannelArrow,
    DoubleDot, DoubleDotEq, Ellipsis,
    Question, Exclamation,
    At, Hash, Dollar, Backslash,
    Underscore,

    # Delimiters
    LParen, RParen,
    LBracket, RBracket,
    LBrace, RBrace,
    Newline, Indent, Dedent,

    # Literals
    Integer,
    Float,
    TypedInteger,  # 42i32, 100u64
    TypedFloat,  # 3.14f64
    text,
    RawString,  # 'raw string'
    Symbol,  # :symbol
    TypedString,  # "text"_suffix
    TypedRawString,  # 'text'_suffix
    FStringStart, FStringText, FStringEnd, FStringFormatSpec,

    # Identifiers
    Identifier, TypeIdentifier,

    # Special Tokens
    CustomBlock,  # m{...}, sh{...}, sql{...}, etc.
    Pointcut,  # pc{...}
    DocComment,  # /** ... */ or ##
    Error,
    Eof
