# Core Matchers - eq, be, be_nil
# Basic equality and identity matchers

use matchers.{Matcher, MatchResult}

# Equality matcher: expect x to eq 5
class EqMatcher<T>:
    expected: T

impl EqMatcher:
    fn new(expected: T) -> EqMatcher<T>:
        return EqMatcher { expected: expected }

impl Matcher for EqMatcher<T>:
    fn matches(actual: T) -> MatchResult:
        if actual == self.expected:
            return MatchResult.success()
        else:
            return MatchResult.failure(
                "Expected {actual} to equal {self.expected}"
            )

fn eq<T>(expected: T) -> EqMatcher<T>:
    return EqMatcher.new(expected)

# Identity matcher: expect x to be y (same object)
class BeMatcher<T>:
    expected: T

impl BeMatcher:
    fn new(expected: T) -> BeMatcher<T>:
        return BeMatcher { expected: expected }

impl Matcher for BeMatcher<T>:
    fn matches(actual: T) -> MatchResult:
        if actual is self.expected:
            return MatchResult.success()
        else:
            return MatchResult.failure(
                "Expected {actual} to be {self.expected}"
            )

fn be<T>(expected: T) -> BeMatcher<T>:
    return BeMatcher.new(expected)

# Nil matcher: expect x to be_nil
class BeNilMatcher:
    _dummy: bool

impl BeNilMatcher:
    fn new() -> BeNilMatcher:
        return BeNilMatcher { _dummy: false }

impl Matcher for BeNilMatcher:
    fn matches(actual: Option<Any>) -> MatchResult:
        match actual:
            case nil:
                return MatchResult.success()
            case Some(v):
                return MatchResult.failure(
                    "Expected nil but got Some({v})"
                )

fn be_nil() -> BeNilMatcher:
    return BeNilMatcher.new()
