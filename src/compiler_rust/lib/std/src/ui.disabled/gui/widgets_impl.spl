# GUI Widgets - Tooltip and Divider Components
#
# Tooltip and Divider widget implementations.
# Part of the GUI widgets module - see widgets.spl for Card, Chip, Avatar, Badge.

use core.*
use ui.element.*
use ui.attrs.*
use ui.gui.theme.*

# Tooltip component - hover information
pub struct Tooltip:
    id: NodeId
    content: text
    position: TooltipPosition

pub enum TooltipPosition:
    Top
    Bottom
    Left
    Right

impl TooltipPosition:
    pub fn to_string(self) -> text:
        """Convert tooltip position to string.

        Returns:
            Position name
        """
        match self:
            case TooltipPosition.Top: "top"
            case TooltipPosition.Bottom: "bottom"
            case TooltipPosition.Left: "left"
            case TooltipPosition.Right: "right"

    pub fn description(self) -> text:
        """Get position description.

        Returns:
            Human-readable description
        """
        match self:
            case TooltipPosition.Top: "Display above element"
            case TooltipPosition.Bottom: "Display below element"
            case TooltipPosition.Left: "Display to left of element"
            case TooltipPosition.Right: "Display to right of element"

    pub fn is_vertical(self) -> bool:
        """Check if vertical position.

        Returns:
            True for Top or Bottom
        """
        match self:
            case TooltipPosition.Top: true
            case TooltipPosition.Bottom: true
            case _: false

    pub fn is_horizontal(self) -> bool:
        """Check if horizontal position.

        Returns:
            True for Left or Right
        """
        match self:
            case TooltipPosition.Left: true
            case TooltipPosition.Right: true
            case _: false

    pub fn is_top(self) -> bool:
        """Check if top position."""
        match self:
            case TooltipPosition.Top: true
            case _: false

    pub fn is_bottom(self) -> bool:
        """Check if bottom position."""
        match self:
            case TooltipPosition.Bottom: true
            case _: false

    pub fn summary(self) -> text:
        """Get summary of tooltip position.

        Returns:
            Human-readable summary

        Example:
            TooltipPosition.Top.summary()
            # → "TooltipPosition: top (Display above element, vertical)"
        """
        val name = self.to_string()
        val desc = self.description()
        val orientation = if self.is_vertical(): "vertical" else: "horizontal"
        return "TooltipPosition: {name} ({desc}, {orientation})"

impl Tooltip:
    pub fn new(id: NodeId, content: &str) -> Tooltip:
        return Tooltip {
            id: id,
            content: content.to_string(),
            position: TooltipPosition.Top
        }

    pub fn bottom(self) -> Tooltip:
        self.position = TooltipPosition.Bottom
        return self

    pub fn left(self) -> Tooltip:
        self.position = TooltipPosition.Left
        return self

    pub fn right(self) -> Tooltip:
        self.position = TooltipPosition.Right
        return self

    pub fn to_element(self, alloc: fn() -> NodeId, theme: &Theme) -> Element:
        return Element.new(self.id, ElementKind.Span)
            .with_class("tooltip")
            .with_attr("data-tooltip", &self.content)
            .with_attr("data-position", &self.position_str())
            .with_style("position", "relative")

    fn position_str() -> &str:
        match self.position:
            case TooltipPosition.Top: return "top"
            case TooltipPosition.Bottom: return "bottom"
            case TooltipPosition.Left: return "left"
            case TooltipPosition.Right: return "right"

# Divider component - visual separator
pub struct Divider:
    id: NodeId
    orientation: DividerOrientation
    variant: DividerVariant

pub enum DividerOrientation:
    Horizontal
    Vertical

impl DividerOrientation:
    pub fn to_string(self) -> text:
        """Convert divider orientation to string.

        Returns:
            Orientation name
        """
        match self:
            case DividerOrientation.Horizontal: "horizontal"
            case DividerOrientation.Vertical: "vertical"

    pub fn description(self) -> text:
        """Get orientation description.

        Returns:
            Human-readable description
        """
        match self:
            case DividerOrientation.Horizontal:
                "Horizontal divider (full width)"
            case DividerOrientation.Vertical:
                "Vertical divider (full height)"

    pub fn is_horizontal(self) -> bool:
        """Check if horizontal orientation."""
        match self:
            case DividerOrientation.Horizontal: true
            case _: false

    pub fn is_vertical(self) -> bool:
        """Check if vertical orientation."""
        match self:
            case DividerOrientation.Vertical: true
            case _: false

    pub fn summary(self) -> text:
        """Get summary of divider orientation.

        Returns:
            Human-readable summary

        Example:
            DividerOrientation.Horizontal.summary()
            # → "DividerOrientation: horizontal (Horizontal divider (full width))"
        """
        val name = self.to_string()
        val desc = self.description()
        return "DividerOrientation: {name} ({desc})"

pub enum DividerVariant:
    Full
    Inset
    Middle

impl DividerVariant:
    pub fn to_string(self) -> text:
        """Convert divider variant to string.

        Returns:
            Variant name
        """
        match self:
            case DividerVariant.Full: "full"
            case DividerVariant.Inset: "inset"
            case DividerVariant.Middle: "middle"

    pub fn description(self) -> text:
        """Get variant description.

        Returns:
            Human-readable description
        """
        match self:
            case DividerVariant.Full:
                "Full width/height divider"
            case DividerVariant.Inset:
                "Inset divider with left margin"
            case DividerVariant.Middle:
                "Middle divider with both margins"

    pub fn has_margins(self) -> bool:
        """Check if variant has margins.

        Returns:
            True for Inset or Middle
        """
        match self:
            case DividerVariant.Full: false
            case _: true

    pub fn is_full(self) -> bool:
        """Check if full variant."""
        match self:
            case DividerVariant.Full: true
            case _: false

    pub fn is_inset(self) -> bool:
        """Check if inset variant."""
        match self:
            case DividerVariant.Inset: true
            case _: false

    pub fn is_middle(self) -> bool:
        """Check if middle variant."""
        match self:
            case DividerVariant.Middle: true
            case _: false

    pub fn summary(self) -> text:
        """Get summary of divider variant.

        Returns:
            Human-readable summary

        Example:
            DividerVariant.Inset.summary()
            # → "DividerVariant: inset (Inset divider with left margin, has margins)"
        """
        val name = self.to_string()
        val desc = self.description()
        val margins = if self.has_margins(): "has margins" else: "no margins"
        return "DividerVariant: {name} ({desc}, {margins})"

impl Divider:
    pub fn horizontal(id: NodeId) -> Divider:
        return Divider {
            id: id,
            orientation: DividerOrientation.Horizontal,
            variant: DividerVariant.Full
        }

    pub fn vertical(id: NodeId) -> Divider:
        return Divider {
            id: id,
            orientation: DividerOrientation.Vertical,
            variant: DividerVariant.Full
        }

    pub fn inset(self) -> Divider:
        self.variant = DividerVariant.Inset
        return self

    pub fn middle(self) -> Divider:
        self.variant = DividerVariant.Middle
        return self

    pub fn to_element(self, theme: &Theme) -> Element:
        var divider = Element.new(self.id, ElementKind.Div)
            .with_class("divider")
            .with_style("background-color", &color_to_style(&theme.palette.border))

        match self.orientation:
            case DividerOrientation.Horizontal:
                divider = divider
                    .with_style("height", "1px")
                    .with_style("width", "100%")

                match self.variant:
                    case DividerVariant.Inset:
                        divider = divider.with_style("margin-left", "72px")
                    case DividerVariant.Middle:
                        divider = divider
                            .with_style("margin-left", "16px")
                            .with_style("margin-right", "16px")
                    case DividerVariant.Full: pass

            case DividerOrientation.Vertical:
                divider = divider
                    .with_style("width", "1px")
                    .with_style("height", "100%")
                    .with_style("align-self", "stretch")

        return divider

# Helper to convert Color to CSS style string
fn color_to_style(color: &Color) -> text:
    val rgba = color.to_rgba()
    val r = (rgba >> 16) & 0xFF
    val g = (rgba >> 8) & 0xFF
    val b = rgba & 0xFF
    return "rgb({r}, {g}, {b})"
