[build]
# Build configuration for Simple language
# Note: Test thread limits are managed dynamically by scripts/cpu-aware-test.sh
# based on CPU_THROTTLE_THRESHOLD (default 70%) in simple.test.toml

# Limit parallel jobs to prevent resource exhaustion on high-core-count systems
# Without this, cargo test --workspace on 32+ core systems can hang at 100% CPU
jobs = 8

# Default to single-threaded Rust tests for deterministic behavior
# Use RUST_TEST_THREADS=N or cargo test -- --test-threads=N to override
[env]
RUST_TEST_THREADS = "1"

[target.x86_64-unknown-linux-gnu]
# Startup optimization linker flags (#1992, #1995)
rustflags = [
    # #1995: Section GC - remove unused sections
    "-C", "link-arg=-Wl,--gc-sections",
    # #1992: RELR relocations - packed relative relocations (requires ld 2.27+)
    "-C", "link-arg=-Wl,-z,pack-relative-relocs",
]

# Cross-compilation linker configs
[target.x86_64-pc-windows-gnu]
linker = "x86_64-w64-mingw32-gcc"

[target.aarch64-unknown-linux-gnu]
linker = "aarch64-linux-gnu-gcc"

[target.riscv64gc-unknown-linux-gnu]
linker = "riscv64-linux-gnu-gcc"
