# MCP Service Traits - Interface Definitions for DI
#
# Defines trait interfaces for the MCP server's core services.
# These traits are desugared into structs with fn-fields by the
# trait desugar pass, enabling lazy proxy generation.
#
# Usage:
#   use app.mcp.services.{JsonService, ProtocolService}
#
# See Also:
#   - src/app/mcp/helpers.spl - JsonService implementation
#   - src/lib/mcp/protocol.spl - ProtocolService implementation
#   - doc/design/di_auto_lazy_proxy.md - Design document

export JsonService, ProtocolService

# ============================================================================
# JsonService - JSON helper operations
# ============================================================================

# Interface for JSON construction and extraction helpers.
#
# Wraps the functions from helpers.spl that are used by the MCP server
# dispatch loop. Each method maps to a helper function.
trait JsonService:
    fn escape(s: text) -> text
    fn js(s: text) -> text
    fn jp(key: text, value: text) -> text
    fn jo1(p1: text) -> text
    fn jo2(p1: text, p2: text) -> text
    fn jo3(p1: text, p2: text, p3: text) -> text
    fn extract_field(json: text, key: text) -> text
    fn extract_value(json: text, key: text) -> text
    fn extract_nested(json: text, outer: text, inner: text) -> text
    fn make_result(id: text, result: text) -> text
    fn make_error(id: text, code: i64, msg: text) -> text

# ============================================================================
# ProtocolService - MCP protocol I/O
# ============================================================================

# Interface for MCP protocol message reading/writing.
#
# Wraps the protocol module's read/write functions so they can be
# resolved lazily via DI.
trait ProtocolService:
    fn read_message() -> text
    fn write_message(body: text)
