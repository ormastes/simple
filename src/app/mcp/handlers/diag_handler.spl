# Diagnostic Tools Handler - Lazy loaded with minimal implementation
#
# Handles: simple_* tools with inline implementations
# NO HEAVY IMPORTS - everything inlined for fast subprocess startup

extern fn rt_file_read_text(path: text) -> text
extern fn rt_process_run(cmd: text, args: [text]) -> (text, text, i64)

# Get command line args: [tool_name, id, request_body]
extern fn rt_cli_get_args() -> [text]

val args = rt_cli_get_args()
if args.len() < 4:
    print "ERROR: Usage: diag_handler.spl <tool_name> <id> <request_body>"
else:
    val tool_name = args[1]
    val id = args[2]
    val body = args[3]

    var response = ""
    if tool_name == "simple_read":
        response = handle_simple_read(id, body)
    elif tool_name == "simple_check":
        response = handle_simple_check(id, body)
    elif tool_name == "simple_symbols":
        response = handle_simple_symbols(id, body)
    elif tool_name == "simple_status":
        response = handle_simple_status(id, body)
    elif tool_name == "simple_edit":
        response = handle_simple_edit(id, body)
    elif tool_name == "simple_multi_edit":
        response = handle_simple_multi_edit(id, body)
    elif tool_name == "simple_run":
        response = handle_simple_run(id, body)
    elif tool_name == "simple_diff":
        response = handle_simple_diff(id, body)
    elif tool_name == "simple_log":
        response = handle_simple_log(id, body)
    elif tool_name == "simple_squash":
        response = handle_simple_squash(id, body)
    elif tool_name == "simple_new":
        response = handle_simple_new(id, body)
    else:
        response = make_error_response(id, -32601, "Unknown tool: " + tool_name)

    print_raw(response)
