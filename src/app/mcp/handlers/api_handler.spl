# API Tools Handler - Loaded on-demand
#
# Handles: simple_api
#
# This script is invoked as a subprocess, so imports only load when needed.

use app.mcp.api_tools.{handle_simple_api}

extern fn rt_cli_get_args() -> [text]
extern fn print_raw(s: text)

val args = rt_cli_get_args()
if args.len() < 4:
    print "ERROR: Usage: api_handler.spl <tool_name> <id> <request_body>"
else:
    val tool_name = args[1]
    val id = args[2]
    val body = args[3]

    var response = ""
    if tool_name == "simple_api":
        response = handle_simple_api(id, body)
    else:
        response = "{\"jsonrpc\":\"2.0\",\"id\":\"" + id + "\",\"error\":{\"code\":-32601,\"message\":\"Unknown tool: " + tool_name + "\"}}"

    print_raw(response)
