# Query CLI - Schema Discovery
#
# Lists available node types and predicates for AST pattern and semantic queries.
# Used for tool discoverability and auto-completion support.

# ============================================================================
# Public Entry Point
# ============================================================================

fn engine_query_schema(kind: text) -> i64:
    if kind == "ast":
        _print_ast_schema()
    elif kind == "sem":
        _print_sem_schema()
    else:
        _print_ast_schema()
        print ""
        _print_sem_schema()
    0

# ============================================================================
# AST Pattern Schema
# ============================================================================

fn _print_ast_schema():
    print "=== AST Pattern Query Schema ==="
    print ""
    print "Syntax: (node_kind predicate: \"value\" ...)"
    print ""
    print "--- Node Kinds ---"
    print "  function    — fn, method, static_method, extern_fn"
    print "  class       — class declarations"
    print "  struct      — struct declarations"
    print "  enum        — enum declarations"
    print "  trait       — trait declarations"
    print "  impl        — impl blocks"
    print "  import      — use/import statements"
    print "  field       — struct/class fields"
    print "  val         — val bindings"
    print "  var         — var bindings"
    print "  *           — wildcard (matches any node)"
    print ""
    print "--- Predicates ---"
    print "  name: \"value\"        — match symbol name"
    print "  return_type: \"value\" — match return type"
    print "  params: \"value\"      — match parameter string"
    print "  type: \"value\"        — alias for return_type (fields)"
    print "  module: \"value\"      — match import module path"
    print "  parent: \"value\"      — match parent type name"
    print "  kind: \"value\"        — match exact symbol kind"
    print "  signature: \"value\"   — match full signature"
    print "  trait: \"value\"       — match trait name (impl blocks)"
    print "  visibility: \"value\"  — match pub/private"
    print ""
    print "--- Pattern Operators ---"
    print "  =          — exact match (default)"
    print "  ~          — glob match (use * wildcards)"
    print ""
    print "--- Nested Patterns ---"
    print "  (class methods: (function name: \"to_string\"))"
    print "  (struct fields: (field type: \"i64\"))"
    print ""
    print "--- Examples ---"
    print "  (function name: \"main\")"
    print "  (function return_type: \"i64\" visibility: \"pub\")"
    print "  (class methods: (function name: \"to_string\"))"
    print "  (import module: \"std.*\")"
    print "  (impl trait: \"Printable\")"
    print "  (* name: \"query_main\")"

# ============================================================================
# Semantic Query Schema
# ============================================================================

fn _print_sem_schema():
    print "=== Semantic Query Schema ==="
    print ""
    print "Syntax: FIND <target> WHERE <predicate> [AND <predicate> ...]"
    print ""
    print "--- Targets ---"
    print "  fn          — functions (fn, method, static_method, extern_fn)"
    print "  class       — class declarations"
    print "  struct      — struct declarations"
    print "  enum        — enum declarations"
    print "  trait       — trait declarations"
    print "  impl        — impl blocks"
    print "  import      — use/import statements"
    print "  type        — any type (class, struct, enum, trait)"
    print "  field       — struct/class fields"
    print "  val         — val bindings"
    print "  var         — var bindings"
    print "  *           — all symbols"
    print ""
    print "--- Field Predicates ---"
    print "  name          — symbol name"
    print "  return_type   — return type (functions)"
    print "  params        — parameter string"
    print "  parent        — parent type name"
    print "  kind          — exact symbol kind"
    print "  signature     — full signature line"
    print "  module        — import module path"
    print "  trait         — trait name (impl blocks)"
    print "  visibility    — pub or private"
    print ""
    print "--- Numeric Fields ---"
    print "  param_count   — number of parameters"
    print "  field_count   — number of fields (struct/class)"
    print ""
    print "--- Comparison Operators ---"
    print "  =             — equals"
    print "  !=            — not equals"
    print "  >             — greater than"
    print "  <             — less than"
    print "  >=            — greater than or equal"
    print "  <=            — less than or equal"
    print "  starts_with   — string prefix match"
    print "  ends_with     — string suffix match"
    print "  contains      — string contains"
    print ""
    print "--- Function Predicates ---"
    print "  calls(\"name\")       — function calls another function"
    print "  has_method(\"name\")  — type has a method"
    print "  implements(\"name\")  — type implements a trait"
    print "  imports(\"name\")     — import contains module"
    print ""
    print "--- Examples ---"
    print "  FIND fn WHERE return_type = \"i64\""
    print "  FIND fn WHERE name starts_with \"parse_\" AND param_count > 2"
    print "  FIND fn WHERE calls(\"rt_file_read_text\")"
    print "  FIND class WHERE has_method(\"to_string\")"
    print "  FIND struct WHERE field_count > 5"
    print "  FIND import WHERE module contains \"std\""
    print "  FIND impl WHERE trait = \"Iterator\""

export engine_query_schema
