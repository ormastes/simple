#!/usr/bin/env simple
# Test Database Repair CLI Tool
#
# Usage: simple test_db_repair.spl [--validate|--migrate|--benchmark]

use app.test_runner_new.test_db_migrate.{run_migration_cli, validate_databases}
use app.test_runner_new.test_db_perf.{run_benchmarks}
use app.io.io (env_args)

fn main():
    val args = env_args()

    if args.len() <= 1:
        print_usage()
        return

    val command = args[1]

    if command == "--validate" or command == "-v":
        run_validate()
    elif command == "--migrate" or command == "-m":
        run_migration_cli()
    elif command == "--benchmark" or command == "-b":
        run_benchmarks()
    elif command == "--help" or command == "-h":
        print_usage()
    else:
        print "Error: Unknown command '{command}'\n"
        print_usage()

fn run_validate():
    """Run database validation only."""
    print "Test Database Validation"
    print "=======================\n"

    val (is_valid, issues) = validate_databases()

    if is_valid:
        print "âœ“ All databases are valid\n"
    else:
        print "âœ— Found {issues.len()} issue(s):\n"
        for issue in issues:
            print "  {issue}"
        print "\nRun with --migrate to repair databases\n"

fn print_usage():
    print "Test Database Repair Tool"
    print "========================\n"
    print "Usage: simple test_db_repair.spl [COMMAND]\n"
    print "Commands:"
    print "  --validate, -v    Validate databases without making changes"
    print "  --migrate, -m     Migrate and repair corrupted databases"
    print "  --benchmark, -b   Run performance benchmarks"
    print "  --help, -h        Show this help message\n"
    print "Examples:"
    print "  simple src/app/cli/test_db_repair.spl --validate"
    print "  simple src/app/cli/test_db_repair.spl --migrate"
    print "  simple src/app/cli/test_db_repair.spl --benchmark\n"

main()
