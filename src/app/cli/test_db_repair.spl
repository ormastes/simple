#!/usr/bin/env simple
# Test Database Repair CLI Tool
#
# Usage: simple test_db_repair.spl [--validate|--migrate|--benchmark]

use app.test_runner_new.test_db_migrate.{run_migration_cli, validate_databases}
use app.test_runner_new.test_db_perf.{run_benchmarks}
use app.io.mod (env_args)
use std.text.{NL}

fn main():
    val args = env_args()

    if args.len() <= 1:
        print_usage()
        return

    val command = args[1]

    if command == "--validate" or command == "-v":
        run_validate()
    elif command == "--migrate" or command == "-m":
        run_migration_cli()
    elif command == "--benchmark" or command == "-b":
        run_benchmarks()
    elif command == "--help" or command == "-h":
        print_usage()
    else:
        print "Error: Unknown command '{command}'{NL}"
        print_usage()

fn run_validate():
    """Run database validation only."""
    print "Test Database Validation"
    print "======================={NL}"

    val (is_valid, issues) = validate_databases()

    if is_valid:
        print "âœ“ All databases are valid{NL}"
    else:
        print "âœ— Found {issues.len()} issue(s):{NL}"
        for issue in issues:
            print "  {issue}"
        print "{NL}Run with --migrate to repair databases{NL}"

fn print_usage():
    print "Test Database Repair Tool"
    print "========================{NL}"
    print "Usage: simple test_db_repair.spl [COMMAND]{NL}"
    print "Commands:"
    print "  --validate, -v    Validate databases without making changes"
    print "  --migrate, -m     Migrate and repair corrupted databases"
    print "  --benchmark, -b   Run performance benchmarks"
    print "  --help, -h        Show this help message{NL}"
    print "Examples:"
    print "  simple src/app/cli/test_db_repair.spl --validate"
    print "  simple src/app/cli/test_db_repair.spl --migrate"
    print "  simple src/app/cli/test_db_repair.spl --benchmark{NL}"

main()
