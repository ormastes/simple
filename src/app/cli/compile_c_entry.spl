# C Backend Compile Entry Point
#
# Compiles a Simple source file to C++20 using the MIR C backend.
# Used as Path 1 in compile_c_backend (interpreter mode entry point).
#
# Usage: simple compile_c_entry.spl <source.spl> <output.cpp>

use compiler.driver.driver.{aot_c_file}
use compiler.driver.driver_types.{CompileResult}

extern fn sys_get_args() -> [text]

fn main() -> i64:
    val args = sys_get_args()
    if args.len() < 3:
        print "Usage: simple compile_c_entry.spl <source.spl> <output.cpp>"
        return 1

    val source = args[1]
    val output = args[2]

    val result = aot_c_file(source, output)
    match result:
        case CompileResult.Success(_):
            print "Output: {output}"
            return 0
        case _:
            val errors = result.get_errors()
            for err in errors:
                print "error: {err}"
            return 1
