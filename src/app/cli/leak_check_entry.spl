# Lightweight leak-check entry point for `simple leak-check`
#
# This file loads only the minimal imports needed to run leak-check,
# avoiding the overhead of loading the full CLI with all its modules.
#
# Usage:
#   bin/release/simple src/app/cli/leak_check_entry.spl leak-check [options] <source.spl>

use app.io.cli_ops.{cli_get_args}
use app.leak_check.main (run_leak_check)

fn get_leak_check_args() -> [text]:
    val all_args = cli_get_args()
    var args: [text] = []
    var start_idx = 1
    # Skip script path (first arg is the entry point .spl path)
    if all_args.len() > 1 and all_args[1].ends_with("leak_check_entry.spl"):
        start_idx = 2
    # Skip "leak-check" command if present
    if all_args.len() > start_idx and all_args[start_idx] == "leak-check":
        start_idx = start_idx + 1
    var i = start_idx
    while i < all_args.len():
        args = args.push(all_args[i])
        i = i + 1
    args

fn main() -> i64:
    val args = get_leak_check_args()
    run_leak_check(args)
