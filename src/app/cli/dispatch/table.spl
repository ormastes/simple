# CLI Command Dispatch - Command Table
#
# Table-driven command dispatch: 48 commands organized by category.
# Port of rust/driver/src/main.rs (731 lines, 48 commands)

use app.cli.dispatch.types.{CommandEntry}

# ============================================================================
# Command Table Function - Returns inline data (workaround for module closure)
# ============================================================================

fn get_command_table() -> [CommandEntry]:
    """Get command table as function to avoid module closure limitation.

    Returns:
        Array of all 48 command entries

    NOTE: This function returns the array inline rather than storing it
    in a module-level variable, because imported functions cannot access
    module-level collections (MEMORY.md: Module function closures broken).
    """
    [
        # ---------------------------------------------------------------------
        # Compilation Commands
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "compile",
            app_path: "src/app/compile/main.spl",
            env_override: "SIMPLE_COMPILE_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "targets",
            app_path: "src/app/targets/main.spl",
            env_override: "SIMPLE_TARGETS_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "linkers",
            app_path: "src/app/linkers/main.spl",
            env_override: "SIMPLE_LINKERS_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Web Framework
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "web",
            app_path: "src/app/web/main.spl",
            env_override: "SIMPLE_WEB_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # File Watching
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "watch",
            app_path: "src/app/watch/main.spl",
            env_override: "SIMPLE_WATCH_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Testing - Currently Rust-only (cargo test integration)
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "test",
            app_path: "",  # No Simple impl yet (complex cargo integration)
            env_override: "",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Code Quality
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "lint",
            app_path: "src/app/lint/main.spl",
            env_override: "SIMPLE_LINT_RUST",
            needs_rust_flags: ["--json", "--fix"]
        ),

        CommandEntry(
            name: "fix",
            app_path: "src/app/fix/main.spl",
            env_override: "SIMPLE_FIX_RUST",
            needs_rust_flags: ["--fix", "--fix-all", "--fix-dry-run", "--fix-interactive"]
        ),

        CommandEntry(
            name: "duplicate-check",
            app_path: "src/app/duplicate_check/main.spl",
            env_override: "SIMPLE_DUPLICATE_CHECK_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "fmt",
            app_path: "src/app/formatter/main.spl",
            env_override: "SIMPLE_FMT_RUST",
            needs_rust_flags: ["--json"]
        ),

        CommandEntry(
            name: "check",
            app_path: "src/app/check/main.spl",
            env_override: "SIMPLE_CHECK_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "check-capsule",
            app_path: "src/app/cli/check_capsule.spl",
            env_override: "SIMPLE_CHECK_CAPSULE_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "check-dbs",
            app_path: "src/app/cli/check_dbs.spl",
            env_override: "SIMPLE_CHECK_DBS_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "fix-dbs",
            app_path: "src/app/cli/fix_dbs.spl",
            env_override: "SIMPLE_FIX_DBS_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Localization
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "i18n",
            app_path: "src/app/i18n/main.spl",
            env_override: "SIMPLE_I18N_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Migration and Tooling
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "migrate",
            app_path: "src/app/migrate/main.spl",
            env_override: "SIMPLE_MIGRATE_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "mcp",
            app_path: "src/app/mcp/main.spl",
            env_override: "SIMPLE_MCP_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "diff",
            app_path: "src/app/diff/main.spl",
            env_override: "SIMPLE_DIFF_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "context",
            app_path: "src/app/context/main.spl",
            env_override: "SIMPLE_CONTEXT_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "constr",
            app_path: "src/app/constr/main.spl",
            env_override: "SIMPLE_CONSTR_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Analysis and Querying
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "query",
            app_path: "src/app/query/main.spl",
            env_override: "SIMPLE_QUERY_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "info",
            app_path: "src/app/info/main.spl",
            env_override: "SIMPLE_INFO_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "spec-coverage",
            app_path: "src/app/spec_coverage/main.spl",
            env_override: "SIMPLE_SPEC_COVERAGE_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "replay",
            app_path: "src/app/replay/main.spl",
            env_override: "SIMPLE_REPLAY_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Code Generation
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "gen-lean",
            app_path: "src/app/gen_lean/main.spl",
            env_override: "SIMPLE_GEN_LEAN_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "feature-gen",
            app_path: "src/app/feature_gen/main.spl",
            env_override: "SIMPLE_FEATURE_GEN_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "task-gen",
            app_path: "src/app/task_gen/main.spl",
            env_override: "SIMPLE_TASK_GEN_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "spec-gen",
            app_path: "src/app/spec_gen/main.spl",
            env_override: "SIMPLE_SPEC_GEN_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "todo-scan",
            app_path: "src/app/todo_scan/main.spl",
            env_override: "SIMPLE_TODO_SCAN_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "todo-gen",
            app_path: "src/app/todo_gen/main.spl",
            env_override: "SIMPLE_TODO_GEN_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "sspec-docgen",
            app_path: "src/app/sspec_docgen/main.spl",
            env_override: "SIMPLE_SSPEC_DOCGEN_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "feature-doc",
            app_path: "src/app/feature_doc/main.spl",
            env_override: "SIMPLE_FEATURE_DOC_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Documentation
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "brief",
            app_path: "src/app/brief/main.spl",
            env_override: "SIMPLE_BRIEF_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "dashboard",
            app_path: "src/app/dashboard/main.spl",
            env_override: "SIMPLE_DASHBOARD_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Package Management
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "init",
            app_path: "src/app/init/main.spl",
            env_override: "SIMPLE_INIT_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "install",
            app_path: "src/app/install/main.spl",
            env_override: "SIMPLE_INSTALL_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "publish",
            app_path: "src/app/publish/main.spl",
            env_override: "SIMPLE_PUBLISH_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "add",
            app_path: "src/app/add/main.spl",
            env_override: "SIMPLE_ADD_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "remove",
            app_path: "src/app/remove/main.spl",
            env_override: "SIMPLE_REMOVE_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "search",
            app_path: "src/app/search/main.spl",
            env_override: "SIMPLE_SEARCH_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "deps",
            app_path: "src/app/deps/main.spl",
            env_override: "SIMPLE_DEPS_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "list",
            app_path: "src/app/list/main.spl",
            env_override: "SIMPLE_LIST_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "tree",
            app_path: "src/app/tree/main.spl",
            env_override: "SIMPLE_TREE_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Build System
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "build",
            app_path: "src/app/build/main.spl",
            env_override: "SIMPLE_BUILD_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "run",
            app_path: "src/app/run/main.spl",
            env_override: "SIMPLE_RUN_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "clean",
            app_path: "src/app/clean/main.spl",
            env_override: "SIMPLE_CLEAN_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Benchmarking
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "bench",
            app_path: "src/app/bench/main.spl",
            env_override: "SIMPLE_BENCH_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # REPL and Execution
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "repl",
            app_path: "src/app/repl/main.spl",
            env_override: "SIMPLE_REPL_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "verify",
            app_path: "src/app/verify/main.spl",
            env_override: "SIMPLE_VERIFY_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Qualification
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "qualify-ignore",
            app_path: "src/app/qualify_ignore/main.spl",
            env_override: "SIMPLE_QUALIFY_IGNORE_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Bug Tracking
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "bug-add",
            app_path: "src/app/bug_add/main.spl",
            env_override: "SIMPLE_BUG_ADD_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "bug-gen",
            app_path: "src/app/bug_gen/main.spl",
            env_override: "SIMPLE_BUG_GEN_RUST",
            needs_rust_flags: []
        ),

        # ---------------------------------------------------------------------
        # Wrapper Generation
        # ---------------------------------------------------------------------

        CommandEntry(
            name: "wrapper-gen",
            app_path: "src/app/wrapper_gen/main.spl",
            env_override: "SIMPLE_WRAPPER_GEN_RUST",
            needs_rust_flags: []
        ),

        CommandEntry(
            name: "ffi-gen",
            app_path: "src/app/ffi_gen/main.spl",
            env_override: "SIMPLE_FFI_GEN_RUST",
            needs_rust_flags: []
        ),
    ]

fn get_all_commands() -> [CommandEntry]:
    """Get all registered commands.

    Returns:
        Copy of the command table
    """
    get_command_table()

export get_command_table, get_all_commands
