# Git-to-JJ Wrapper
#
# Simple (.spl) replacement for script/jj-wrappers/git.bat
# Redirects git commands to jj equivalents
# Helps LLMs use jj instead of git

use app.io.mod.{shell, get_args, exit}

fn forward_args(args: [text], start_idx: i64) -> text:
    """Build argument string from args starting at index"""
    var result = ""
    var idx = 0
    for arg in args:
        if idx >= start_idx:
            if result != "":
                result = result + " "
            result = result + arg
        idx = idx + 1
    result

fn main():
    val args = get_args()

    if args.len() < 2:
        print "Usage: simple run src/app/jj/git_wrapper.spl <git-command> [args...]"
        exit(1)

    val cmd = args[1]
    val rest = forward_args(args, 2)

    print "NOTE: This project uses jj (Jujutsu) instead of git."
    print "      Please use 'jj' commands directly next time."
    print "      Translating 'git {cmd}' -> jj equivalent..."
    print ""

    var jj_cmd = ""

    if cmd == "status":
        jj_cmd = "jj status {rest}"
    else if cmd == "diff":
        jj_cmd = "jj diff {rest}"
    else if cmd == "log":
        jj_cmd = "jj log {rest}"
    else if cmd == "add":
        print "Note: jj auto-tracks files, no need to add"
        jj_cmd = "jj status"
    else if cmd == "commit":
        jj_cmd = "jj commit {rest}"
    else if cmd == "push":
        jj_cmd = "jj git push {rest}"
    else if cmd == "pull":
        jj_cmd = "jj git fetch {rest}"
    else if cmd == "fetch":
        jj_cmd = "jj git fetch {rest}"
    else if cmd == "checkout":
        jj_cmd = "jj edit {rest}"
    else if cmd == "branch":
        jj_cmd = "jj bookmark {rest}"
    else if cmd == "stash":
        print "Note: jj doesn't need stash - changes are always preserved"
        jj_cmd = "jj status"
    else if cmd == "init":
        jj_cmd = "jj git init {rest}"
    else if cmd == "clone":
        jj_cmd = "jj git clone {rest}"
    else if cmd == "show":
        jj_cmd = "jj show {rest}"
    else if cmd == "reset":
        print "Note: use 'jj restore' or 'jj abandon' instead of git reset"
        jj_cmd = "jj status"
    else:
        print "Unknown git command: {cmd}"
        print "Use jj directly. Common commands:"
        print "  jj status, jj diff, jj log, jj commit, jj describe"
        print "  jj git push, jj git fetch, jj edit, jj new"
        exit(1)

    val result = shell(jj_cmd)
    exit(result.exit_code)

main()
