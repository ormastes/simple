# Generate C Code Only (no compilation)
#
# Utility script that generates C code from Simple source without compiling.
# Useful for cross-compilation workflows where gcc isn't the target compiler.
#
# Usage: simple src/app/compile/gen_c_only.spl <source.spl> <output.c>

extern fn rt_file_read_text(path: text) -> text
extern fn rt_cli_get_args() -> [str]
use app.compile.c_codegen.{generate_c_code}
use app.io.file_shell.{file_write}
use std.log.{error, info}

fn main():
    val args = rt_cli_get_args()
    if args.len() < 4:
        print "Usage: gen_c_only.spl <source.spl> <output.c>"
        return
    val source = rt_file_read_text(args[2]) ?? ""
    if source == "":
        error("compile", "cannot read source file: {args[2]}")
        return
    val c_code = generate_c_code(source)
    file_write(args[3], c_code)
    info("compile", "Generated C: {args[3]} ({c_code.len()} bytes)")
