# Divide & Conquer: Phase 1 only (load + parse)
extern fn rt_cli_get_args() -> [str]
use compiler.driver.driver.{CompilerDriver}
use compiler.driver.driver_types.{CompileOptions, CompileOptions__default, CompileMode, CompileResult}

fn main() -> i64:
    val options = CompileOptions__default()
    options.input_files = ["/tmp/test_minimal.spl"]
    options.mode = CompileMode.Aot
    options.output_file = Some("/tmp/test_out.cpp")
    options.backend = "c"

    val driver = CompilerDriver__create(options)
    print "Phase 1: loading..."
    if not driver.load_sources_impl():
        print "load FAILED"
        return 1
    print "Phase 1 done"

    print "Phase 2: parsing..."
    if not driver.parse_all_impl():
        print "parse FAILED"
        return 1
    print "Phase 2 done"
    print "STOPPED after phase 2"
    0
