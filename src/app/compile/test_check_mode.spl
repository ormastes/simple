# Test: Check mode only (phases 1-4, no AOT/codegen)
# If this leaks -> problem is in phases 1-4
# If this is fine -> problem is in AOT phase

extern fn rt_cli_get_args() -> [str]

use compiler.driver.driver.{CompilerDriver}
use compiler.driver.driver_types.{CompileOptions, CompileOptions__default, CompileMode, CompileResult}

fn main() -> i64:
    val options = CompileOptions__default()
    options.input_files = ["/tmp/test_minimal.spl"]
    options.mode = CompileMode.Check
    options.backend = "c"
    options.verbose = false

    val driver = CompilerDriver__create(options)
    val result = driver.compile()

    match result:
        case CompileResult.Success(_):
            print "CHECK MODE SUCCESS"
            0
        case _:
            val errors = result.get_errors()
            for err in errors:
                print err
            1
