# Progress Bar Rendering
#
# Renders ASCII progress bars for percentage displays.

use dashboard.render.colors.{GREEN, YELLOW, RED, DIM, RESET}

# =========================================================================
# Progress Bar
# =========================================================================

# Render progress bar
fn render_progress_bar(percent: f64, width: i32) -> text:
    val filled_width = ((percent / 100.0) * (width as f64)) as i32
    val empty_width = width - filled_width

    # Choose color based on percentage
    val color = if percent >= 80.0:
        GREEN
    elif percent >= 60.0:
        YELLOW
    else:
        RED

    # Build bar
    var bar = "["
    for i in 0..filled_width:
        bar = "{bar}="
    for i in 0..empty_width:
        bar = "{bar} "
    bar = "{bar}]"

    return "{color}{bar}{RESET} {percent}%"

# Render progress bar with counts
fn render_progress_with_counts(current: i32, total: i32, width: i32) -> text:
    val percent = if total == 0:
        0.0
    else:
        ((current as f64) / (total as f64)) * 100.0

    val bar = render_progress_bar(percent, width)
    return "{bar} ({current}/{total})"

# Render simple percentage
fn render_percentage(percent: f64) -> text:
    val color = if percent >= 80.0:
        GREEN
    elif percent >= 60.0:
        YELLOW
    else:
        RED

    return "{color}{percent}%{RESET}"

# Render fraction
fn render_fraction(current: i32, total: i32) -> text:
    val percent = if total == 0:
        0.0
    else:
        ((current as f64) / (total as f64)) * 100.0

    val color = if percent >= 80.0:
        GREEN
    elif percent >= 60.0:
        YELLOW
    else:
        RED

    return "{color}{current}/{total}{RESET}"

# =========================================================================
# Exports
# =========================================================================

export render_progress_bar, render_progress_with_counts
export render_percentage, render_fraction
