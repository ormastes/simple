# Project statistics aggregation and reporting

use app.stats.types (ProjectStats, LineCount, TestStats, CoverageStats, FeatureStats, BugStats, FileStats)
use app.stats.file_scanner (scan_project_files)
use app.stats.line_counter (count_project_lines)
use app.stats.db_aggregator (collect_test_stats, collect_coverage_stats,
    collect_feature_stats, collect_bug_stats)
use app.stats.formatter (format_stats_table)

# Main entry point for stats command
fn run_stats(args: [text]):
    print "Collecting statistics..."
    print ""
    print "About to scan files..."

    val file_stats = scan_project_files()

    print "Files scanned: {file_stats.total_files}"
    # val file_stats = FileStats(total_files: 0, app_files: 0, lib_files: 0, std_files: 0, test_files: 0, doc_files: 0)
    # val line_stats = count_project_lines()
    val line_stats = LineCount(code: 0, blank: 0, comment: 0, total: 0)
    # val test_stats = collect_test_stats()
    val test_stats = TestStats(total: 0, passed: 0, failed: 0, skipped: 0,
        sspec_count: 0, sdoc_count: 0, system_count: 0, integration_count: 0, unit_count: 0)
    # val coverage_stats = collect_coverage_stats()
    val coverage_stats = CoverageStats(percent: 0.0, lines_covered: 0, lines_total: 0)
    # val feature_stats = collect_feature_stats()
    val feature_stats = FeatureStats(total: 0, complete: 0, in_progress: 0, planned: 0)
    # val bug_stats = collect_bug_stats()
    val bug_stats = BugStats(total: 0, open: 0, critical: 0, fixed: 0)

    val stats = ProjectStats(
        file_stats: file_stats,
        line_stats: line_stats,
        test_stats: test_stats,
        coverage_stats: coverage_stats,
        feature_stats: feature_stats,
        bug_stats: bug_stats
    )

    print format_stats_table(stats)

export run_stats
