# JSON output formatter for stats

# Format statistics as JSON
fn format_json(
    total_src: i64,
    app_files: i64,
    lib_files: i64,
    std_files: i64,
    test_files: i64,
    total_lines: i64,
    test_count: i64,
    pass_count: i64,
    feat_total: i64,
    feat_complete: i64,
    feat_progress: i64,
    feat_planned: i64
) -> text:
    var json = "{\n"
    json = "{json}  \"files\": {\n"
    json = "{json}    \"total\": {total_src},\n"
    json = "{json}    \"app\": {app_files},\n"
    json = "{json}    \"lib\": {lib_files},\n"
    json = "{json}    \"std\": {std_files},\n"
    json = "{json}    \"tests\": {test_files}\n"
    json = "{json}  },\n"
    json = "{json}  \"lines\": {\n"
    json = "{json}    \"total\": {total_lines}\n"
    json = "{json}  },\n"
    json = "{json}  \"tests\": {\n"
    json = "{json}    \"total\": {test_count},\n"
    json = "{json}    \"passed\": {pass_count},\n"

    var pass_rate = 0
    if test_count > 0:
        pass_rate = (pass_count * 100) / test_count

    json = "{json}    \"pass_rate\": {pass_rate}\n"
    json = "{json}  },\n"
    json = "{json}  \"features\": {\n"
    json = "{json}    \"total\": {feat_total},\n"
    json = "{json}    \"complete\": {feat_complete},\n"
    json = "{json}    \"in_progress\": {feat_progress},\n"
    json = "{json}    \"planned\": {feat_planned}\n"
    json = "{json}  }\n"
    json = "{json}}"

    json

export format_json
