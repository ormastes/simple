# JSON output formatter for stats

# Format statistics as JSON
use std.string.{NL}

fn format_json(
    total_src: i64,
    app_files: i64,
    lib_files: i64,
    std_files: i64,
    test_files: i64,
    total_lines: i64,
    test_count: i64,
    pass_count: i64,
    feat_total: i64,
    feat_complete: i64,
    feat_progress: i64,
    feat_planned: i64
) -> text:
    var json = "{{NL}"
    json = "{json}  \"files\": {{NL}"
    json = "{json}    \"total\": {total_src},{NL}"
    json = "{json}    \"app\": {app_files},{NL}"
    json = "{json}    \"lib\": {lib_files},{NL}"
    json = "{json}    \"std\": {std_files},{NL}"
    json = "{json}    \"tests\": {test_files}{NL}"
    json = "{json}  },{NL}"
    json = "{json}  \"lines\": {{NL}"
    json = "{json}    \"total\": {total_lines}{NL}"
    json = "{json}  },{NL}"
    json = "{json}  \"tests\": {{NL}"
    json = "{json}    \"total\": {test_count},{NL}"
    json = "{json}    \"passed\": {pass_count},{NL}"

    var pass_rate = 0
    if test_count > 0:
        pass_rate = (pass_count * 100) / test_count

    json = "{json}    \"pass_rate\": {pass_rate}{NL}"
    json = "{json}  },{NL}"
    json = "{json}  \"features\": {{NL}"
    json = "{json}    \"total\": {feat_total},{NL}"
    json = "{json}    \"complete\": {feat_complete},{NL}"
    json = "{json}    \"in_progress\": {feat_progress},{NL}"
    json = "{json}    \"planned\": {feat_planned}{NL}"
    json = "{json}  }{NL}"
    json = "{json}}"

    json

export format_json
