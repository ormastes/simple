# File scanning and categorization

use app.io (dir_list, is_dir)
use app.stats.types (FileStats)

# Recursive directory walking
fn dir_walk_recursive(path: text) -> [text]:
    var results: [text] = []
    val entries = dir_list(path)
    for entry in entries:
        val full_path = "{path}/{entry}"
        if is_dir(full_path):
            results = results.merge(dir_walk_recursive(full_path))
        else:
            results.push(full_path)
    results

# Categorize file by path prefix
fn categorize_file(path: text) -> text:
    if path.starts_with("src/app/"): "app"
    elif path.starts_with("src/lib/"): "lib"
    elif path.starts_with("src/std/"): "std"
    elif path.starts_with("test/"): "test"
    elif path.starts_with("doc/"): "doc"
    else: "other"

# Scan all project files and categorize them
fn scan_project_files() -> FileStats:
    val src_files = dir_walk_recursive("src")
    val test_files = dir_walk_recursive("test")
    val doc_files = dir_walk_recursive("doc")
    val all = src_files.merge(test_files).merge(doc_files)

    var app = 0
    var lib = 0
    var std = 0
    var test = 0
    var doc = 0

    for file in all:
        val category = categorize_file(file)
        if category == "app":
            app = app + 1
        elif category == "lib":
            lib = lib + 1
        elif category == "std":
            std = std + 1
        elif category == "test":
            test = test + 1
        elif category == "doc":
            doc = doc + 1

    FileStats(
        total_files: all.len(),
        app_files: app,
        lib_files: lib,
        std_files: std,
        test_files: test,
        doc_files: doc
    )

export scan_project_files
