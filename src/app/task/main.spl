///
Simple Task - AI Assistant Dispatcher

Connects users to AI drivers (copilot, codex, claude).
Simple command-line interface for AI tasks.

Usage:
    simple task copilot "description"
    simple task codex "description"  
    simple task claude "description"
///

use app.io.process_ops (shell, ProcessResult)
use app.cli_util (get_cli_args)

fn main():
    val argv = get_cli_args()
    
    # argv[0] is script path, real args start from index 1
    if argv.len < 2:
        print_usage()
        rt_exit(1)
    
    val cmd = argv[1]
    
    match cmd:
        case "--help":
            print_usage()
        case "--list":
            list_drivers()
        case "copilot":
            if argv.len < 3:
                print "Error: Task description required"
                rt_exit(1)
            run_copilot(argv[2])
        case "codex":
            if argv.len < 3:
                print "Error: Task description required"
                rt_exit(1)
            run_codex(argv[2])
        case "claude":
            if argv.len < 3:
                print "Error: Task description required"
                rt_exit(1)
            run_claude(argv[2])
        case _:
            print "Unknown command: {cmd}"
            print "Use: copilot, codex, or claude"
            print "Try: simple task --help"
            rt_exit(1)

fn run_copilot(task: str):
    print "Running GitHub Copilot..."
    val cmd = "gh copilot --dangerously-skip-permissions \"{task}\""
    val result = shell(cmd)
    rt_exit(result.exit_code)

fn run_codex(task: str):
    print "Running Codex..."
    val cmd = "codex \"{task}\""
    val result = shell(cmd)
    rt_exit(result.exit_code)

fn run_claude(task: str):
    print "Running Claude..."
    val cmd = "claude \"{task}\""
    val result = shell(cmd)
    rt_exit(result.exit_code)

fn print_usage():
    print "Simple Task - AI Assistant Dispatcher"
    print ""
    print "Usage:"
    print "  simple task copilot \"task description\""
    print "  simple task codex \"task description\""
    print "  simple task claude \"task description\""
    print ""
    print "  simple task --list     List available drivers"
    print "  simple task --help     Show this help"
    print ""
    print "Examples:"
    print "  simple task copilot \"Create a Python web scraper\""
    print "  simple task codex \"Write a sorting algorithm\""
    print "  simple task claude \"Explain this code\""

fn list_drivers():
    print "Available AI Drivers:"
    print ""
    print "  copilot  - GitHub Copilot CLI"
    print "             Install: gh extension install github/gh-copilot"
    print ""
    print "  codex    - OpenAI Codex CLI"
    print "             Install: pip install openai-codex-cli"
    print ""
    print "  claude   - Anthropic Claude CLI"
    print "             Install: npm install -g @anthropic-ai/claude-cli"
