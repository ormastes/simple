# Tier 1 Generator - Helper/Predicate Functions
#
# Utility functions used across Tier 1 code generation sub-modules.

use app.wrapper_gen.spec_parser.{WrapperSpec}

fn is_handle_type(type_name: text, spec: WrapperSpec) -> bool:
    for handle in spec.handle_types:
        if type_name == handle.name:
            return true
    false

fn lib_upper(spec: WrapperSpec) -> text:
    """Get uppercase library name for #ifdef macros."""
    spec.name.upper()

fn is_embedded(spec: WrapperSpec) -> bool:
    """Check if this is an embedded library (no external deps, C++ IS the implementation)."""
    val no_include = spec.cpp_include == ""
    val no_libs = spec.link_libs.len() == 0
    no_include and no_libs

fn qualified_fn_name(spec_name: text, fn_name: text) -> text:
    """Build qualified function name, avoiding double prefix.
    E.g. spec_name='debug', fn_name='debug_is_active' -> 'debug_is_active' (not 'debug_debug_is_active')
    """
    val prefix = spec_name + "_"
    if fn_name.starts_with(prefix):
        return fn_name
    "{spec_name}_{fn_name}"

fn is_void_return(return_type: text) -> bool:
    """Check if return type is void (no return value)."""
    val rt = return_type.trim()
    rt == "void" or rt == ""

export is_handle_type, lib_upper, is_embedded, qualified_fn_name, is_void_return
