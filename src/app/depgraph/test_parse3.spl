print("Start")
extern fn native_fs_read_string(path: String) -> Any

enum ImportKind:
    Use
    ExportUse
    CommonUse
    TypeUse

class ImportEntry:
    path: String
    kind: ImportKind
    is_glob: Bool
    line_number: Int
    
    fn new(path: String, kind: ImportKind) -> ImportEntry:
        return ImportEntry(
            path: path,
            kind: kind,
            is_glob: false,
            line_number: 0
        )

class ParseResult:
    file_path: String
    imports: List<ImportEntry>
    
    fn new(file_path: String) -> ParseResult:
        return ParseResult(
            file_path: file_path,
            imports: []
        )

fn parse_source(file_path: String, source: String) -> ParseResult:
    var imports: List<ImportEntry> = []

    val lines = source.split("\n")
    for line in lines:
        val trimmed = line.trim()
        if trimmed.starts_with("import "):
            val path = trimmed.substring(7, trimmed.len())
            val entry = ImportEntry.new(path, ImportKind.Use)
            imports.push(entry)

    var result = ParseResult.new(file_path)
    result.imports = imports
    return result

fn parse_file(file_path: String) -> Result<ParseResult, String>:
    val content = native_fs_read_string(file_path)
    match content:
        case Err(e):
            return Err("Failed: {e}")
        case Ok(source):
            return Ok(parse_source(file_path=file_path, source=source))

print("Parse file")
val r = parse_file("simple/app/depgraph/scanner.spl")
match r:
    case Err(e):
        print("Error: {e}")
    case Ok(result):
        print("Success!")
        print("File: {result.file_path}")
        print("Imports: {result.imports.len()}")

print("End")
