# Build System Types
#
# Core types for the Simple build system

# Build profiles
enum BuildProfile:
    Debug          # Fast builds with debug info
    Release        # Optimized builds
    Bootstrap      # Minimal size builds for distribution

# Build result
struct BuildResult:
    success: bool
    exit_code: i64
    stdout: text
    stderr: text
    duration_ms: i64

# Build error
struct BuildError:
    message: text
    exit_code: i64
    stderr: text

# Build configuration
struct BuildConfig:
    profile: BuildProfile
    features: [text]
    workspace_root: text
    target_dir: text
    jobs: i64
    verbose: bool

# Test result
struct TestResult:
    success: bool
    exit_code: i64
    stdout: text
    stderr: text
    tests_run: i64
    tests_passed: i64
    tests_failed: i64

# Test error
struct TestError:
    message: text
    exit_code: i64
    stderr: text

fn profile_to_string(profile: BuildProfile) -> text:
    match profile:
        case BuildProfile.Debug: "debug"
        case BuildProfile.Release: "release"
        case BuildProfile.Bootstrap: "bootstrap"

fn profile_from_string(s: text) -> BuildProfile:
    match s:
        case "debug": BuildProfile.Debug
        case "release": BuildProfile.Release
        case "bootstrap": BuildProfile.Bootstrap
        case _: BuildProfile.Debug  # Default to debug

# Test configuration
struct TestConfig:
    filter: text          # Test name filter (empty = all tests)
    level: text           # Test level: all, unit, integration, system
    tag: text             # Tag filter (empty = all tags)
    fail_fast: bool       # Stop on first failure
    timeout: i64          # Test timeout in ms (0 = no timeout)
    parallel: bool        # Run test suites in parallel
    rust_only: bool       # Run only Rust tests
    doc_only: bool        # Run only doc-tests
    simple_only: bool     # Run only Simple tests

# Combined test results (all 3 test types)
struct TestResults:
    rust: TestResult      # Rust workspace tests
    doc: TestResult       # Doc-tests
    simple: TestResult    # Simple/SSpec tests
    total_duration_ms: i64

impl TestResults:
    fn all_passed() -> bool:
        self.rust.success and self.doc.success and self.simple.success

    fn total_tests() -> i64:
        self.rust.tests_run + self.doc.tests_run + self.simple.tests_run

    fn total_passed() -> i64:
        self.rust.tests_passed + self.doc.tests_passed + self.simple.tests_passed

    fn total_failed() -> i64:
        self.rust.tests_failed + self.doc.tests_failed + self.simple.tests_failed

# Coverage level
enum CoverageLevel:
    Unit          # Unit tests only
    Integration   # Integration tests only
    System        # System tests only
    All           # All test levels

# Coverage format
enum CoverageFormat:
    Text          # Plain text summary
    Html          # HTML report
    Lcov          # LCOV format for CI
    Json          # JSON format for tooling
