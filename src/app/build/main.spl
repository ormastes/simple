# Simple Build System
#
# Main entry point for the build command

use app.build.config (parse_build_args)
use app.build.orchestrator (orchestrate_build, orchestrate_test, orchestrate_clean)

fn print_help():
    print "Simple Build System"
    print ""
    print "Usage:"
    print "  simple build [options]          Build the project"
    print "  simple build test               Run tests"
    print "  simple build clean              Clean build artifacts"
    print "  simple build check              Check without building"
    print ""
    print "Options:"
    print "  --profile=<profile>             Build profile: debug, release, bootstrap"
    print "  --release                       Build with release profile"
    print "  --bootstrap                     Build with bootstrap profile"
    print "  --features=<features>           Comma-separated feature flags"
    print "  --verbose, -v                   Verbose output"
    print "  --help, -h                      Show this help"
    print ""
    print "Examples:"
    print "  simple build                    # Build with debug profile"
    print "  simple build --release          # Build with release profile"
    print "  simple build --bootstrap        # Build with bootstrap profile (minimal size)"
    print "  simple build test               # Run all tests"
    print "  simple build clean              # Clean build artifacts"

fn main(args: [text]) -> i64:
    # Check for subcommands
    if args.len() > 0:
        val cmd = args[0]
        match cmd:
            case "--help" | "-h":
                print_help()
                return 0
            case "test":
                val config = parse_build_args(args[1:])
                return orchestrate_test(config)
            case "clean":
                val config = parse_build_args(args[1:])
                return orchestrate_clean(config.verbose)
            case _:
                # Treat as build options
                ()

    # Parse configuration
    val config = parse_build_args(args)

    # Execute build
    val result = orchestrate_build(config)

    if result.success:
        return 0
    else:
        return result.exit_code
