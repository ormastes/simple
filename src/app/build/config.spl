# Build Configuration
#
# Loads and parses build configuration from simple.sdn

use app.build.types (BuildConfig, BuildProfile, profile_from_string)

# Default configuration
fn default_config() -> BuildConfig:
    BuildConfig(
        profile: BuildProfile.Debug,
        features: [],
        workspace_root: "rust",
        target_dir: "rust/target",
        jobs: 4,
        verbose: false
    )

# Load configuration from simple.sdn
fn load_config(profile: BuildProfile, verbose: bool) -> BuildConfig:
    var config = default_config()
    config.profile = profile
    config.verbose = verbose

    # TODO: Parse simple.sdn for custom build settings
    # For now, use defaults

    config

# Parse command-line arguments
fn parse_build_args(args: [text]) -> BuildConfig:
    var profile = BuildProfile.Debug
    var features: [text] = []
    var verbose = false

    for arg in args:
        if arg == "--verbose" or arg == "-v":
            verbose = true
        elif arg.starts_with("--profile="):
            val profile_str = arg[10:]
            profile = profile_from_string(profile_str)
        elif arg == "--release":
            profile = BuildProfile.Release
        elif arg == "--bootstrap":
            profile = BuildProfile.Bootstrap
        elif arg.starts_with("--features="):
            val features_str = arg[11:]
            features = features_str.split(",")

    load_config(profile, verbose)
