# Documentation Warnings for Build System
#
# Integrates documentation checking into the build pipeline.

use app.io.mod (cwd)
use app.doc_coverage.scanner.file_scanner.{discover_source_files}
use app.doc_coverage.compiler_warnings.{check_multiple_files, emit_summary}
use std.string.{NL}

# =========================================================================
# Build Integration
# =========================================================================

fn run_doc_warnings(verbose: bool) -> i64:
    """
    Run documentation warnings check on all source files.

    Args:
        verbose: Show verbose output

    Returns:
        Exit code (0 = success, >0 = warnings found)
    """
    if verbose:
        print "Checking documentation coverage..."

    val root = cwd()
    val patterns: [text] = []
    val files = discover_source_files(root, patterns)

    if files.len() == 0:
        if verbose:
            print "No source files found"
        return 0

    if verbose:
        print "Scanning {files.len()} source files..."

    val result = check_multiple_files(files)
    val all_warnings = result.0
    val files_with_warnings = result.1

    # Emit all warnings
    if all_warnings.len() > 0:
        print ""
        var i = 0
        while i < all_warnings.len():
            print all_warnings[i]
            print ""
            i = i + 1

    # Emit summary
    emit_summary(files.len(), files_with_warnings, all_warnings.len())

    # Return non-zero if warnings found (but don't fail build)
    if all_warnings.len() > 0:
        1
    else:
        0

# =========================================================================
# Exports
# =========================================================================

export run_doc_warnings
