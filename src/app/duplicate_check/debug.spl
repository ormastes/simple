# Debug logging utilities for duplicate detection
# Optimized version that reads env once and passes the flag

use app.io.mod.{env_get}
use std.log.{debug}

# Note: Can't use module var due to runtime limitation
# So we check env_get once and pass result through

fn get_debug_flag() -> bool:
    val env_debug = env_get("SIMPLE_DUP_DEBUG")
    env_debug == "1" or env_debug == "true"

fn init_debug():
    # Just for user feedback
    if get_debug_flag():
        debug("dup", "Debug mode enabled (set SIMPLE_DUP_DEBUG=0 to disable)")

fn debug_log(message: text):
    # Note: Calling env_get every time is slow!
    # But we can't cache in module var
    # For now, keep minimal - only use for critical checkpoints
    if get_debug_flag():
        debug("dup", message)

fn debug_log_progress(current: i64, total: i64, message: text):
    if get_debug_flag():
        if current % 10 == 0 or current == total:
            debug("dup", "{message} ({current}/{total})")

export init_debug, debug_log, debug_log_progress, get_debug_flag
