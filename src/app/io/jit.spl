# JIT Backend Control
#
# Wrappers for execution manager and JIT backend selection.

# --- Execution Manager ---
extern fn rt_set_jit_backend(backend: text) -> bool
extern fn rt_get_jit_backend() -> text
extern fn rt_exec_manager_create(backend: text) -> i64
extern fn rt_exec_manager_compile(handle: i64, mir_data: text) -> text
extern fn rt_exec_manager_execute(handle: i64, name: text, args: [i64]) -> i64
extern fn rt_exec_manager_has_function(handle: i64, name: text) -> bool
extern fn rt_exec_manager_backend_name(handle: i64) -> text
extern fn rt_exec_manager_cleanup(handle: i64)

fn set_jit_backend(backend: text) -> bool:
    """Set the JIT backend: 'auto', 'cranelift', or 'llvm'."""
    rt_set_jit_backend(backend)

fn get_jit_backend() -> text:
    """Get the current JIT backend name."""
    rt_get_jit_backend()

fn exec_manager_create(backend: text) -> i64:
    """Create a new execution manager. Returns handle (0 on failure)."""
    rt_exec_manager_create(backend)

fn exec_manager_compile(handle: i64, mir_data: text) -> text:
    """Compile MIR data. Returns empty string on success, error message on failure."""
    rt_exec_manager_compile(handle, mir_data)

fn exec_manager_execute(handle: i64, name: text, args: [i64]) -> i64:
    """Execute a compiled function by name."""
    rt_exec_manager_execute(handle, name, args)

fn exec_manager_has_function(handle: i64, name: text) -> bool:
    """Check if a function has been compiled."""
    rt_exec_manager_has_function(handle, name)

fn exec_manager_backend_name(handle: i64) -> text:
    """Get the backend name for an execution manager."""
    rt_exec_manager_backend_name(handle)

fn exec_manager_cleanup(handle: i64):
    """Release resources for an execution manager."""
    rt_exec_manager_cleanup(handle)

export set_jit_backend, get_jit_backend
export exec_manager_create, exec_manager_compile, exec_manager_execute
export exec_manager_has_function, exec_manager_backend_name, exec_manager_cleanup
