# File Shell Operations
#
# Common shell-based file operations used by compilation pipelines.
# Provides a unified interface for file I/O via shell commands.

extern fn rt_process_run(cmd: text, args: [text]) -> (text, text, i64)

# Execute shell command and return (stdout, stderr, exit_code)
fn shell(command: text) -> (text, text, i64):
    rt_process_run("sh", ["-c", command])

# Execute shell command and return trimmed stdout
fn shell_output(command: text) -> text:
    val (out, err, code) = rt_process_run("sh", ["-c", command])
    out.trim()

# Write content to file using heredoc (shell-safe)
fn file_write(path: text, content: text) -> bool:
    val (out, err, code) = shell("cat > '{path}' << 'SIMPLE_WRITE_EOF'\n{content}\nSIMPLE_WRITE_EOF")
    code == 0

# Delete file (safe - uses -f flag)
fn file_delete(path: text):
    shell("rm -f '{path}'")

# Get file size in bytes (returns 0 if file doesn't exist)
fn file_size(path: text) -> i64:
    val (size_str, err, code) = shell("stat -c '%s' '{path}' 2>/dev/null")
    if code != 0:
        return 0
    val trimmed = size_str.trim()
    if trimmed == "":
        return 0
    int(trimmed)

export shell, shell_output, file_write, file_delete, file_size
