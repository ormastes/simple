# Simple FFI Test - Tests all 11 functions
use app.io
use std.text.{NL}
print "Testing All 11 Package FFI Functions..."
print "=========================================="

var passed = 0
var failed = 0

# Test 1: rt_package_exists
print "{NL}1. rt_package_exists"
if package_ffi.path_exists("/tmp"):
    print "   ✓ Works"
    passed = passed + 1
else:
    print "   ✗ Failed"
    failed = failed + 1

# Test 2: rt_package_is_dir
print "{NL}2. rt_package_is_dir"
if package_ffi.is_directory("/tmp"):
    print "   ✓ Works"
    passed = passed + 1
else:
    print "   ✗ Failed"
    failed = failed + 1

# Test 3: rt_package_mkdir_all
print "{NL}3. rt_package_mkdir_all"
val test_dir = "/tmp/ffi-test-dir/nested"
if package_ffi.path_exists("/tmp/ffi-test-dir"):
    package_ffi.remove_dir_all("/tmp/ffi-test-dir")
if package_ffi.mkdir_all(test_dir):
    print "   ✓ Works"
    passed = passed + 1
else:
    print "   ✗ Failed"
    failed = failed + 1

# Test 4: rt_package_file_size
print "{NL}4. rt_package_file_size"
val size = package_ffi.get_file_size("/etc/passwd")
if size > 0:
    print "   ✓ Works (size: " + size.to_string() + ")"
    passed = passed + 1
else:
    print "   ✗ Failed"
    failed = failed + 1

# Test 5: rt_package_copy_file
print "{NL}5. rt_package_copy_file"
val copy_dest = "/tmp/ffi-test-dir/passwd_copy"
if package_ffi.copy_file("/etc/passwd", copy_dest):
    print "   ✓ Works"
    passed = passed + 1
else:
    print "   ✗ Failed"
    failed = failed + 1

# Test 6: rt_package_chmod
print "{NL}6. rt_package_chmod"
if package_ffi.set_permissions(copy_dest, 0o644):
    print "   ✓ Works"
    passed = passed + 1
else:
    print "   ✗ Failed"
    failed = failed + 1

# Test 7: rt_package_sha256
print "{NL}7. rt_package_sha256"
val checksum = package_ffi.calculate_checksum(copy_dest)
if checksum.starts_with("sha256:"):
    print "   ✓ Works"
    passed = passed + 1
else:
    print "   ✗ Failed: " + checksum
    failed = failed + 1

# Test 8: rt_package_create_symlink
print "{NL}8. rt_package_create_symlink"
val link_path = "/tmp/ffi-test-dir/link"
if package_ffi.create_symlink(copy_dest, link_path):
    print "   ✓ Works"
    passed = passed + 1
else:
    print "   ✗ Failed"
    failed = failed + 1

# Test 9: rt_package_create_tarball
print "{NL}9. rt_package_create_tarball"
val tarball = "/tmp/ffi-test.tar.gz"
if package_ffi.create_tarball("/tmp/ffi-test-dir", tarball):
    print "   ✓ Works"
    passed = passed + 1
else:
    print "   ✗ Failed"
    failed = failed + 1

# Test 10: rt_package_extract_tarball
print "{NL}10. rt_package_extract_tarball"
val extract_dir = "/tmp/ffi-test-extract"
package_ffi.mkdir_all(extract_dir)
if package_ffi.extract_tarball(tarball, extract_dir):
    print "   ✓ Works"
    passed = passed + 1
else:
    print "   ✗ Failed"
    failed = failed + 1

# Test 11: rt_package_remove_dir_all
print "{NL}11. rt_package_remove_dir_all"
if package_ffi.remove_dir_all("/tmp/ffi-test-dir"):
    print "   ✓ Works"
    passed = passed + 1
else:
    print "   ✗ Failed"
    failed = failed + 1

# Cleanup
package_ffi.remove_dir_all(extract_dir)

# Summary
print "{NL}=========================================="
print "Results: " + passed.to_string() + "/11 passed"
if failed == 0:
    print "✅ ALL 11 FFI FUNCTIONS WORKING!"
else:
    print "❌ " + failed.to_string() + " tests failed"
print "=========================================="
