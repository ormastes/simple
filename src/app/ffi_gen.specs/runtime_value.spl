# Runtime Value Module - Intern FFI Spec
#
# Declares RuntimeValue extern functions for the minimal FFI runtime.
# These functions provide the core value operations needed to replace
# the Rust runtime with FFI wrappers.
#
# Usage: simple ffi-gen --gen-intern src/app/ffi_gen/specs/runtime_value.spl

use app.ffi_gen.intern_codegen (InternFnSpec, InternParamSpec)

fn runtime_value_specs() -> [InternFnSpec]:
    var specs: [InternFnSpec] = []

    # =========================================================================
    # Constructors
    # =========================================================================

    specs.push(InternFnSpec(
        name: "value_nil", category: "runtime_value",
        params: [],
        return_type: "Value", runtime_fn: "rt_value_nil",
        doc: "Create a nil value"
    ))

    specs.push(InternFnSpec(
        name: "value_bool", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "bool")],
        return_type: "Value", runtime_fn: "rt_value_bool",
        doc: "Create a boolean value"
    ))

    specs.push(InternFnSpec(
        name: "value_int", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "i64")],
        return_type: "Value", runtime_fn: "rt_value_int",
        doc: "Create an integer value"
    ))

    specs.push(InternFnSpec(
        name: "value_float", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "f64")],
        return_type: "Value", runtime_fn: "rt_value_float",
        doc: "Create a float value"
    ))

    specs.push(InternFnSpec(
        name: "value_string", category: "runtime_value",
        params: [
            InternParamSpec(name: "ptr", value_type: "i64"),
            InternParamSpec(name: "len", value_type: "i64")
        ],
        return_type: "Value", runtime_fn: "rt_value_string",
        doc: "Create a string value from pointer and length"
    ))

    specs.push(InternFnSpec(
        name: "value_array_new", category: "runtime_value",
        params: [],
        return_type: "Value", runtime_fn: "rt_value_array_new",
        doc: "Create an empty array"
    ))

    specs.push(InternFnSpec(
        name: "value_dict_new", category: "runtime_value",
        params: [],
        return_type: "Value", runtime_fn: "rt_value_dict_new",
        doc: "Create an empty dictionary"
    ))

    # =========================================================================
    # Type Checking
    # =========================================================================

    specs.push(InternFnSpec(
        name: "value_is_nil", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "bool", runtime_fn: "rt_value_is_nil",
        doc: "Check if value is nil"
    ))

    specs.push(InternFnSpec(
        name: "value_is_bool", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "bool", runtime_fn: "rt_value_is_bool",
        doc: "Check if value is boolean"
    ))

    specs.push(InternFnSpec(
        name: "value_is_int", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "bool", runtime_fn: "rt_value_is_int",
        doc: "Check if value is integer"
    ))

    specs.push(InternFnSpec(
        name: "value_is_float", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "bool", runtime_fn: "rt_value_is_float",
        doc: "Check if value is float"
    ))

    specs.push(InternFnSpec(
        name: "value_is_string", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "bool", runtime_fn: "rt_value_is_string",
        doc: "Check if value is string"
    ))

    specs.push(InternFnSpec(
        name: "value_is_array", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "bool", runtime_fn: "rt_value_is_array",
        doc: "Check if value is array"
    ))

    specs.push(InternFnSpec(
        name: "value_is_dict", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "bool", runtime_fn: "rt_value_is_dict",
        doc: "Check if value is dictionary"
    ))

    # =========================================================================
    # Conversions
    # =========================================================================

    specs.push(InternFnSpec(
        name: "value_as_bool", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "bool", runtime_fn: "rt_value_as_bool",
        doc: "Convert value to boolean (truthiness)"
    ))

    specs.push(InternFnSpec(
        name: "value_as_int", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "i64", runtime_fn: "rt_value_as_int",
        doc: "Convert value to integer"
    ))

    specs.push(InternFnSpec(
        name: "value_as_float", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "f64", runtime_fn: "rt_value_as_float",
        doc: "Convert value to float"
    ))

    specs.push(InternFnSpec(
        name: "value_as_string", category: "runtime_value",
        params: [
            InternParamSpec(name: "value", value_type: "Value"),
            InternParamSpec(name: "out_len", value_type: "i64")
        ],
        return_type: "i64", runtime_fn: "rt_value_as_string",
        doc: "Get string pointer from value (writes length to out_len)"
    ))

    # =========================================================================
    # Arithmetic Operations
    # =========================================================================

    specs.push(InternFnSpec(
        name: "value_add", category: "runtime_value",
        params: [
            InternParamSpec(name: "left", value_type: "Value"),
            InternParamSpec(name: "right", value_type: "Value")
        ],
        return_type: "Value", runtime_fn: "rt_value_add",
        doc: "Add two values (int, float, or string concatenation)"
    ))

    specs.push(InternFnSpec(
        name: "value_sub", category: "runtime_value",
        params: [
            InternParamSpec(name: "left", value_type: "Value"),
            InternParamSpec(name: "right", value_type: "Value")
        ],
        return_type: "Value", runtime_fn: "rt_value_sub",
        doc: "Subtract two values"
    ))

    specs.push(InternFnSpec(
        name: "value_mul", category: "runtime_value",
        params: [
            InternParamSpec(name: "left", value_type: "Value"),
            InternParamSpec(name: "right", value_type: "Value")
        ],
        return_type: "Value", runtime_fn: "rt_value_mul",
        doc: "Multiply two values"
    ))

    specs.push(InternFnSpec(
        name: "value_div", category: "runtime_value",
        params: [
            InternParamSpec(name: "left", value_type: "Value"),
            InternParamSpec(name: "right", value_type: "Value")
        ],
        return_type: "Value", runtime_fn: "rt_value_div",
        doc: "Divide two values"
    ))

    # =========================================================================
    # Comparison
    # =========================================================================

    specs.push(InternFnSpec(
        name: "value_eq", category: "runtime_value",
        params: [
            InternParamSpec(name: "left", value_type: "Value"),
            InternParamSpec(name: "right", value_type: "Value")
        ],
        return_type: "bool", runtime_fn: "rt_value_eq",
        doc: "Check equality of two values"
    ))

    specs.push(InternFnSpec(
        name: "value_lt", category: "runtime_value",
        params: [
            InternParamSpec(name: "left", value_type: "Value"),
            InternParamSpec(name: "right", value_type: "Value")
        ],
        return_type: "bool", runtime_fn: "rt_value_lt",
        doc: "Check if left < right"
    ))

    # =========================================================================
    # Printing
    # =========================================================================

    specs.push(InternFnSpec(
        name: "value_print", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "()", runtime_fn: "rt_value_print",
        doc: "Print value to stdout (no newline)"
    ))

    specs.push(InternFnSpec(
        name: "value_println", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "()", runtime_fn: "rt_value_println",
        doc: "Print value to stdout with newline"
    ))

    # =========================================================================
    # Memory Management
    # =========================================================================

    specs.push(InternFnSpec(
        name: "value_free", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "()", runtime_fn: "rt_value_free",
        doc: "Free a value (when not using GC)"
    ))

    specs.push(InternFnSpec(
        name: "value_clone", category: "runtime_value",
        params: [InternParamSpec(name: "value", value_type: "Value")],
        return_type: "Value", runtime_fn: "rt_value_clone",
        doc: "Clone a value (shallow copy with Arc increment)"
    ))

    # =========================================================================
    # GC Functions
    # =========================================================================

    specs.push(InternFnSpec(
        name: "gc_init", category: "runtime_value",
        params: [],
        return_type: "()", runtime_fn: "rt_gc_init",
        doc: "Initialize garbage collector"
    ))

    specs.push(InternFnSpec(
        name: "gc_malloc", category: "runtime_value",
        params: [InternParamSpec(name: "size", value_type: "i64")],
        return_type: "i64", runtime_fn: "rt_gc_malloc",
        doc: "Allocate GC-managed memory"
    ))

    specs.push(InternFnSpec(
        name: "gc_collect", category: "runtime_value",
        params: [],
        return_type: "()", runtime_fn: "rt_gc_collect",
        doc: "Force garbage collection"
    ))

    specs
