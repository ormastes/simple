# Cargo Module - FFI Spec
#
# Cargo build system operations for the Simple runtime.
# Generates build/rust/ffi_gen/src/cargo.rs
#
# Usage: simple ffi-gen --gen-intern src/app/ffi_gen/specs/cargo.spl

use app.ffi_gen.intern_codegen (InternFnSpec, InternParamSpec)

fn cargo_specs() -> [InternFnSpec]:
    var specs: [InternFnSpec] = []

    # =========================================================================
    # Build Commands
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_cargo_build", category: "cargo",
        params: [InternParamSpec(name: "profile", value_type: "String"),
                 InternParamSpec(name: "features", value_type: "Value"),
                 InternParamSpec(name: "feature_count", value_type: "i64")],
        return_type: "Value", runtime_fn: "rt_cargo_build",
        doc: "Run cargo build, returns dict with success/stdout/stderr"
    ))

    specs.push(InternFnSpec(
        name: "rt_cargo_check", category: "cargo",
        params: [],
        return_type: "Value", runtime_fn: "rt_cargo_check",
        doc: "Run cargo check, returns dict with success/stdout/stderr"
    ))

    specs.push(InternFnSpec(
        name: "rt_cargo_clean", category: "cargo",
        params: [],
        return_type: "i64", runtime_fn: "rt_cargo_clean",
        doc: "Run cargo clean, returns exit code"
    ))

    # =========================================================================
    # Test Commands
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_cargo_test", category: "cargo",
        params: [InternParamSpec(name: "package", value_type: "String"),
                 InternParamSpec(name: "filter", value_type: "String")],
        return_type: "Value", runtime_fn: "rt_cargo_test",
        doc: "Run cargo test, returns dict with success/passed/failed"
    ))

    specs.push(InternFnSpec(
        name: "rt_cargo_test_doc", category: "cargo",
        params: [InternParamSpec(name: "package", value_type: "String")],
        return_type: "Value", runtime_fn: "rt_cargo_test_doc",
        doc: "Run cargo test --doc, returns dict"
    ))

    # =========================================================================
    # Quality Commands
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_cargo_lint", category: "cargo",
        params: [InternParamSpec(name: "fix", value_type: "i64")],
        return_type: "Value", runtime_fn: "rt_cargo_lint",
        doc: "Run cargo clippy (lint), fix=1 to auto-fix"
    ))

    specs.push(InternFnSpec(
        name: "rt_cargo_fmt", category: "cargo",
        params: [InternParamSpec(name: "check_only", value_type: "i64")],
        return_type: "Value", runtime_fn: "rt_cargo_fmt",
        doc: "Run cargo fmt, check_only=1 to only check"
    ))

    specs
