# Fault Detection Module - FFI Spec
#
# Fault detection and resource limits for the Simple runtime.
# Generates build/rust/ffi_gen/src/fault.rs
#
# Usage: simple ffi-gen --gen-intern src/app/ffi_gen/specs/fault.spl

use app.ffi_gen.intern_codegen (InternFnSpec, InternParamSpec)

fn fault_specs() -> [InternFnSpec]:
    var specs: [InternFnSpec] = []

    # =========================================================================
    # Stack Overflow Detection
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_fault_set_stack_overflow_detection", category: "fault",
        params: [InternParamSpec(name: "enabled", value_type: "bool")],
        return_type: "void", runtime_fn: "rt_fault_set_stack_overflow_detection",
        doc: "Enable/disable stack overflow detection"
    ))

    # =========================================================================
    # Recursion Limits
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_fault_set_max_recursion_depth", category: "fault",
        params: [InternParamSpec(name: "depth", value_type: "i64")],
        return_type: "void", runtime_fn: "rt_fault_set_max_recursion_depth",
        doc: "Set maximum recursion depth (0 = unlimited)"
    ))

    # =========================================================================
    # Execution Limits
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_fault_set_timeout", category: "fault",
        params: [InternParamSpec(name: "timeout_ms", value_type: "i64")],
        return_type: "void", runtime_fn: "rt_fault_set_timeout",
        doc: "Set execution timeout in milliseconds (0 = no timeout)"
    ))

    specs.push(InternFnSpec(
        name: "rt_fault_set_execution_limit", category: "fault",
        params: [InternParamSpec(name: "max_instructions", value_type: "i64")],
        return_type: "void", runtime_fn: "rt_fault_set_execution_limit",
        doc: "Set maximum instruction count (0 = unlimited)"
    ))

    specs
