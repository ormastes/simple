# FFI Wrapper Generator - Build Module
#
# Compiles the generated Rust wrapper crate using cargo.

use app.io.mod (process_run)

# ============================================================================
# Build Functions
# ============================================================================

# Build the generated wrapper crate
fn build_crate(crate_dir: text, verbose: bool) -> i64:
    var args = ["build", "--release", "--manifest-path", "{crate_dir}/Cargo.toml"]

    val result = process_run("cargo", args)
    val stdout = result.0
    val stderr = result.1
    val exit_code = result.2

    if verbose:
        if stdout != "":
            print stdout
        if stderr != "":
            print stderr

    if exit_code != 0:
        print "cargo build failed (exit code {exit_code}):"
        if stderr != "":
            print stderr

    exit_code
