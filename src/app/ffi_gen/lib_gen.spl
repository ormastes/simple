# FFI Wrapper Generator - lib.rs Generation
#
# Generates lib.rs files that re-export module contents.
#
# Usage:
#   import app.ffi_gen.lib_gen (generate_lib_rs)

use app.ffi_gen.types*

# ============================================================================
# lib.rs Generation
# ============================================================================

# Generate lib.rs content with module declarations and re-exports
fn generate_lib_rs(modules: [text], doc: text) -> text:
    var out = ""

    # Module-level doc comment (handle multi-line)
    if doc != "":
        for line in doc.split("\n"):
            if line.trim() != "":
                out = out + "//! {line}\n"
            else:
                out = out + "//!\n"
    else:
        out = out + "//! FFI Generated Crate\n"
        out = out + "//!\n"

    out = out + "//! Auto-generated by: simple ffi-gen --gen-all\n"
    out = out + "//! Do not edit manually.\n"
    out = out + "\n"

    # Module declarations
    for mod_name in modules:
        out = out + "pub mod {mod_name};\n"

    if modules.len() > 0:
        out = out + "\n"

    # Re-exports
    for mod_name in modules:
        out = out + "pub use {mod_name}::*;\n"

    out

# Generate lib.rs with conditional compilation
fn generate_lib_rs_conditional(modules: [{text: text}]) -> text:
    var out = ""
    out = out + "//! FFI Generated Crate\n"
    out = out + "//!\n"
    out = out + "//! Auto-generated by: simple ffi-gen --gen-all\n"
    out = out + "//! Do not edit manually.\n"
    out = out + "\n"

    # Module declarations with optional feature gates
    for entry in modules:
        for mod_name in entry.keys():
            val feature = entry[mod_name]
            if feature != "":
                out = out + "#[cfg(feature = \"{feature}\")]\n"
            out = out + "pub mod {mod_name};\n"

    out = out + "\n"

    # Re-exports with optional feature gates
    for entry in modules:
        for mod_name in entry.keys():
            val feature = entry[mod_name]
            if feature != "":
                out = out + "#[cfg(feature = \"{feature}\")]\n"
            out = out + "pub use {mod_name}::*;\n"

    out

# Generate lib.rs for the Simple FFI crate
fn generate_simple_ffi_lib() -> text:
    val modules = ["runtime_value", "gc", "bootstrap_ffi"]
    generate_lib_rs(modules, "Simple Runtime FFI\n\nGenerated FFI wrappers for the Simple language runtime.")
