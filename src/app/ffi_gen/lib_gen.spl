# FFI Wrapper Generator - lib.rs Generation
#
# Generates lib.rs files that re-export module contents.
#
# Usage:
#   import app.ffi_gen.lib_gen (generate_lib_rs)

use app.ffi_gen.types*
use std.text.{NL}

# ============================================================================
# lib.rs Generation
# ============================================================================

# Generate lib.rs content with module declarations and re-exports
fn generate_lib_rs(modules: [text], doc: text) -> text:
    var out = ""

    # Module-level doc comment (handle multi-line)
    if doc != "":
        for line in doc.split(NL):
            if line.trim() != "":
                out = out + "//! {line}{NL}"
            else:
                out = out + "//!{NL}"
    else:
        out = out + "//! FFI Generated Crate{NL}"
        out = out + "//!{NL}"

    out = out + "//! Auto-generated by: simple ffi-gen --gen-all{NL}"
    out = out + "//! Do not edit manually.{NL}"
    out = out + NL

    # Module declarations
    for mod_name in modules:
        out = out + "pub mod {mod_name};{NL}"

    if modules.len() > 0:
        out = out + NL

    # Re-exports
    for mod_name in modules:
        out = out + "pub use {mod_name}::*;{NL}"

    out

# Generate lib.rs with conditional compilation
fn generate_lib_rs_conditional(modules: [{text: text}]) -> text:
    var out = ""
    out = out + "//! FFI Generated Crate{NL}"
    out = out + "//!{NL}"
    out = out + "//! Auto-generated by: simple ffi-gen --gen-all{NL}"
    out = out + "//! Do not edit manually.{NL}"
    out = out + NL

    # Module declarations with optional feature gates
    for entry in modules:
        for mod_name in entry.keys():
            val feature = entry[mod_name]
            if feature != "":
                out = out + "#[cfg(feature = \"{feature}\")]{NL}"
            out = out + "pub mod {mod_name};{NL}"

    out = out + NL

    # Re-exports with optional feature gates
    for entry in modules:
        for mod_name in entry.keys():
            val feature = entry[mod_name]
            if feature != "":
                out = out + "#[cfg(feature = \"{feature}\")]{NL}"
            out = out + "pub use {mod_name}::*;{NL}"

    out

# Generate lib.rs for the Simple FFI crate
fn generate_simple_ffi_lib() -> text:
    val modules = ["runtime_value", "gc", "bootstrap_ffi"]
    generate_lib_rs(modules, "Simple Runtime FFI{NL}{NL}Generated FFI wrappers for the Simple language runtime.")
