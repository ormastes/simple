# Process Module - Intern FFI Spec
#
# Declares process control extern functions for auto-generation of
# interpreter_extern/process.rs boilerplate.
#
# Usage: simple ffi-gen --gen-intern src/app/ffi_gen/specs/process.spl

use app.ffi_gen.intern_codegen (InternFnSpec, InternParamSpec)

fn process_specs() -> [InternFnSpec]:
    var specs: [InternFnSpec] = []

    # =========================================================================
    # Process Control
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_exit", category: "process",
        params: [InternParamSpec(name: "code", value_type: "i64")],
        return_type: "void", runtime_fn: "rt_exit",
        doc: "Exit process with given exit code"
    ))

    specs.push(InternFnSpec(
        name: "rt_panic", category: "process",
        params: [InternParamSpec(name: "message", value_type: "String")],
        return_type: "void", runtime_fn: "rt_panic",
        doc: "Panic with error message and abort"
    ))

    specs.push(InternFnSpec(
        name: "rt_abort", category: "process",
        params: [],
        return_type: "void", runtime_fn: "rt_abort",
        doc: "Abort process immediately"
    ))

    specs.push(InternFnSpec(
        name: "rt_pid", category: "process",
        params: [],
        return_type: "i64", runtime_fn: "rt_pid",
        doc: "Get current process ID"
    ))

    # =========================================================================
    # Subprocess Execution
    # =========================================================================

    specs.push(InternFnSpec(
        name: "rt_exec", category: "process",
        params: [InternParamSpec(name: "command", value_type: "String")],
        return_type: "i64", runtime_fn: "rt_exec",
        doc: "Execute shell command and return exit code"
    ))

    specs.push(InternFnSpec(
        name: "rt_exec_output", category: "process",
        params: [InternParamSpec(name: "command", value_type: "String")],
        return_type: "String", runtime_fn: "rt_exec_output",
        doc: "Execute shell command and return stdout as string"
    ))

    specs.push(InternFnSpec(
        name: "rt_exec_with_args", category: "process",
        params: [InternParamSpec(name: "program", value_type: "String"),
                 InternParamSpec(name: "args", value_type: "Value")],
        return_type: "i64", runtime_fn: "rt_exec_with_args",
        doc: "Execute program with arguments and return exit code"
    ))

    specs.push(InternFnSpec(
        name: "rt_exec_output_with_args", category: "process",
        params: [InternParamSpec(name: "program", value_type: "String"),
                 InternParamSpec(name: "args", value_type: "Value")],
        return_type: "String", runtime_fn: "rt_exec_output_with_args",
        doc: "Execute program with arguments and return stdout"
    ))

    specs
