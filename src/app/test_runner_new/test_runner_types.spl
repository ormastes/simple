# Test Runner Type Definitions
#
# Core types used throughout the test runner.

use app.io.mod (dir_walk, path_basename, process_run, process_run_timeout, process_run_with_limits, file_exists, file_read, file_write, file_append, time_now_unix_micros, env_set, env_get)

# =========================================================================
# Execution Mode
# =========================================================================

enum TestExecutionMode:
    Interpreter
    Smf
    Native

# =========================================================================
# Test Level Filter
# =========================================================================

enum TestLevel:
    All
    Unit
    Integration
    System

# =========================================================================
# Output Format
# =========================================================================

enum OutputFormat:
    Default
    Doc

# =========================================================================
# Test Options
# =========================================================================

struct TestOptions:
    path: text
    level: TestLevel
    tag: text
    fail_fast: bool
    mode: TestExecutionMode
    timeout: i64
    list: bool
    list_ignored: bool
    only_slow: bool
    only_skipped: bool
    show_tags: bool
    gc_log: bool
    gc_off: bool
    seed: i64
    has_seed: bool
    safe_mode: bool
    force_rebuild: bool
    keep_artifacts: bool
    run_all: bool
    format: OutputFormat
    list_skip_features: bool
    planned_only: bool
    no_limits: bool
    sdoctest: bool
    sdoctest_env: text
    sdoctest_force: bool
    no_db: bool

# =========================================================================
# Test File Result
# =========================================================================

struct TestFileResult:
    path: text
    passed: i64
    failed: i64
    skipped: i64
    pending: i64
    duration_ms: i64
    error: text
    timed_out: bool

impl TestFileResult:
    fn is_ok() -> bool:
        self.failed == 0 and self.error == "" and not self.timed_out

# =========================================================================
# Test Run Result
# =========================================================================

struct TestRunResult:
    files: [TestFileResult]
    total_passed: i64
    total_failed: i64
    total_skipped: i64
    total_pending: i64
    total_timed_out: i64
    total_duration_ms: i64

impl TestRunResult:
    fn is_ok() -> bool:
        self.total_failed == 0 and self.total_timed_out == 0

# =========================================================================
# Skip Feature Info
# =========================================================================

struct SkipFeatureInfo:
    file_path: text
    title: text
    feature_ids: text
    category: text
    status: text

# =========================================================================
# Exports
# =========================================================================

export TestExecutionMode
export TestLevel
export OutputFormat
export TestOptions
export TestFileResult
export TestRunResult
export SkipFeatureInfo
