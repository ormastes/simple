# Simple Test Runner (Written in Simple)
#
# Refactored into modules for maintainability.
# See test_runner_*.spl files for implementation details.
#
# Usage:
#   simple_old src/app/test_runner_new/main.spl [path] [options]
#
# Options:
#   --unit              Run unit tests only
#   --integration       Run integration tests only
#   --system            Run system tests only
#   --fail-fast         Stop on first failure
#   --tag <name>        Filter by tag
#   --mode <mode>       Execution mode: interpreter (default), smf, native
#   --mode=<mode>       Equals syntax also supported
#   --timeout <secs>    Timeout per test file (default: 120)
#   --list              List test files without running
#   --list-ignored      List ignored tests
#   --only-slow         Run only slow tests
#   --only-skipped      Run only skipped tests
#   --show-tags         Show tags in output
#   --seed <N>          Shuffle tests deterministically
#   --safe-mode/--safe  Run in safe mode (subprocess, already default)
#   --force-rebuild     Force rebuild cached artifacts
#   --keep-artifacts    Keep compiled artifacts after run
#   --all               Run all tests including slow
#   --format doc        Nested RSpec-style output
#   --list-skip-features  List features from .skip files
#   --planned-only/--pending  Filter skip features to planned only
#   --coverage           Enable branch/condition coverage tracking
#   --gc-log            Enable GC logging
#   --gc=off            Disable GC

# Import all modules
use test_runner_types.*
use test_runner_args.*
use test_runner_files.*
use test_runner_execute.*
use test_runner_output.*
use test_runner_db.*
use test_runner_main.*

# New modules (Phase: Rust-to-Simple migration)
use test_db_types.*
use test_db_compat.*  # Compatibility layer for unified database
use test_config.*
use test_runner_parallel.*
use lib.database.feature.*  # Using unified feature database
use doc_generator.*
use doctest_runner.*
use rust_test_runner.*
use sdoctest.mod.*
use test_runner_coverage.*

# NOTE: The following modules are now replaced by unified database libraries:
# - string_interner → lib.database.test_extended.StringInterner
# - test_db_lock → lib.database.mod (atomic operations in SdnDatabase)
# - test_db_io → lib.database.mod (persistence in SdnDatabase)
# - test_db_parser → lib.database.mod (SDN parsing in SdnDatabase)
# - test_db_serializer → lib.database.mod (SDN serialization in SdnDatabase)
# - test_db_core → test_db_compat (wraps lib.database.test_extended)
# - test_stats → lib.database.stats
# - test_db_validation → integrated in lib.database.test_extended
# - feature_db → lib.database.feature

# Re-export all public APIs
# Types
export TestExecutionMode, TestLevel, OutputFormat
export TestOptions, TestFileResult, TestRunResult
export SkipFeatureStatus, SkipFeatureInfo

# Args module
export parse_mode_str, parse_test_args

# Files module
export discover_test_files, shuffle_files
export extract_skip_feature_info, file_has_slow_test
export print_discovery_summary, is_test_file, strip_ansi, read_file_content

# Execute module
export find_simple_new_binary, find_runtime_lib_dir, find_simple_binary
export parse_test_output, extract_number_before
export build_child_args, make_result_from_output
export run_test_file_interpreter, run_test_file_smf
export run_test_file_native_old, run_test_file_native
export preprocess_sspec_file
export run_test_file_safe_mode
export list_tests_static

# Output module
export print_result_default, print_result_doc
export print_result, print_summary

# DB module (using unified libraries)
export TestDatabase  # From test_db_compat (wraps lib.database.test_extended)
export FeatureDatabase, Feature, FeatureStatus  # From lib.database.feature

# Validation module
export ValidationIssue, validate_database
export needs_qualification, count_unqualified_ignores

# Config module
export TestConfig, find_config_file

# Parallel execution
export ParallelConfig, run_tests_parallel

# Doc generation
export generate_all_docs

# Doctest
export extract_doctests, run_doctests

# Rust tests
export run_rust_tests, run_rust_doc_tests

# SDoctest
export SdoctestConfig, SdoctestBlock, SdoctestRunResult
export load_sdoctest_config, run_sdoctest_mode, print_sdoctest_summary
export extract_sdoctest_blocks, discover_sdoctest_files
export write_sdoctest_db, generate_sdoctest_report
export glob_match_path

# Coverage
export FileCoverage, CoverageData
export setup_coverage, collect_coverage
export print_coverage_summary, generate_coverage_reports
export check_coverage_threshold, get_coverage_threshold
export save_coverage_baseline, load_coverage_baseline, print_coverage_delta

# Main orchestration
export propagate_env_vars, run_tests, mode_to_str, run_single_test
export update_test_database
export main
