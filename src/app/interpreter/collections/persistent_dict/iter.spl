# Persistent Dictionary Iterator
#
# Iterator for traversing persistent dictionary entries.

use app.interpreter.collections.persistent_dict.node.{HamtNode}

struct PersistentDictIter<K, V>:
    """Iterator over PersistentDict entries."""
    entries: [(K, V)]
    index: i64

impl PersistentDictIter<K, V>:
    static fn new(dict: PersistentDict<K, V>) -> PersistentDictIter<K, V>:
        PersistentDictIter(
            entries: dict.entries(),
            index: 0
        )

    fn next() -> (K, V)?:
        if self.index >= self.entries.len():
            None
        else:
            val entry = self.entries[self.index]
            self.index = self.index + 1
            Some(entry)

    fn has_next() -> bool:
        self.index < self.entries.len()

impl Iterable<(K, V)> for PersistentDict<K, V>:
    fn iter() -> PersistentDictIter<K, V>:
        PersistentDictIter.new(self)


export PersistentDictIter
