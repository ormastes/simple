# Network HTTP Extern Functions
#
# HTTP networking operations.
# Split from network.spl for modularity.
#
# Provides Simple wrappers for HTTP operations with proper error handling.

from ..core import {Value, InterpreterError}

export http_send

#==============================================================================
# FFI Declarations - Call into Rust runtime (HTTP)
#==============================================================================

@extern("native_http_send_interp")
fn rt_http_send(method: Value, url: text, body: Value, timeout_ns: i64) -> Value

#==============================================================================
# HTTP Wrapper Functions
#==============================================================================

fn http_send(args: [Value]) -> Result<Value, InterpreterError>:
    """Send HTTP request.

    Args:
        method: HTTP method as string or enum (GET/POST/PUT/DELETE/etc.)
        url: URL as string
        body: Optional request body (byte array or string)
        timeout_ns: Optional timeout in nanoseconds

    Returns:
        Result<HttpResponse{status, body}, IoError>
    """
    if args.len() < 2:
        return Err(InterpreterError.ArityError("http_send expects at least 2 arguments"))

    val method = args[0]  # Can be string or enum
    val url = args[1].as_str() ?? return Err(InterpreterError.TypeError("http_send expects string URL"))
    val body = if args.len() > 2: args[2] else: Value.nil()
    val timeout = if args.len() > 3: args[3].as_int() ?? 0 else: 0

    Ok(rt_http_send(method, url, body, timeout))
