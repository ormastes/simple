# Layout Profiling Extern Functions
#
# Functions for marking execution phases for 4KB page locality optimization.
# Port of rust/compiler/src/interpreter_extern/layout.rs

from ..core import {Value, InterpreterError}

export simple_layout_mark_extern

@extern("simple_layout_mark")
fn _layout_mark(marker: text)

fn simple_layout_mark_extern(args: [Value]) -> Result<Value, InterpreterError>:
    if args.len() != 1:
        return Err(InterpreterError.ArityError("simple_layout_mark expects 1 argument"))
    val marker = match args[0].type_name():
        case "String": args[0].as_string() ?? ""
        case "Symbol": args[0].as_string() ?? ""
        case _: return Err(InterpreterError.TypeError(
            "simple_layout_mark expects a string or symbol argument"))
    _layout_mark(marker)
    Ok(Value.nil())
