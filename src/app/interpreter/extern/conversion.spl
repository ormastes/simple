# Type Conversion Extern Functions
#
# Provides conversion between Simple language types (int, string, bool).
# Port of rust/compiler/src/interpreter_extern/conversion.rs

from ..core import {Value, InterpreterError}

export to_string_extern, to_int_extern

# Convert a value to string representation
fn to_string_extern(args: [Value]) -> Result<Value, InterpreterError>:
    if args.len() != 1:
        return Err(InterpreterError.ArityError("to_string expects 1 argument"))
    Ok(Value.string(args[0].to_display_string()))

# Convert a value to integer
# Supports: Int→Int, String→Int (parse), Bool→Int (true=1, false=0)
fn to_int_extern(args: [Value]) -> Result<Value, InterpreterError>:
    if args.len() != 1:
        return Err(InterpreterError.ArityError("to_int expects 1 argument"))
    val v = args[0]
    match v.type_name():
        case "Int":
            Ok(v)
        case "String":
            val s = v.as_string() ?? ""
            val parsed = s.parse_int()
            if parsed.?:
                Ok(Value.int(parsed.unwrap()))
            else:
                Err(InterpreterError.TypeError("cannot convert '{s}' to int"))
        case "Bool":
            Ok(Value.int(if v.is_truthy(): 1 else: 0))
        case _:
            Err(InterpreterError.TypeError("to_int expects string, int, or bool"))
