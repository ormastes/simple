# Configuration System
# Hierarchical configuration management with Simple-syntax config files

pub use Config, from_dict, merge
pub use from_file, from_hierarchy, parse_config_file from loader

class Config:
    """Configuration wrapper around dictionary data."""
    _data: any

    fn __init__(data: any):
        self._data = data

    fn get(path: str) -> Option<any>:
        """Get value at dotted path like 'train.epochs'

        Returns:
            Some(value) if path exists, None otherwise

        Example:
            val cfg = from_dict({"train": {"epochs": 10}})
            match cfg.get("train.epochs"):
                case Some(val): print(val)  # 10
                case None: print("not found")
        """
        if "." in path:
            val parts = path.split(".")
            var current = self._data
            for part in parts:
                if part in current:
                    current = current[part]
                else:
                    return None
            return Some(current)
        else:
            if path in self._data:
                return Some(self._data[path])
            return None


# ============================================================================
# Module-level functions
# ============================================================================

fn from_dict(data: any) -> Config:
    """Create config from dictionary.

    Args:
        data: Dictionary to convert

    Returns:
        Config object

    Example:
        val cfg = from_dict({"epochs": 10, "lr": 0.001})
        match cfg.get("epochs"):
            case Some(val): print(val)  # 10
            case None: print("not found")
    """
    return Config(data)


fn merge(base: Config, overlay: Config) -> Config:
    """Merge two configs (overlay overrides base).

    Args:
        base: Base config
        overlay: Override config

    Returns:
        Merged config

    Example:
        val base = from_dict({"a": 1, "b": 2})
        val over = from_dict({"b": 3, "c": 4})
        val merged = merge(base, over)  # {a: 1, b: 3, c: 4}
    """
    var merged = {}

    # Copy base
    for (key, value) in base._data.items():
        merged.set(key, value)

    # Overlay second config
    for (key, value) in overlay._data.items():
        merged.set(key, value)

    return Config(merged)
