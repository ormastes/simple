# Matcher Protocol
# Base interface for all matchers (RSpec-aligned)

# Match result returned by matchers
class MatchResult:
    matched: bool
    failure_message: text
    negated_failure_message: text

impl MatchResult:
    fn new(matched: bool, failure_message: text, negated_failure_message: text) -> MatchResult:
        return MatchResult {
            matched: matched,
            failure_message: failure_message,
            negated_failure_message: negated_failure_message
        }

    fn success() -> MatchResult:
        return MatchResult.new(true, "", "")

    fn failure(message: text) -> MatchResult:
        return MatchResult.new(false, message, "")

    # =========================================================================
    # Helper Methods
    # =========================================================================

    fn is_success() -> bool:
        """Check if match was successful."""
        return self.matched

    fn is_failure() -> bool:
        """Check if match failed."""
        return not self.matched

    fn has_failure_message() -> bool:
        """Check if failure message is set."""
        return not self.failure_message.is_empty()

    fn has_negated_failure_message() -> bool:
        """Check if negated failure message is set."""
        return not self.negated_failure_message.is_empty()

    fn get_message(negated: bool) -> text:
        """Get appropriate message based on negation."""
        if negated:
            return self.negated_failure_message
        else:
            return self.failure_message

    fn with_failure_message(message: text) -> MatchResult:
        """Create new result with updated failure message."""
        return MatchResult.new(self.matched, message, self.negated_failure_message)

    fn with_negated_message(message: text) -> MatchResult:
        """Create new result with updated negated failure message."""
        return MatchResult.new(self.matched, self.failure_message, message)

    fn negate() -> MatchResult:
        """Create negated version of this result."""
        return MatchResult.new(not self.matched, self.negated_failure_message, self.failure_message)

    fn summary() -> text:
        """Get summary of match result."""
        val status = if self.is_success(): "success" else: "failure"
        val msg = if self.is_failure() and self.has_failure_message(): " - {self.failure_message}" else: ""
        return "MatchResult: {status}{msg}"

# Matcher interface
trait Matcher<T>:
    fn matches(actual: T) -> MatchResult

pub use MatchResult, Matcher
