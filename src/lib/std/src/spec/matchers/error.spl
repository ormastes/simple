# Error Matchers - raise_error
# Exception and error handling matchers

import matchers.{Matcher, MatchResult}

# Raise error matcher: expect_raises ValueError: ...
class RaiseErrorMatcher:
    expected_type: Option<Type>
    expected_message: Option<text>

impl RaiseErrorMatcher:
    fn new(expected_type: Option<Type>, expected_message: Option<text>) -> RaiseErrorMatcher:
        return RaiseErrorMatcher {
            expected_type: expected_type,
            expected_message: expected_message
        }

impl Matcher for RaiseErrorMatcher:
    fn matches(actual: Option<Error>) -> MatchResult:
        match actual:
            case None:
                return MatchResult.failure("Expected an error to be raised but nothing was raised")
            case Some(error):
                # Check type if specified
                if val Some(typ) = self.expected_type:
                    if not error is typ:
                        return MatchResult.failure(
                            "Expected {typ} but got {error.type}"
                        )

                # Check message if specified
                if val Some(msg) = self.expected_message:
                    if error.message != msg:
                        return MatchResult.failure(
                            "Expected message '{msg}' but got '{error.message}'"
                        )

                return MatchResult.success()

fn raise_error(expected_type: Option<Type>, message: Option<text>) -> RaiseErrorMatcher:
    return RaiseErrorMatcher.new(expected_type, message)
