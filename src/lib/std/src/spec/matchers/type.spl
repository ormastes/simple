# Type Matchers - be_instance_of, be_a, be_an, be_option, be_result
# Type checking matchers for verifying value types

import matchers.{Matcher, MatchResult}

# Option matcher - checks if value is an Option (Some or None)
class BeOptionMatcher:
    _dummy: bool

impl BeOptionMatcher:
    fn new() -> BeOptionMatcher:
        return BeOptionMatcher { _dummy: false }

impl Matcher for BeOptionMatcher:
    fn matches(actual: Option<Any>) -> MatchResult:
        # Any Option<T> value (Some or None) is valid
        return MatchResult.success()

fn be_option() -> BeOptionMatcher:
    return BeOptionMatcher.new()

# Result matcher - checks if value is a Result (Ok or Err)
class BeResultMatcher:
    _dummy: bool

impl BeResultMatcher:
    fn new() -> BeResultMatcher:
        return BeResultMatcher { _dummy: false }

impl Matcher for BeResultMatcher:
    fn matches(actual: Result<Any, Any>) -> MatchResult:
        # Any Result<T, E> value (Ok or Err) is valid
        return MatchResult.success()

fn be_result() -> BeResultMatcher:
    return BeResultMatcher.new()

# Generic type checking class that stores expected type name
class BeInstanceOfMatcher:
    type_name: text

impl BeInstanceOfMatcher:
    fn new(type_name: text) -> BeInstanceOfMatcher:
        return BeInstanceOfMatcher { type_name: type_name }

# Factory function for be_instance_of
# Works with type expressions: be_instance_of(Option), be_instance_of(Result)
# The type is converted to its string name for comparison
fn be_instance_of(type_expr: Any) -> BeInstanceOfMatcher:
    # Convert type expression to string for comparison
    # This is a placeholder - actual type checking depends on interpreter support
    return BeInstanceOfMatcher.new("type")

# Overload for common types - these provide direct matching
# Usage: expect(opt_value).to(be_instance_of(Option))
#        expect(res_value).to(be_instance_of(Result))

# Aliases for natural language
fn be_a(type_name: text) -> BeInstanceOfMatcher:
    return BeInstanceOfMatcher.new(type_name)

fn be_an(type_name: text) -> BeInstanceOfMatcher:
    return BeInstanceOfMatcher.new(type_name)

export be_instance_of, be_a, be_an, be_option, be_result
export BeInstanceOfMatcher, BeOptionMatcher, BeResultMatcher
