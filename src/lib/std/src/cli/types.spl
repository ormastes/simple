# CLI Types - Argument specification types

export ArgType, ArgSpec

# Argument types
pub enum ArgType:
    Flag          # Boolean flag
    Option        # text option
    Positional    # Positional string
    FileOption    # File option (auto-staged)
    FilePositional # File positional (auto-staged)

impl ArgType:
    # =========================================================================
    # Helper Methods
    # =========================================================================

    pub fn to_string(self) -> text:
        """Convert argument type to string."""
        match self:
            case Flag: return "Flag"
            case Option: return "Option"
            case Positional: return "Positional"
            case FileOption: return "FileOption"
            case FilePositional: return "FilePositional"

    pub fn description(self) -> text:
        """Get detailed description of argument type."""
        match self:
            case Flag: return "Boolean flag"
            case Option: return "text option"
            case Positional: return "Positional string argument"
            case FileOption: return "File option (auto-staged)"
            case FilePositional: return "File positional argument (auto-staged)"

    pub fn is_flag(self) -> bool:
        """Check if this is a Flag type."""
        match self:
            case Flag: true
            case _: false

    pub fn is_option(self) -> bool:
        """Check if this is an Option type."""
        match self:
            case Option: true
            case _: false

    pub fn is_positional(self) -> bool:
        """Check if this is a Positional type."""
        match self:
            case Positional: true
            case _: false

    pub fn is_file_option(self) -> bool:
        """Check if this is a FileOption type."""
        match self:
            case FileOption: true
            case _: false

    pub fn is_file_positional(self) -> bool:
        """Check if this is a FilePositional type."""
        match self:
            case FilePositional: true
            case _: false

    pub fn is_file_type(self) -> bool:
        """Check if this is a file-related type (FileOption or FilePositional)."""
        match self:
            case FileOption: true
            case FilePositional: true
            case _: false

    pub fn requires_value(self) -> bool:
        """Check if this argument type requires a value."""
        match self:
            case Flag: false
            case _: true

    pub fn summary(self) -> text:
        """Get argument type summary.

        Returns:
            Human-readable summary

        Example:
            ArgType::FileOption.summary()
            # â†’ "ArgType: FileOption (File option (auto-staged), requires value, file type)"
        """
        val name = self.to_string()
        val desc = self.description()
        var props = []

        if self.requires_value():
            props.push("requires value")
        else:
            props.push("no value")

        if self.is_file_type():
            props.push("file type")

        val props_str = props.join(", ")
        return "ArgType: {name} ({desc}, {props_str})"

# Argument specification
pub struct ArgSpec:
    name: text
    short: Option<text>
    long: text
    help: text
    required: bool
    default_value: Option<text>
    arg_type: ArgType
    # File-specific options
    auto_stage: bool
    must_exist: bool
    must_be_readable: bool
    must_be_writable: bool
    allowed_extensions: Array<text>

impl ArgSpec:
    # =========================================================================
    # Helper Methods
    # =========================================================================

    pub fn has_short(self) -> bool:
        """Check if has short name."""
        return self.short.is_some()

    pub fn has_default(self) -> bool:
        """Check if has default value."""
        return self.default_value.is_some()

    pub fn is_required(self) -> bool:
        """Check if argument is required."""
        return self.required

    pub fn is_optional(self) -> bool:
        """Check if argument is optional."""
        return not self.required

    pub fn is_file_type(self) -> bool:
        """Check if this is a file argument type."""
        return self.arg_type.is_file_type()

    pub fn is_auto_stage_enabled(self) -> bool:
        """Check if auto-staging is enabled."""
        return self.auto_stage

    pub fn has_existence_check(self) -> bool:
        """Check if file must exist."""
        return self.must_exist

    pub fn has_read_check(self) -> bool:
        """Check if file must be readable."""
        return self.must_be_readable

    pub fn has_write_check(self) -> bool:
        """Check if file must be writable."""
        return self.must_be_writable

    pub fn has_extension_restrictions(self) -> bool:
        """Check if has extension restrictions."""
        return self.allowed_extensions.len() > 0

    pub fn extension_count(self) -> usize:
        """Get count of allowed extensions."""
        return self.allowed_extensions.len()

    pub fn allows_extension(self, ext: text) -> bool:
        """Check if extension is allowed."""
        if self.allowed_extensions.len() == 0:
            return true  # No restrictions
        for allowed in &self.allowed_extensions:
            if allowed == ext:
                return true
        return false

    pub fn summary(self) -> text:
        """Get summary of argument spec."""
        val req = if self.required: "required" else: "optional"
        val short_str = if self.has_short(): " (-{self.short.unwrap()})" else: ""
        return "ArgSpec: --{self.long}{short_str}, {self.arg_type.to_string()}, {req}"
