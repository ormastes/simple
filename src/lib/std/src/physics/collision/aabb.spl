"""Axis-Aligned Bounding Box (AABB) collision detection.

This module provides the AABB class for broad-phase collision detection.
AABBs are simple rectangular volumes aligned with coordinate axes.

Example:
    ```simple
    import physics.collision.aabb as aabb
    import physics.core as core

    val box1 = aabb.AABB(
        core.Vector3(0, 0, 0),
        core.Vector3(10, 10, 10)
    )
    val box2 = aabb.AABB.from_center_size(
        core.Vector3(5, 5, 5),
        core.Vector3(8, 8, 8)
    )

    if box1.intersects(box2):
        io.println("Boxes overlap!")
    ```
"""

export AABB

use ..core as core


# ============================================================================
# AABB - Axis-Aligned Bounding Box
# ============================================================================

class AABB:
    """Axis-Aligned Bounding Box for broad-phase collision detection.

    An AABB is defined by two corner points: minimum and maximum.
    All edges are parallel to the coordinate axes. This makes intersection
    tests very fast, making AABBs ideal for broad-phase collision detection.

    Attributes:
        min: Minimum corner (lowest x, y, z values)
        max: Maximum corner (highest x, y, z values)
    """
    min: core.Vector3
    max: core.Vector3
    fn __init__(min: core.Vector3, max: core.Vector3):
        """Initialize AABB with min and max corners.

        Args:
            min: Minimum corner
            max: Maximum corner

        Raises:
            Assertion error if min >= max on any axis
        """
        self.min = min
        self.max = max

    static fn from_center_size(center: core.Vector3, size: core.Vector3) -> AABB:
        """Create AABB from center point and size.

        Creates a box centered at the given point with the specified size.

        Args:
            center: Center point of the box
            size: Size vector (full width, height, depth on each axis)

        Returns:
            AABB instance

        Example:
            ```simple
            # Create a 10x10x10 box centered at origin
            val box = AABB.from_center_size(
                Vector3(0, 0, 0),
                Vector3(10, 10, 10)
            )
            ```
        """
        val half_size = size.scale(0.5)
        return AABB(
            center.sub(half_size),
            center.add(half_size)
        )
    fn intersects(other: AABB) -> bool:
        """Check if this AABB intersects another.

        Uses the separating axis theorem (SAT). Two AABBs intersect if and only if
        they overlap on all three axes. Complexity: O(1).

        Args:
            other: Other AABB to test against

        Returns:
            True if AABBs overlap on all axes, false otherwise

        Example:
            ```simple
            if box1.intersects(box2):
                # Handle collision
            ```
        """
        # Check for separation on each axis
        if self.max.x < other.min.x or self.min.x > other.max.x:
            return false
        if self.max.y < other.min.y or self.min.y > other.max.y:
            return false
        if self.max.z < other.min.z or self.min.z > other.max.z:
            return false

        return true
    fn contains_point(point: core.Vector3) -> bool:
        """Check if a point is inside this AABB.

        Point is considered inside if it's within the min/max bounds (inclusive).
        Complexity: O(1).

        Args:
            point: Point to test

        Returns:
            True if point is inside AABB, false otherwise

        Example:
            ```simple
            if box.contains_point(Vector3(5, 5, 5)):
                # Point is inside the box
            ```
        """
        return (
            point.x >= self.min.x and point.x <= self.max.x and
            point.y >= self.min.y and point.y <= self.max.y and
            point.z >= self.min.z and point.z <= self.max.z
        )
    fn center() -> core.Vector3:
        """Get the center point of this AABB.

        Calculates the midpoint between min and max corners.

        Returns:
            Center point of the AABB

        Example:
            ```simple
            val c = box.center()
            ```
        """
        return core.Vector3(
            (self.min.x + self.max.x) * 0.5,
            (self.min.y + self.max.y) * 0.5,
            (self.min.z + self.max.z) * 0.5
        )
    fn size() -> core.Vector3:
        """Get the size (extent) of this AABB.

        Calculates the dimensions on each axis.

        Returns:
            Size vector with width, height, depth

        Example:
            ```simple
            val s = box.size()
            io.println("Width: " + s.x.to_string())
            ```
        """
        return self.max.sub(self.min)
