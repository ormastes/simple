# SpatialHashGrid - Test Interface for Spatial Hashing

export SpatialHashGrid

from .aabb import AABB

class SpatialHashGrid:
    """Spatial hash grid for broad-phase collision detection (test interface)."""
    cell_size: f64
    objects: {i64: AABB}

    fn __init__(cell_size: f64 = 1.0):
        """Initialize spatial hash grid."""
        self.cell_size = cell_size
        self.objects = {}

    fn num_objects() -> i64:
        """Get number of objects in grid."""
        return self.objects.len() as i64

    fn insert(object_id: i64, aabb: AABB):
        """Insert object with AABB."""
        self.objects[object_id] = aabb

    fn remove(object_id: i64):
        """Remove object from grid."""
        if object_id in self.objects:
            self.objects.pop(object_id)

    fn update(object_id: i64, aabb: AABB):
        """Update object's AABB."""
        self.objects[object_id] = aabb

    fn query(aabb: AABB) -> [i64]:
        """Query objects overlapping AABB."""
        var results = []
        for (obj_id, obj_aabb) in self.objects.items():
            if aabb.intersects(obj_aabb):
                results.append(obj_id)
        return results

    fn get_collision_pairs() -> [(i64, i64)]:
        """Get all potentially colliding pairs."""
        var pairs = []
        val ids = self.objects.keys()
        for i in range(ids.len()):
            for j in range(i + 1, ids.len()):
                val id1 = ids[i]
                val id2 = ids[j]
                val aabb1 = self.objects[id1]
                val aabb2 = self.objects[id2]
                if aabb1.intersects(aabb2):
                    pairs.append((id1, id2))
        return pairs
