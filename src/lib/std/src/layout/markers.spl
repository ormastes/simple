# Layout Markers - Runtime markers for profiling and layout optimization
#
# These markers are used by the profiler/test framework to determine
# which functions are called during different execution phases (startup,
# first_frame, steady, cold) for optimal 4KB page grouping.

#[variant(any)]
mod markers

# Predefined marker names for common milestones
const STARTUP_COMPLETE: str = "startup.complete"
const UI_READY: str = "ui.ready"
const FIRST_FRAME: str = "first_frame"
const EVENT_LOOP_ENTER: str = "event_loop.enter"


#[extern("simple_layout_mark")]
#[inline]
fn _mark_impl(name: str):
    """
    Internal implementation of mark().
    This is a no-op in normal execution but is intercepted by:
    1. The test framework in --layout-record mode
    2. The profiler for phase boundary detection
    """
    pass


fn mark(name: str):
    """
    Mark a milestone in program execution for layout profiling.

    Markers establish boundaries between execution phases:
    - Startup phase: process start → first_frame or ui.ready marker
    - First frame phase: first_frame marker → ui.ready marker
    - Steady phase: after ui.ready (normal execution)

    Common usage:
        std.layout.mark("ui.ready")  # UI is ready for interaction
        std.layout.mark("first_frame")  # First frame rendered
        std.layout.mark("startup.complete")  # Initialization done

    The profiler uses these markers to:
    1. Identify which functions are called before each marker
    2. Group those functions into 4KB pages
    3. Order pages for optimal startup locality

    Args:
        name: A unique marker name (e.g., "ui.ready", "first_frame")
    """
    _mark_impl(name)


fn mark_startup_complete():
    """
    Convenience marker for when initialization is complete.
    Call this after all startup initialization but before the main loop.
    """
    mark(STARTUP_COMPLETE)


fn mark_ui_ready():
    """
    Convenience marker for when the UI is ready for interaction.
    This is the primary milestone for TUI/GUI applications.
    """
    mark(UI_READY)


fn mark_first_frame():
    """
    Convenience marker for when the first frame has been rendered.
    For graphical applications, this marks the end of the first_frame phase.
    """
    mark(FIRST_FRAME)


fn mark_event_loop_enter():
    """
    Convenience marker for when entering the main event loop.
    Call this just before the main loop begins.
    """
    mark(EVENT_LOOP_ENTER)
