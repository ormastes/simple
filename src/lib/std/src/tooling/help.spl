# Help and Version Information for the Simple CLI
#
# Migrated from Rust src/driver/src/cli/help.rs

use core.*

# =========================================================================
# Constants
# =========================================================================

pub val VERSION: text = "0.1.0"

# =========================================================================
# Help Functions
# =========================================================================

pub fn print_help():
    print "Simple Language v{VERSION}"
    print ""
    print "Usage:"
    print "  simple                      Start interactive TUI REPL (default)"
    print "  simple --notui              Start Normal REPL (rustyline-based)"
    print "  simple <file.spl>           Run source file"
    print "  simple <file.smf>           Run compiled binary"
    print "  simple -c \"code\"            Run code string"
    print "  simple compile <src> [-o <out>] [options]  Compile source file"
    print "  simple watch <file.spl>     Watch and auto-recompile"
    print "  simple targets              List available target architectures"
    print "  simple linkers              List available native linkers"
    print ""
    print "Testing:"
    print "  simple test [path]          Run tests (default: test/)"
    print "  simple test --unit          Run unit tests only"
    print "  simple test --integration   Run integration tests only"
    print "  simple test --system        Run system tests only"
    print "  simple test --tag <name>    Filter by tag"
    print "  simple test --fail-fast     Stop on first failure"
    print "  simple test --seed <N>      Deterministic shuffle"
    print "  simple test --format <fmt>  Output format: text, json, doc"
    print "  simple test --json          Shorthand for --format json"
    print "  simple test --doc           Shorthand for --format doc"
    print "  simple test --watch         Watch and auto-rerun on changes"
    print "  simple test --seq-diagram   Generate sequence diagrams from tests"
    print "  simple test --class-diagram Generate class diagrams from tests"
    print "  simple test --arch-diagram  Generate architecture diagrams from tests"
    print "  simple test --diagram-all   Generate all diagram types"
    print ""
    print "Diagram Generation:"
    print "  simple diagram -A -n my_test      Generate all diagrams"
    print "  simple diagram -s --include \"*Service\"   Sequence with filter"
    print "  simple diagram --help             Show diagram options"
    print ""
    print "Code Quality:"
    print "  simple lint [path]          Run linter on file or directory"
    print "  simple lint --json          Output lint results as JSON"
    print "  simple lint --fix           Apply auto-fixes"
    print "  simple fmt [path]           Format file or directory"
    print "  simple fmt --check          Check formatting without changes"
    print ""
    print "Internationalization (i18n):"
    print "  simple i18n extract [path]      Extract i18n strings to locale files"
    print "  simple i18n generate <locale>   Generate locale template (e.g., ko-KR)"
    print "  simple i18n --help              Show i18n help"
    print ""
    print "LLM-Friendly Tools:"
    print "  simple mcp <file.spl>       Generate minimal code preview (90% token reduction)"
    print "  simple mcp <file.spl> --expand <symbol>  Expand specific symbol"
    print "  simple mcp <file.spl> --search <query>   Search for symbols"
    print "  simple mcp <file.spl> --show-coverage    Show coverage overlays"
    print "  simple diff <old.spl> <new.spl> --semantic  Semantic diff (compare AST/HIR)"
    print "  simple diff <old.spl> <new.spl> --json     Output diff as JSON"
    print "  simple context <file.spl> [target]  Extract minimal context pack"
    print "  simple context <file.spl> --minimal     Only direct dependencies"
    print "  simple context <file.spl> --json        Output as JSON"
    print "  simple context <file.spl> --markdown    Output as Markdown"
    print ""
    print "Build & Audit (#911-915):"
    print "  simple query --generated           Find all LLM-generated code"
    print "  simple query --generated --unverified    Find unverified generated code"
    print "  simple query --generated-by=<tool>       Find code by specific tool"
    print "  simple info <function> --provenance      Show provenance metadata"
    print "  simple spec-coverage                     Show specification coverage"
    print "  simple spec-coverage --by-category       Coverage by category"
    print "  simple spec-coverage --missing           Show missing features"
    print "  simple spec-coverage --report=html       Generate HTML report"
    print "  simple replay <log.json>                 Display build log"
    print "  simple replay --compare <log1> <log2>    Compare two builds"
    print "  simple replay --extract-errors <log>     Extract diagnostics"
    print ""
    print "Verification (Lean Code Generation):"
    print "  simple gen-lean generate           Generate all Lean verification files"
    print "  simple gen-lean compare            Compare generated with existing Lean files"
    print "  simple gen-lean compare --diff     Show unified diff for differences"
    print "  simple gen-lean write              Write generated files (safe, won't overwrite)"
    print "  simple gen-lean write --force      Overwrite existing Lean files"
    print "  simple gen-lean --project <name>   Generate specific project only"
    print ""
    print "Package Management:"
    print "  simple init [name]          Create a new project"
    print "  simple add <pkg> [options]  Add a dependency"
    print "  simple remove <pkg>         Remove a dependency"
    print "  simple install              Install all dependencies"
    print "  simple update [pkg]         Update dependencies"
    print "  simple list                 List installed dependencies"
    print "  simple tree                 Show dependency tree"
    print ""
    print "Cache Management:"
    print "  simple cache info           Show cache information"
    print "  simple cache list           List cached packages"
    print "  simple cache clean          Clear the cache"
    print ""
    print "Options:"
    print "  -h, --help     Show this help"
    print "  -v, --version  Show version"
    print "  -c <code>      Run code string"
    print "  --notui        Use Normal REPL instead of TUI (TUI is default)"
    print "  --gc-log       Enable verbose GC logging"
    print "  --gc=off       Disable garbage collection"
    print "  --macro-trace  Enable macro expansion tracing"
    print "  --debug        Enable debug mode (dprint statements will output)"
    print "  --lang <code>  Set output language for diagnostics (e.g., ko, ja)"
    print "  --target <arch>  Target architecture for cross-compilation"
    print "  --linker <name>  Native linker: mold, lld, ld (auto-detected if not set)"
    print "  --snapshot     Create JJ snapshot on successful build/test"
    print ""
    print "Sandboxed Execution (#916-919):"
    print "  --sandbox               Enable sandboxing with default limits"
    print "  --time-limit <secs>     Set CPU time limit (seconds)"
    print "  --memory-limit <bytes>  Set memory limit (bytes, accepts K/M/G suffix)"
    print "  --fd-limit <count>      Set file descriptor limit"
    print "  --thread-limit <count>  Set thread limit"
    print "  --no-network            Block all network access"
    print "  --network-allow <domains>  Allow specific domains (comma-separated)"
    print "  --network-block <domains>  Block specific domains (comma-separated)"
    print "  --read-only <paths>     Restrict filesystem to read-only paths (comma-separated)"
    print "  --read-write <paths>    Restrict filesystem to specific read-write paths (comma-separated)"
    print ""
    print "Build Optimization (#824):"
    print "  --parallel     Enable parallel compilation (uses all CPU cores)"
    print "  --parallel=N   Use N threads for parallel compilation"
    print "  --profile      Show compilation profiling information"
    print "  --mmap         Force memory-mapped file reading"
    print "  --no-mmap      Disable memory-mapped file reading"
    print ""
    print "IR Export (LLM-friendly #885-887):"
    print "  --emit-ast     Export AST to stdout"
    print "  --emit-ast=<file>  Export AST to file"
    print "  --emit-hir     Export HIR to stdout"
    print "  --emit-hir=<file>  Export HIR to file"
    print "  --emit-mir     Export MIR to stdout"
    print "  --emit-mir=<file>  Export MIR to file"
    print ""
    print "Deterministic Builds (#911) & Replay Logs (#912):"
    print "  --deterministic              Enable deterministic build mode"
    print "  --build-timestamp=<ISO8601>  Override build timestamp (e.g., 2025-01-15T10:00:00Z)"
    print "  --log=<file.json>            Save build log for replay and debugging"
    print ""
    print "Target Architectures:"
    print "  x86_64   64-bit x86 (default on most systems)"
    print "  aarch64  64-bit ARM (Apple Silicon, ARM servers)"
    print "  i686     32-bit x86"
    print "  armv7    32-bit ARM"
    print "  riscv64  64-bit RISC-V"
    print "  riscv32  32-bit RISC-V"
    print ""
    print "Add Options:"
    print "  --path <path>  Add as path dependency"
    print "  --git <url>    Add as git dependency"
    print "  --branch <br>  Git branch (with --git)"
    print "  --dev          Add as dev dependency"
    print ""
    print "Examples:"
    print "  simple                      # Start REPL"
    print "  simple hello.spl            # Run source"
    print "  simple -c \"main = 42\"       # Run expression"
    print "  simple compile app.spl      # Compile to app.smf"
    print "  simple compile app.spl --target aarch64  # Cross-compile"
    print "  simple compile app.spl --snapshot  # Compile and snapshot"
    print "  simple watch app.spl        # Watch for changes"
    print "  simple init myapp           # Create new project"
    print "  simple add http \"1.0\"       # Add dependency"
    print "  simple add mylib --path ../mylib  # Add local dep"
    print ""
    print "Sandbox Examples:"
    print "  simple script.spl --sandbox                    # Run with default sandbox"
    print "  simple script.spl --time-limit 30              # 30 second CPU limit"
    print "  simple script.spl --memory-limit 100M          # 100 MB memory limit"
    print "  simple script.spl --no-network                 # Block all network"
    print "  simple script.spl --network-allow github.com   # Allow only GitHub"
    print "  simple script.spl --read-only /tmp,/usr/lib    # Read-only filesystem"
    print "  simple script.spl --sandbox --time-limit 60 --memory-limit 256M  # Combined"

pub fn print_version():
    print "Simple Language v{VERSION}"

pub fn version() -> text:
    return VERSION

# =========================================================================
# Exports
# =========================================================================

pub use VERSION
pub use print_help, print_version, version
