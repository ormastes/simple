# Bounds - Bounding volumes and topology
#
# BoundingSphere and PrimitiveTopology for 3D graphics.

export BoundingSphere, PrimitiveTopology

use graphics.math.*
use mesh_types.*

# =============================================================================
# BoundingSphere
# =============================================================================

pub struct BoundingSphere:
    center: Vec3
    radius: f32

impl BoundingSphere:
    pub fn new(center: Vec3, radius: f32) -> BoundingSphere:
        return BoundingSphere { center: center, radius: radius }

    pub fn from_aabb(aabb: AABB) -> BoundingSphere:
        val center = aabb.center()
        val size = aabb.size()
        val radius = sqrt(size.x * size.x + size.y * size.y + size.z * size.z) / 2.0
        return BoundingSphere { center: center, radius: radius }

    pub fn contains_point(self, point: Vec3) -> bool:
        return self.center.distance_to(point) <= self.radius

    pub fn intersects(self, other: BoundingSphere) -> bool:
        val distance = self.center.distance_to(other.center)
        return distance <= (self.radius + other.radius)

# =============================================================================
# PrimitiveTopology
# =============================================================================

pub enum PrimitiveTopology:
    TriangleList
    TriangleStrip
    LineList
    LineStrip
    PointList

impl PrimitiveTopology:
    # =========================================================================
    # Helper Methods
    # =========================================================================

    pub fn is_triangle_list(self) -> bool:
        """Check if this is triangle list topology.

        Returns:
            true for TriangleList

        Example:
            PrimitiveTopology::TriangleList.is_triangle_list()  # → true
        """
        match self:
            case TriangleList: true
            case _: false

    pub fn is_triangle_strip(self) -> bool:
        """Check if this is triangle strip topology.

        Returns:
            true for TriangleStrip

        Example:
            PrimitiveTopology::TriangleStrip.is_triangle_strip()  # → true
        """
        match self:
            case TriangleStrip: true
            case _: false

    pub fn is_line_list(self) -> bool:
        """Check if this is line list topology.

        Returns:
            true for LineList

        Example:
            PrimitiveTopology::LineList.is_line_list()  # → true
        """
        match self:
            case LineList: true
            case _: false

    pub fn is_line_strip(self) -> bool:
        """Check if this is line strip topology.

        Returns:
            true for LineStrip

        Example:
            PrimitiveTopology::LineStrip.is_line_strip()  # → true
        """
        match self:
            case LineStrip: true
            case _: false

    pub fn is_point_list(self) -> bool:
        """Check if this is point list topology.

        Returns:
            true for PointList

        Example:
            PrimitiveTopology::PointList.is_point_list()  # → true
        """
        match self:
            case PointList: true
            case _: false

    pub fn is_triangle_type(self) -> bool:
        """Check if this renders triangles.

        Returns:
            true for TriangleList or TriangleStrip

        Example:
            PrimitiveTopology::TriangleList.is_triangle_type()  # → true
            PrimitiveTopology::LineList.is_triangle_type()  # → false
        """
        match self:
            case TriangleList: true
            case TriangleStrip: true
            case _: false

    pub fn is_line_type(self) -> bool:
        """Check if this renders lines.

        Returns:
            true for LineList or LineStrip

        Example:
            PrimitiveTopology::LineList.is_line_type()  # → true
        """
        match self:
            case LineList: true
            case LineStrip: true
            case _: false

    pub fn is_point_type(self) -> bool:
        """Check if this renders points.

        Returns:
            true for PointList

        Example:
            PrimitiveTopology::PointList.is_point_type()  # → true
        """
        match self:
            case PointList: true
            case _: false

    pub fn uses_strips(self) -> bool:
        """Check if this topology uses strip mode.

        Returns:
            true for TriangleStrip or LineStrip

        Example:
            PrimitiveTopology::TriangleStrip.uses_strips()  # → true
            PrimitiveTopology::TriangleList.uses_strips()  # → false
        """
        match self:
            case TriangleStrip: true
            case LineStrip: true
            case _: false

    pub fn to_string(self) -> text:
        """Convert primitive topology to string.

        Returns:
            Topology name

        Example:
            PrimitiveTopology::TriangleList.to_string()  # → "triangle_list"
        """
        match self:
            case TriangleList: "triangle_list"
            case TriangleStrip: "triangle_strip"
            case LineList: "line_list"
            case LineStrip: "line_strip"
            case PointList: "point_list"

    pub fn description(self) -> text:
        """Get primitive topology description.

        Returns:
            Human-readable description

        Example:
            PrimitiveTopology::TriangleList.description()
            # → "Triangle list (independent triangles)"
        """
        match self:
            case TriangleList: "Triangle list (independent triangles)"
            case TriangleStrip: "Triangle strip (shared vertices)"
            case LineList: "Line list (independent line segments)"
            case LineStrip: "Line strip (connected lines)"
            case PointList: "Point list (individual points)"

    pub fn summary(self) -> text:
        """Get primitive topology summary.

        Returns:
            Human-readable summary

        Example:
            PrimitiveTopology::TriangleList.summary()
            # → "PrimitiveTopology: triangle_list (Triangle list (independent triangles), renders triangles)"
        """
        val name = self.to_string()
        val desc = self.description()
        val prim_type = if self.is_triangle_type():
            "renders triangles"
        elif self.is_line_type():
            "renders lines"
        else:
            "renders points"

        val strip_info = if self.uses_strips(): ", uses strips" else: ""
        return "PrimitiveTopology: {name} ({desc}, {prim_type}{strip_info})"

# Helper function
fn sqrt(x: f32) -> f32:
    # Placeholder - will be provided by core
    return 0.0
