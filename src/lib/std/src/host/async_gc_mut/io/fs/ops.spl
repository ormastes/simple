# File System Operations (async_gc_mut variant)
#
# Re-exports common operations with variant-specific additions.

use host.common.io.fs_ops.*
use host.common.io.types.*

pub use read, read_text, write, write_text, append, append_text
pub use create_dir, create_dir_all, remove, remove_dir, remove_dir_all
pub use rename, copy, copy_zero
pub use exists, metadata, read_dir
pub use read_sync, read_text_sync, write_sync, write_text_sync
pub use exists_sync, metadata_sync

from file import File

# ===============================
# Variant-Specific Operations
# ===============================

# Zero-copy file transfer using sendfile
pub async fn copy_zero(src: FilePath, dst: FilePath) -> Result<ByteCount, IoError>:
    val src_file = await File.open_read(src)?
    val dst_file = await File.open_write(dst)?

    val size = await src_file.size()?
    val result = native_sendfile(dst_file.handle, src_file.handle, 0, size as u64)?

    await src_file.close()?
    await dst_file.close()?

    return Ok(result)
