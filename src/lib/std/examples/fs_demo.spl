# File System Module Demo
#
# Demonstrates the new fs module that unblocks 30+ TODOs.

import fs.*

fn main():
    print "=== File System Module Demo ==="
    print ""

    # 1. Path operations (no I/O required)
    print "1. Path Operations:"
    print "  Separator: {separator()}"
    print "  Join ['path', 'to', 'file']: {join(['path', 'to', 'file'])}"
    print "  Basename '/path/to/file.txt': {basename('/path/to/file.txt')}"
    print "  Dirname '/path/to/file.txt': {dirname('/path/to/file.txt')}"
    print "  Extension 'file.txt': {extension('file.txt')}"
    print ""

    # 2. File existence check
    print "2. File Existence:"
    val test_path = ".simple/config.sdn"
    print "  Checking if '{test_path}' exists..."
    if exists(test_path):
        print "  ✓ File exists!"
    else:
        print "  ✗ File does not exist"
    print ""

    # 3. Write and read a test file
    print "3. File I/O Operations:"
    val temp_file = "test_fs_demo.txt"
    val content = "Hello from Simple fs module!\nThis demonstrates file I/O."

    print "  Writing to '{temp_file}'..."
    match write_text(temp_file, content):
        Ok(_):
            print "  ✓ Write successful!"

            print "  Reading back from '{temp_file}'..."
            match read_text(temp_file):
                Ok(read_content):
                    print "  ✓ Read successful!"
                    print "  Content length: {read_content.len()} bytes"

                    # Clean up
                    match remove(temp_file):
                        Ok(_):
                            print "  ✓ Cleanup successful!"
                        Err(e):
                            print "  ✗ Cleanup failed: {e}"
                Err(e):
                    print "  ✗ Read failed: {e}"
        Err(e):
            print "  ✗ Write failed: {e}"
    print ""

    # 4. Directory operations
    print "4. Directory Operations:"
    print "  Listing current directory..."
    match list_dir("."):
        Ok(entries):
            print "  ✓ Found {entries.len()} entries"
            if entries.len() > 0:
                print "  First few entries:"
                var i = 0
                while i < 5 and i < entries.len():
                    print "    - {entries[i]}"
                    i = i + 1
        Err(e):
            print "  ✗ List failed: {e}"
    print ""

    # 5. File utilities
    print "5. File Utilities:"
    val sample_lines = ["Line 1", "Line 2", "Line 3"]
    val lines_file = "test_lines.txt"

    print "  Writing {sample_lines.len()} lines to '{lines_file}'..."
    match write_lines(lines_file, sample_lines):
        Ok(_):
            print "  ✓ Write lines successful!"

            print "  Reading lines back..."
            match read_lines(lines_file):
                Ok(read_lines):
                    print "  ✓ Read {read_lines.len()} lines"

                    # Clean up
                    match remove(lines_file):
                        Ok(_):
                            print "  ✓ Cleanup successful!"
                        Err(e):
                            print "  ✗ Cleanup failed: {e}"
                Err(e):
                    print "  ✗ Read lines failed: {e}"
        Err(e):
            print "  ✗ Write lines failed: {e}"
    print ""

    print "=== Demo Complete ==="
    print ""
    print "The fs module is now available for use throughout Simple!"
    print "This unblocks 30+ TODOs that were waiting for file I/O."
