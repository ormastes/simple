# WebSocket Utilities Module
# Provides debugging, conversion, and helper functions

from std.websocket.types import opcode_name
from std.websocket.handshake import text_to_bytes
from std.websocket.handshake import bytes_to_text

# ==============================================================================
# Debugging Functions
# ==============================================================================

fn bytes_to_hex(data: List<i64>) -> text:
    val hex_chars = "0123456789ABCDEF"
    var result = ""
    val len = data.length()
    var i = 0

    while i < len:
        val byte = data.at(i)
        val hi = (byte >> 4) & 0x0F
        val lo = byte & 0x0F
        val hi_char = hex_chars.char_at(hi)
        val lo_char = hex_chars.char_at(lo)
        result = result + hi_char + lo_char
        if i < len - 1:
            result = result + " "
        i = i + 1

    result

fn frame_info(fin: i64, opcode: i64, masked: i64, payload_length: i64) -> text:
    val fin_text = if fin == 1: "FIN" else: "MORE"
    val opcode_text = opcode_name(opcode)
    val masked_text = if masked == 1: "MASKED" else: "UNMASKED"

    "Frame: {fin_text} | {opcode_text} | {masked_text} | Payload: {payload_length} bytes"

# ==============================================================================
# Payload Conversion Functions
# ==============================================================================

fn payload_to_text(payload: List<i64>) -> text:
    bytes_to_text(payload)

fn text_payload_length(text_data: text) -> i64:
    text_data.length()
