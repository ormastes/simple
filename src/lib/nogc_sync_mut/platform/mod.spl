# Platform Abstraction Library
#
# @tag:stdlib
# @tag:api
#
# Provides cross-platform abstractions for handling endianness, newlines, and wire formats.
# Uses a send/receive pattern inspired by Go's network programming: convert at boundaries,
# not everywhere. When host platform equals remote platform, all operations are zero-cost.
#
# ## Core Principle
#
# Convert data at system boundaries (network, files, cross-compilation), not scattered
# throughout code. This makes platform differences explicit and testable.
#
# ## Key Features
#
# - **Auto-detection**: `host_config()` detects local machine properties
# - **Zero-cost same-platform**: When host == remote, conversions are identity functions
# - **Type-safe**: Must specify both platforms explicitly, preventing endian bugs
# - **Composable**: send/recv can be chained for multi-hop conversions
#
# ## Quick Examples
#
# Basic platform configuration and endianness conversion:
#
# ```simple:skip
# use std.platform.{host_config, network_config, send_u32, recv_u32}
#
# val host = host_config()
# val net = network_config()
# val wire_val = send_u32(host, net, 0x12345678)
# ```
#
# Newline translation between platforms:
#
# ```simple:skip
# use std.platform.{make_config, send_text}
# use std.common.target.{TargetArch, TargetOS}
#
# val unix = make_config(TargetArch.X86_64, TargetOS.Linux)
# val win = make_config(TargetArch.X86_64, TargetOS.Windows)
# val crlf = send_text(unix, win, "line1\nline2\n")
# ```
#
# Wire format serialization for network protocols:
#
# ```simple:skip
# use std.platform.{wire_writer_network, wire_reader_new, network_config}
#
# var writer = wire_writer_network()
# writer.write_u32(42)
# writer.write_text("hello")
# val bytes = writer.to_bytes()
#
# var reader = wire_reader_new(bytes, network_config())
# val num = reader.read_u32()
# val msg = reader.read_text()
# ```
#
# Platform-aware file I/O:
#
# ```simple:skip
# use std.platform.{text_file_write_local, text_file_read_local}
#
# text_file_write_local("output.txt", "data\n")
# val content = text_file_read_local("output.txt")
# ```
#
# ## Modules
#
# - **config**: Platform configuration and auto-detection
# - **convert**: Endianness and newline conversion (send/recv pattern)
# - **newline**: Newline translation utilities
# - **wire**: WireWriter/WireReader for binary serialization
# - **text_io**: Platform-aware text file I/O
#
# ## Common Use Cases
#
# - Network protocols (always use `network_config()` for big-endian byte order)
# - File formats with fixed byte order (Cap'n Proto, Protocol Buffers)
# - Cross-compilation (generating constants for embedded targets)
# - Cross-platform text files (handling CRLF vs LF)
#
# ## Performance
#
# Same-platform operations compile to identity functions (zero overhead).
# Cross-platform operations perform minimal work (byte swaps, string replace).
#
# ## Related
#
# - `src/std/common/target.spl` - TargetArch, TargetOS, Endian enums
# - `src/std/platform.spl` - OS detection helpers (is_windows, is_unix)
# - `src/std/text.spl` - Newline constants (LF, CRLF, _NL, NL)

# ============================================================
# Imports from submodules
# ============================================================

# Platform configuration and detection
use std.platform.config.{PlatformConfig, host_config, make_config, network_config, needs_swap, same_platform}

# Endianness and text conversion (send/recv pattern)
use std.platform.convert.{send_u16, send_u32, send_u64, recv_u16, recv_u32, recv_u64, send_text, recv_text, send_bytes_u32, recv_bytes_u32}

# Newline translation utilities
use std.platform.newline.{TextMode, translate_write, translate_read}

# Wire format serialization
use std.platform.wire.{WireWriter, WireReader, wire_writer_new, wire_writer_network, wire_writer_le, wire_reader_new}

# Platform-aware text file I/O
use std.platform.text_io.{text_file_write, text_file_write_local, text_file_read, text_file_read_local}

# ============================================================
# Public API exports
# ============================================================

# Platform configuration
export PlatformConfig, host_config, make_config, network_config
export needs_swap, same_platform

# Endianness conversion
export send_u16, send_u32, send_u64, recv_u16, recv_u32, recv_u64

# Text and byte conversion
export send_text, recv_text, send_bytes_u32, recv_bytes_u32

# Newline translation
export TextMode, translate_write, translate_read

# Wire format
export WireWriter, WireReader
export wire_writer_new, wire_writer_network, wire_writer_le, wire_reader_new

# Text file I/O
export text_file_write, text_file_write_local, text_file_read, text_file_read_local
