# DNS Query Building Functions

fn dns_build_query(id: i64, domain: text, qtype: i64) -> text:
    # Build DNS query message for domain resolution
    # Returns wire format as text representation
    val header = dns_create_header(id, DNS_FLAG_QR_QUERY, DNS_FLAG_OPCODE_QUERY, 0, 0, 1, 0, 0, 1, 0, 0, 0)
    val question = dns_create_question(domain, qtype, DNS_CLASS_IN)
    val questions = [question]
    val answers = []
    val authority = []
    val additional = []
    val message = dns_create_message(header, questions, answers, authority, additional)
    dns_serialize_message(message)

fn dns_build_a_query(id: i64, domain: text) -> text:
    # Build DNS A record query (IPv4)
    dns_build_query(id, domain, DNS_TYPE_A)

fn dns_build_aaaa_query(id: i64, domain: text) -> text:
    # Build DNS AAAA record query (IPv6)
    dns_build_query(id, domain, DNS_TYPE_AAAA)

fn dns_build_mx_query(id: i64, domain: text) -> text:
    # Build DNS MX record query (mail exchange)
    dns_build_query(id, domain, DNS_TYPE_MX)

fn dns_build_ns_query(id: i64, domain: text) -> text:
    # Build DNS NS record query (nameserver)
    dns_build_query(id, domain, DNS_TYPE_NS)

fn dns_build_cname_query(id: i64, domain: text) -> text:
    # Build DNS CNAME record query (canonical name)
    dns_build_query(id, domain, DNS_TYPE_CNAME)

fn dns_build_ptr_query(id: i64, ip_addr: text) -> text:
    # Build DNS PTR record query (reverse lookup)
    val reversed = dns_reverse_ip_addr(ip_addr)
    dns_build_query(id, reversed, DNS_TYPE_PTR)

fn dns_build_txt_query(id: i64, domain: text) -> text:
    # Build DNS TXT record query
    dns_build_query(id, domain, DNS_TYPE_TXT)

fn dns_build_srv_query(id: i64, service: text) -> text:
    # Build DNS SRV record query (service location)
    dns_build_query(id, service, DNS_TYPE_SRV)

fn dns_serialize_message(message) -> text:
    # Serialize DNS message to wire format representation
    val header = dns_get_message_header(message)
    val questions = dns_get_message_questions(message)
    var result = "DNS-MESSAGE:"
    val id = dns_get_header_id(header)
    result = result + "ID={id};"
    val flags = dns_get_header_flags(header)
    result = result + "FLAGS={flags};"
    var i = 0
    while i < questions.size():
        val q = questions.get(i)
        val qname = dns_get_question_name(q)
        val qtype = dns_get_question_type(q)
        result = result + "Q={qname}:{qtype};"
        i = i + 1
    result
