# Network FFI Bindings
#
# Low-level extern function declarations for network operations.
# This module provides the raw FFI layer for TCP, UDP, HTTP, and URL operations.
#
# Architecture:
# - All extern fn declarations in one place
# - Type-safe FFI boundary
# - Used by tcp.spl, udp.spl, http.spl modules

use std.error.*

# ============================================================================
# TCP FFI Functions
# ============================================================================

extern fn tcp_listener_bind(addr: text) -> Result<TcpListener, SimpleError>
extern fn tcp_listener_accept(listener: TcpListener) -> Result<TcpStream, SimpleError>
extern fn tcp_listener_accept_timeout(listener: TcpListener, timeout_ms: i64) -> Result<TcpStream, SimpleError>
extern fn tcp_listener_local_addr(listener: TcpListener) -> text?
extern fn tcp_listener_set_nonblocking(listener: TcpListener, nonblocking: bool) -> bool
extern fn tcp_listener_close(listener: TcpListener)

extern fn tcp_stream_connect(addr: text) -> Result<TcpStream, SimpleError>
extern fn tcp_stream_connect_timeout(addr: text, timeout_ms: i64) -> Result<TcpStream, SimpleError>
extern fn tcp_stream_read(stream: TcpStream, size: usize) -> Result<[u8], SimpleError>
extern fn tcp_stream_read_exact(stream: TcpStream, size: usize) -> Result<[u8], SimpleError>
extern fn tcp_stream_read_line(stream: TcpStream) -> Result<text, SimpleError>
extern fn tcp_stream_write(stream: TcpStream, data: [u8]) -> Result<usize, SimpleError>
extern fn tcp_stream_write_all(stream: TcpStream, data: [u8]) -> Result<(), SimpleError>
extern fn tcp_stream_flush(stream: TcpStream) -> Result<(), SimpleError>
extern fn tcp_stream_peer_addr(stream: TcpStream) -> text?
extern fn tcp_stream_local_addr(stream: TcpStream) -> text?
extern fn tcp_stream_set_read_timeout(stream: TcpStream, timeout_ms: i64?) -> bool
extern fn tcp_stream_set_write_timeout(stream: TcpStream, timeout_ms: i64?) -> bool
extern fn tcp_stream_set_nodelay(stream: TcpStream, nodelay: bool) -> bool
extern fn tcp_stream_set_nonblocking(stream: TcpStream, nonblocking: bool) -> bool
extern fn tcp_stream_close(stream: TcpStream)

# ============================================================================
# UDP FFI Functions
# ============================================================================

extern fn udp_socket_bind(addr: text) -> Result<UdpSocket, SimpleError>
extern fn udp_socket_recv_from(socket: UdpSocket, size: usize) -> Result<([u8], text), SimpleError>
extern fn udp_socket_send_to(socket: UdpSocket, data: [u8], addr: text) -> Result<usize, SimpleError>
extern fn udp_socket_connect(socket: UdpSocket, addr: text) -> Result<(), SimpleError>
extern fn udp_socket_send(socket: UdpSocket, data: [u8]) -> Result<usize, SimpleError>
extern fn udp_socket_recv(socket: UdpSocket, size: usize) -> Result<[u8], SimpleError>
extern fn udp_socket_local_addr(socket: UdpSocket) -> text?
extern fn udp_socket_set_broadcast(socket: UdpSocket, broadcast: bool) -> bool
extern fn udp_socket_set_multicast_loop(socket: UdpSocket, multicast_loop: bool) -> bool
extern fn udp_socket_join_multicast(socket: UdpSocket, multicast_addr: text) -> bool
extern fn udp_socket_leave_multicast(socket: UdpSocket, multicast_addr: text) -> bool
extern fn udp_socket_set_read_timeout(socket: UdpSocket, timeout_ms: i64?) -> bool
extern fn udp_socket_set_nonblocking(socket: UdpSocket, nonblocking: bool) -> bool
extern fn udp_socket_close(socket: UdpSocket)

# ============================================================================
# HTTP FFI Functions
# ============================================================================

extern fn http_request(client: HttpClient, url: text, request: HttpRequest) -> Result<HttpResponse, SimpleError>

# ============================================================================
# URL FFI Functions
# ============================================================================

extern fn url_parse(url: text) -> Result<Url, SimpleError>
extern fn url_encode(text: text) -> text
extern fn url_decode(text: text) -> text

# ============================================================================
# Utility FFI Functions
# ============================================================================

extern fn bytes_to_string(bytes: [u8]) -> text
extern fn file_write_bytes(path: text, data: [u8]) -> Result<(), SimpleError>
