# Sanitizer Library
# @tag:api
#
# Unified API for all sanitizer modules:
# - ASan: Address Sanitizer (use-after-free, double-free, buffer overflow)
# - LSan: Leak Sanitizer (wraps mem_tracker with named checkpoints)
# - UBSan: Undefined Behavior Sanitizer (overflow, div-by-zero, bounds)
# - TSan: Thread Sanitizer (data races, lock ordering)
# - MSan: Memory State Sanitizer (uninitialized reads, use-after-free)
#
# All sanitizers use a cooperative model â€” users call checking
# functions explicitly. No compiler instrumentation required.
#
# Usage:
#     use std.sanitizer.mod.{san_enable_all, san_report_all, san_reset_all}
#     san_enable_all()
#     # ... instrumented code ...
#     san_report_all()
#     san_reset_all()

use types.{SanEvent, san_event}
use asan.mod.{asan_enable, asan_disable, asan_is_enabled, asan_on_alloc, asan_on_free, asan_check_access, asan_check_bounds, asan_error_count, asan_report, asan_get_events, asan_reset}
use lsan.mod.{lsan_enable, lsan_disable, lsan_is_enabled, lsan_checkpoint, lsan_check_since, lsan_bytes_since, lsan_suppress_tag, lsan_is_suppressed, lsan_error_count, lsan_report, lsan_get_events, lsan_reset}
use ubsan.mod.{ubsan_enable, ubsan_disable, ubsan_is_enabled, ubsan_check_not_nil, ubsan_add_i64, ubsan_sub_i64, ubsan_mul_i64, ubsan_div_i64, ubsan_shl_i64, ubsan_check_index, ubsan_unreachable, ubsan_error_count, ubsan_report, ubsan_get_events, ubsan_reset}
use tsan.mod.{tsan_enable, tsan_disable, tsan_is_enabled, tsan_set_thread, tsan_read, tsan_write, tsan_lock_acquire, tsan_lock_release, tsan_error_count, tsan_report, tsan_get_events, tsan_reset}
use msan.mod.{msan_enable, msan_disable, msan_is_enabled, msan_alloc_uninit, msan_alloc_init, msan_init, msan_free_region, msan_check_init, msan_check_not_freed, msan_check_overlap, msan_error_count, msan_report, msan_get_events, msan_reset}

# =========================================================================
# Unified API
# =========================================================================

fn san_enable_all():
    asan_enable()
    ubsan_enable()
    tsan_enable()
    msan_enable()

fn san_disable_all():
    asan_disable()
    ubsan_disable()
    tsan_disable()
    msan_disable()

fn san_report_all():
    asan_report()
    lsan_report()
    ubsan_report()
    tsan_report()
    msan_report()

fn san_reset_all():
    asan_reset()
    lsan_reset()
    ubsan_reset()
    tsan_reset()
    msan_reset()

fn san_total_errors() -> i64:
    asan_error_count() + lsan_error_count() + ubsan_error_count() + tsan_error_count() + msan_error_count()

# =========================================================================
# Re-exports: shared types
# =========================================================================

export SanEvent, san_event

# =========================================================================
# Re-exports: unified API
# =========================================================================

export san_enable_all, san_disable_all, san_report_all, san_reset_all, san_total_errors

# =========================================================================
# Re-exports: ASan
# =========================================================================

export asan_enable, asan_disable, asan_is_enabled
export asan_on_alloc, asan_on_free
export asan_check_access, asan_check_bounds
export asan_error_count, asan_report, asan_get_events, asan_reset

# =========================================================================
# Re-exports: LSan
# =========================================================================

export lsan_enable, lsan_disable, lsan_is_enabled
export lsan_checkpoint, lsan_check_since, lsan_bytes_since
export lsan_suppress_tag, lsan_is_suppressed
export lsan_error_count, lsan_report, lsan_get_events, lsan_reset

# =========================================================================
# Re-exports: UBSan
# =========================================================================

export ubsan_enable, ubsan_disable, ubsan_is_enabled
export ubsan_check_not_nil
export ubsan_add_i64, ubsan_sub_i64, ubsan_mul_i64, ubsan_div_i64
export ubsan_shl_i64, ubsan_check_index, ubsan_unreachable
export ubsan_error_count, ubsan_report, ubsan_get_events, ubsan_reset

# =========================================================================
# Re-exports: TSan
# =========================================================================

export tsan_enable, tsan_disable, tsan_is_enabled, tsan_set_thread
export tsan_read, tsan_write
export tsan_lock_acquire, tsan_lock_release
export tsan_error_count, tsan_report, tsan_get_events, tsan_reset

# =========================================================================
# Re-exports: MSan
# =========================================================================

export msan_enable, msan_disable, msan_is_enabled
export msan_alloc_uninit, msan_alloc_init, msan_init, msan_free_region
export msan_check_init, msan_check_not_freed, msan_check_overlap
export msan_error_count, msan_report, msan_get_events, msan_reset
