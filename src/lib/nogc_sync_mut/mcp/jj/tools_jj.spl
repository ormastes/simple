# tools_jj.spl - Dispatcher and collector for all 48 native jj tools
#
# Individual tool implementations live in split files:
#   tools_jj_changes.spl   - Change operations (14): new, describe, commit, squash,
#                            split, duplicate, edit, diffedit, absorb, abandon,
#                            restore, rebase, revert, parallelize
#   tools_jj_viewing.spl   - Viewing & querying (7): status, log, diff, show,
#                            revset, interdiff, evolog
#   tools_jj_files.spl     - File operations (3): file_annotate, file_list, file_show
#   tools_jj_bookmarks.spl - Bookmark management (6): bookmark_create, bookmark_delete,
#                            bookmark_list, bookmark_move, bookmark_set, bookmark_rename
#   tools_jj_git.spl       - Git interop (5): git_fetch, git_push, git_clone,
#                            git_remote, git_export
#   tools_jj_misc.spl      - Misc (13): tag_list, op_log, op_undo, op_restore,
#                            workspace_add, workspace_list, workspace_forget,
#                            sparse_list, sparse_set, conflict_list, resolve,
#                            config_get, config_set

use app.mcp_jj.helpers.{make_error_response}

# --- Import schema + handler functions from split files ---

# Change operations (14 tools)
use app.mcp_jj.tools_jj_changes.{schema_jj_new, schema_jj_describe, schema_jj_commit, schema_jj_squash, schema_jj_split, schema_jj_duplicate, schema_jj_edit, schema_jj_diffedit, schema_jj_absorb, schema_jj_abandon, schema_jj_restore, schema_jj_rebase, schema_jj_revert, schema_jj_parallelize, handle_jj_new, handle_jj_describe, handle_jj_commit, handle_jj_squash, handle_jj_split, handle_jj_duplicate, handle_jj_edit, handle_jj_diffedit, handle_jj_absorb, handle_jj_abandon, handle_jj_restore, handle_jj_rebase, handle_jj_revert, handle_jj_parallelize}

# Viewing & querying (7 tools)
use app.mcp_jj.tools_jj_viewing.{schema_jj_status, schema_jj_log, schema_jj_diff, schema_jj_show, schema_jj_revset, schema_jj_interdiff, schema_jj_evolog, handle_jj_status, handle_jj_log, handle_jj_diff, handle_jj_show, handle_jj_revset, handle_jj_interdiff, handle_jj_evolog}

# File operations (3 tools)
use app.mcp_jj.tools_jj_files.{schema_jj_file_annotate, schema_jj_file_list, schema_jj_file_show, handle_jj_file_annotate, handle_jj_file_list, handle_jj_file_show}

# Bookmark management (6 tools)
use app.mcp_jj.tools_jj_bookmarks.{schema_jj_bookmark_create, schema_jj_bookmark_delete, schema_jj_bookmark_list, schema_jj_bookmark_move, schema_jj_bookmark_set, schema_jj_bookmark_rename, handle_jj_bookmark_create, handle_jj_bookmark_delete, handle_jj_bookmark_list, handle_jj_bookmark_move, handle_jj_bookmark_set, handle_jj_bookmark_rename}

# Git interop (5 tools)
use app.mcp_jj.tools_jj_git.{schema_jj_git_fetch, schema_jj_git_push, schema_jj_git_clone, schema_jj_git_remote, schema_jj_git_export, handle_jj_git_fetch, handle_jj_git_push, handle_jj_git_clone, handle_jj_git_remote, handle_jj_git_export}

# Misc: tags, ops, workspace, sparse, conflicts, config (13 tools)
use app.mcp_jj.tools_jj_misc.{schema_jj_tag_list, schema_jj_op_log, schema_jj_op_undo, schema_jj_op_restore, schema_jj_workspace_add, schema_jj_workspace_list, schema_jj_workspace_forget, schema_jj_sparse_list, schema_jj_sparse_set, schema_jj_conflict_list, schema_jj_resolve, schema_jj_config_get, schema_jj_config_set, handle_jj_tag_list, handle_jj_op_log, handle_jj_op_undo, handle_jj_op_restore, handle_jj_workspace_add, handle_jj_workspace_list, handle_jj_workspace_forget, handle_jj_sparse_list, handle_jj_sparse_set, handle_jj_conflict_list, handle_jj_resolve, handle_jj_config_get, handle_jj_config_set}

# =============================================================================
# COLLECTOR - builds the list of all 48 tool schemas
# =============================================================================

fn get_all_jj_tool_schemas() -> [String]:
    var tools: [String] = []
    # Change operations (14)
    tools.push(schema_jj_new())
    tools.push(schema_jj_describe())
    tools.push(schema_jj_commit())
    tools.push(schema_jj_squash())
    tools.push(schema_jj_split())
    tools.push(schema_jj_duplicate())
    tools.push(schema_jj_edit())
    tools.push(schema_jj_diffedit())
    tools.push(schema_jj_absorb())
    tools.push(schema_jj_abandon())
    tools.push(schema_jj_restore())
    tools.push(schema_jj_rebase())
    tools.push(schema_jj_revert())
    tools.push(schema_jj_parallelize())
    # Viewing & querying (7)
    tools.push(schema_jj_status())
    tools.push(schema_jj_log())
    tools.push(schema_jj_diff())
    tools.push(schema_jj_show())
    tools.push(schema_jj_revset())
    tools.push(schema_jj_interdiff())
    tools.push(schema_jj_evolog())
    # File operations (3)
    tools.push(schema_jj_file_annotate())
    tools.push(schema_jj_file_list())
    tools.push(schema_jj_file_show())
    # Bookmark management (6)
    tools.push(schema_jj_bookmark_create())
    tools.push(schema_jj_bookmark_delete())
    tools.push(schema_jj_bookmark_list())
    tools.push(schema_jj_bookmark_move())
    tools.push(schema_jj_bookmark_set())
    tools.push(schema_jj_bookmark_rename())
    # Git interop (5)
    tools.push(schema_jj_git_fetch())
    tools.push(schema_jj_git_push())
    tools.push(schema_jj_git_clone())
    tools.push(schema_jj_git_remote())
    tools.push(schema_jj_git_export())
    # Tags (1)
    tools.push(schema_jj_tag_list())
    # Operation history (3)
    tools.push(schema_jj_op_log())
    tools.push(schema_jj_op_undo())
    tools.push(schema_jj_op_restore())
    # Workspace (3)
    tools.push(schema_jj_workspace_add())
    tools.push(schema_jj_workspace_list())
    tools.push(schema_jj_workspace_forget())
    # Sparse (2)
    tools.push(schema_jj_sparse_list())
    tools.push(schema_jj_sparse_set())
    # Conflicts (2)
    tools.push(schema_jj_conflict_list())
    tools.push(schema_jj_resolve())
    # Config (2)
    tools.push(schema_jj_config_get())
    tools.push(schema_jj_config_set())
    tools

# =============================================================================
# DISPATCHER - routes tool_name to the correct handler
# =============================================================================

fn handle_jj_tool(id: String, tool_name: String, body: String, repo_path: String) -> String:
    # Change operations (14)
    if tool_name == "jj_new":
        return handle_jj_new(id, body, repo_path)
    elif tool_name == "jj_describe":
        return handle_jj_describe(id, body, repo_path)
    elif tool_name == "jj_commit":
        return handle_jj_commit(id, body, repo_path)
    elif tool_name == "jj_squash":
        return handle_jj_squash(id, body, repo_path)
    elif tool_name == "jj_split":
        return handle_jj_split(id, body, repo_path)
    elif tool_name == "jj_duplicate":
        return handle_jj_duplicate(id, body, repo_path)
    elif tool_name == "jj_edit":
        return handle_jj_edit(id, body, repo_path)
    elif tool_name == "jj_diffedit":
        return handle_jj_diffedit(id, body, repo_path)
    elif tool_name == "jj_absorb":
        return handle_jj_absorb(id, body, repo_path)
    elif tool_name == "jj_abandon":
        return handle_jj_abandon(id, body, repo_path)
    elif tool_name == "jj_restore":
        return handle_jj_restore(id, body, repo_path)
    elif tool_name == "jj_rebase":
        return handle_jj_rebase(id, body, repo_path)
    elif tool_name == "jj_revert":
        return handle_jj_revert(id, body, repo_path)
    elif tool_name == "jj_parallelize":
        return handle_jj_parallelize(id, body, repo_path)
    # Viewing & querying (7)
    elif tool_name == "jj_status":
        return handle_jj_status(id, body, repo_path)
    elif tool_name == "jj_log":
        return handle_jj_log(id, body, repo_path)
    elif tool_name == "jj_diff":
        return handle_jj_diff(id, body, repo_path)
    elif tool_name == "jj_show":
        return handle_jj_show(id, body, repo_path)
    elif tool_name == "jj_revset":
        return handle_jj_revset(id, body, repo_path)
    elif tool_name == "jj_interdiff":
        return handle_jj_interdiff(id, body, repo_path)
    elif tool_name == "jj_evolog":
        return handle_jj_evolog(id, body, repo_path)
    # File operations (3)
    elif tool_name == "jj_file_annotate":
        return handle_jj_file_annotate(id, body, repo_path)
    elif tool_name == "jj_file_list":
        return handle_jj_file_list(id, body, repo_path)
    elif tool_name == "jj_file_show":
        return handle_jj_file_show(id, body, repo_path)
    # Bookmark management (6)
    elif tool_name == "jj_bookmark_create":
        return handle_jj_bookmark_create(id, body, repo_path)
    elif tool_name == "jj_bookmark_delete":
        return handle_jj_bookmark_delete(id, body, repo_path)
    elif tool_name == "jj_bookmark_list":
        return handle_jj_bookmark_list(id, body, repo_path)
    elif tool_name == "jj_bookmark_move":
        return handle_jj_bookmark_move(id, body, repo_path)
    elif tool_name == "jj_bookmark_set":
        return handle_jj_bookmark_set(id, body, repo_path)
    elif tool_name == "jj_bookmark_rename":
        return handle_jj_bookmark_rename(id, body, repo_path)
    # Git interop (5)
    elif tool_name == "jj_git_fetch":
        return handle_jj_git_fetch(id, body, repo_path)
    elif tool_name == "jj_git_push":
        return handle_jj_git_push(id, body, repo_path)
    elif tool_name == "jj_git_clone":
        return handle_jj_git_clone(id, body, repo_path)
    elif tool_name == "jj_git_remote":
        return handle_jj_git_remote(id, body, repo_path)
    elif tool_name == "jj_git_export":
        return handle_jj_git_export(id, body, repo_path)
    # Tags (1)
    elif tool_name == "jj_tag_list":
        return handle_jj_tag_list(id, body, repo_path)
    # Operation history (3)
    elif tool_name == "jj_op_log":
        return handle_jj_op_log(id, body, repo_path)
    elif tool_name == "jj_op_undo":
        return handle_jj_op_undo(id, body, repo_path)
    elif tool_name == "jj_op_restore":
        return handle_jj_op_restore(id, body, repo_path)
    # Workspace (3)
    elif tool_name == "jj_workspace_add":
        return handle_jj_workspace_add(id, body, repo_path)
    elif tool_name == "jj_workspace_list":
        return handle_jj_workspace_list(id, body, repo_path)
    elif tool_name == "jj_workspace_forget":
        return handle_jj_workspace_forget(id, body, repo_path)
    # Sparse (2)
    elif tool_name == "jj_sparse_list":
        return handle_jj_sparse_list(id, body, repo_path)
    elif tool_name == "jj_sparse_set":
        return handle_jj_sparse_set(id, body, repo_path)
    # Conflicts (2)
    elif tool_name == "jj_conflict_list":
        return handle_jj_conflict_list(id, body, repo_path)
    elif tool_name == "jj_resolve":
        return handle_jj_resolve(id, body, repo_path)
    # Config (2)
    elif tool_name == "jj_config_get":
        return handle_jj_config_get(id, body, repo_path)
    elif tool_name == "jj_config_set":
        return handle_jj_config_set(id, body, repo_path)
    else:
        return ""

# =============================================================================
# EXPORTS
# =============================================================================

# Schema functions (48) - re-exported from split files
export schema_jj_new, schema_jj_describe, schema_jj_commit, schema_jj_squash
export schema_jj_split, schema_jj_duplicate, schema_jj_edit, schema_jj_diffedit
export schema_jj_absorb, schema_jj_abandon, schema_jj_restore, schema_jj_rebase
export schema_jj_revert, schema_jj_parallelize
export schema_jj_status, schema_jj_log, schema_jj_diff, schema_jj_show
export schema_jj_revset, schema_jj_interdiff, schema_jj_evolog
export schema_jj_file_annotate, schema_jj_file_list, schema_jj_file_show
export schema_jj_bookmark_create, schema_jj_bookmark_delete, schema_jj_bookmark_list
export schema_jj_bookmark_move, schema_jj_bookmark_set, schema_jj_bookmark_rename
export schema_jj_git_fetch, schema_jj_git_push, schema_jj_git_clone
export schema_jj_git_remote, schema_jj_git_export
export schema_jj_tag_list
export schema_jj_op_log, schema_jj_op_undo, schema_jj_op_restore
export schema_jj_workspace_add, schema_jj_workspace_list, schema_jj_workspace_forget
export schema_jj_sparse_list, schema_jj_sparse_set
export schema_jj_conflict_list, schema_jj_resolve
export schema_jj_config_get, schema_jj_config_set

# Handler functions (48) - re-exported from split files
export handle_jj_new, handle_jj_describe, handle_jj_commit, handle_jj_squash
export handle_jj_split, handle_jj_duplicate, handle_jj_edit, handle_jj_diffedit
export handle_jj_absorb, handle_jj_abandon, handle_jj_restore, handle_jj_rebase
export handle_jj_revert, handle_jj_parallelize
export handle_jj_status, handle_jj_log, handle_jj_diff, handle_jj_show
export handle_jj_revset, handle_jj_interdiff, handle_jj_evolog
export handle_jj_file_annotate, handle_jj_file_list, handle_jj_file_show
export handle_jj_bookmark_create, handle_jj_bookmark_delete, handle_jj_bookmark_list
export handle_jj_bookmark_move, handle_jj_bookmark_set, handle_jj_bookmark_rename
export handle_jj_git_fetch, handle_jj_git_push, handle_jj_git_clone
export handle_jj_git_remote, handle_jj_git_export
export handle_jj_tag_list
export handle_jj_op_log, handle_jj_op_undo, handle_jj_op_restore
export handle_jj_workspace_add, handle_jj_workspace_list, handle_jj_workspace_forget
export handle_jj_sparse_list, handle_jj_sparse_set
export handle_jj_conflict_list, handle_jj_resolve
export handle_jj_config_get, handle_jj_config_set

# Collector and dispatcher
export get_all_jj_tool_schemas, handle_jj_tool
