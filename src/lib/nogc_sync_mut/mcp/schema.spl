# MCP Library - Pre-computed Tool Schemas
#
# Pre-computed JSON schemas for all MCP tools.
# Avoids runtime schema generation overhead.

# Pre-computed schemas as constant string
# NOTE: This avoids module-level var access issues in runtime
fn build_tool_schema(name: text, desc: text, props: text, req: text) -> text:
    "{" + "\"name\":\"" + name + "\",\"description\":\"" + desc + "\",\"inputSchema\":{\"type\":\"object\",\"properties\":{" + props + "},\"required\":[" + req + "]}}"

fn concat_with_comma(items: [text]) -> text:
    var result = ""
    var i = 0
    while i < items.len():
        if i > 0:
            result = result + ","
        result = result + items[i]
        i = i + 1
    result

fn build_all_schemas() -> text:
    var schemas: [text] = []
    schemas.push(build_tool_schema("read_code", "Read a Simple language source file", "\"path\":{\"type\":\"string\",\"description\":\"File path\"}", "\"path\""))
    schemas.push(build_tool_schema("list_files", "List Simple language files in a directory", "\"path\":{\"type\":\"string\",\"description\":\"Directory path\"}", ""))
    schemas.push(build_tool_schema("search_code", "Search for code patterns", "\"query\":{\"type\":\"string\",\"description\":\"Search query\"}", "\"query\""))
    schemas.push(build_tool_schema("file_info", "Get file information", "\"path\":{\"type\":\"string\",\"description\":\"File path\"}", "\"path\""))
    schemas.push(build_tool_schema("bugdb_get", "Get bug by ID", "\"id\":{\"type\":\"string\",\"description\":\"Bug ID\"}", "\"id\""))
    schemas.push(build_tool_schema("bugdb_add", "Add new bug", "\"bug\":{\"type\":\"string\",\"description\":\"Bug JSON\"}", "\"bug\""))
    schemas.push(build_tool_schema("bugdb_update", "Update existing bug", "\"id\":{\"type\":\"string\",\"description\":\"Bug ID\"}", "\"id\""))
    schemas.push(build_tool_schema("debug_create_session", "Create debug session", "", ""))
    "[" + concat_with_comma(schemas) + "]"

var ALL_TOOL_SCHEMAS_JSON = build_all_schemas()

# No-op init for API compatibility
fn init_core_schemas():
    ()  # No-op - schemas are pre-computed constants

# Get all tool schemas as JSON array (pre-computed)
fn get_all_tool_schemas() -> text:
    ALL_TOOL_SCHEMAS_JSON

# Get tool count
fn get_tool_count() -> i64:
    8  # Pre-computed count

# Export
export init_core_schemas, get_all_tool_schemas, get_tool_count
