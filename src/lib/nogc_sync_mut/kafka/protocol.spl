# Apache Kafka Protocol Module
# Group coordination and metadata API

import kafka.types

# ============================================================================
# Metadata API
# ============================================================================

# Metadata request body: (topics, allow_auto_topic_creation)
# topics: [topic_name]
fn create_metadata_request_body(topics: list, allow_auto_topic_creation: bool) -> list:
    [topics, allow_auto_topic_creation]

fn get_metadata_request_topics(body: list) -> list:
    body[0]

fn get_metadata_request_allow_auto_topic_creation(body: list) -> bool:
    body[1]

# Metadata response body: (throttle_time_ms, brokers, cluster_id, controller_id, topic_metadata)
# brokers: [(node_id, host, port, rack)]
# topic_metadata: [(error_code, topic_name, is_internal, partition_metadata)]
fn create_metadata_response_body(throttle_time_ms: i64, brokers: list, cluster_id: text, controller_id: i64, topic_metadata: list) -> list:
    [throttle_time_ms, brokers, cluster_id, controller_id, topic_metadata]

fn get_metadata_response_throttle_time(body: list) -> i64:
    body[0]

fn get_metadata_response_brokers(body: list) -> list:
    body[1]

fn get_metadata_response_cluster_id(body: list) -> text:
    body[2]

fn get_metadata_response_controller_id(body: list) -> i64:
    body[3]

fn get_metadata_response_topic_metadata(body: list) -> list:
    body[4]

# Topic metadata: (error_code, topic_name, is_internal, partition_metadata)
fn create_topic_metadata(error_code: i64, topic_name: text, is_internal: bool, partition_metadata: list) -> list:
    [error_code, topic_name, is_internal, partition_metadata]

fn get_topic_metadata_error_code(metadata: list) -> i64:
    metadata[0]

fn get_topic_metadata_name(metadata: list) -> text:
    metadata[1]

fn get_topic_metadata_is_internal(metadata: list) -> bool:
    metadata[2]

fn get_topic_metadata_partition_metadata(metadata: list) -> list:
    metadata[3]

# ============================================================================
# Group Coordination API
# ============================================================================

# Join group request body: (group_id, session_timeout_ms, rebalance_timeout_ms, member_id, protocol_type, group_protocols)
# group_protocols: [(protocol_name, protocol_metadata)]
fn create_join_group_request_body(group_id: text, session_timeout_ms: i64, rebalance_timeout_ms: i64, member_id: text, protocol_type: text, group_protocols: list) -> list:
    [group_id, session_timeout_ms, rebalance_timeout_ms, member_id, protocol_type, group_protocols]

fn get_join_group_request_group_id(body: list) -> text:
    body[0]

fn get_join_group_request_session_timeout(body: list) -> i64:
    body[1]

fn get_join_group_request_rebalance_timeout(body: list) -> i64:
    body[2]

fn get_join_group_request_member_id(body: list) -> text:
    body[3]

fn get_join_group_request_protocol_type(body: list) -> text:
    body[4]

fn get_join_group_request_group_protocols(body: list) -> list:
    body[5]

# Join group response body: (throttle_time_ms, error_code, generation_id, protocol_name, leader, member_id, members)
# members: [(member_id, metadata)]
fn create_join_group_response_body(throttle_time_ms: i64, error_code: i64, generation_id: i64, protocol_name: text, leader: text, member_id: text, members: list) -> list:
    [throttle_time_ms, error_code, generation_id, protocol_name, leader, member_id, members]

fn get_join_group_response_throttle_time(body: list) -> i64:
    body[0]

fn get_join_group_response_error_code(body: list) -> i64:
    body[1]

fn get_join_group_response_generation_id(body: list) -> i64:
    body[2]

fn get_join_group_response_protocol_name(body: list) -> text:
    body[3]

fn get_join_group_response_leader(body: list) -> text:
    body[4]

fn get_join_group_response_member_id(body: list) -> text:
    body[5]

fn get_join_group_response_members(body: list) -> list:
    body[6]

# Sync group request body: (group_id, generation_id, member_id, group_assignment)
# group_assignment: [(member_id, member_assignment)]
fn create_sync_group_request_body(group_id: text, generation_id: i64, member_id: text, group_assignment: list) -> list:
    [group_id, generation_id, member_id, group_assignment]

fn get_sync_group_request_group_id(body: list) -> text:
    body[0]

fn get_sync_group_request_generation_id(body: list) -> i64:
    body[1]

fn get_sync_group_request_member_id(body: list) -> text:
    body[2]

fn get_sync_group_request_group_assignment(body: list) -> list:
    body[3]

# Sync group response body: (throttle_time_ms, error_code, member_assignment)
fn create_sync_group_response_body(throttle_time_ms: i64, error_code: i64, member_assignment: list) -> list:
    [throttle_time_ms, error_code, member_assignment]

fn get_sync_group_response_throttle_time(body: list) -> i64:
    body[0]

fn get_sync_group_response_error_code(body: list) -> i64:
    body[1]

fn get_sync_group_response_member_assignment(body: list) -> list:
    body[2]

# Heartbeat request body: (group_id, generation_id, member_id)
fn create_heartbeat_request_body(group_id: text, generation_id: i64, member_id: text) -> list:
    [group_id, generation_id, member_id]

fn get_heartbeat_request_group_id(body: list) -> text:
    body[0]

fn get_heartbeat_request_generation_id(body: list) -> i64:
    body[1]

fn get_heartbeat_request_member_id(body: list) -> text:
    body[2]

# Heartbeat response body: (throttle_time_ms, error_code)
fn create_heartbeat_response_body(throttle_time_ms: i64, error_code: i64) -> list:
    [throttle_time_ms, error_code]

fn get_heartbeat_response_throttle_time(body: list) -> i64:
    body[0]

fn get_heartbeat_response_error_code(body: list) -> i64:
    body[1]

# Leave group request body: (group_id, member_id)
fn create_leave_group_request_body(group_id: text, member_id: text) -> list:
    [group_id, member_id]

fn get_leave_group_request_group_id(body: list) -> text:
    body[0]

fn get_leave_group_request_member_id(body: list) -> text:
    body[1]

# Leave group response body: (throttle_time_ms, error_code)
fn create_leave_group_response_body(throttle_time_ms: i64, error_code: i64) -> list:
    [throttle_time_ms, error_code]

fn get_leave_group_response_throttle_time(body: list) -> i64:
    body[0]

fn get_leave_group_response_error_code(body: list) -> i64:
    body[1]

