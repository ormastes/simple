# File Discovery Utilities
#
# Recursive file finding and filtering for Simple source files.

# SFFI wrappers for file discovery (avoid libâ†’app dependency)
extern fn rt_dir_list(path: text) -> text
fn list_files(dir: text) -> [text]:
    val raw = rt_dir_list(dir)
    if raw == nil:
        return []
    raw.split("\n")

fn path_join(base: text, name: text) -> text:
    if base.ends_with("/"):
        "{base}{name}"
    else:
        "{base}/{name}"

fn find_spl_files(dir: text) -> [text]:
    """Recursively find all .spl files in directory."""
    var result: [text] = []
    val files = list_files(dir)
    for file in files:
        val full_path = path_join(dir, file)
        if file.ends_with(".spl"):
            result = result.push(full_path)
    result

fn find_spec_files(dir: text) -> [text]:
    """Recursively find all *_spec.spl files."""
    val all_files = find_spl_files(dir)
    var specs: [text] = []
    for file in all_files:
        if file.contains("_spec.spl"):
            specs = specs.push(file)
    specs

export find_spl_files, find_spec_files
