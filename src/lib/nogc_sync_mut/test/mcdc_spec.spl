# MC/DC Module Basic Tests
use std.spec.*
use std.mcdc.*

describe "MC/DC Basic Tests":
    it "enables and disables mcdc tag":
        disable_mcdc_tag()
        expect is_mcdc_tag_enabled() == false
        enable_mcdc_tag()
        expect is_mcdc_tag_enabled() == true
        disable_mcdc_tag()
        expect is_mcdc_tag_enabled() == false
    
    it "registers decisions":
        enable_mcdc_tag()
        clear_mcdc_data()
        val id = register_decision("a and b", ["a", "b"], "and", "test.spl", 1)
        expect id == 0
        val d = get_decision(id)
        expect d != nil
        disable_mcdc_tag()
    
    it "tracks mcdc_and":
        enable_mcdc_tag()
        clear_mcdc_data()
        val id = register_decision("x and y", ["x", "y"], "and", "t.spl", 1)
        
        val r1 = track_mcdc_and(id, true, true)
        expect r1 == true
        
        val r2 = track_mcdc_and(id, false, true)
        expect r2 == false
        
        val r3 = track_mcdc_and(id, true, false)
        expect r3 == false
        
        val result = analyze_mcdc(id)
        expect result.is_covered == true
        expect result.mcdc_percent == 100.0
        
        disable_mcdc_tag()
    
    it "tracks mcdc_or":
        enable_mcdc_tag()
        clear_mcdc_data()
        val id = register_decision("p or q", ["p", "q"], "or", "t.spl", 1)
        
        track_mcdc_or(id, false, false)
        track_mcdc_or(id, true, false)
        track_mcdc_or(id, false, true)
        
        val result = analyze_mcdc(id)
        expect result.is_covered == true
        
        disable_mcdc_tag()
    
    it "detects incomplete mcdc":
        enable_mcdc_tag()
        clear_mcdc_data()
        val id = register_decision("a and b", ["a", "b"], "and", "t.spl", 1)
        
        # Only one test - not enough for MC/DC
        track_mcdc_and(id, true, true)
        
        val result = analyze_mcdc(id)
        expect result.is_covered == false
        expect result.conditions_covered == 0
        
        disable_mcdc_tag()

describe "MC/DC Summary":
    it "prints test summary":
        print ""
        print "MC/DC Module Tests Passed!"
