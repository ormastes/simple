# MQTT Types Module
# Data structures and constants for MQTT protocol

# =============================================================================
# MQTT Constants
# =============================================================================

# Protocol Versions
val MQTT_VERSION_3_1_1 = 4
val MQTT_VERSION_5_0 = 5

# Packet Types
val PACKET_TYPE_CONNECT = 1
val PACKET_TYPE_CONNACK = 2
val PACKET_TYPE_PUBLISH = 3
val PACKET_TYPE_PUBACK = 4
val PACKET_TYPE_PUBREC = 5
val PACKET_TYPE_PUBREL = 6
val PACKET_TYPE_PUBCOMP = 7
val PACKET_TYPE_SUBSCRIBE = 8
val PACKET_TYPE_SUBACK = 9
val PACKET_TYPE_UNSUBSCRIBE = 10
val PACKET_TYPE_UNSUBACK = 11
val PACKET_TYPE_PINGREQ = 12
val PACKET_TYPE_PINGRESP = 13
val PACKET_TYPE_DISCONNECT = 14
val PACKET_TYPE_AUTH = 15

# QoS Levels
val QOS_AT_MOST_ONCE = 0
val QOS_AT_LEAST_ONCE = 1
val QOS_EXACTLY_ONCE = 2

# CONNECT Flags
val CONNECT_FLAG_USERNAME = 128
val CONNECT_FLAG_PASSWORD = 64
val CONNECT_FLAG_WILL_RETAIN = 32
val CONNECT_FLAG_WILL_QOS_1 = 8
val CONNECT_FLAG_WILL_QOS_2 = 16
val CONNECT_FLAG_WILL_FLAG = 4
val CONNECT_FLAG_CLEAN_SESSION = 2

# PUBLISH Flags
val PUBLISH_FLAG_DUP = 8
val PUBLISH_FLAG_QOS_1 = 2
val PUBLISH_FLAG_QOS_2 = 4
val PUBLISH_FLAG_RETAIN = 1

# CONNACK Return Codes (v3.1.1)
val CONNACK_ACCEPTED = 0
val CONNACK_REFUSED_PROTOCOL = 1
val CONNACK_REFUSED_IDENTIFIER = 2
val CONNACK_REFUSED_SERVER_UNAVAILABLE = 3
val CONNACK_REFUSED_BAD_CREDENTIALS = 4
val CONNACK_REFUSED_NOT_AUTHORIZED = 5

# MQTT v5.0 Reason Codes
val REASON_SUCCESS = 0
val REASON_NORMAL_DISCONNECTION = 0
val REASON_GRANTED_QOS_0 = 0
val REASON_GRANTED_QOS_1 = 1
val REASON_GRANTED_QOS_2 = 2
val REASON_DISCONNECT_WILL = 4
val REASON_NO_MATCHING_SUBSCRIBERS = 16
val REASON_UNSPECIFIED_ERROR = 128
val REASON_MALFORMED_PACKET = 129
val REASON_PROTOCOL_ERROR = 130
val REASON_IMPLEMENTATION_ERROR = 131
val REASON_UNSUPPORTED_PROTOCOL = 132
val REASON_CLIENT_IDENTIFIER_NOT_VALID = 133
val REASON_BAD_CREDENTIALS = 134
val REASON_NOT_AUTHORIZED = 135
val REASON_SERVER_UNAVAILABLE = 136
val REASON_SERVER_BUSY = 137
val REASON_BANNED = 138
val REASON_BAD_AUTHENTICATION = 140
val REASON_TOPIC_NAME_INVALID = 144
val REASON_PACKET_TOO_LARGE = 149
val REASON_QUOTA_EXCEEDED = 151
val REASON_PAYLOAD_FORMAT_INVALID = 153
val REASON_RETAIN_NOT_SUPPORTED = 154
val REASON_QOS_NOT_SUPPORTED = 155
val REASON_USE_ANOTHER_SERVER = 156
val REASON_SERVER_MOVED = 157
val REASON_CONNECTION_RATE_EXCEEDED = 159

# MQTT v5.0 Property IDs
val PROPERTY_PAYLOAD_FORMAT = 1
val PROPERTY_MESSAGE_EXPIRY = 2
val PROPERTY_CONTENT_TYPE = 3
val PROPERTY_RESPONSE_TOPIC = 8
val PROPERTY_CORRELATION_DATA = 9
val PROPERTY_SUBSCRIPTION_ID = 11
val PROPERTY_SESSION_EXPIRY = 17
val PROPERTY_ASSIGNED_CLIENT_ID = 18
val PROPERTY_SERVER_KEEP_ALIVE = 19
val PROPERTY_AUTH_METHOD = 21
val PROPERTY_AUTH_DATA = 22
val PROPERTY_REQUEST_PROBLEM_INFO = 23
val PROPERTY_WILL_DELAY = 24
val PROPERTY_REQUEST_RESPONSE_INFO = 25
val PROPERTY_RESPONSE_INFO = 26
val PROPERTY_SERVER_REFERENCE = 28
val PROPERTY_REASON_STRING = 31
val PROPERTY_RECEIVE_MAXIMUM = 33
val PROPERTY_TOPIC_ALIAS_MAXIMUM = 34
val PROPERTY_TOPIC_ALIAS = 35
val PROPERTY_MAXIMUM_QOS = 36
val PROPERTY_RETAIN_AVAILABLE = 37
val PROPERTY_USER_PROPERTY = 38
val PROPERTY_MAXIMUM_PACKET_SIZE = 39
val PROPERTY_WILDCARD_SUB_AVAILABLE = 40
val PROPERTY_SUB_ID_AVAILABLE = 41
val PROPERTY_SHARED_SUB_AVAILABLE = 42

# Maximum lengths
val MAX_CLIENT_ID_LENGTH = 23
val MAX_TOPIC_LENGTH = 65535
val MAX_PAYLOAD_SIZE = 268435455

# =============================================================================
# Packet Structure Functions
# Packet: (type, flags, headers, payload)
# =============================================================================

fn mqtt_create_packet(packet_type, flags, headers, payload):
    """Create an MQTT packet tuple."""
    (packet_type, flags, headers, payload)

fn mqtt_packet_type(packet):
    """Get packet type from packet tuple."""
    val parts = packet
    parts[0]

fn mqtt_packet_flags(packet):
    """Get packet flags from packet tuple."""
    val parts = packet
    parts[1]

fn mqtt_packet_headers(packet):
    """Get packet headers from packet tuple."""
    val parts = packet
    parts[2]

fn mqtt_packet_payload(packet):
    """Get packet payload from packet tuple."""
    val parts = packet
    parts[3]

fn mqtt_set_packet_type(packet, packet_type):
    """Set packet type in packet tuple."""
    val parts = packet
    val flags = parts[1]
    val headers = parts[2]
    val payload = parts[3]
    (packet_type, flags, headers, payload)

fn mqtt_set_packet_flags(packet, flags):
    """Set packet flags in packet tuple."""
    val parts = packet
    val ptype = parts[0]
    val headers = parts[2]
    val payload = parts[3]
    (ptype, flags, headers, payload)

fn mqtt_set_packet_headers(packet, headers):
    """Set packet headers in packet tuple."""
    val parts = packet
    val ptype = parts[0]
    val flags = parts[1]
    val payload = parts[3]
    (ptype, flags, headers, payload)

fn mqtt_set_packet_payload(packet, payload):
    """Set packet payload in packet tuple."""
    val parts = packet
    val ptype = parts[0]
    val flags = parts[1]
    val headers = parts[2]
    (ptype, flags, headers, payload)
