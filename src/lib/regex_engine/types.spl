# Regular Expression Engine - Type Definitions
#
# Data structures for regex engine implementation.

# ============================================================================
# DATA STRUCTURES
# ============================================================================

class RegexToken:
    """Token from regex lexer."""
    token_type: text    # "literal", "dot", "star", "plus", "question", "pipe", "lparen", "rparen", "lbracket", "rbracket", "lbrace", "rbrace", "caret", "dollar", "escape", "eof"
    value: text         # Token value (character or escape sequence)
    pos: i64            # Position in input string

class RegexAST:
    """Abstract syntax tree node for regex."""
    node_type: text     # "literal", "dot", "char_class", "concat", "alternation", "quantifier", "group", "anchor"
    value: text         # Value for literals, class definition for char_class
    children: [any]     # Child AST nodes
    min_count: i64      # For quantifiers: minimum repetitions
    max_count: i64      # For quantifiers: maximum repetitions (-1 for infinity)
    lazy: bool          # For quantifiers: lazy matching
    negated: bool       # For char_class: negated class [^...]
    group_id: i64       # For groups: group number
    group_name: text    # For named groups: group name

class NFAState:
    """State in NFA automaton."""
    state_id: i64       # Unique state identifier
    is_accept: bool     # True if this is an accepting state
    group_start: i64    # Group ID if this starts a group capture (-1 otherwise)
    group_end: i64      # Group ID if this ends a group capture (-1 otherwise)

class NFATransition:
    """Transition in NFA automaton."""
    from_state: i64     # Source state ID
    to_state: i64       # Destination state ID
    symbol: text        # Input symbol (empty string for epsilon transition)
    char_class: text    # Character class definition if applicable

class NFA:
    """Non-deterministic finite automaton."""
    states: [any]       # Array of NFAState
    transitions: [any]  # Array of NFATransition
    start_state: i64    # Start state ID
    accept_state: i64   # Accept state ID
    next_state_id: i64  # Counter for generating unique state IDs
    group_count: i64    # Number of capture groups

class DFAState:
    """State in DFA automaton."""
    state_id: i64       # Unique state identifier
    is_accept: bool     # True if this is an accepting state
    nfa_states: [i64]   # Set of NFA states this DFA state represents

class DFATransition:
    """Transition in DFA automaton."""
    from_state: i64     # Source state ID
    to_state: i64       # Destination state ID
    symbol: text        # Input symbol

class DFA:
    """Deterministic finite automaton."""
    states: [any]       # Array of DFAState
    transitions: [any]  # Array of DFATransition
    start_state: i64    # Start state ID
    accept_states: [i64] # List of accept state IDs

class MatchState:
    """Current state during regex matching."""
    pos: i64            # Current position in input string
    nfa_states: [i64]   # Current set of NFA states
    groups: [any]       # Captured groups: array of (start, end) tuples
    backtrack_stack: [any] # Stack for backtracking: array of MatchState snapshots

class MatchResult:
    """Result of a regex match operation."""
    matched: bool       # Whether a match was found
    start_pos: i64      # Start position of match in input
    end_pos: i64        # End position of match in input (exclusive)
    groups: [any]       # Captured groups: array of (start, end, text) tuples
    group_names: {text: i64} # Map from group names to group IDs

export RegexToken, RegexAST, NFAState, NFATransition, NFA
export DFAState, DFATransition, DFA, MatchState, MatchResult
