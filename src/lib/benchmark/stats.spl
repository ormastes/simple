# Benchmark Statistical Calculations

# ============================================================================
# Statistical Calculation
# ============================================================================

fn calculate_mean(values):
    """Calculate arithmetic mean.

    Example:
        calculate_mean([1, 2, 3, 4, 5])  # 3
    """
    if values.len() == 0:
        return 0

    var total = 0
    for value in values:
        total = total + value

    total / values.len()

fn calculate_median(values):
    """Calculate median from sorted values.

    Example:
        calculate_median([1, 2, 3, 4, 5])  # 3
    """
    if values.len() == 0:
        return 0

    val sorted = sort_values(values)
    val len = sorted.len()
    val mid = len / 2

    if len % 2 == 1:
        sorted[mid]
    else:
        (sorted[mid - 1] + sorted[mid]) / 2

fn calculate_variance(values):
    """Calculate population variance.

    Example:
        calculate_variance([1, 2, 3, 4, 5])  # 2
    """
    if values.len() == 0:
        return 0

    val mean_val = calculate_mean(values)
    var sum_sq_diff = 0

    for value in values:
        val diff = value - mean_val
        sum_sq_diff = sum_sq_diff + (diff * diff)

    sum_sq_diff / values.len()

fn calculate_stddev(values):
    """Calculate standard deviation (integer approximation).

    Example:
        calculate_stddev([1, 2, 3, 4, 5])  # ~1
    """
    val variance = calculate_variance(values)

    # Integer square root approximation
    var low = 0
    var high = variance
    var result = 0

    while low <= high:
        val mid = low + (high - low) / 2
        val squared = mid * mid

        if squared == variance:
            return mid
        elif squared < variance:
            result = mid
            low = mid + 1
        else:
            high = mid - 1

    result

fn calculate_sum(values):
    """Calculate sum of values.

    Example:
        calculate_sum([1, 2, 3, 4, 5])  # 15
    """
    var total = 0
    for value in values:
        total = total + value
    total

# ============================================================================
# Percentile Calculation
# ============================================================================

fn percentile(sorted_values, p: i64):
    """Calculate percentile from sorted values.

    Args:
        sorted_values: Array sorted in ascending order
        p: Percentile (0-100)

    Example:
        percentile([1, 2, 3, 4, 5], 50)  # 3 (median)
        percentile([1, 2, 3, 4, 5], 95)  # 5
    """
    if sorted_values.len() == 0:
        return 0

    if p < 0:
        return sorted_values[0]
    if p > 100:
        return sorted_values[sorted_values.len() - 1]

    val index = (p * (sorted_values.len() - 1)) / 100
    sorted_values[index]

fn percentile_50(values):
    """Calculate 50th percentile (median).

    Example:
        percentile_50([5, 1, 3, 2, 4])  # 3
    """
    val sorted = sort_values(values)
    percentile(sorted, 50)

fn percentile_95(values):
    """Calculate 95th percentile.

    Example:
        percentile_95([1, 2, 3, 4, 5])  # 5
    """
    val sorted = sort_values(values)
    percentile(sorted, 95)

fn percentile_99(values):
    """Calculate 99th percentile.

    Example:
        percentile_99([1, 2, 3, 4, 5])  # 5
    """
    val sorted = sort_values(values)
    percentile(sorted, 99)

# ============================================================================
# Distribution Analysis
# ============================================================================

fn min_value(values):
    """Find minimum value in array.

    Example:
        min_value([3, 1, 4, 1, 5])  # 1
    """
    if values.len() == 0:
        return 0

    var min_val = values[0]
    for value in values:
        if value < min_val:
            min_val = value
    min_val

fn max_value(values):
    """Find maximum value in array.

    Example:
        max_value([3, 1, 4, 1, 5])  # 5
    """
    if values.len() == 0:
        return 0

    var max_val = values[0]
    for value in values:
        if value > max_val:
            max_val = value
    max_val

fn range_value(values):
    """Calculate range (max - min).

    Example:
        range_value([1, 2, 3, 4, 5])  # 4
    """
    max_value(values) - min_value(values)

fn coefficient_of_variation(values):
    """Calculate coefficient of variation (stddev/mean * 100).

    Returns percentage as integer (e.g., 15 for 15%).

    Example:
        coefficient_of_variation([10, 12, 14])  # ~15
    """
    val mean_val = calculate_mean(values)
    if mean_val == 0:
        return 0

    val stddev = calculate_stddev(values)
    (stddev * 100) / mean_val

# ============================================================================
