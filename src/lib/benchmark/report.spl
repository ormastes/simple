# Benchmark Reporting and Output

# ============================================================================
# Formatted Output
# ============================================================================

fn format_time(value: i64):
    """Format time value with appropriate unit.

    Example:
        format_time(1234)  # "1234 units"
    """
    "{value} units"

fn format_percentage(value: i64):
    """Format percentage value.

    Example:
        format_percentage(150)  # "150%"
    """
    "{value}%"

fn format_result(result):
    """Format benchmark result as string.

    Example:
        print format_result(result)
    """
    val (name, _, stats, iterations) = result
    val mean_val = get_stat_mean(stats)
    val median_val = get_stat_median(stats)
    val stddev = get_stat_stddev(stats)
    val p95 = get_stat_p95(stats)

    var output = ""
    output = "{output}{name}:"
    output = "{output}\n  Iterations: {iterations}"
    output = "{output}\n  Mean:   {mean_val} units"
    output = "{output}\n  Median: {median_val} units"
    output = "{output}\n  StdDev: {stddev}"
    output = "{output}\n  95th:   {p95} units"
    output

fn format_comparison(comparison):
    """Format comparison result as string.

    Example:
        print format_comparison(comp)
    """
    val (name1, name2, speedup, faster_name, significant) = comparison

    val speedup_x = speedup / 100
    val speedup_frac = speedup % 100

    var sig_text = ""
    if significant:
        sig_text = " (SIGNIFICANT)"

    "Comparison: {name1} vs {name2}\n  Faster: {faster_name}\n  Speedup: {speedup_x}.{speedup_frac}x{sig_text}"

fn format_stats_row(name: text, stats):
    """Format stats as table row.

    Returns: Formatted string
    """
    val mean_val = get_stat_mean(stats)
    val median_val = get_stat_median(stats)
    val stddev = get_stat_stddev(stats)
    val p95 = get_stat_p95(stats)

    "{name}: mean={mean_val}, median={median_val}, std={stddev}, p95={p95}"

# ============================================================================
# Summary Reports
# ============================================================================

fn print_result(result):
    """Print formatted benchmark result.

    Example:
        print_result(result)
    """
    print format_result(result)

fn print_comparison(comparison):
    """Print formatted comparison.

    Example:
        print_comparison(comp)
    """
    print format_comparison(comparison)

fn print_summary(suite_result):
    """Print comprehensive suite summary.

    Example:
        val suite_result = run_suite(suite)
        print_summary(suite_result)
    """
    val (suite_name, results, summary) = suite_result
    val (total_benchmarks, avg_mean, avg_median) = summary

    print "================================"
    print "Benchmark Suite: {suite_name}"
    print "================================"
    print "Total Benchmarks: {total_benchmarks}"
    print ""

    for result in results:
        print format_result(result)
        print ""

    print "--------------------------------"
    print "Suite Average:"
    print "  Mean:   {avg_mean} units"
    print "  Median: {avg_median} units"
    print "================================"

fn print_comparison_table(results):
    """Print comparison table for multiple results.

    Example:
        print_comparison_table([result1, result2, result3])
    """
    print "Comparison Table:"
    print "--------------------------------"

    for result in results:
        val (name, _, stats, _) = result
        print format_stats_row(name, stats)

    print "--------------------------------"

fn print_regression_report(baseline_result, current_result):
    """Print regression analysis report.

    Example:
        print_regression_report(baseline, current)
    """
    val regressed = detect_regression(baseline_result, current_result, 5)
    val change = regression_percentage(baseline_result, current_result)

    print "Regression Analysis:"
    print "  Change: {change}%"

    if regressed:
        print "  Status: REGRESSION DETECTED"
    elif change < 0:
        print "  Status: Performance Improved"
    else:
        print "  Status: Within Threshold"

# ============================================================================
# Export to File (Text Format)
# ============================================================================

fn export_result_text(result):
    """Export result to text format.

    Returns: String representation suitable for file export
    """
    format_result(result)

fn export_comparison_text(comparison):
    """Export comparison to text format.

    Returns: String representation
    """
    format_comparison(comparison)

fn export_suite_text(suite_result):
    """Export suite result to text format.

    Returns: String representation
    """
    val (suite_name, results, summary) = suite_result
    val (total_benchmarks, avg_mean, avg_median) = summary

    var output = "Benchmark Suite: {suite_name}\n"
    output = "{output}Total Benchmarks: {total_benchmarks}\n\n"

    for result in results:
        val formatted = format_result(result)
        output = "{output}{formatted}\n\n"

    output = "{output}Suite Average:\n"
    output = "{output}  Mean:   {avg_mean} units\n"
    output = "{output}  Median: {avg_median} units\n"

    output

# ============================================================================
