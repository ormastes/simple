# Standard Library â€” Option Chaining Methods
#
# @tag:api
# @tag:stdlib
#
# Functional chaining methods for Option values.
# Simple language uses nil = None, non-nil = Some convention.
#
# Usage:
#   val opt = some_value
#   val mapped = option_map(opt, fn(x): x * 2)
#   val default = option_unwrap_or(mapped, 0)

# Returns true if option has a value (Some).
fn option_is_some(opt) -> bool:
    opt != nil

# Returns true if option is empty (None).
fn option_is_none(opt) -> bool:
    opt == nil

# Maps a Some value. Returns nil if None.
fn option_map(opt, transform: fn()):
    if opt == nil:
        return nil
    transform(opt)

# Filters: returns opt if predicate is true, nil otherwise.
fn option_filter(opt, predicate: fn()) -> bool:
    if opt == nil:
        return nil
    val passes = predicate(opt)
    if passes:
        return opt
    nil

# Chains an option-returning function (flatMap).
fn option_flat_map(opt, chain: fn()):
    if opt == nil:
        return nil
    chain(opt)

# Returns alternative Option if opt is None.
fn option_or_else(opt, alternative: fn()):
    if opt != nil:
        return opt
    alternative()

# Returns value or default if None.
fn option_unwrap_or(opt, default_val):
    if opt == nil:
        return default_val
    opt

# Returns value or calls function to produce default.
fn option_unwrap_or_else(opt, default_fn: fn()):
    if opt == nil:
        return default_fn()
    opt

# Zips two options into a pair (as array [a, b]), or nil if either is None.
fn option_zip(opt_a, opt_b):
    if opt_a == nil:
        return nil
    if opt_b == nil:
        return nil
    [opt_a, opt_b]

# Converts None to an error result, Some to Ok result.
fn option_to_result(opt, error_msg: text):
    if opt == nil:
        return nil
    opt

# Applies side effect if Some, returns opt unchanged.
fn option_inspect(opt, side_effect: fn()):
    if opt != nil:
        side_effect(opt)
    opt

export option_is_some, option_is_none
export option_map, option_filter, option_flat_map
export option_or_else, option_unwrap_or, option_unwrap_or_else
export option_zip, option_to_result, option_inspect
