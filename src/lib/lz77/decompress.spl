# LZ77 Decompression Operations
#
# Functions for decompressing LZ77-encoded data.

# ============================================================================
# Exports
# ============================================================================

export decompress_tokens_simple

# ============================================================================
# Decompression
# ============================================================================

fn decompress_tokens_simple(tokens: list) -> list:
    # Simple decompression from token list
    val output = []
    var i = 0
    val len = tokens.len()
    while i < len:
        val token = tokens[i]
        if token.is_literal():
            val byte = token.get_literal_value()
            output.push(byte)
        else:
            val distance = token.get_match_distance()
            val length = token.get_match_length()
            val out_len = output.len()
            val start_pos = out_len - distance
            var j = 0
            while j < length:
                val src_idx = start_pos + j
                if src_idx >= 0:
                    if src_idx < output.len():
                        val byte = output[src_idx]
                        output.push(byte)
                j = j + 1
        i = i + 1
    output
