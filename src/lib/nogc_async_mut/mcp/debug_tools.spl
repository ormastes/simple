# MCP Debug Tools - Bridges DAP debug infrastructure to MCP server
#
# Provides 16 debug tools for AI agents:
# - Session lifecycle: create, list, close
# - Breakpoints: set, remove, function breakpoint, enable/disable
# - Execution: continue, step, terminate
# - Inspection: variables, stack trace, evaluate, source
# - Watches: add, remove, list
# - Variable modification: set variable
#
# Schema functions are in debug_schemas.spl
# Handler functions are in debug_handlers.spl

use std.nogc_async_mut.mcp.helpers.{LB, RB, Q, jp, js, jo1, jo2, parse_int, extract_arg, extract_nested_string, make_tool_result, make_error_response, make_tool_schema_multi}
use app.io.mod (rt_debug_set_active, rt_debug_add_breakpoint_at, rt_debug_remove_breakpoint_at, rt_debug_continue_exec, rt_debug_pause_exec, rt_debug_set_step_mode_val, rt_debug_stack_trace_lines, rt_debug_local_vars, rt_debug_get_current_file, rt_debug_get_current_line, rt_debug_add_breakpoint_rich, rt_debug_add_function_breakpoint, rt_debug_set_breakpoint_enabled, rt_debug_get_breakpoint_info, rt_debug_list_breakpoints, rt_debug_get_source_lines, rt_debug_add_watch, rt_debug_remove_watch, rt_debug_list_watches, rt_debug_set_variable, rt_debug_terminate, rt_debug_select_frame, rt_debug_get_selected_frame, rt_debug_frame_locals)

# Sub-module imports
use std.nogc_async_mut.mcp.debug_session.{SessionState, TargetType, SessionBreakpoint, SessionDataBreakpoint, DebugSession, SessionManager}
use std.nogc_async_mut.mcp.debug_eval.{EvalResult, eval_expression, eval_get_type, eval_get_value}
use std.nogc_async_mut.mcp.debug_parse.{parse_var_entry, parse_stack_frame, step_mode_to_int}

fn data_breakpoint_limit_for_target(target_type: String) -> Int:
    if target_type == "remote" or target_type == "baremetal":
        return 1
    1024

# --- Exports ---

# Re-export from sub-modules
export SessionState, TargetType, SessionBreakpoint, SessionDataBreakpoint, DebugSession, SessionManager
export EvalResult, eval_expression, eval_get_type, eval_get_value
export parse_var_entry, parse_stack_frame, step_mode_to_int

# Own schema functions
export schema_debug_create_session, schema_debug_list_sessions, schema_debug_close_session
export schema_debug_set_breakpoint, schema_debug_remove_breakpoint
export schema_debug_continue, schema_debug_step
export schema_debug_get_variables, schema_debug_stack_trace, schema_debug_evaluate
export schema_debug_set_function_breakpoint, schema_debug_enable_breakpoint
export schema_debug_get_source, schema_debug_watch
export schema_debug_set_variable, schema_debug_set_data_breakpoint, schema_debug_list_data_breakpoints, schema_debug_remove_data_breakpoint, schema_debug_terminate

# Own handler functions
export handle_debug_create_session, handle_debug_list_sessions, handle_debug_close_session
export handle_debug_set_breakpoint, handle_debug_remove_breakpoint
export handle_debug_continue, handle_debug_step
export handle_debug_get_variables, handle_debug_stack_trace, handle_debug_evaluate
export handle_debug_set_function_breakpoint, handle_debug_enable_breakpoint
export handle_debug_get_source, handle_debug_watch
export handle_debug_set_variable, handle_debug_set_data_breakpoint, handle_debug_list_data_breakpoints, handle_debug_remove_data_breakpoint, handle_debug_terminate
