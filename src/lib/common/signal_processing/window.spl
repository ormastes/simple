# Signal Processing - Window Functions Module

use signal_processing.types.{TWO_PI, cos_f64, sqrt_f64, abs_f64}

# ============================================================================
# WINDOW FUNCTIONS
# ============================================================================

fn window_rectangular(n: i64, output: list):
    # Rectangular (boxcar) window
    var i = 0
    while i < n:
        output[i] = 1.0
        i = i + 1
    pass

fn window_hamming(n: i64, output: list):
    # Hamming window
    var i = 0
    while i < n:
        var phase = TWO_PI * i / (n - 1)
        output[i] = 0.54 - 0.46 * cos_f64(phase)
        i = i + 1
    pass

fn window_hanning(n: i64, output: list):
    # Hanning (Hann) window
    var i = 0
    while i < n:
        var phase = TWO_PI * i / (n - 1)
        output[i] = 0.5 * (1.0 - cos_f64(phase))
        i = i + 1
    pass

fn window_blackman(n: i64, output: list):
    # Blackman window
    var a0 = 0.42
    var a1 = 0.5
    var a2 = 0.08
    var i = 0
    while i < n:
        var phase1 = TWO_PI * i / (n - 1)
        var phase2 = 2.0 * phase1
        output[i] = a0 - a1 * cos_f64(phase1) + a2 * cos_f64(phase2)
        i = i + 1
    pass

fn window_kaiser(n: i64, beta: f64, output: list):
    # Kaiser window (simplified - using approximation)
    var alpha = (n - 1) / 2.0
    var i = 0
    while i < n:
        var x = (i - alpha) / alpha
        var arg = beta * sqrt_f64(1.0 - x * x)
        # Simplified I0 Bessel function approximation
        var bessel = 1.0 + arg * arg / 4.0
        output[i] = bessel / (1.0 + beta * beta / 4.0)
        i = i + 1
    pass

fn window_bartlett(n: i64, output: list):
    # Bartlett (triangular) window
    var mid = (n - 1) / 2.0
    var i = 0
    while i < n:
        output[i] = 1.0 - abs_f64((i - mid) / mid)
        i = i + 1
    pass

fn apply_window(signal: list, window: list, output: list, n: i64):
    # Apply window function to signal
    var i = 0
    while i < n:
        output[i] = signal[i] * window[i]
        i = i + 1
    pass
