# K-d Tree Insertion Operations
# Single and bulk point insertion

import kd_tree.types

# ============================================================================
# K-d Tree Insertion
# ============================================================================

fn kdtree_insert_recursive(node, point: List<i64>, depth: i64, k: i64):
    # Recursively insert point into K-d tree
    if node == nil:
        val dim = depth % k
        val value = point.get(dim)
        return kdnode_create(dim, value, point)

    val dim = kdnode_get_dim(node)
    val pivot = kdnode_get_value(node)
    val coord = point.get(dim)

    if coord < pivot:
        val left = kdnode_get_left(node)
        val new_left = kdtree_insert_recursive(left, point, depth + 1, k)
        kdnode_set_left(node, new_left)
    else:
        val right = kdnode_get_right(node)
        val new_right = kdtree_insert_recursive(right, point, depth + 1, k)
        kdnode_set_right(node, new_right)

    node

fn kdtree_insert(node, point: List<i64>):
    # Insert point into K-d tree
    val k = point_dimension(point)
    kdtree_insert_recursive(node, point, 0, k)

# ============================================================================
# Bulk Operations
# ============================================================================

fn kdtree_bulk_insert(node, points: List<List<i64>>):
    # Insert multiple points into tree
    var current = node
    var i = 0
    while i < points.length():
        val point = points.get(i)
        current = kdtree_insert(current, point)
        i = i + 1
    current
