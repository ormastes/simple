# Rope Types and Constants Module
# Type definitions and configuration constants for rope data structure

# ============================================================================
# CONSTANTS AND CONFIGURATION
# ============================================================================

val ROPE_MIN_LEAF_SIZE = 8
val ROPE_MAX_LEAF_SIZE = 1024
val ROPE_IDEAL_LEAF_SIZE = 512
val ROPE_REBALANCE_RATIO = 1.5

# ============================================================================
# NODE STRUCTURE
# ============================================================================
# Rope nodes are tuples: (tag, weight, left, right, value)
# - tag: "leaf" or "concat"
# - weight: left subtree length (for concat) or string length (for leaf)
# - left: left child node (for concat) or nil (for leaf)
# - right: right child node (for concat) or nil (for leaf)
# - value: string data (for leaf) or nil (for concat)

# ============================================================================
# TYPE PREDICATES
# ============================================================================

fn rope_is_leaf(node: any) -> bool:
    # Check if node is a leaf
    if node == nil:
        return false
    var tag = node.0
    tag == "leaf"

fn rope_is_concat(node: any) -> bool:
    # Check if node is a concat node
    if node == nil:
        return false
    var tag = node.0
    tag == "concat"

fn rope_is_empty(node: any) -> bool:
    # Check if rope is empty
    if node == nil:
        return true
    rope_length(node) == 0

# ============================================================================
# ROPE PROPERTIES
# ============================================================================

fn rope_length(node: any) -> i64:
    # Get total length of rope
    if node == nil:
        return 0

    var tag = node.0
    if tag == "leaf":
        return node.1

    # Concat node: sum both subtrees
    var left_weight = node.1
    var right = node.3
    var right_len = rope_length(right)
    left_weight + right_len

fn rope_weight(node: any) -> i64:
    # Get weight of node (left subtree length)
    if node == nil:
        return 0
    node.1

fn rope_depth(node: any) -> i64:
    # Get depth of rope tree
    if node == nil:
        return 0

    if rope_is_leaf(node):
        return 1

    var left = node.2
    var right = node.3
    var left_depth = rope_depth(left)
    var right_depth = rope_depth(right)

    var max_depth = left_depth
    if right_depth > max_depth:
        max_depth = right_depth

    max_depth + 1
