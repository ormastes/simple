# Standard Library â€” StringBuilder
#
# @tag:api
# @tag:stdlib
#
# A mutable string builder that accumulates parts efficiently.
# Use this instead of repeated string concatenation for large strings.
#
# Usage:
#   val sb = StringBuilder()
#   sb.push("Hello, ")
#   sb.push("World!")
#   val result = sb.to_text()

class StringBuilder:
    parts: [text]

    fn push(part: text):
        self.parts.push(part)

    fn push_line(part: text):
        self.parts.push(part)
        self.parts.push("\n")

    fn push_char(c: text):
        self.parts.push(c)

    fn to_text() -> text:
        self.parts.join("")

    fn len() -> i64:
        var total: i64 = 0
        for p in self.parts:
            total = total + p.len()
        total

    fn is_empty() -> bool:
        self.parts.len() == 0

    me clear():
        self.parts = []

    fn push_all(parts: [text]):
        for p in parts:
            self.parts.push(p)

    fn push_sep(part: text, sep: text):
        if self.parts.len() > 0:
            self.parts.push(sep)
        self.parts.push(part)

    fn to_text_sep(sep: text) -> text:
        self.parts.join(sep)

    static fn from_parts(parts: [text]) -> StringBuilder:
        StringBuilder(parts: parts)

    static fn new() -> StringBuilder:
        StringBuilder(parts: [])

    static fn from_text(s: text) -> StringBuilder:
        val sb = StringBuilder(parts: [])
        sb.parts.push(s)
        sb

fn string_builder() -> StringBuilder:
    StringBuilder(parts: [])

fn string_builder_from(s: text) -> StringBuilder:
    val sb = StringBuilder(parts: [])
    sb.parts.push(s)
    sb

export StringBuilder, string_builder, string_builder_from
