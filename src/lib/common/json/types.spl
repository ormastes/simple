# JSON Types and Constructors
#
# Purpose: Core JSON value constructors and type checking
#
# Contains:
# - Constructors: json_null, json_boolean, json_number, json_string, json_array, json_object
# - Type checking: json_get_type, json_type_check, json_is_* predicates
# - Type conversion: json_to_* extractors

# ============================================================================
# Constructors
# ============================================================================

fn json_null():
    """Create a JSON null value.

    Returns:
        ("null", nil)

    Example:
        val n = json_null()
    """
    ("null", nil)

fn json_boolean(value: bool):
    """Create a JSON boolean value.

    Args:
        value: Boolean value

    Returns:
        ("boolean", value)

    Example:
        val b = json_boolean(true)
    """
    ("boolean", value)

fn json_number(value: f64):
    """Create a JSON number value.

    Args:
        value: Number value

    Returns:
        ("number", value)

    Example:
        val n = json_number(42.5)
    """
    ("number", value)

fn json_string(value: text):
    """Create a JSON string value.

    Args:
        value: String value

    Returns:
        ("string", value)

    Example:
        val s = json_string("hello")
    """
    ("string", value)

fn json_array(values: [any]):
    """Create a JSON array value.

    Args:
        values: Array of JSON values

    Returns:
        ("array", values)

    Example:
        val arr = json_array([json_number(1), json_number(2)])
    """
    ("array", values)

fn json_object(pairs: {text: any}):
    """Create a JSON object value.

    Args:
        pairs: Map of key-value pairs

    Returns:
        ("object", pairs)

    Example:
        val obj = json_object({"name": json_string("Alice")})
    """
    ("object", pairs)

# ============================================================================
# Type Checking
# ============================================================================

fn json_get_type(value: any) -> text:
    """Get the type of a JSON value.

    Args:
        value: JSON value tuple

    Returns:
        Type name: "object", "array", "string", "number", "boolean", "null"

    Example:
        json_get_type(json_string("hi"))  # "string"
    """
    if value == nil:
        return "null"
    val type_part = value.0
    if type_part == nil:
        return "null"
    type_part

fn json_type_check(value: any, expected_type: text) -> bool:
    """Check if a JSON value has the expected type.

    Args:
        value: JSON value
        expected_type: Expected type name

    Returns:
        true if types match, false otherwise

    Example:
        json_type_check(json_number(5), "number")  # true
    """
    json_get_type(value) == expected_type

fn json_is_null(value: any) -> bool:
    """Check if value is JSON null.

    Args:
        value: JSON value

    Returns:
        true if null, false otherwise
    """
    json_get_type(value) == "null"

fn json_is_boolean(value: any) -> bool:
    """Check if value is JSON boolean.

    Args:
        value: JSON value

    Returns:
        true if boolean, false otherwise
    """
    json_get_type(value) == "boolean"

fn json_is_number(value: any) -> bool:
    """Check if value is JSON number.

    Args:
        value: JSON value

    Returns:
        true if number, false otherwise
    """
    json_get_type(value) == "number"

fn json_is_string(value: any) -> bool:
    """Check if value is JSON string.

    Args:
        value: JSON value

    Returns:
        true if string, false otherwise
    """
    json_get_type(value) == "string"

fn json_is_array(value: any) -> bool:
    """Check if value is JSON array.

    Args:
        value: JSON value

    Returns:
        true if array, false otherwise
    """
    json_get_type(value) == "array"

fn json_is_object(value: any) -> bool:
    """Check if value is JSON object.

    Args:
        value: JSON value

    Returns:
        true if object, false otherwise
    """
    json_get_type(value) == "object"

# ============================================================================
# Type Conversion
# ============================================================================

fn json_to_boolean(value: any) -> any:
    """Extract boolean from JSON value.

    Args:
        value: JSON value

    Returns:
        Boolean value if type matches, nil otherwise

    Example:
        json_to_boolean(json_boolean(true))  # true
    """
    if json_is_boolean(value):
        return value.1
    nil

fn json_to_number(value: any) -> any:
    """Extract number from JSON value.

    Args:
        value: JSON value

    Returns:
        Number value if type matches, nil otherwise

    Example:
        json_to_number(json_number(42))  # 42
    """
    if json_is_number(value):
        return value.1
    nil

fn json_to_string(value: any) -> any:
    """Extract string from JSON value.

    Args:
        value: JSON value

    Returns:
        String value if type matches, nil otherwise

    Example:
        json_to_string(json_string("hi"))  # "hi"
    """
    if json_is_string(value):
        return value.1
    nil

fn json_to_array(value: any) -> any:
    """Extract array from JSON value.

    Args:
        value: JSON value

    Returns:
        Array value if type matches, nil otherwise

    Example:
        json_to_array(json_array([json_number(1)]))  # [json_number(1)]
    """
    if json_is_array(value):
        return value.1
    nil

fn json_to_object(value: any) -> any:
    """Extract object from JSON value.

    Args:
        value: JSON value

    Returns:
        Object map if type matches, nil otherwise

    Example:
        json_to_object(json_object({"k": json_string("v")}))  # {"k": json_string("v")}
    """
    if json_is_object(value):
        return value.1
    nil

export *
