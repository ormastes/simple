# B-Tree Traversal Operations
#
# Purpose: Tree traversal algorithms
#
# Contains:
# - Inorder traversal (sorted order)
# - Level-order traversal (BFS)
# - Keys at specific level

mod b_tree.types

# ============================================================================
# Traversal Functions
# ============================================================================

# Inorder traversal of a node (returns sorted list of keys)
fn inorder_node(node):
    val keys = node_keys(node)
    val children = node_children(node)
    val is_leaf = node_is_leaf(node)
    val n = node_n(node)

    var result = []

    if is_leaf:
        # Just return keys
        for i in 0..n:
            val k = keys.i
            result = list_append(result, k)
        result
    else:
        # Visit children and keys in order
        for i in 0..n:
            val child = children.i
            val child_keys = inorder_node(child)
            result = list_concat(result, child_keys)
            val k = keys.i
            result = list_append(result, k)

        # Visit last child
        val last_child = children.n
        val last_keys = inorder_node(last_child)
        result = list_concat(result, last_keys)
        result

# Inorder traversal of B-tree (returns sorted list)
fn inorder_traversal(tree):
    val root = tree_root(tree)
    inorder_node(root)

# Get all keys at a specific level
fn keys_at_level(node, level, current_level):
    if current_level == level:
        val keys = node_keys(node)
        keys
    else:
        val is_leaf = node_is_leaf(node)
        if is_leaf:
            []
        else:
            val children = node_children(node)
            val n = node_n(node)
            var result = []
            for i in 0..(n + 1):
                val child = children.i
                val child_keys = keys_at_level(child, level, current_level + 1)
                result = list_concat(result, child_keys)
            result

# Level-order traversal (BFS)
fn level_order_traversal(tree):
    val height = tree_height(tree)
    val root = tree_root(tree)
    var result = []
    for level in 0..(height + 1):
        val level_keys = keys_at_level(root, level, 0)
        result = list_concat(result, level_keys)
    result

export *
