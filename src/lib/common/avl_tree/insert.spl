# AVL Tree Insert Operations

use avl_tree.types.{is_nil, get_value, get_left, get_right, set_left, set_right, create_node}
use avl_tree.create.{get_root, get_size, set_root, set_tree_size}
use avl_tree.balance.{rebalance}

# ============================================================================
# Insert Operations
# ============================================================================

# Insert a value into the tree
fn avl_insert(tree, value: i64):
    val root = get_root(tree)
    val new_root = insert_node(root, value)
    var new_tree = set_root(tree, new_root)
    val old_size = get_size(tree)
    set_tree_size(new_tree, old_size + 1)

# Insert into node subtree
fn insert_node(node, value: i64):
    # Base case: create new node
    if is_nil(node):
        return create_node(value)

    val node_value = get_value(node)
    var modified = node

    # Insert into left subtree
    if value < node_value:
        val left = get_left(node)
        val new_left = insert_node(left, value)
        modified = set_left(node, new_left)
    # Insert into right subtree (allow duplicates on right)
    else:
        val right = get_right(node)
        val new_right = insert_node(right, value)
        modified = set_right(node, new_right)

    # Rebalance
    rebalance(modified)
