# Red-Black Tree Traversal Operations
#
# Functions for traversing trees in different orders.

from .types import tree_root, tree_nil
from .types import node_value, node_left, node_right
from .types import is_nil_node

# ============================================================================
# TREE TRAVERSALS
# ============================================================================

# Inorder traversal (sorted order)
fn inorder(tree):
    val root = tree_root(tree)
    val nil_sentinel = tree_nil(tree)
    var result = []
    inorder_helper(root, nil_sentinel, result)

# Inorder helper
fn inorder_helper(node, nil_sentinel, result):
    if is_nil_node(node, nil_sentinel):
        result
    else:
        val left = node_left(node)
        var new_result = inorder_helper(left, nil_sentinel, result)
        val value = node_value(node)
        new_result = new_result + [value]
        val right = node_right(node)
        inorder_helper(right, nil_sentinel, new_result)

# Preorder traversal
fn preorder(tree):
    val root = tree_root(tree)
    val nil_sentinel = tree_nil(tree)
    var result = []
    preorder_helper(root, nil_sentinel, result)

# Preorder helper
fn preorder_helper(node, nil_sentinel, result):
    if is_nil_node(node, nil_sentinel):
        result
    else:
        val value = node_value(node)
        var new_result = result + [value]
        val left = node_left(node)
        new_result = preorder_helper(left, nil_sentinel, new_result)
        val right = node_right(node)
        preorder_helper(right, nil_sentinel, new_result)

# Postorder traversal
fn postorder(tree):
    val root = tree_root(tree)
    val nil_sentinel = tree_nil(tree)
    var result = []
    postorder_helper(root, nil_sentinel, result)

# Postorder helper
fn postorder_helper(node, nil_sentinel, result):
    if is_nil_node(node, nil_sentinel):
        result
    else:
        val left = node_left(node)
        var new_result = postorder_helper(left, nil_sentinel, result)
        val right = node_right(node)
        new_result = postorder_helper(right, nil_sentinel, new_result)
        val value = node_value(node)
        new_result + [value]

# Level-order traversal (breadth-first)
fn level_order(tree):
    val root = tree_root(tree)
    val nil_sentinel = tree_nil(tree)

    if is_nil_node(root, nil_sentinel):
        []
    else:
        var result = []
        var queue = [root]
        level_order_helper(queue, nil_sentinel, result)

# Level-order helper
fn level_order_helper(queue, nil_sentinel, result):
    if queue == []:
        result
    else:
        val node = queue.0
        val rest_queue = queue[1:]
        val value = node_value(node)
        var new_result = result + [value]

        val left = node_left(node)
        var new_queue = rest_queue
        if is_nil_node(left, nil_sentinel) == false:
            new_queue = new_queue + [left]
        else:
            ()

        val right = node_right(node)
        if is_nil_node(right, nil_sentinel) == false:
            new_queue = new_queue + [right]
        else:
            ()

        level_order_helper(new_queue, nil_sentinel, new_result)

# Convert tree to sorted list
fn rb_to_list(tree):
    inorder(tree)
