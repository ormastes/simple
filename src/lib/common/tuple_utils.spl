# Tuple Utilities
#
# Helper functions for working with tuples in Simple.
# Pure Simple implementation - no external dependencies.
#
# Supports tuples of sizes 2-5 (most common use cases).
# Provides accessors, mappers, and transformation functions.
#
# Functions:
# - Pair (2-tuple) operations: fst, snd, swap, map_fst, map_snd
# - Triple (3-tuple) operations: first, second, third, rotate
# - Quad (4-tuple) operations: get_1-4
# - Quint (5-tuple) operations: get_1-5
# - Tuple construction: pair, triple, quad, quint
# - Tuple conversion: from_array, to_array

# ============================================================================
# Pair (2-Tuple) Operations
# ============================================================================

fn pair(a, b):
    """Create a pair (2-tuple).

    Example:
        pair(1, 2)  # (1, 2)
    """
    (a, b)

fn fst(tuple):
    """Get first element of pair.

    Example:
        fst((1, 2))  # 1
    """
    val (a, _) = tuple
    a

fn snd(tuple):
    """Get second element of pair.

    Example:
        snd((1, 2))  # 2
    """
    val (_, b) = tuple
    b

fn swap(tuple):
    """Swap elements of pair.

    Example:
        swap((1, 2))  # (2, 1)
    """
    val (a, b) = tuple
    (b, a)

fn map_fst(tuple, f):
    """Map function over first element of pair.

    Example:
        map_fst((5, "hello"), \\x: x * 2)  # (10, "hello")
    """
    val (a, b) = tuple
    (f(a), b)

fn map_snd(tuple, f):
    """Map function over second element of pair.

    Example:
        map_snd((5, "hello"), \\s: s.upper())  # (5, "HELLO")
    """
    val (a, b) = tuple
    (a, f(b))

fn map_both(tuple, f, g):
    """Map functions over both elements of pair.

    Example:
        map_both((5, 10), \\x: x * 2, \\y: y + 1)  # (10, 11)
    """
    val (a, b) = tuple
    (f(a), g(b))

fn uncurry(f, tuple):
    """Convert curried function application to tuple application.

    Example:
        val add = \\a, b: a + b
        uncurry(add, (2, 3))  # 5
    """
    val (a, b) = tuple
    f(a, b)

fn curry(f):
    """Convert tuple-taking function to curried function.

    Example:
        val tuple_add = \\t: fst(t) + snd(t)
        val curried = curry(tuple_add)
        curried(2, 3)  # 5
    """
    \\a, b: f((a, b))

# ============================================================================
# Triple (3-Tuple) Operations
# ============================================================================

fn triple(a, b, c):
    """Create a triple (3-tuple).

    Example:
        triple(1, 2, 3)  # (1, 2, 3)
    """
    (a, b, c)

fn first(tuple):
    """Get first element of triple.

    Example:
        first((1, 2, 3))  # 1
    """
    val (a, _, _) = tuple
    a

fn second(tuple):
    """Get second element of triple.

    Example:
        second((1, 2, 3))  # 2
    """
    val (_, b, _) = tuple
    b

fn third(tuple):
    """Get third element of triple.

    Example:
        third((1, 2, 3))  # 3
    """
    val (_, _, c) = tuple
    c

fn rotate_left_3(tuple):
    """Rotate triple left: (a,b,c) -> (b,c,a).

    Example:
        rotate_left_3((1, 2, 3))  # (2, 3, 1)
    """
    val (a, b, c) = tuple
    (b, c, a)

fn rotate_right_3(tuple):
    """Rotate triple right: (a,b,c) -> (c,a,b).

    Example:
        rotate_right_3((1, 2, 3))  # (3, 1, 2)
    """
    val (a, b, c) = tuple
    (c, a, b)

fn map_first(tuple, f):
    """Map function over first element of triple.

    Example:
        map_first((5, 10, 15), \\x: x * 2)  # (10, 10, 15)
    """
    val (a, b, c) = tuple
    (f(a), b, c)

fn map_second(tuple, f):
    """Map function over second element of triple.

    Example:
        map_second((5, 10, 15), \\x: x * 2)  # (5, 20, 15)
    """
    val (a, b, c) = tuple
    (a, f(b), c)

fn map_third(tuple, f):
    """Map function over third element of triple.

    Example:
        map_third((5, 10, 15), \\x: x * 2)  # (5, 10, 30)
    """
    val (a, b, c) = tuple
    (a, b, f(c))

# ============================================================================
# Quad (4-Tuple) Operations
# ============================================================================

fn quad(a, b, c, d):
    """Create a quad (4-tuple).

    Example:
        quad(1, 2, 3, 4)  # (1, 2, 3, 4)
    """
    (a, b, c, d)

fn get_1(tuple):
    """Get 1st element of 4-tuple or larger.

    Example:
        get_1((1, 2, 3, 4))  # 1
    """
    val (a, _, _, _) = tuple
    a

fn get_2(tuple):
    """Get 2nd element of 4-tuple or larger.

    Example:
        get_2((1, 2, 3, 4))  # 2
    """
    val (_, b, _, _) = tuple
    b

fn get_3(tuple):
    """Get 3rd element of 4-tuple or larger.

    Example:
        get_3((1, 2, 3, 4))  # 3
    """
    val (_, _, c, _) = tuple
    c

fn get_4(tuple):
    """Get 4th element of 4-tuple or larger.

    Example:
        get_4((1, 2, 3, 4))  # 4
    """
    val (_, _, _, d) = tuple
    d

fn map_at_1(tuple, f):
    """Map function at position 1 of 4-tuple.

    Example:
        map_at_1((5, 10, 15, 20), \\x: x * 2)  # (10, 10, 15, 20)
    """
    val (a, b, c, d) = tuple
    (f(a), b, c, d)

fn map_at_2(tuple, f):
    """Map function at position 2 of 4-tuple.

    Example:
        map_at_2((5, 10, 15, 20), \\x: x * 2)  # (5, 20, 15, 20)
    """
    val (a, b, c, d) = tuple
    (a, f(b), c, d)

fn map_at_3(tuple, f):
    """Map function at position 3 of 4-tuple.

    Example:
        map_at_3((5, 10, 15, 20), \\x: x * 2)  # (5, 10, 30, 20)
    """
    val (a, b, c, d) = tuple
    (a, b, f(c), d)

fn map_at_4(tuple, f):
    """Map function at position 4 of 4-tuple.

    Example:
        map_at_4((5, 10, 15, 20), \\x: x * 2)  # (5, 10, 15, 40)
    """
    val (a, b, c, d) = tuple
    (a, b, c, f(d))

# ============================================================================
# Quint (5-Tuple) Operations
# ============================================================================

fn quint(a, b, c, d, e):
    """Create a quint (5-tuple).

    Example:
        quint(1, 2, 3, 4, 5)  # (1, 2, 3, 4, 5)
    """
    (a, b, c, d, e)

fn get_5(tuple):
    """Get 5th element of 5-tuple.

    Example:
        get_5((1, 2, 3, 4, 5))  # 5
    """
    val (_, _, _, _, e) = tuple
    e

fn map_at_5(tuple, f):
    """Map function at position 5 of 5-tuple.

    Example:
        map_at_5((1, 2, 3, 4, 5), \\x: x * 2)  # (1, 2, 3, 4, 10)
    """
    val (a, b, c, d, e) = tuple
    (a, b, c, d, f(e))

# ============================================================================
# Tuple Construction from Arrays
# ============================================================================

fn pair_from_array(arr):
    """Create pair from array of length 2.

    Returns Some((a, b)) if length is 2, nil otherwise.

    Example:
        pair_from_array([1, 2])  # Some((1, 2))
        pair_from_array([1])     # nil
    """
    if arr.len() == 2:
        Some((arr[0], arr[1]))
    else:
        nil

fn triple_from_array(arr):
    """Create triple from array of length 3.

    Returns Some((a, b, c)) if length is 3, nil otherwise.

    Example:
        triple_from_array([1, 2, 3])  # Some((1, 2, 3))
    """
    if arr.len() == 3:
        Some((arr[0], arr[1], arr[2]))
    else:
        nil

fn quad_from_array(arr):
    """Create quad from array of length 4.

    Returns Some((a, b, c, d)) if length is 4, nil otherwise.
    """
    if arr.len() == 4:
        Some((arr[0], arr[1], arr[2], arr[3]))
    else:
        nil

fn quint_from_array(arr):
    """Create quint from array of length 5.

    Returns Some((a, b, c, d, e)) if length is 5, nil otherwise.
    """
    if arr.len() == 5:
        Some((arr[0], arr[1], arr[2], arr[3], arr[4]))
    else:
        nil

# ============================================================================
# Tuple Conversion to Arrays
# ============================================================================

fn pair_to_array(tuple):
    """Convert pair to array.

    Example:
        pair_to_array((1, 2))  # [1, 2]
    """
    val (a, b) = tuple
    [a, b]

fn triple_to_array(tuple):
    """Convert triple to array.

    Example:
        triple_to_array((1, 2, 3))  # [1, 2, 3]
    """
    val (a, b, c) = tuple
    [a, b, c]

fn quad_to_array(tuple):
    """Convert quad to array.

    Example:
        quad_to_array((1, 2, 3, 4))  # [1, 2, 3, 4]
    """
    val (a, b, c, d) = tuple
    [a, b, c, d]

fn quint_to_array(tuple):
    """Convert quint to array.

    Example:
        quint_to_array((1, 2, 3, 4, 5))  # [1, 2, 3, 4, 5]
    """
    val (a, b, c, d, e) = tuple
    [a, b, c, d, e]

# ============================================================================
# Tuple Comparison
# ============================================================================

fn pair_equals(tuple1, tuple2):
    """Check if two pairs are equal.

    Example:
        pair_equals((1, 2), (1, 2))  # true
        pair_equals((1, 2), (1, 3))  # false
    """
    val (a1, b1) = tuple1
    val (a2, b2) = tuple2
    a1 == a2 and b1 == b2

fn triple_equals(tuple1, tuple2):
    """Check if two triples are equal.

    Example:
        triple_equals((1, 2, 3), (1, 2, 3))  # true
    """
    val (a1, b1, c1) = tuple1
    val (a2, b2, c2) = tuple2
    a1 == a2 and b1 == b2 and c1 == c2

# ============================================================================
# Tuple Utility Functions
# ============================================================================

fn dup(value):
    """Create a pair with the same value twice.

    Example:
        dup(5)  # (5, 5)
    """
    (value, value)

fn triplicate(value):
    """Create a triple with the same value three times.

    Example:
        triplicate(5)  # (5, 5, 5)
    """
    (value, value, value)

fn split_at(arr, index: i64):
    """Split array at index into two parts (tuple of arrays).

    Example:
        split_at([1, 2, 3, 4, 5], 2)  # ([1, 2], [3, 4, 5])
    """
    var left = []
    var right = []

    var i = 0
    while i < index and i < arr.len():
        left.push(arr[i])
        i = i + 1

    while i < arr.len():
        right.push(arr[i])
        i = i + 1

    (left, right)

fn both(predicate, tuple):
    """Check if predicate is true for both elements of pair.

    Example:
        both(\\x: x > 0, (1, 2))  # true
        both(\\x: x > 0, (1, -1))  # false
    """
    val (a, b) = tuple
    predicate(a) and predicate(b)

fn either(predicate, tuple):
    """Check if predicate is true for either element of pair.

    Example:
        either(\\x: x > 0, (1, -1))  # true
        either(\\x: x > 0, (-1, -2))  # false
    """
    val (a, b) = tuple
    predicate(a) or predicate(b)

fn merge(tuple, combiner):
    """Merge pair into single value using combiner function.

    Example:
        merge((2, 3), \\a, b: a + b)  # 5
    """
    val (a, b) = tuple
    combiner(a, b)
