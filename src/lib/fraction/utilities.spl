# Fraction Utility Functions

fn mediant(a: (i64, i64), b: (i64, i64)) -> (i64, i64):
    val num_a = a.0
    val den_a = a.1
    val num_b = b.0
    val den_b = b.1

    return (num_a + num_b, den_a + den_b)

fn continued_fraction(frac: (i64, i64), max_terms: i64) -> text:
    var num = frac.0
    var den = frac.1

    var result = "["
    var term_count = 0

    loop:
        if term_count >= max_terms or den == 0:
            break

        val quotient = num / den
        val remainder = num % den

        if term_count > 0:
            result = "{result}, "

        result = "{result}{i64_to_string(quotient)}"

        num = den
        den = remainder
        term_count = term_count + 1

    result = "{result}]"
    return result

fn farey_sequence(n: i64) -> text:
    if n <= 0:
        return "[]"

    var result = "[0/1"

    var a = 0
    var b = 1
    var c = 1
    var d = n

    loop:
        if c > n:
            break

        val k = (n + b) / d
        val next_a = k * c - a
        val next_b = k * d - b

        result = "{result}, {i64_to_string(c)}/{i64_to_string(d)}"

        a = c
        b = d
        c = next_a
        d = next_b

    result = "{result}]"
    return result

fn sum_array(fractions: text, count: i64) -> (i64, i64):
    # Note: Due to runtime limitations, this is a simplified version
    # In practice, would need to parse the text or use actual arrays
    return (0, 1)

fn min_array(fractions: text, count: i64) -> (i64, i64):
    # Simplified version
    return (0, 1)

fn max_array(fractions: text, count: i64) -> (i64, i64):
    # Simplified version
    return (0, 1)

# Example functions
fn example_basic():
    print "=== Basic Fraction Arithmetic ==="

    val a = from_int(1, 2)  # 1/2
    val b = from_int(1, 3)  # 1/3

    print "a = {to_string(a)}"
    print "b = {to_string(b)}"
    print "a + b = {to_string(add(a, b))}"
    print "a - b = {to_string(subtract(a, b))}"
    print "a * b = {to_string(multiply(a, b))}"
    print "a / b = {to_string(divide(a, b))}"
    print ""

fn example_simplification():
    print "=== Fraction Simplification ==="

    val f1 = from_int(6, 8)
    print "6/8 simplified = {to_string(reduce(f1))}"

    val f2 = from_int(15, 25)
    print "15/25 simplified = {to_string(reduce(f2))}"

    val f3 = from_int(100, 150)
    print "100/150 simplified = {to_string(reduce(f3))}"
    print ""

fn example_mixed():
    print "=== Mixed Numbers ==="

    val f1 = from_int(7, 3)
    print "{to_string(f1)} = {to_mixed(f1)}"

    val f2 = from_int(10, 4)
    print "{to_string(f2)} = {to_mixed(f2)}"

    val f3 = from_int(-11, 5)
    print "{to_string(f3)} = {to_mixed(f3)}"
    print ""

fn example_common():
    print "=== Common Fractions ==="
    print "half = {to_string(half())}"
    print "third = {to_string(third())}"
    print "quarter = {to_string(quarter())}"
    print "two_thirds = {to_string(two_thirds())}"
    print "three_quarters = {to_string(three_quarters())}"
    print ""

fn example_decimal():
    print "=== Decimal Conversions ==="

    val f1 = half()
    print "{to_string(f1)} = {f64_to_string(to_decimal(f1))}"

    val f2 = quarter()
    print "{to_string(f2)} = {to_percentage(f2)}"

    val f3 = three_quarters()
    print "{to_string(f3)} = {to_percentage(f3)}"
    print ""

fn example_comparison():
    print "=== Fraction Comparisons ==="

    val a = from_int(1, 2)
    val b = from_int(2, 3)

    print "{to_string(a)} < {to_string(b)} = {less_than(a, b)}"
    print "{to_string(a)} > {to_string(b)} = {greater_than(a, b)}"
    print "{to_string(a)} == {to_string(b)} = {equal(a, b)}"
    print "compare({to_string(a)}, {to_string(b)}) = {i64_to_string(compare(a, b))}"
    print ""

fn example_properties():
    print "=== Fraction Properties ==="

    val f1 = from_int(1, 2)
    print "{to_string(f1)} is_proper = {is_proper(f1)}"
    print "{to_string(f1)} is_improper = {is_improper(f1)}"

    val f2 = from_int(5, 3)
    print "{to_string(f2)} is_proper = {is_proper(f2)}"
    print "{to_string(f2)} is_improper = {is_improper(f2)}"

    val f3 = from_int(0, 1)
    print "{to_string(f3)} is_zero = {is_zero(f3)}"
    print ""

fn run_examples():
    example_basic()
    example_simplification()
    example_mixed()
    example_common()
    example_decimal()
    example_comparison()
    example_properties()
