# STOMP Utilities Module

# ============================================================================
# Utility Functions
# ============================================================================

# Convert frame to debug string
fn frame_to_debug_string(frame: tuple) -> text:
    val command = get_frame_command(frame)
    val headers = get_frame_headers(frame)
    val body = get_frame_body(frame)

    var result = "STOMP Frame:\n"
    result = result + "  Command: "
    result = result + command
    result = result + "\n"
    result = result + "  Headers:\n"

    var i = 0
    while i < headers.len():
        val header = headers[i]
        val name = header[0]
        val value = header[1]
        result = result + "    "
        result = result + name
        result = result + ": "
        result = result + value
        result = result + "\n"
        i = i + 1

    result = result + "  Body: "
    val body_preview = body.substring(0, 50)
    result = result + body_preview
    if body.len() > 50:
        result = result + "..."
    result = result + "\n"

    return result

# Count frames in buffer
fn count_frames(buffer: text) -> i64:
    var count = 0
    var i = 0
    while i < buffer.len():
        val ch = buffer.substring(i, i + 1)
        if ch == "\0":
            count = count + 1
        i = i + 1
    return count

# Split buffer into individual frames
fn split_frames(buffer: text) -> list:
    var result = []
    var current = ""
    var i = 0

    while i < buffer.len():
        val ch = buffer.substring(i, i + 1)

        if ch == "\0":
            if current != "":
                result.push(current)
                current = ""
        else:
            current = current + ch

        i = i + 1

    return result

# Export all public functions
