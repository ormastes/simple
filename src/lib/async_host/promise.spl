# HostPromise - Write Side of HostFuture
#
# Promise for completing futures with values or errors.

use std.async_core.*
use std.async_host.future.{HostFuture}

class HostPromise<T>:
    """Write-side of a future."""
    future: HostFuture<T>
    completed: bool

    static fn new() -> (HostFuture<T>, HostPromise<T>):
        """Create future-promise pair."""
        val future: HostFuture<T> = HostFuture.pending()
        val promise = HostPromise(future: future, completed: false)
        (future, promise)

    me complete(value: T) -> bool:
        """Complete promise with value."""
        if self.completed:
            return false
        self.completed = true
        self.future.complete(value)
        true

    me fail(err: AsyncError) -> bool:
        """Fail promise with error."""
        if self.completed:
            return false
        self.completed = true
        self.future.fail(err)
        true

    fn is_completed() -> bool:
        self.completed


export HostPromise
