# Waker - Task Wake Notification
#
# Wakers notify the scheduler when a task is ready to make progress.

struct Waker:
    """Waker for notifying scheduler when task is ready.

    Unlike embedded (polling), host runtime uses wakers for efficiency.
    """
    task_id: usize
    scheduler_ref: usize  # Reference to scheduler (opaque)
    wake_count: usize

    static fn new(task_id: usize, scheduler_ref: usize) -> Waker:
        Waker(task_id: task_id, scheduler_ref: scheduler_ref, wake_count: 0)

    me wake():
        """Wake the associated task."""
        self.wake_count = self.wake_count + 1
        # Signal scheduler via FFI
        waker_signal(self.scheduler_ref, self.task_id)

    me wake_by_ref():
        """Wake without consuming waker."""
        self.wake()

    fn will_wake(other: Waker) -> bool:
        """Check if two wakers wake same task."""
        self.task_id == other.task_id

# ============================================================================
# Context - Polling Context
# ============================================================================

struct Context:
    """Context passed to Future.poll().

    Contains waker for signaling readiness.
    """
    waker: Waker

    static fn from_waker(w: Waker) -> Context:
        Context(waker: w)

    fn waker() -> Waker:
        self.waker


export Waker, Context
