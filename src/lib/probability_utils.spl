# Probability Utilities Module
#
# Simple probability calculations and statistical functions.
#
# Categories:
# - Collision probability (birthday paradox)
# - Basic probability math
#
# All operations use pure Simple implementations (no FFI required).

# ============================================================================
# Exports
# ============================================================================

export collision_probability

# ============================================================================
# Collision Probability (Birthday Paradox)
# ============================================================================

fn collision_probability(n: i64) -> f64:
    """Calculate probability of hash collision for n items.

    Uses the birthday paradox formula for estimating collision probability
    in a 64-bit hash space.

    Args:
        n: Number of items to hash

    Returns:
        Probability of at least one collision (0.0 to 1.0)

    Example:
        collision_probability(10)    # Very low: ~0.00000...
        collision_probability(1000)  # Still low: ~0.000027
        collision_probability(10000) # Higher: ~0.0027
    """
    if n <= 0:
        return 0.0
    if n == 1:
        return 0.0

    # Birthday paradox formula: P(collision) ≈ 1 - e^(-n²/2m)
    # where m is the hash space size (2^64 for i64)
    #
    # For 64-bit hashes: m = 2^64 ≈ 1.844 × 10^19
    # Simplified: P ≈ n² / (2 * 2^64) for small n

    val n_f64 = n as f64
    val hash_space = 18446744073709551616.0  # 2^64

    # Calculate n * (n-1) / (2 * hash_space)
    # This is the exact birthday paradox formula for hash collisions
    val numerator = n_f64 * (n_f64 - 1.0)
    val denominator = 2.0 * hash_space

    numerator / denominator
