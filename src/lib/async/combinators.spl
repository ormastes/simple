# Async Combinators
#
# Helper functions for working with futures and tasks.

use std.async.future.{Future}
use std.async.task.{Task}
use std.async.ffi.{async_join, async_select}

fn spawn<T>(f: fn() -> Future<T>) -> Task:
    """Convenience function to spawn task.

    Args:
        f: Async function

    Returns:
        Task
    """
    Task.new(f)

fn join<T>(futures: [Future<T>]) -> Future<[T]>:
    """Wait for all futures to complete.

    Args:
        futures: Futures to wait for

    Returns:
        Future with all results
    """
    val state = async_join(futures.map(\f: f.state))
    Future(state: state)

fn select<T>(futures: [Future<T>]) -> Future<T>:
    """Wait for first future to complete.

    Args:
        futures: Futures to race

    Returns:
        Future with first result
    """
    val state = async_select(futures.map(\f: f.state))
    Future(state: state)

export spawn, join, select
